"use strict";(self["webpackChunkramp_website"]=self["webpackChunkramp_website"]||[]).push([[8253],{8253:function(e,t,i){i.d(t,{I:function(){return Bt},M:function(){return zt},S:function(){return Ft},T:function(){return $e},V:function(){return Et},a:function(){return h},b:function(){return ii},c:function(){return qt},d:function(){return At},e:function(){return Je},f:function(){return Ct},g:function(){return Tt},h:function(){return Vt},i:function(){return y},j:function(){return pt},k:function(){return Zt},l:function(){return d},m:function(){return It},n:function(){return Pt},o:function(){return g},p:function(){return Ye},t:function(){return m},u:function(){return jt},v:function(){return Nt},w:function(){return Ze},x:function(){return St},y:function(){return Gt}});var s=i(81298),o=i(44444),a=i(66080),r=i(56499),n=i(54396),l=i(57177),u=i(31061),c=i(38006);class p{get forceStaticPath(){return"disabled"===(0,o.Q)("esri-cim-animations-enable-status")}get forceAnimatedPath(){return"forced"===(0,o.Q)("esri-cim-animations-enable-status")}get freezeGlobalTime(){return(0,o.Q)("esri-cim-animations-freeze-time")??!1}get spotlightAnimatedSymbols(){return!!(0,o.Q)("esri-cim-animations-spotlight")}get forceGlobalTimeOrigin(){return!1!==(0,o.Q)("esri-cim-animations-freeze-time")}}const d=new p;function f(e){return e.locationsMap}const h={color:{write:[!0,!0,!0,!0],blendMode:"composite"},depth:!1,stencil:!1};let m=class{constructor(){this.drawPhase=o.aK.MAP|o.aK.HITTEST|o.aK.HIGHLIGHT|o.aK.DEBUG}startup(){}shutdown(e){}};const b={[o.aC.BYTE]:1,[o.aC.UNSIGNED_BYTE]:1,[o.aC.SHORT]:2,[o.aC.UNSIGNED_SHORT]:2,[o.aC.HALF_FLOAT]:2,[o.aC.INT]:4,[o.aC.UNSIGNED_INT]:4,[o.aC.FLOAT]:4};let y=class{constructor(e,t){this._boundPart=null,this.vertexBuffers=new Map;for(const[s,r]of Object.entries(t.vertex)){const t=a.E.createVertex(e,o.az.STATIC_DRAW,r);this.vertexBuffers.set(s,t)}const i=new Map;for(const[s,r]of Object.entries(t.index??{})){const t=a.E.createIndex(e,o.az.STATIC_DRAW,r);i.set(s,t)}this.groups=[];for(const s of t.groups){let a;if(null!=s.index){if(!t.index?.[s.index])throw new Error("No index data.");const{BYTES_PER_ELEMENT:e}=t.index[s.index];2===e?a=o.aC.UNSIGNED_SHORT:4===e&&(a=o.aC.UNSIGNED_INT)}const l=null!=s.index?i.get(s.index):null,u=new Map,c=new Map;for(const e of s.attributes){const{name:t,count:i,type:s,offset:o,normalized:a,divisor:r,stride:l,vertex:p,location:d}=e;let f=c.get(p);f||(f=[],c.set(p,f));const h=new n.t(t,i,s,o,l,a,r);f.push(h),u.set(t,d)}const p=new r.o(e,u,c,this.vertexBuffers,l);this.groups.push({...s,vertexArray:p,locations:u,layout:c,indexing:a})}this.parts=t.parts}bind(e,t){this._boundPart=t;const{group:i}=this.parts[this._boundPart],{vertexArray:s}=this.groups[i];e.bindVAO(s)}draw(e){if(null==this._boundPart)throw new Error("Mesh.bind() has not been called.");const{start:t,count:i}=this.parts[this._boundPart],{group:s}=this.parts[this._boundPart],{indexing:o,primitive:a}=this.groups[s];o?e.drawElements(a,i,o,t*b[o]):e.drawArrays(a,t,i)}unbind(e){this._boundPart=null,e.bindVAO(null)}destroy(){for(const{vertexArray:e}of this.groups)e.dispose()}};const x={position:{type:o.aC.SHORT,count:2}};let g=class e extends y{static create(t,i,s){const o=[];let{stride:a}=i;if(null==a){a=0;for(const[e,{count:t,type:s,offset:o}]of Object.entries(i.layout)){if(null!=o)throw new Error("Stride cannot be computed automatically when attribute offsets are supplied explicitly.");a+=t*b[s]}}let r=0;for(const[e,{count:p,offset:d,type:f,normalized:h}]of Object.entries(i.layout)){null!=d&&(r=d);const t=s.get(e);if(null==t)throw new Error("Locations must be specified at mesh initialization.");const i={name:e,location:t,vertex:"vertexData",count:p,type:f,offset:r,stride:a,divisor:0,normalized:null!=h&&h};o.push(i),r+=p*b[f]}const n={attributes:o,primitive:i.primitive};null!=i.index&&(n.index="indexData");let{count:l}=i;if(null==l&&(l=i.index?i.index.length:i.vertex.byteLength/a,Math.floor(l)!==l))throw new Error(`The byte length of vertex data must be an exact multiple of the stride, which is ${a}.`);const u={start:0,count:l,group:0,primitive:i.primitive},c={vertex:{vertexData:i.vertex},parts:[u],groups:[n]};return null!=i.index&&(c.index={indexData:i.index}),new e(t,c,i.layout)}static fromVertexStream(t,i){return e.create(t,{primitive:o.hW.TRIANGLE_STRIP,vertex:new Uint16Array(i),layout:x},new Map([["position",0]]))}constructor(e,t,i){super(e,t),this._spec=i}bind(e,t=0){super.bind(e,t)}},v=class extends s.P{};(0,o.bt)([(0,s.g)(s.j)],v.prototype,"globalTime",void 0),(0,o.bt)([(0,s.g)(s.C)],v.prototype,"animationTextureSize",void 0),(0,o.bt)([(0,s.g)(s.S)],v.prototype,"animationTexture",void 0),(0,o.bt)([(0,s.g)(s.a)],v.prototype,"toScreen",void 0),(0,o.bt)([(0,s.g)(s.a)],v.prototype,"toNdc",void 0),(0,o.bt)([(0,s.g)(s.j)],v.prototype,"mapRotation",void 0),(0,o.bt)([(0,s.g)(s.j)],v.prototype,"pixelRatio",void 0);let w=class extends s.P{getVVRotationMat4(e){return(0,s.x)((0,s.aD)(e),s.aC.identity(),(()=>{const t=this.getNormalizedAngle(e).multiply(s.aF),i=(0,s.$)(t),o=(0,s._)(t);return new s.aC(o,i,0,0,i.multiply(new s.j(-1)),o,0,0,0,0,1,0,0,0,0,1)}))}getVVRotationMat3(e){return(0,s.x)((0,s.aD)(e),s.a.identity(),(()=>{const t=this.getNormalizedAngle(e).multiply(s.aF),i=(0,s.$)(t),o=(0,s._)(t);return new s.a(o,i,0,i.multiply(new s.j(-1)),o,0,0,0,1)}))}getNormalizedAngle(e){const t=(0,s.U)(this.rotationType,new s.j(s.aE.Arithmatic));return(0,s.x)(t,new s.j(90).subtract(e),e)}};(0,o.bt)([(0,s.g)(s.j)],w.prototype,"rotationType",void 0);class S extends s.aH{}(0,o.bt)([(0,s.h)(3,s.H)],S.prototype,"animationPointerAndBaseSizeAndReferenceSize",void 0),(0,o.bt)([(0,s.h)(4,s.C)],S.prototype,"zoomRange",void 0);class V extends s.aV{}class z extends s.aI{_getScreenPosition(e){const{pos:t,translation:i,rotation:o,scale:a,offset:r,id:n,vvScale:l}=e,u=(0,s.aJ)(this,n).multiply(Math.PI/180),c=i.x.multiply(4/3),p=i.y.multiply(-1).multiply(4/3),d=(0,s.$)(o.subtract(u)),f=(0,s._)(o.subtract(u)),h=new s.j(0),m=new s.j(1),{pixelRatio:b}=this.animationInfo,y=new s.a(m,h,h,h,m,h,c.multiply(b),p.multiply(b),m),x=new s.a(f,d.multiply(-1),h,d,f,h,0,0,m),g=a.multiply(l).multiply(b).multiply(4/3),v=x.multiply(g),w=this.animationInfo.toScreen.multiply(new s.G(t,1)),S=y.multiply(w).xy,V=v.multiply(new s.G(r,0)).xy;return S.add(V)}_clip(e,t){let i=super.clip(e,t);const o=(0,s.J)(this._getLocalTimeOrigin(e),new s.j(0));return d.forceGlobalTimeOrigin||(i=i.add((0,s.F)([o,()=>new s.j(2)],[!0,()=>new s.j(0)]))),i}_getLocalTimeOrigin(e){return this.storage.getLocalTimeOrigin(e)}_toNdc(e){return this.animationInfo.toNdc.multiply(new s.G(e,1)).xy}_getEvalParams(e,t){const{globalTime:i,animationTextureSize:s,animationTexture:o}=this.animationInfo;return{globalTime:i,localTimeOrigin:this._getLocalTimeOrigin(e.id),animationTextureSize:s,animationTexture:o,pixelDimensions:t}}_getColor(e,t){return(0,s.x)((0,s.U)(t.isSDF,new s.j(1)),this._getSDFColor(e,t),this._getSpriteColor(e,t))}_getSpriteColor(e,t){return(0,s.l)(this.mosaicInfo.texture,e).multiply(t.color)}_getSDFColor(e,t){const i=(0,s.l)(this.mosaicInfo.texture,e),o=new s.j(.5).subtract((0,s.aK)(i)).multiply(t.distanceToPx).multiply(s.aL),a=(0,s.y)(new s.j(.5).subtract(o),new s.j(0),new s.j(1)),r=t.color.multiply(a),n=t.outlineSize.multiply(.5),l=(0,s.Y)(o).subtract(n),u=(0,s.y)(new s.j(.5).subtract(l),new s.j(0),new s.j(1)),c=t.outlineColor.multiply(u);return new s.j(1).subtract(c.a).multiply(r).add(c)}}function _(e,t,i){const o=e.add(new s.C(t,0)),a=(0,s.l)(i.animationTexture,o.add(.5).divide(i.animationTextureSize)).xy;return e=e.add(a),(0,s.aM)({animationPointer:e,...i},s.H,null,(e=>{const{out:t}=e;if(!t)throw new Error("out is null");return(0,s.aN)({...e,out:t})}))}var C;(0,o.bt)([(0,s.g)(s.aO)],z.prototype,"mosaicInfo",void 0),(0,o.bt)([(0,s.g)(v)],z.prototype,"animationInfo",void 0),(0,o.bt)([(0,s.aG)(s.aP)],z.prototype,"visualVariableColor",void 0),(0,o.bt)([(0,s.aG)(s.aQ)],z.prototype,"visualVariableOpacity",void 0),(0,o.bt)([(0,s.aG)(s.aR)],z.prototype,"visualVariableSizeMinMaxValue",void 0),(0,o.bt)([(0,s.aG)(s.aS)],z.prototype,"visualVariableSizeScaleStops",void 0),(0,o.bt)([(0,s.aG)(s.aT)],z.prototype,"visualVariableSizeStops",void 0),(0,o.bt)([(0,s.aG)(s.aU)],z.prototype,"visualVariableSizeUnitValue",void 0),(0,o.bt)([(0,s.aG)(w)],z.prototype,"visualVariableRotation",void 0),function(e){e[e.transform=0]="transform",e[e.fromColor=1]="fromColor",e[e.toColor=2]="toColor",e[e.colorMix=3]="colorMix",e[e.toOpacity=4]="toOpacity",e[e.opacityMix=5]="opacityMix"}(C||(C={}));let T=class extends S{};(0,o.bt)([(0,s.h)(5,s.C)],T.prototype,"offset",void 0),(0,o.bt)([(0,s.h)(6,s.C)],T.prototype,"uv",void 0),(0,o.bt)([(0,s.h)(7,s.H)],T.prototype,"sizing",void 0),(0,o.bt)([(0,s.h)(8,s.j)],T.prototype,"angle",void 0);class P extends s.aW{}(0,o.bt)([(0,s.h)(12,s.C)],P.prototype,"offsetNextVertex1",void 0),(0,o.bt)([(0,s.h)(13,s.C)],P.prototype,"offsetNextVertex2",void 0),(0,o.bt)([(0,s.h)(14,s.C)],P.prototype,"textureUVNextVertex1",void 0),(0,o.bt)([(0,s.h)(15,s.C)],P.prototype,"textureUVNextVertex2",void 0);class M extends V{}function A(e,t,i,s){return t.multiply(e.x).add(i.multiply(e.y)).add(s.multiply(e.z))}let R=class extends z{constructor(){super(...arguments),this.computeAttributes={offset:["offsetNextVertex1","offsetNextVertex2"],uv:["textureUVNextVertex1","textureUVNextVertex2"]}}_vertexPreamble(e){const{id:t,pos:i,offset:o,animationPointerAndBaseSizeAndReferenceSize:a,uv:r,sizing:n,angle:l}=e,u=a.xy,c=a.z,p=a.w,d=n.xy,f=n.z,h=(0,s.aX)(e.bitset,s.o.bitset.isStroke),m=n.w,b=(0,s.aX)(e.bitset,s.o.bitset.scaleSymbolsProportionally),y=this._getEvalParams(e,d),x=_(u,C.transform,y),g=(0,s.F)([(0,s.U)((0,s.aX)(e.bitset,s.o.bitset.isMapAligned),new s.j(1)),this.view.rotation.divide(180).multiply(Math.PI)],[!0,new s.j(0)]),v=new s.aY((0,s._)(g),(0,s.$)(g.multiply(-1)),(0,s.$)(g),(0,s._)(g)).multiply(x.xy),w=x.z.subtract(g).subtract(l.multiply(s.n)),S=x.w,V=(0,s.aX)(e.bitset,s.o.bitset.isSDF),z=(0,s.aZ)(this,t,new s.j(p)).divide(new s.j(p));return{baseSize:c,animationPointer:u,strokeWidth:f,isOutline:h,unscaledDistanceToPx:m,scaleSymbolsProportionally:b,isSDF:V,position:this._getScreenPosition({id:t,pos:i,offset:o,referenceSize:p,translation:v,rotation:w,scale:S,vvScale:z}),uv:r,evalParams:y,vvScale:z,scale:S}}vertex(e,t){const{position:i,animationPointer:o,evalParams:a,isOutline:r,unscaledDistanceToPx:n,vvScale:l,uv:u,strokeWidth:c,scaleSymbolsProportionally:p,scale:d,isSDF:f,baseSize:h}=this._vertexPreamble(e),m=this._toNdc(i);let b=_(o,C.fromColor,a);b=new s.H(b.rgb.multiply(b.a),b.a);let y=_(o,C.toColor,a);y=new s.H(y.rgb.multiply(y.a),y.a);let x=_(o,C.colorMix,a);x=new s.H(x.rgb.multiply(x.a),x.a);const g=_(o,C.toOpacity,a).a,v=_(o,C.opacityMix,a).a,w=(0,s.a_)(this,e.id,b,(0,s.a$)((0,s.b1)(e.bitset,s.o.bitset.colorLocked),new s.b0(r))),S=(0,s.a6)(w,y,x),V=(0,s.b2)(this,e.id),z=(0,s.a6)(V,g,v),T=S.multiply(z),P=this.clip(e.id,e.zoomRange),M=n.multiply(l);return{glPosition:new s.H(m,P,1),uv:u.divide(this.mosaicInfo.size),color:T.multiply(new s.j(1).subtract(r)),outlineColor:T.multiply(r),distanceToPx:M,strokeWidth:c.multiply((0,s.a6)(new s.j(1),d,p)),isOutline:r,isSDF:f,...this.maybeRunHittest(e,t,{pos:e.pos,size:h,sizeCorrection:new s.j(1),isMapAligned:new s.j(1),vvRotationMat3:new s.a(1,0,0,0,1,0,0,0,1),placementMat3:new s.a(1,0,0,0,1,0,0,0,1),outlineSize:new s.j(1),distanceToPx:M,isSDF:f})}}fragment(e){let t=this._getColor(e.uv,{color:e.color,distanceToPx:e.distanceToPx,isSDF:e.isSDF,outlineColor:e.outlineColor,outlineSize:e.strokeWidth});return d.spotlightAnimatedSymbols&&(t=t.add(new s.H(0,.3,0,.3))),this.getFragmentOutput(t,e)}hittest(e,t,i){return(0,s.x)((0,s.Q)(i.size,this.hittestRequest.smallSymbolSizeThreshold),this._hittestSmallMarker(e,t,i),this._hittestMarker(e,t,i))}_hittestSmallMarker(e,t,i){const{position:o,distance:a,smallSymbolDistance:r}=this.hittestRequest,n=a.subtract(r),{viewMat3:l,tileMat3:u}=this.view,c=l.multiply(u).multiply(new s.G(i.pos,1)).xy,p=i.size.multiply(.5);return(0,s.b3)(c,o).subtract(p).add(n)}_hittestMarker(e,t,i){const o=this._vertexPreamble({...e}).position,a=this._vertexPreamble({...e,offset:t.offsetNextVertex1,uv:t.textureUVNextVertex1}).position,r=this._vertexPreamble({...e,offset:t.offsetNextVertex2,uv:t.textureUVNextVertex2}).position,n=this.hittestRequest.position,l=this.hittestRequest.distance,u=(0,s.b4)(n,o,a,r);return(0,s.x)((0,s.N)(u,l),u,this._hittestSamples(o,a,r,e,t,i))}_hittestSamples(e,t,i,o,a,r){const{outlineSize:n,isSDF:l,distanceToPx:u}=r,c=this.hittestRequest.position,p=this.hittestRequest.distance,d=(0,s.b5)(c.add(new s.C((0,s.b6)(p),(0,s.b6)(p))),e,t,i),f=(0,s.b5)(c.add(new s.C(0,(0,s.b6)(p))),e,t,i),h=(0,s.b5)(c.add(new s.C(p,(0,s.b6)(p))),e,t,i),m=(0,s.b5)(c.add(new s.C((0,s.b6)(p),0)),e,t,i),b=(0,s.b5)(c,e,t,i),y=(0,s.b5)(c.add(new s.C(p,0)),e,t,i),x=(0,s.b5)(c.add(new s.C((0,s.b6)(p),p)),e,t,i),g=(0,s.b5)(c.add(new s.C(0,p)),e,t,i),v=(0,s.b5)(c.add(new s.C(p,p)),e,t,i),w=o.uv.divide(this.mosaicInfo.size),S=a.textureUVNextVertex1.divide(this.mosaicInfo.size),V=a.textureUVNextVertex2.divide(this.mosaicInfo.size),z={color:new s.H(1,1,1,1),outlineSize:n,outlineColor:new s.H(1,1,1,1),isSDF:l,distanceToPx:u};let _=new s.j(0);return _=_.add((0,s.b7)(d).multiply(this._getColor(A(d,w,S,V),z).a)),_=_.add((0,s.b7)(f).multiply(this._getColor(A(f,w,S,V),z).a)),_=_.add((0,s.b7)(h).multiply(this._getColor(A(h,w,S,V),z).a)),_=_.add((0,s.b7)(m).multiply(this._getColor(A(m,w,S,V),z).a)),_=_.add((0,s.b7)(b).multiply(this._getColor(A(b,w,S,V),z).a)),_=_.add((0,s.b7)(y).multiply(this._getColor(A(y,w,S,V),z).a)),_=_.add((0,s.b7)(x).multiply(this._getColor(A(x,w,S,V),z).a)),_=_.add((0,s.b7)(g).multiply(this._getColor(A(g,w,S,V),z).a)),_=_.add((0,s.b7)(v).multiply(this._getColor(A(v,w,S,V),z).a)),(0,s.E)(_,new s.j(.05)).multiply((0,s.b8)(this.hittestRequest))}};(0,o.bt)([(0,o.ic)(0,(0,s.m)(T)),(0,o.ic)(1,(0,s.m)(P))],R.prototype,"vertex",null),(0,o.bt)([(0,o.ic)(0,(0,s.m)(M))],R.prototype,"fragment",null);let j=class extends m{constructor(){super(...arguments),this.symbologyPlane=o.qM.FILL,this._input=null}},I=class extends j{render(e,t){const{context:i,painter:s}=e,{target:a}=t,{freezeGlobalTime:r}=d,n=0,l=s.textureManager.animationStore.getTexture(i,n),u=[2/e.state.size[0],0,0,0,-2/e.state.size[1],0,-1,1,1],c=Array.from((0,o.o2)((0,o.gH)(),u)),p=Array.from((0,o.gF)((0,o.gH)(),c,a.transforms.displayViewScreenMat3)),f=t.instance.getInput();s.setShader({shader:this.shaders.geometry,uniforms:{...(0,o.sd)(e,t.target,f.uniforms),...(0,o.se)(e,t.target),mosaicInfo:s.textureManager.getMosaicInfo(i,t.textureKey,!0),animationInfo:{globalTime:!1===r?e.time/1e3:r,animationTextureSize:[l.descriptor.width,l.descriptor.height],animationTexture:{unit:6,texture:l},toScreen:p,toNdc:u,mapRotation:e.state.rotation,pixelRatio:e.state.pixelRatio}},defines:{...(0,o.sf)(e)},optionalAttributes:{zoomRange:!0},useComputeBuffer:!0}),s.setPipelineState({...(0,o.sg)(e)}),s.submitDraw(e,t),!1===r&&a.requestRender()}},O=class extends I{constructor(){super(...arguments),this.type=s.e.AnimatedMarker,this.shaders={geometry:new R}}},F=class extends s.I{};(0,o.bt)([(0,s.h)(0,s.C)],F.prototype,"pos",void 0);let D=class extends s.aV{};class E extends s.P{}(0,o.bt)([(0,s.g)(s.j)],E.prototype,"dotSize",void 0);let L=class extends s.P{};(0,o.bt)([(0,s.g)(s.S)],L.prototype,"locations",void 0),(0,o.bt)([(0,s.g)(s.j)],L.prototype,"pixelRatio",void 0),(0,o.bt)([(0,s.g)(s.j)],L.prototype,"tileZoomFactor",void 0);const H=1e-6;class N extends s.b{vertex(e){const t=new s.a(1,0,0,0,-1,0,0,1,1).multiply(new s.G(e.pos.xy.divide(o.ls),1)),i=(0,s.l)(this.draw.locations,t.xy),a=(0,s.A)(this.instance.dotSize.divide(2),new s.j(1));let r=new s.j(0);r=r.add((0,s.E)(i.a,new s.j(H)).multiply(2));let n=a.add(this.instance.dotSize);const l=this.view.displayViewScreenMat3.multiply(new s.G(e.pos.add(.5),1)),u=new s.H(l.xy,r,1),c=this.instance.dotSize.divide(n),p=new s.j(-1).divide(a.divide(n));return n=n.multiply(this.draw.pixelRatio.multiply(this.draw.tileZoomFactor)),{glPosition:u,glPointSize:n,color:i,ratio:c,invEdgeRatio:p}}fragment(e){const t=(0,s.X)(e.glPointCoord.subtract(.5)).multiply(2),i=(0,s.a1)(new s.j(0),new s.j(1),e.invEdgeRatio.multiply(t.subtract(e.ratio)).add(1)),o=new s.w;return o.glFragColor=e.color.multiply(i),o}}(0,o.bt)([(0,s.g)(E)],N.prototype,"instance",void 0),(0,o.bt)([(0,s.g)(L)],N.prototype,"draw",void 0),(0,o.bt)([(0,s.g)(s.b9)],N.prototype,"view",void 0),(0,o.bt)([(0,o.ic)(0,(0,s.m)(F))],N.prototype,"vertex",null),(0,o.bt)([(0,o.ic)(0,(0,s.m)(D))],N.prototype,"fragment",null);class G extends s.aH{}(0,o.bt)([(0,s.h)(3,s.j)],G.prototype,"inverseArea",void 0);let k=class extends s.P{};(0,o.bt)([(0,s.g)(s.ba.ofType(s.H,2))],k.prototype,"isActive",void 0),(0,o.bt)([(0,s.g)(s.ba.ofType(s.H,8))],k.prototype,"colors",void 0),(0,o.bt)([(0,s.g)(s.j)],k.prototype,"dotValue",void 0);let B=class extends s.P{};(0,o.bt)([(0,s.g)(s.S)],B.prototype,"dotTexture0",void 0),(0,o.bt)([(0,s.g)(s.S)],B.prototype,"dotTexture1",void 0),(0,o.bt)([(0,s.g)(s.j)],B.prototype,"tileZoomFactor",void 0),(0,o.bt)([(0,s.g)(s.j)],B.prototype,"pixelRatio",void 0),(0,o.bt)([(0,s.g)(s.j)],B.prototype,"tileDotsOverArea",void 0);let q=class extends s.aI{_dotThreshold(e,t,i){return e.divide(t).divide(i)}vertex(e){const t=new s.a(2/o.ls,0,0,0,-2/o.ls,0,-1,1,1).multiply(new s.G(e.pos,1)),i=this.clip(e.id),a=new s.H(t.xy,i,1),r=this.storage.getVVData(e.id).multiply(this.instance.isActive.get(0)).multiply(e.inverseArea),n=this.storage.getDataDrivenData0(e.id).multiply(this.instance.isActive.get(1)).multiply(e.inverseArea),l=this.draw.tileZoomFactor.multiply(o.ls).divide(this.draw.pixelRatio),u=this._dotThreshold(r,this.instance.dotValue,this.draw.tileDotsOverArea),c=this._dotThreshold(n,this.instance.dotValue,this.draw.tileDotsOverArea),p=e.pos.add(.5).divide(l);return{glPosition:a,color:new s.H(0,0,0,0),textureCoords:p,thresholds0:u,thresholds1:c}}fragment(e){const t=new s.w,i=(0,s.l)(this.draw.dotTexture0,e.textureCoords),o=(0,s.l)(this.draw.dotTexture1,e.textureCoords),a=e.thresholds0.subtract(i),r=e.thresholds1.subtract(o);let n;const l=s.aC.fromColumns(this.instance.colors[0],this.instance.colors[1],this.instance.colors[2],this.instance.colors[3]),u=s.aC.fromColumns(this.instance.colors[4],this.instance.colors[5],this.instance.colors[6],this.instance.colors[7]);if(this.blending){const e=(0,s.E)(new s.j(0),a),t=(0,s.E)(new s.j(0),r),i=(0,s.c)(e,a).add((0,s.c)(t,r)),o=(0,s.E)(i,new s.j(0)),c=new s.j(1).subtract(o),p=i.add(o),d=a.multiply(e).divide(p),f=r.multiply(t).divide(p),h=l.multiply(d).add(u.multiply(f));n=c.multiply(h)}else{const e=(0,s.A)((0,s.bb)(a),(0,s.bb)(r)),t=(0,s.E)(e,new s.j(0)),i=new s.j(1).subtract(t),o=(0,s.E)(e,a),c=(0,s.E)(e,r),p=l.multiply(o).add(u.multiply(c));n=i.multiply(p)}return t.glFragColor=n,t}hittest(e){return(0,s.b8)(this.hittestRequest)}};(0,o.bt)([s.K],q.prototype,"blending",void 0),(0,o.bt)([(0,s.g)(k)],q.prototype,"instance",void 0),(0,o.bt)([(0,s.g)(B)],q.prototype,"draw",void 0),(0,o.bt)([(0,o.ic)(0,(0,s.m)(G))],q.prototype,"vertex",null),(0,o.bt)([(0,o.ic)(0,(0,s.m)(s.aV))],q.prototype,"fragment",null);const U={pos:{count:2,type:o.aC.UNSIGNED_SHORT}};let K=class{constructor(){this._dotTextureSize=0,this._dotTextures=null,this._dotMesh=null}destroy(){this._disposeTextures(),this._dotFBO&&this._dotFBO.dispose(),this._dotMesh&&this._dotMesh.destroy()}getFBO(e){if(null==this._dotFBO){const t=o.ls,i=o.ls,s=new o.ct(t,i);s.samplingMode=o.cw.NEAREST,s.wrapMode=o.cx.CLAMP_TO_EDGE;const a=new l.s(e,new l.i(o.ln.DEPTH_STENCIL,t,i));this._dotFBO=new l.x(e,s,a)}return this._dotFBO}getDotDensityMesh(e,t){if(null==this._dotMesh){const i=o.ls,s=i*i,a=2,r=new Int16Array(s*a);for(let e=0;e<i;e++)for(let t=0;t<i;t++)r[a*(t+e*i)]=t,r[a*(t+e*i)+1]=e;this._dotMesh=g.create(e,{primitive:o.hW.POINTS,vertex:r,count:s,layout:U},t)}return this._dotMesh}getDotDensityTextures(e,t,i){if(this._dotTextureSize===t&&this._seed===i||(this._disposeTextures(),this._dotTextureSize=t,this._seed=i),null===this._dotTextures){const s=new o.mj(i);this._dotTextures=[this._allocDotDensityTexture(e,t,s),this._allocDotDensityTexture(e,t,s)]}return this._dotTextures}_disposeTextures(){if(this._dotTextures){for(let e=0;e<this._dotTextures.length;e++)this._dotTextures[e].dispose();this._dotTextures=null}}_allocDotDensityTexture(e,t,i){const s=new Float32Array(t*t*4);for(let o=0;o<s.length;o++)s[o]=i.getFloat();const a=new o.ct;return a.dataType=o.cv.FLOAT,a.samplingMode=o.cw.NEAREST,a.width=t,a.height=t,new o.cy(e,a,s)}},X=class extends j{constructor(){super(...arguments),this.type=s.e.DotDensity,this.shaders={polygon:new q,point:new N,fill:new s.bc},this._resources=new Map}render(e,t){(0,o.sh)(e)||(0,o.qN)(e)?this._renderPolygons(e,t):this._renderDotDensity(e,t)}_renderPolygons(e,t){const{painter:i}=e;i.setShader({shader:this.shaders.fill,uniforms:{...(0,o.se)(e,t.target),visualVariableColor:null,visualVariableOpacity:null},defines:{...(0,o.sf)(e)},optionalAttributes:{zoomRange:!1},useComputeBuffer:(0,o.qN)(e)}),i.setPipelineState((0,o.sg)(e)),i.submitDraw(e,t)}_renderDotDensity(e,t){const{context:i,painter:s,requiredLevel:a}=e,r=t.instance.getInput().uniforms,n=this._getOrCreateResourcesRecord(i),l=n.getDotDensityTextures(i,o.ls,r.seed),u=1/2**(a-t.target.key.level),c=o.ls,p=c*window.devicePixelRatio*c*window.devicePixelRatio,d=1/u*(1/u),h=r.dotScale?e.state.scale/r.dotScale:1,m=r.dotValue*h*d;s.setShader({shader:this.shaders.polygon,uniforms:{...(0,o.se)(e,t.target),instance:{isActive:r.isActive,colors:r.colors,dotValue:Math.max(1,m)},draw:{dotTexture0:{unit:o.si,texture:l[0]},dotTexture1:{unit:o.sj,texture:l[1]},tileZoomFactor:u,pixelRatio:window.devicePixelRatio,tileDotsOverArea:p/(o.ls*window.devicePixelRatio*o.ls*window.devicePixelRatio)}},defines:{...(0,o.sf)(e),blending:r.blending},optionalAttributes:{},useComputeBuffer:!1});const b=i.getViewport();i.setViewport(0,0,o.ls,o.ls);const y=i.getBoundFramebufferObject(),x=n.getFBO(i);i.bindFramebuffer(x),i.setClearColor(0,0,0,0),i.clear(o.h_.COLOR),s.setPipelineState({color:{write:[!0,!0,!0,!0],blendMode:"composite"},depth:!1,stencil:!1}),s.updatePipelineState(i),s.submitDraw(e,t),i.bindFramebuffer(y),i.setViewport(b.x,b.y,b.width,b.height);const g=n.getFBO(i).colorTexture,v={shader:this.shaders.point,uniforms:{view:(0,o.sk)(e,t.target),instance:{dotSize:r.dotSize},draw:{locations:{unit:o.si,texture:g},tileZoomFactor:1,pixelRatio:window.devicePixelRatio}},defines:{...(0,o.sf)(e)},optionalAttributes:{},useComputeBuffer:!1};s.setPipelineState((0,o.sg)(e)),s.submitDrawMesh(i,v,n.getDotDensityMesh(i,f(this.shaders.point)))}shutdown(e){super.shutdown(e),this._resources.get(e)?.destroy(),this._resources.delete(e)}_getOrCreateResourcesRecord(e){let t=this._resources.get(e);return null==t&&(t=new K,this._resources.set(e,t)),t}},W=class extends j{constructor(){super(...arguments),this.type=s.e.ComplexFill,this.shaders={geometry:new s.bd}}render(e,t){const{context:i,painter:s}=e,a=t.instance.getInput();s.setShader({shader:this.shaders.geometry,uniforms:{...(0,o.sd)(e,t.target,a.uniforms),...(0,o.se)(e,t.target),mosaicInfo:s.textureManager.getMosaicInfo(i,t.textureKey),localTileOffset:(0,o.sl)(t.target)},defines:{...(0,o.sf)(e)},optionalAttributes:a.optionalAttributes,useComputeBuffer:(0,o.qN)(e)}),s.setPipelineState((0,o.sg)(e)),s.submitDraw(e,t)}};function $(e){const t=1/e;return{antialiasing:t,blur:0+t}}let Z=class extends j{constructor(){super(...arguments),this.type=s.e.ComplexOutlineFill,this.shaders={geometry:new s.be}}render(e,t){const{context:i,painter:s,pixelRatio:a}=e,r=t.instance.getInput();s.setShader({shader:this.shaders.geometry,uniforms:{...(0,o.sd)(e,t.target,r.uniforms),...(0,o.se)(e,t.target),antialiasingControls:$(a),mosaicInfo:s.textureManager.getMosaicInfo(i,t.textureKey),localTileOffset:(0,o.sl)(t.target)},defines:{...(0,o.sf)(e)},optionalAttributes:r.optionalAttributes,useComputeBuffer:(0,o.qN)(e)}),s.setPipelineState((0,o.sg)(e)),s.submitDraw(e,t)}},Y=class extends j{constructor(){super(...arguments),this.type=s.e.Fill,this.shaders={geometry:new s.bc}}render(e,t){const{painter:i}=e,s=t.instance.getInput();i.setShader({shader:this.shaders.geometry,uniforms:{...(0,o.sd)(e,t.target,s.uniforms),...(0,o.se)(e,t.target)},defines:(0,o.sf)(e),optionalAttributes:s.optionalAttributes,useComputeBuffer:(0,o.qN)(e)}),i.setPipelineState((0,o.sg)(e)),i.submitDraw(e,t)}},Q=class extends j{constructor(){super(...arguments),this.type=s.e.OutlineFill,this.shaders={geometry:new s.bf}}render(e,t){const{painter:i,pixelRatio:s}=e,a=t.instance.getInput();i.setShader({shader:this.shaders.geometry,uniforms:{...(0,o.sd)(e,t.target,a.uniforms),...(0,o.se)(e,t.target),antialiasingControls:$(s)},defines:{...(0,o.sf)(e)},optionalAttributes:a.optionalAttributes,useComputeBuffer:(0,o.qN)(e)}),i.setPipelineState((0,o.sg)(e)),i.submitDraw(e,t)}},J=class extends j{constructor(){super(...arguments),this.type=s.e.PatternFill,this.shaders={geometry:new s.bg}}render(e,t){const{context:i,painter:s}=e,a=t.instance.getInput();s.setShader({shader:this.shaders.geometry,uniforms:{...(0,o.sd)(e,t.target,a.uniforms),...(0,o.se)(e,t.target),mosaicInfo:s.textureManager.getMosaicInfo(i,t.textureKey),localTileOffset:(0,o.sl)(t.target)},defines:{...(0,o.sf)(e)},optionalAttributes:a.optionalAttributes,useComputeBuffer:(0,o.qN)(e)}),s.setPipelineState((0,o.sg)(e)),s.submitDraw(e,t)}},ee=class extends j{constructor(){super(...arguments),this.type=s.e.PatternOutlineFill,this.shaders={geometry:new s.bh}}render(e,t){const{context:i,painter:s,pixelRatio:a}=e,r=t.instance.getInput();s.setShader({shader:this.shaders.geometry,uniforms:{...(0,o.sd)(e,t.target,r.uniforms),...(0,o.se)(e,t.target),antialiasingControls:$(a),mosaicInfo:s.textureManager.getMosaicInfo(i,t.textureKey),localTileOffset:(0,o.sl)(t.target)},defines:{...(0,o.sf)(e)},optionalAttributes:r.optionalAttributes,useComputeBuffer:(0,o.qN)(e)}),s.setPipelineState((0,o.sg)(e)),s.submitDraw(e,t)}},te=class{constructor(e,t,i,s){this.dataType=e,this.samplingMode=t,this.pixelFormat=i,this.internalFormat=s}};function ie(e,t){const{textureFloatLinear:i,colorBufferFloat:s}=e.capabilities,a=s?.textureFloat,r=s?.textureHalfFloat,n=s?.floatBlend,l=e.driverTest.floatBufferBlend.result;if(!a&&!r)throw new o.s("heatmap:missing-color-buffer-float","HeatmapRenderer requires the WebGL extension EXT_color_buffer_float or EXT_color_buffer_half_float or WEBGL_color_buffer_float.");if(!(n&&l||r))throw new o.s("heatmap:missing-float-blend","HeatmapRenderer requires the WebGL extension EXT_float_blend or EXT_color_buffer_half_float."+(l?"":" This device claims support for EXT_float_blend, but does not actually support it."));const u=a&&n&&l,c=r,p=i,d=!!s?.R32F,f=!!s?.R16F;if(u&&p)return p||t.warnOnce("Missing WebGL extension OES_texture_float_linear. Heatmap quality may be reduced."),new te(o.cv.FLOAT,p?o.cw.LINEAR:o.cw.NEAREST,d?o.cA.RED:o.cA.RGBA,d?o.cu.R32F:o.cA.RGBA);if(c)return new te(o.cv.HALF_FLOAT,o.cw.LINEAR,f?o.cA.RED:o.cA.RGBA,f?o.cu.R16F:o.cA.RGBA);throw new o.s("heatmap:missing-hardware-support","HeatmapRenderer requires WebGL extensions that allow it to render and blend to float or half float textures.")}new te(o.cv.HALF_FLOAT,o.cw.NEAREST,o.cA.RGBA,o.cA.RGBA);const se=()=>o.G.getLogger("esri.views.2d.engine.webgl.shaderGraph.techniques.heatmap.HeatmapResources");let oe=class{destroy(){this._accumulateFramebuffer=(0,o.aI)(this._accumulateFramebuffer),this._resolveGradientTexture=(0,o.aI)(this._resolveGradientTexture),this._prevGradientHash=null,this._qualityProfile=null}get initialized(){return null!=this._accumulateFramebuffer&&null!=this._resolveGradientTexture}get accumulateFramebuffer(){return this._accumulateFramebuffer}get resolveGradientTexture(){return this._resolveGradientTexture}loadQualityProfile(e){if(null==this._qualityProfile){const t=ie(e,se());this._qualityProfile={...t,defines:{usesHalfFloatPrecision:t.dataType!==o.cv.FLOAT}}}return this._qualityProfile}ensureAccumulateFBO(e,t,i){if(null==this._accumulateFramebuffer){const{dataType:s,samplingMode:a,pixelFormat:r,internalFormat:n}=this.loadQualityProfile(e),u=new o.ct(t,i);u.pixelFormat=r,u.internalFormat=n,u.dataType=s,u.samplingMode=a,u.wrapMode=o.cx.CLAMP_TO_EDGE;const c=new l.i(o.ln.DEPTH_STENCIL,t,i);this._accumulateFramebuffer=new l.x(e,u,c)}else{const{width:e,height:s}=this._accumulateFramebuffer;e===t&&s===i||this._accumulateFramebuffer.resize(t,i)}return this._accumulateFramebuffer}ensureResolveGradientTexture(e,t,i){if(null==this._resolveGradientTexture){const t=new o.ct;t.wrapMode=o.cx.CLAMP_TO_EDGE,this._resolveGradientTexture=new o.cy(e,t)}else this._prevGradientHash!==t&&(this._resolveGradientTexture.resize(i.length/4,1),this._resolveGradientTexture.setData(i),this._prevGradientHash=t);return this._resolveGradientTexture}};function ae(e){return e?.25:1}let re=class extends s.aH{};(0,o.bt)([(0,s.h)(5,s.C)],re.prototype,"offset",void 0);let ne=class extends s.aV{},le=class extends s.P{};(0,o.bt)([(0,s.g)(s.j)],le.prototype,"radius",void 0),(0,o.bt)([(0,s.g)(s.j)],le.prototype,"isFieldActive",void 0);class ue extends s.aI{constructor(){super(...arguments),this.usesHalfFloatPrecision=!1}vertex(e){const{radius:t,isFieldActive:i}=this.kernelControls,o=e.offset,a=i.multiply(this.storage.getVVData(e.id).x).add(new s.j(1).subtract(i)),r=this.view.displayViewScreenMat3.multiply(new s.G(e.pos,1)).add(this.view.displayViewMat3.multiply(new s.G(o,0)).multiply(t)),n=this.clip(e.id);return{glPosition:new s.H(r.xy,n,1),offset:o,fieldValue:a,color:new s.H(0),...this.maybeRunHittest(e,{},null)}}fragment(e){const{offset:t,fieldValue:i}=e,o=(0,s.X)(t),a=(0,s.E)(o,new s.j(1)),r=new s.j(1).subtract(o.multiply(o)),n=r.multiply(r),l=a.multiply(n).multiply(i).multiply(new s.j(ae(this.usesHalfFloatPrecision)));return this.getFragmentOutput(new s.H(l),e)}hittest(e){const{viewMat3:t,tileMat3:i}=this.view,o=t.multiply(i).multiply(new s.G(e.pos,1));return(0,s.bi)(o.xy,this.kernelControls.radius,this.hittestRequest.position)}}(0,o.bt)([s.K],ue.prototype,"usesHalfFloatPrecision",void 0),(0,o.bt)([(0,s.g)(le)],ue.prototype,"kernelControls",void 0),(0,o.bt)([(0,o.ic)(0,(0,s.m)(re))],ue.prototype,"vertex",null),(0,o.bt)([(0,o.ic)(0,(0,s.m)(ne))],ue.prototype,"fragment",null);let ce=class extends s.I{};(0,o.bt)([(0,s.h)(0,s.C)],ce.prototype,"position",void 0);let pe=class extends s.v{},de=class extends s.P{};(0,o.bt)([(0,s.g)(s.S)],de.prototype,"texture",void 0),(0,o.bt)([(0,s.g)(s.C)],de.prototype,"minAndInvRange",void 0),(0,o.bt)([(0,s.g)(s.j)],de.prototype,"normalization",void 0);let fe=class extends s.P{};(0,o.bt)([(0,s.g)(s.S)],fe.prototype,"texture",void 0);let he=class extends s.b{constructor(){super(...arguments),this.usesHalfFloatPrecision=!1}vertex(e){return{glPosition:new s.H(e.position.multiply(2).subtract(1),1,1),uv:e.position}}fragment(e){const{accumulatedDensity:t,gradient:i}=this;let o=(0,s.l)(t.texture,e.uv).r.divide(new s.j(ae(this.usesHalfFloatPrecision)));o=o.multiply(t.normalization),o=o.subtract(t.minAndInvRange.x).multiply(t.minAndInvRange.y);const a=(0,s.l)(i.texture,new s.C(o,.5)),r=new s.w;return r.glFragColor=new s.H(a.rgb.multiply(a.a),a.a),r}};(0,o.bt)([s.K],he.prototype,"usesHalfFloatPrecision",void 0),(0,o.bt)([(0,s.g)(de)],he.prototype,"accumulatedDensity",void 0),(0,o.bt)([(0,s.g)(fe)],he.prototype,"gradient",void 0),(0,o.bt)([(0,o.ic)(0,(0,s.m)(ce))],he.prototype,"vertex",null),(0,o.bt)([(0,o.ic)(0,(0,s.m)(pe))],he.prototype,"fragment",null);let me=class extends j{constructor(){super(...arguments),this.type=s.e.Heatmap,this.drawPhase=o.aK.MAP|o.aK.HITTEST|o.aK.DEBUG,this.shaders={accumulate:new ue,resolve:new he},this._isBound=!1,this._resources=new Map}shutdown(e){super.shutdown(e),this._resources.get(e)?.destroy(),this._resources.delete(e),this._prevFBO=null,this._unbind()}render(e,t){const{context:i,painter:s,state:a}=e,r=t.instance.getInput(),{isFieldActive:n}=r.uniforms,l=this._getOrCreateResourcesRecord(i),u=l.loadQualityProfile(i);(0,o.qN)(e)||this._bind(e,l,r),s.setShader({shader:this.shaders.accumulate,uniforms:{...(0,o.se)(e,t.target),kernelControls:{radius:we(r,a),isFieldActive:n?1:0}},defines:{...(0,o.sf)(e),...u.defines},optionalAttributes:{},useComputeBuffer:(0,o.qN)(e)});const c=(0,o.qN)(e)?ge:xe;s.setPipelineState(c),s.submitDraw(e,t)}getStencilReference(e){return ye(e)}renderResolvePass(e,t){if((0,o.qN)(e))return;const{context:i,painter:s}=e,a=this._resources.get(i);if(null==this._prevFBO||null==this._prevViewport||!a?.initialized)return;const{defines:r}=a.loadQualityProfile(i),{minDensity:n,maxDensity:l,radius:u}=t.getInput().uniforms,c=8,p=9,d=a.accumulateFramebuffer,f=a.resolveGradientTexture,h={shader:this.shaders.resolve,uniforms:{accumulatedDensity:{texture:{unit:c,texture:d.colorTexture},minAndInvRange:[n,1/(l-n)],normalization:3/(u*u*Math.PI)},gradient:{texture:{unit:p,texture:f}}},defines:r,optionalAttributes:{},useComputeBuffer:!1};i.bindFramebuffer(this._prevFBO),i.setViewport(0,0,this._prevViewport.width,this._prevViewport.height),i.bindTexture(d.colorTexture,c),i.bindTexture(f,p),s.setPipelineState(ve),s.submitDrawMesh(i,h,s.quadMesh),this._unbind()}_getOrCreateResourcesRecord(e){let t=this._resources.get(e);return null==t&&(t=new oe,this._resources.set(e,t)),t}_unbind(){this._prevFBO=null,this._prevViewport=null,this._isBound=!1}_bind(e,t,i){if(this._isBound)return;const{context:s,state:a,pixelRatio:r}=e,n=s.getBoundFramebufferObject(),l=s.getViewport();this._prevFBO=n,this._prevViewport=l;const{gradient:u,gradientHash:c}=i.uniforms;t.ensureResolveGradientTexture(s,c,u);const{width:p,height:d}=l,f=be(we(i,a),r),h=p*f,m=d*f,b=t.ensureAccumulateFBO(s,h,m);s.blitFramebuffer(n,b,0,0,n.width,n.height,0,0,b.width,b.height,o.h_.STENCIL,o.cw.NEAREST),s.bindFramebuffer(b),s.setViewport(0,0,b.width,b.height),s.setColorMask(!0,!0,!0,!0),s.setClearColor(0,0,0,0),s.clear(o.h_.COLOR),this._isBound=!0}};function be(e,t){const i=t>1.5?.25:.5;return e<1/(2*i)?1:i}function ye(e){return e.key.level+1}const xe={color:{write:[!0,!0,!0,!0],blendMode:"additive"},depth:!1,stencil:{write:!1,test:{ref:ye,compare:o.id.GEQUAL,mask:255,op:{fail:o.ie.KEEP,zFail:o.ie.KEEP,zPass:o.ie.REPLACE}}}},ge={...xe,stencil:!1},ve={color:{write:[!0,!0,!0,!0],blendMode:"composite"},depth:!1,stencil:!1};function we(e,t){const{referenceScale:i,radius:s}=e.uniforms;return s*(0!==i?i/t.scale:1)}const Se=360/254;var Ve;(function(e){e[e.Color=0]="Color",e[e.Outline=1]="Outline",e[e.Halo=2]="Halo"})(Ve||(Ve={}));let ze=class extends s.aH{};(0,o.bt)([(0,s.h)(3,s.H)],ze.prototype,"color",void 0),(0,o.bt)([(0,s.h)(4,s.C)],ze.prototype,"offset",void 0),(0,o.bt)([(0,s.h)(5,s.C)],ze.prototype,"textureUV",void 0),(0,o.bt)([(0,s.h)(6,s.j)],ze.prototype,"fontSize",void 0),(0,o.bt)([(0,s.h)(7,s.j)],ze.prototype,"referenceSize",void 0),(0,o.bt)([(0,s.h)(8,s.H)],ze.prototype,"outlineColor",void 0),(0,o.bt)([(0,s.h)(9,s.H)],ze.prototype,"haloColor",void 0),(0,o.bt)([(0,s.h)(10,s.C)],ze.prototype,"outlineAndHaloSize",void 0),(0,o.bt)([(0,s.h)(11,s.C)],ze.prototype,"zoomRange",void 0),(0,o.bt)([(0,s.h)(12,s.j)],ze.prototype,"clipAngle",void 0),(0,o.bt)([(0,s.h)(13,s.H)],ze.prototype,"referenceSymbol",void 0);let _e=class extends s.aW{};(0,o.bt)([(0,s.h)(14,s.C)],_e.prototype,"offsetNextVertex1",void 0),(0,o.bt)([(0,s.h)(15,s.C)],_e.prototype,"offsetNextVertex2",void 0);let Ce=class extends s.aV{},Te=class extends s.aI{constructor(){super(...arguments),this.computeAttributes={offset:["offsetNextVertex1","offsetNextVertex2"]},this.textRenderPassType=Ve.Color,this.isBackgroundPass=!1,this.isLabel=!1}clipLabel(e,t,i){const a=t.multiply(Se),r=(0,s.Y)(this.view.rotation.subtract(a)),n=(0,s.B)(new s.j(360).subtract(r),r);let l=new s.j(0);const u=(0,s.bj)(this.view.currentZoom.multiply(o.na)).divide(o.na),c=e.x,p=e.y,d=new s.j(1).subtract((0,s.E)(c,u)).multiply(2),f=(0,s.E)(new s.j(90),n).multiply(2),h=new s.j(2).multiply(new s.j(1).subtract((0,s.E)(u,p)));return l=l.add(i.multiply(d)),l=l.add(i.multiply(f)),l=l.add(h),l}vertex(e,t){const i=(0,s.aX)(e.bitset,s.an),a=new s.j(1).subtract(i);let r=e.fontSize,n=r.divide(s.bk);const l=this.textRenderPassType===Ve.Outline?e.outlineColor:this.textRenderPassType===Ve.Halo?e.haloColor:this._getVertexColor(e),u=this.isLabel?this.storage.getLabelVisibility(e.id):new s.j(1),c=this.isLabel?l.multiply(u):l,p=this.view.displayViewScreenMat3.multiply(new s.G(e.pos,1));let d=e.offset,f=new s.j(1),h=s.a.identity(),m=new s.C(0);if(this.isLabel){if(!e.referenceSymbol)throw new Error("InternalError: Optional attribute 'referenceSymbol' expected for labels");const t=e.referenceSymbol,i=t.xy,a=t.z,r=this._unpackDirection(t.w),n=(0,s.aZ)(this,e.id,a).divide(2),l=r.multiply(n.add(o.q9));m=i.add(l),d=d.add(m)}else f=(0,s.aZ)(this,e.id,e.referenceSize).divide(e.referenceSize),r=r.multiply(f),n=n.multiply(f),d=d.multiply(f),h=(0,s.bl)(this,e.id),d=h.multiply(new s.G(d,0)).xy;const b=(0,s.aX)(e.bitset,s.ao),y=this._getViewRotationMatrix(b).multiply(new s.G(d,0));let x=this.isLabel?this.clipLabel(e.zoomRange,e.clipAngle,b):this.clip(e.id,e.zoomRange);x=this.isBackgroundPass?x.add(a.multiply(2)):x.add(i.multiply(2));const g=this.isLabel?(0,s.a$)((0,s.N)(x,new s.j(1)),(0,s.U)(u,new s.j(0))):new s.b0(!1),v=new s.H(p.xy.add(y.xy),x,1),w=e.textureUV.divide(this.mosaicInfo.size);let S=new s.j(0);if(this.textRenderPassType===Ve.Outline&&((0,s.U)(e.outlineAndHaloSize.x,new s.j(0))&&(x=x.add(new s.j(2))),S=new s.j(e.outlineAndHaloSize.x).divide(n).divide(s.bm)),this.textRenderPassType===Ve.Halo){const t=e.outlineAndHaloSize.x,i=new s.j(e.outlineAndHaloSize.y);(0,s.U)(i,new s.j(0))&&(x=x.add(new s.j(2))),S=i.add(t).divide(n).divide(s.bm)}return{glPosition:v,color:c,size:n,textureUV:w,antialiasingWidth:new s.j(.105*s.bk).divide(r).divide(this.view.pixelRatio),outlineDistanceOffset:S,...this.maybeRunHittest(e,t,{vvSizeAdjustment:f,vvRotation:h,labelOffset:m,labelClipped:g})}}_getViewRotationMatrix(e){const t=this.view.displayViewMat3,i=this.view.displayMat3,o=new s.j(1).subtract(e);return t.multiply(e).add(i.multiply(o))}fragment(e){const t=new s.j(.25),i=new s.j(1).subtract(t),o=(0,s.l)(this.mosaicInfo.texture,e.textureUV).a;let a=i.subtract(e.outlineDistanceOffset);this.highlight&&(a=a.divide(2));const r=e.antialiasingWidth,n=(0,s.a1)(a.subtract(r),a.add(r),o);return this.getFragmentOutput(e.color.multiply(n),e)}hittest(e,t,{vvSizeAdjustment:i,vvRotation:o,labelOffset:a,labelClipped:r}){let n,l,u;this.isLabel?(n=new s.G(e.offset.add(a),0),l=new s.G(t.offsetNextVertex1.add(a),0),u=new s.G(t.offsetNextVertex2.add(a),0)):(n=o.multiply(new s.G(e.offset.multiply(i),0)),l=o.multiply(new s.G(t.offsetNextVertex1.multiply(i),0)),u=o.multiply(new s.G(t.offsetNextVertex2.multiply(i),0)));const{viewMat3:c,tileMat3:p}=this.view,d=c.multiply(p).multiply(new s.G(e.pos,1)),f=d.add(p.multiply(n)).xy,h=d.add(p.multiply(l)).xy,m=d.add(p.multiply(u)).xy,b=(0,s.b4)(this.hittestRequest.position,f.xy,h.xy,m.xy);return this.isLabel?(0,s.x)(r,(0,s.b8)(this.hittestRequest),b):b}_unpackDirection(e){const t=new s.a2(e),i=(0,s.bn)(t,new s.a2(2)),o=(0,s.bo)(t,new s.a2(3));return new s.C(new s.j(i).subtract(1),new s.j(o).subtract(1))}_getVertexColor(e){let t=e.color;if(this.visualVariableColor){const i=this.storage.getColorValue(e.id);t=this.visualVariableColor.getColor(i,e.color,new s.b0(!1))}if(this.visualVariableOpacity){const i=this.storage.getOpacityValue(e.id),s=this.visualVariableOpacity.getOpacity(i);t=t.multiply(s)}return t}};(0,o.bt)([(0,s.aG)(s.aP)],Te.prototype,"visualVariableColor",void 0),(0,o.bt)([(0,s.aG)(s.aQ)],Te.prototype,"visualVariableOpacity",void 0),(0,o.bt)([(0,s.aG)(w)],Te.prototype,"visualVariableRotation",void 0),(0,o.bt)([(0,s.aG)(s.aR)],Te.prototype,"visualVariableSizeMinMaxValue",void 0),(0,o.bt)([(0,s.aG)(s.aS)],Te.prototype,"visualVariableSizeScaleStops",void 0),(0,o.bt)([(0,s.aG)(s.aT)],Te.prototype,"visualVariableSizeStops",void 0),(0,o.bt)([(0,s.aG)(s.aU)],Te.prototype,"visualVariableSizeUnitValue",void 0),(0,o.bt)([(0,s.g)(s.aO)],Te.prototype,"mosaicInfo",void 0),(0,o.bt)([s.K],Te.prototype,"textRenderPassType",void 0),(0,o.bt)([s.K],Te.prototype,"isBackgroundPass",void 0),(0,o.bt)([s.K],Te.prototype,"isLabel",void 0),(0,o.bt)([(0,o.ic)(0,(0,s.m)(ze)),(0,o.ic)(1,(0,s.m)(_e))],Te.prototype,"vertex",null),(0,o.bt)([(0,o.ic)(0,(0,s.m)(Ce))],Te.prototype,"fragment",null);let Pe=class extends j{constructor(){super(...arguments),this.type=s.e.Label,this.shaders={geometry:new Te},this.drawPhase=o.aK.LABEL|o.aK.LABEL_ALPHA|o.aK.HITTEST,this.symbologyPlane=o.qM.TEXT}render(e,t){const{context:i,painter:s}=e,a=(0,o.sf)(e),r={...(0,o.sg)(e)},n=t.instance.getInput(),l={shader:this.shaders.geometry,uniforms:{...(0,o.sd)(e,t.target,n.uniforms),...(0,o.se)(e,t.target),mosaicInfo:s.textureManager.getMosaicInfo(i,t.textureKey)},defines:{...a,textRenderPassType:Ve.Color,isBackgroundPass:!0,isLabel:!0},optionalAttributes:n.optionalAttributes,useComputeBuffer:(0,o.qN)(e)};s.setShader(l),s.setPipelineState(r),s.submitDraw(e,t),s.setShader({...l,defines:{...a,textRenderPassType:Ve.Halo,isBackgroundPass:!1,isLabel:!0}}),s.setPipelineState(r),s.submitDraw(e,t),s.setShader({...l,defines:{...a,textRenderPassType:Ve.Color,isBackgroundPass:!1,isLabel:!0}}),s.setPipelineState(r),s.submitDraw(e,t)}},Me=class extends j{constructor(){super(...arguments),this.type=s.e.Line,this.shaders={geometry:new s.bp},this.symbologyPlane=o.qM.LINE}render(e,t){const{painter:i,pixelRatio:s}=e,a=t.instance.getInput();i.setShader({shader:this.shaders.geometry,uniforms:{...(0,o.sd)(e,t.target,a.uniforms),...(0,o.se)(e,t.target),antialiasingControls:$(s)},defines:{...(0,o.sf)(e)},optionalAttributes:a.optionalAttributes,useComputeBuffer:(0,o.qN)(e)}),i.setPipelineState((0,o.sg)(e)),i.submitDraw(e,t)}};class Ae extends s.bq{}(0,o.bt)([(0,s.h)(9,s.j)],Ae.prototype,"accumulatedDistance",void 0),(0,o.bt)([(0,s.h)(10,s.C)],Ae.prototype,"segmentDirection",void 0),(0,o.bt)([(0,s.h)(11,s.j)],Ae.prototype,"offsetAlongLine",void 0),(0,o.bt)([(0,s.h)(12,s.j)],Ae.prototype,"capType",void 0),(0,o.bt)([(0,s.h)(13,s.H)],Ae.prototype,"tlbr",void 0);class Re extends s.bp{_getDistanceRatio(e,t){const i=(0,s.aX)(e.bitset,s.aq);return i.multiply((0,s.A)(t,new s.j(.25)).multiply(new s.j(2))).add(new s.j(1).subtract(i).multiply((0,o.d2)(1)))}_getSDFAlpha(e){const{halfWidth:t,normal:i,tlbr:o,patternSize:a,accumulatedDistance:r,offsetAlongLine:n,dashToPx:l,capType:c}=e,p=a.x.divide(u.t).multiply(l),d=(0,s.a0)(r.add(n).divide(p)),f=(0,s.a6)(o.xy,o.zw,new s.C(d,.5)),h=(0,s.aK)((0,s.l)(this.mosaicInfo.texture,f)).multiply(2).subtract(1).multiply(u.c).multiply(l),m=i.y.multiply(t),b=(0,s.F)([(0,s.U)(c,new s.j(1)),h.subtract(t)],[(0,s.U)(c,new s.j(2)),(0,s.O)((0,s.R)((0,s.A)(h,new s.j(0)),new s.j(2)).add(m.multiply(m))).subtract(t)],[!0,h]),y=(0,s.y)(new s.j(.25).subtract(b),new s.j(0),new s.j(1));return new s.H(y)}_getPatternColor(e){const{halfWidth:t,normal:i,color:o,accumulatedDistance:a,patternSize:r,sampleAlphaOnly:n,tlbr:l}=e,u=r.y.multiply(new s.j(2).multiply(t).divide(r.x)),c=(0,s.a0)(a.divide(u)),p=new s.j(.5).multiply(i.y).add(new s.j(.5)),d=(0,s.a6)(l.xy,l.zw,new s.C(p,c));let f=(0,s.l)(this.mosaicInfo.texture,d);return null!=this.visualVariableColor&&(f=(0,s.x)((0,s.N)(n,new s.j(.5)),new s.H(o.a),o)),f}vertex(e,t){const{segmentDirection:i,tlbr:o,bitset:a}=e,r=(0,s.br)(this,e),n=e.accumulatedDistance.divide(this.view.displayZoomFactor).add((0,s.c)(i,r.scaledOffset)),l=new s.C(o.z.subtract(o.x),o.w.subtract(o.y)),u=o.divide(this.mosaicInfo.size.xyxy),c=(0,s.aX)(a,s.ar),p=(0,s.aX)(a,s.ag),d=(0,s.x)((0,s.N)(c,new s.j(.5)),this._getDistanceRatio(e,r.scaledHalfWidth),new s.j(1));return{...r,tlbr:u,patternSize:l,accumulatedDistance:n,isSDF:c,sampleAlphaOnly:p,dashToPx:d,offsetAlongLine:e.offsetAlongLine,capType:e.capType,...this.maybeRunHittest(e,t,r.halfWidth)}}fragment(e){const{color:t,opacity:i,isSDF:o}=e,a=(0,s.bs)(e,this.antialiasingControls.blur),r=(0,s.x)((0,s.N)(o,new s.j(.5)),this._getSDFAlpha(e),this._getPatternColor(e)),n=t.multiply(i).multiply(a).multiply(r);return this.getFragmentOutput(n,e)}}(0,o.bt)([(0,s.g)(s.aO)],Re.prototype,"mosaicInfo",void 0),(0,o.bt)([(0,o.ic)(0,(0,s.m)(Ae)),(0,o.ic)(1,(0,s.m)(s.bt))],Re.prototype,"vertex",null);let je=class extends j{constructor(){super(...arguments),this.type=s.e.TexturedLine,this.shaders={geometry:new Re},this.symbologyPlane=o.qM.LINE}render(e,t){const{context:i,painter:s,pixelRatio:a}=e,r=t.instance.getInput();s.setShader({shader:this.shaders.geometry,uniforms:{...(0,o.sd)(e,t.target,r.uniforms),...(0,o.se)(e,t.target),antialiasingControls:$(a),mosaicInfo:s.textureManager.getMosaicInfo(i,t.textureKey)},defines:{...(0,o.sf)(e)},optionalAttributes:r.optionalAttributes,useComputeBuffer:(0,o.qN)(e)}),s.setPipelineState((0,o.sg)(e)),s.submitDraw(e,t)}};class Ie extends s.aH{}(0,o.bt)([(0,s.h)(3,s.H)],Ie.prototype,"color",void 0),(0,o.bt)([(0,s.h)(4,s.H)],Ie.prototype,"outlineColor",void 0),(0,o.bt)([(0,s.h)(5,s.C)],Ie.prototype,"offset",void 0),(0,o.bt)([(0,s.h)(6,s.C)],Ie.prototype,"textureUV",void 0),(0,o.bt)([(0,s.h)(7,s.H)],Ie.prototype,"sizing",void 0),(0,o.bt)([(0,s.h)(8,s.j)],Ie.prototype,"placementAngle",void 0),(0,o.bt)([(0,s.h)(9,s.j)],Ie.prototype,"sdfDecodeCoeff",void 0),(0,o.bt)([(0,s.h)(10,s.C)],Ie.prototype,"zoomRange",void 0);class Oe extends s.aW{}(0,o.bt)([(0,s.h)(12,s.C)],Oe.prototype,"offsetNextVertex1",void 0),(0,o.bt)([(0,s.h)(13,s.C)],Oe.prototype,"offsetNextVertex2",void 0),(0,o.bt)([(0,s.h)(14,s.C)],Oe.prototype,"textureUVNextVertex1",void 0),(0,o.bt)([(0,s.h)(15,s.C)],Oe.prototype,"textureUVNextVertex2",void 0);class Fe extends s.aV{}function De(e,t,i,s){return t.multiply(e.x).add(i.multiply(e.y)).add(s.multiply(e.z))}function Ee(e){return e.multiply(e).divide(128)}class Le extends s.aI{constructor(){super(...arguments),this.computeAttributes={offset:["offsetNextVertex1","offsetNextVertex2"],textureUV:["textureUVNextVertex1","textureUVNextVertex2"]}}vertex(e,t){const i=Ee(e.sizing.x),o=Ee(e.sizing.y),a=Ee(e.sizing.z),r=e.placementAngle,n=(0,s.aX)(e.bitset,s.o.bitset.isSDF),l=(0,s.aX)(e.bitset,s.o.bitset.isMapAligned),u=(0,s.aX)(e.bitset,s.o.bitset.scaleSymbolsProportionally),c=(0,s.b1)(e.bitset,s.o.bitset.colorLocked),p=(0,s.b2)(this,e.id),d=(0,s.a_)(this,e.id,e.color,c).multiply(p),f=this.view.displayViewScreenMat3.multiply(new s.G(e.pos.xy,1)),h=(0,s.aZ)(this,e.id,a).divide(a),m=i.multiply(h),b=e.offset.xy.multiply(h);let y=o.multiply(u.multiply(h.subtract(1)).add(1));y=(0,s.B)(y,(0,s.A)(m.subtract(.99),new s.j(0)));const x=(0,s.A)(y,new s.j(1)),g=(0,s.B)(y,new s.j(1)),v=s.a.fromRotation(r.multiply(s.n)),w=(0,s.bl)(this,e.id),S=this._getViewRotationMatrix(l).multiply(w).multiply(v).multiply(new s.G(b.xy,0)),V=this.clip(e.id,e.zoomRange),z=new s.H(f.xy.add(S.xy),V,1),_=e.textureUV.divide(this.mosaicInfo.size),C=e.outlineColor.multiply(g),T=(0,s.aX)(e.bitset,s.o.bitset.overrideOutlineColor),P=e.sdfDecodeCoeff.multiply(m);return{glPosition:z,color:d,textureUV:_,outlineColor:C,outlineSize:x,distanceToPx:P,isSDF:n,overrideOutlineColor:T,...this.maybeRunHittest(e,t,{pos:e.pos,size:m,sizeCorrection:h,isMapAligned:l,vvRotationMat3:w,placementMat3:v,outlineSize:x,distanceToPx:P,isSDF:n})}}fragment(e){const t=this._getColor(e.textureUV,e);return this.getFragmentOutput(t,e)}hittest(e,t,i){return(0,s.x)((0,s.Q)(i.size,this.hittestRequest.smallSymbolSizeThreshold),this._hittestSmallMarker(e,t,i),this._hittestMarker(e,t,i))}_getViewRotationMatrix(e){const t=this.view.displayViewMat3,i=this.view.displayMat3,o=new s.j(1).subtract(e);return t.multiply(e).add(i.multiply(o))}_getViewScreenMatrix(e){const t=this.view.viewMat3.multiply(this.view.tileMat3),i=this.view.tileMat3,o=new s.j(1).subtract(e);return t.multiply(e).add(i.multiply(o))}_getColor(e,t){return(0,s.x)((0,s.U)(t.isSDF,new s.j(1)),this._getSDFColor(e,t),this._getSpriteColor(e,t))}_getSpriteColor(e,t){return(0,s.l)(this.mosaicInfo.texture,e).multiply(t.color)}_getSDFColor(e,t){const i=(0,s.l)(this.mosaicInfo.texture,e),o=new s.j(.5).subtract((0,s.aK)(i)).multiply(t.distanceToPx).multiply(s.aL),a=(0,s.y)(new s.j(.5).subtract(o),new s.j(0),new s.j(1)),r=t.color.multiply(a);let n=t.outlineSize;this.highlight&&(n=(0,s.A)(n,t.overrideOutlineColor.multiply(4)));const l=n.multiply(.5),u=(0,s.Y)(o).subtract(l),c=(0,s.y)(new s.j(.5).subtract(u),new s.j(0),new s.j(1)),p=(0,s.a6)(t.outlineColor,t.color,t.overrideOutlineColor).multiply(c);return new s.j(1).subtract(p.a).multiply(r).add(p)}_hittestSmallMarker(e,t,i){const{position:o,distance:a,smallSymbolDistance:r}=this.hittestRequest,n=a.subtract(r),{viewMat3:l,tileMat3:u}=this.view,c=l.multiply(u).multiply(new s.G(i.pos,1)).xy,p=i.size.multiply(.5);return(0,s.b3)(c,o).subtract(p).add(n)}_hittestMarker(e,t,i){const{pos:o,sizeCorrection:a,isMapAligned:r}=i,n=new s.G(e.offset.multiply(a),0),l=new s.G(t.offsetNextVertex1.multiply(a),0),u=new s.G(t.offsetNextVertex2.multiply(a),0),{viewMat3:c,tileMat3:p}=this.view,d=c.multiply(p).multiply(new s.G(o,1)),f=this._getViewScreenMatrix(r).multiply(i.vvRotationMat3).multiply(i.placementMat3),h=d.add(f.multiply(n)).xy,m=d.add(f.multiply(l)).xy,b=d.add(f.multiply(u)).xy,y=this.hittestRequest.position,x=this.hittestRequest.distance,g=(0,s.b4)(y,h,m,b);return(0,s.x)((0,s.N)(g,x),g,this._hittestSamples(h,m,b,e,t,i))}_hittestSamples(e,t,i,o,a,r){const{outlineSize:n,isSDF:l,distanceToPx:u}=r,c=this.hittestRequest.position,p=this.hittestRequest.distance,d=(0,s.b5)(c.add(new s.C((0,s.b6)(p),(0,s.b6)(p))),e,t,i),f=(0,s.b5)(c.add(new s.C(0,(0,s.b6)(p))),e,t,i),h=(0,s.b5)(c.add(new s.C(p,(0,s.b6)(p))),e,t,i),m=(0,s.b5)(c.add(new s.C((0,s.b6)(p),0)),e,t,i),b=(0,s.b5)(c,e,t,i),y=(0,s.b5)(c.add(new s.C(p,0)),e,t,i),x=(0,s.b5)(c.add(new s.C((0,s.b6)(p),p)),e,t,i),g=(0,s.b5)(c.add(new s.C(0,p)),e,t,i),v=(0,s.b5)(c.add(new s.C(p,p)),e,t,i),w=o.textureUV.divide(this.mosaicInfo.size),S=a.textureUVNextVertex1.divide(this.mosaicInfo.size),V=a.textureUVNextVertex2.divide(this.mosaicInfo.size),z={color:new s.H(1),outlineColor:new s.H(1),overrideOutlineColor:new s.j(1),outlineSize:n,distanceToPx:u,isSDF:l};let _=new s.j(0);return _=_.add((0,s.b7)(d).multiply(this._getColor(De(d,w,S,V),z).a)),_=_.add((0,s.b7)(f).multiply(this._getColor(De(f,w,S,V),z).a)),_=_.add((0,s.b7)(h).multiply(this._getColor(De(h,w,S,V),z).a)),_=_.add((0,s.b7)(m).multiply(this._getColor(De(m,w,S,V),z).a)),_=_.add((0,s.b7)(b).multiply(this._getColor(De(b,w,S,V),z).a)),_=_.add((0,s.b7)(y).multiply(this._getColor(De(y,w,S,V),z).a)),_=_.add((0,s.b7)(x).multiply(this._getColor(De(x,w,S,V),z).a)),_=_.add((0,s.b7)(g).multiply(this._getColor(De(g,w,S,V),z).a)),_=_.add((0,s.b7)(v).multiply(this._getColor(De(v,w,S,V),z).a)),(0,s.E)(_,new s.j(.05)).multiply((0,s.b8)(this.hittestRequest))}}(0,o.bt)([(0,s.aG)(s.aP)],Le.prototype,"visualVariableColor",void 0),(0,o.bt)([(0,s.aG)(s.aQ)],Le.prototype,"visualVariableOpacity",void 0),(0,o.bt)([(0,s.aG)(w)],Le.prototype,"visualVariableRotation",void 0),(0,o.bt)([(0,s.aG)(s.aR)],Le.prototype,"visualVariableSizeMinMaxValue",void 0),(0,o.bt)([(0,s.aG)(s.aS)],Le.prototype,"visualVariableSizeScaleStops",void 0),(0,o.bt)([(0,s.aG)(s.aT)],Le.prototype,"visualVariableSizeStops",void 0),(0,o.bt)([(0,s.aG)(s.aU)],Le.prototype,"visualVariableSizeUnitValue",void 0),(0,o.bt)([(0,s.g)(s.aO)],Le.prototype,"mosaicInfo",void 0),(0,o.bt)([(0,o.ic)(0,(0,s.m)(Ie)),(0,o.ic)(1,(0,s.m)(Oe))],Le.prototype,"vertex",null),(0,o.bt)([(0,o.ic)(0,(0,s.m)(Fe))],Le.prototype,"fragment",null);let He=class extends j{constructor(){super(...arguments),this.type=s.e.Marker,this.shaders={geometry:new Le},this.symbologyPlane=o.qM.MARKER}render(e,t){const{context:i,painter:s}=e,a=t.instance.getInput();s.setShader({shader:this.shaders.geometry,uniforms:{...(0,o.sd)(e,t.target,a.uniforms),...(0,o.se)(e,t.target),mosaicInfo:s.textureManager.getMosaicInfo(i,t.textureKey,!0)},defines:{...(0,o.sf)(e)},optionalAttributes:a.optionalAttributes,useComputeBuffer:(0,o.qN)(e)}),s.setPipelineState((0,o.sg)(e)),s.submitDraw(e,t)}},Ne=class{constructor(){this.computeAttributes={}}get locationsMap(){const e=new Map;for(const t in this.locations)e.set(t,this.locations[t].index);return e}get optionPropertyKeys(){if(!this._optionPropertyKeys){const e=new Set(Object.keys(this.options));this._optionPropertyKeys=e}return this._optionPropertyKeys}get _transformFeedbackBindings(){return[]}get locationInfo(){if(!this._locationInfo){const e=this.locationsMap,t=Array.from(e.entries()).map((([e,t])=>`${e}.${t}`)).join("."),i=(0,o.b1)(t);this._locationInfo={hash:i,locations:e,computeAttributeMap:this.computeAttributes}}return this._locationInfo}get renamedLocationsMap(){const e=new Map;for(const[t,i]of this.locationsMap.entries())e.set("a_"+t,i);return e}getShaderKey(e,t,i){return`${Object.keys(e).map((t=>`${t}.${e[t]}`)).join(".")}.${Object.keys(i).filter((e=>i[e])).map((e=>`${e}_${i[e].toString()}`)).join(".")}.${Object.keys(t).filter((e=>this.optionPropertyKeys.has(e))).join(".")}`}getProgram(e,t,i,o){let a="",r="";for(const s in i)if(i[s]){const e="boolean"==typeof i[s]?`#define ${s}\n`:`#define ${s} ${i[s]}\n`;a+=e,r+=e}return a+=this.vertexShader,r+=this.fragmentShader,new s.bu(a,r,this.renamedLocationsMap,this.locationInfo,this._getUniformBindings(t),this._transformFeedbackBindings)}_getUniformBindings(e){const t=[];for(const i in this.required){const e=this.required[i];t.push({uniformHydrated:null,shaderModulePath:i,uniformName:i,uniformType:e.type,uniformArrayElementType:Ge(e),uniformArrayLength:ke(e)})}for(const i in e){const s=this.options[i];if(e[i])for(const e in s){const o=s[e];t.push({uniformHydrated:null,shaderModulePath:`${i}.${e}`,uniformName:e,uniformType:o.type,uniformArrayElementType:Ge(o),uniformArrayLength:ke(o)})}}return t}};const Ge=e=>"array"===e.type?e.elementType?.type:void 0,ke=e=>"array"===e.type?e.size:void 0,Be={hittestDist:s.j,hittestPos:s.C},qe={filterFlags:s.S,animation:s.S,visualVariableData:s.S,dataDriven0:s.S,dataDriven1:s.S,dataDriven2:s.S,gpgpu:s.S,size:s.j},Ue={displayViewScreenMat3:s.a,displayViewMat3:s.a,displayMat3:s.a,viewMat3:s.a,tileMat3:s.a,displayZoomFactor:s.j,requiredZoomFactor:s.j,tileOffset:s.C,currentScale:s.j,currentZoom:s.j,metersPerSRUnit:s.j};let Ke=class extends Ne{constructor(){super(...arguments),this.vertexShader=(0,c.d)("materials/pie/pie.vert"),this.fragmentShader=(0,c.d)("materials/pie/pie.frag"),this.required={...qe,...Ue,outlineWidth:s.j,colors:s.ba,defaultColor:s.H,othersColor:s.H,outlineColor:s.H,donutRatio:s.j,sectorThreshold:s.j},this.options={hittestUniforms:Be,visualVariableSizeMinMaxValue:{minMaxValueAndSize:s.H},visualVariableSizeScaleStops:{sizes:{...s.ba.ofType(s.j,8),type:"array",elementType:s.j,size:8},values:{...s.ba.ofType(s.j,8),type:"array",elementType:s.j,size:8}},visualVariableSizeStops:{sizes:{...s.ba.ofType(s.j,8),type:"array",elementType:s.j,size:8},values:{...s.ba.ofType(s.j,8),type:"array",elementType:s.j,size:8}},visualVariableSizeUnitValue:{unitValueToPixelsRatio:s.j},visualVariableOpacity:{opacities:{...s.ba.ofType(s.j,8),type:"array",elementType:s.j,size:8},opacityValues:{...s.ba.ofType(s.j,8),type:"array",elementType:s.j,size:8}}},this.locations={pos:{index:0,type:s.C},id:{index:1,type:s.G},bitset:{index:2,type:s.j},offset:{index:3,type:s.C},texCoords:{index:4,type:s.C},size:{index:5,type:s.C},referenceSize:{index:6,type:s.j},zoomRange:{index:7,type:s.C}},this.defines={VV_SIZE_MIN_MAX_VALUE:"boolean",VV_SIZE_SCALE_STOPS:"boolean",VV_SIZE_FIELD_STOPS:"boolean",VV_SIZE_UNIT_VALUE:"boolean",VV_OPACITY:"boolean",HITTEST:"boolean",numberOfFields:"number",highlight:"boolean",inside:"boolean",outside:"boolean"}}setNumberOfFields(e){this.required.colors={...s.ba.ofType(s.H,e),type:"array",elementType:s.H,size:e}}},Xe=class extends j{constructor(){super(...arguments),this.type=s.e.PieChart,this.shaders={geometry:new Ke},this.symbologyPlane=o.qM.MARKER}render(e,t){const{painter:i}=e,{instance:s,target:a}=t,r=this.shaders.geometry,n=s.getInput(),l=n.uniforms.numberOfFields,u=(0,o.qN)(e),c=(0,o.se)(e,a),p=(0,o.sf)(e);r.setNumberOfFields(l),i.setShader({shader:r,uniforms:{...(0,o.sd)(e,t.target,n.uniforms.shader),...c.storage,...c.view,hittestUniforms:c.hittestRequest?{hittestDist:c.hittestRequest?.distance,hittestPos:c.hittestRequest?.position}:null},defines:{VV_SIZE_MIN_MAX_VALUE:!!n.uniforms.shader.visualVariableSizeMinMaxValue,VV_SIZE_SCALE_STOPS:!!n.uniforms.shader.visualVariableSizeScaleStops,VV_SIZE_FIELD_STOPS:!!n.uniforms.shader.visualVariableSizeStops,VV_SIZE_UNIT_VALUE:!!n.uniforms.shader.visualVariableSizeUnitValue,VV_OPACITY:!!n.uniforms.shader.visualVariableOpacity,HITTEST:u,highlight:c.highlight?1:0,...p,numberOfFields:l},optionalAttributes:{},useComputeBuffer:u}),i.setPipelineState((0,o.sg)(e)),i.submitDraw(e,t)}},We=class extends j{constructor(){super(...arguments),this.type=s.e.Text,this.shaders={geometry:new Te},this.symbologyPlane=o.qM.TEXT}render(e,t){const{context:i,painter:s}=e,a=(0,o.sf)(e),r=t.instance.getInput(),n={shader:this.shaders.geometry,uniforms:{...(0,o.sd)(e,t.target,r.uniforms),...(0,o.se)(e,t.target),mosaicInfo:s.textureManager.getMosaicInfo(i,t.textureKey)},defines:{...a,isBackgroundPass:!0,isLabel:!1,textRenderPassType:Ve.Color},optionalAttributes:r.optionalAttributes,useComputeBuffer:(0,o.qN)(e)};s.setShader(n),s.setPipelineState((0,o.sg)(e)),s.submitDraw(e,t),s.setShader({...n,defines:{...a,isBackgroundPass:!1,isLabel:!1,textRenderPassType:Ve.Halo}}),s.submitDraw(e,t),s.setShader({...n,defines:{...a,isBackgroundPass:!1,isLabel:!1,textRenderPassType:Ve.Outline}}),s.submitDraw(e,t),s.setShader({...n,defines:{...a,isBackgroundPass:!1,isLabel:!1,textRenderPassType:Ve.Color}}),s.submitDraw(e,t)}};const $e={fill:new Y,patternFill:new J,complexFill:new W,outlineFill:new Q,patternOutlineFill:new ee,complexOutlineFill:new Z,marker:new He,pieChart:new Xe,line:new Me,texturedLine:new je,text:new We,label:new Pe,heatmap:new me,dotDensity:new X,animatedMarker:new O};function Ze(){for(const e in $e)$e[e].startup()}function Ye(e){for(const t in $e)$e[t].shutdown(e)}function Qe(e,t){const i=e.slice(0,t),s=t-i.length;for(let o=0;o<s;o++){const e=i[i.length-1];i.push(e)}return i}function Je(e){if(!e)return[0,0,0,0];const{r:t,g:i,b:s,a:o}=e;return[t*(o/255),i*(o/255),s*(o/255),o]}const et=8,tt=et-2,it=()=>o.G.getLogger("esri.views.2d.layers.features.support.rendererUtils");function st(e){return e.map((e=>ot(e)?at(e.clone()):e))}function ot(e){return("size"===e.type||"color"===e.type||"opacity"===e.type)&&null!=e.stops}function at(e){return e.stops=ut(e.type,e.stops??[]),e}function rt(e,t,i){return(1-i)*e+i*t}function nt(e,t){const[i,...s]=t,a=s.pop(),r=s[0].value,n=s[s.length-1].value,l=(n-r)/tt,u=[];for(let c=r;c<n;c+=l){let i=0;for(;c>=s[i].value;)i++;const a=s[i],r=t[i-1],n=c-r.value,l=a.value===r.value?1:n/(a.value-r.value);if("color"===e){const e=s[i],o=t[i-1],a=e.color.clone();a.r=rt(o.color.r,a.r,l),a.g=rt(o.color.g,a.g,l),a.b=rt(o.color.b,a.b,l),a.a=rt(o.color.a,a.a,l),u.push({value:c,color:a,label:e.label})}else if("size"===e){const e=s[i],a=t[i-1],r=(0,o.kT)(e.size),n=rt((0,o.kT)(a.size),r,l);u.push({value:c,size:n,label:e.label})}else{const e=s[i],o=rt(t[i-1].opacity,e.opacity,l);u.push({value:c,opacity:o,label:e.label})}}return[i,...u,a]}function lt(e){const[t,...i]=e,s=i.pop();for(;i.length>tt;){let e=0,t=0;for(let s=1;s<i.length;s++){const o=i[s-1],a=i[s],r=Math.abs(a.value-o.value);r>t&&(t=r,e=s)}i.splice(e,1)}return[t,...i,s]}function ut(e,t){return t.length<=et?t:(it().warn(`Found ${t.length} Visual Variable stops, but MapView only supports ${et}. Displayed stops will be simplified.`),t.length>2*et?nt(e,t):lt(t))}function ct(){const{supportsColorBufferFloat:e,supportsColorBufferFloatBlend:t,supportsColorBufferHalfFloat:i}=(0,o.nX)();return e&&t||i}function pt(e){if(!e)return!0;switch(e.type){case"dot-density":break;case"heatmap":if(!ct()){const e=(0,o.nX)(),t=["supportsColorBufferFloat","supportsColorBufferFloatBlend","supportsColorBufferHalfFloat"].filter((t=>!e[t])).join(", ");return it().errorOnce(new o.s("webgl-missing-extension",`Missing WebGL2 requirements for Heatmap: ${t}`)),!1}}return!0}const dt=1.25,ft=128,ht=128;function mt(e){if(!e.stops?.length)return null;const t=e.stops.sort(((e,t)=>e.value-t.value)),i=Qe(t,8),s=i.map((({value:e})=>e)),o=i.map((({color:e})=>Je(e)));return{values:s,colors:o}}function bt(e){if(!e.stops?.length)return null;const t=e.stops.sort(((e,t)=>e.value-t.value)),i=Qe(t,8);return{opacityValues:i.map((({value:e})=>e)),opacities:i.map((({opacity:e})=>e))}}function yt(e){return{rotationType:"geographic"===e.rotationType?s.aE.Geographic:s.aE.Arithmatic}}function xt(e){if(!e.stops?.length)return null;if(e.stops.some((e=>e.useMaxValue||e.useMinValue)))return(t,i)=>{const s=t.statisticsByLevel.get(i.key.level),a=e.stops.map((t=>({value:t.useMaxValue?s?.get(e.field)?.maxValue??0:t.useMinValue?s?.get(e.field)?.minValue??0:t.value,size:t.size?(0,o.d2)(t.size):o.sm}))).sort(((e,t)=>e.value-t.value)),r=Qe(a,8);return{values:r.map((({value:e})=>e)),sizes:r.map((({size:e})=>e))}};const t=e.stops.sort(((e,t)=>e.value-t.value)),i=Qe(t,8);return{values:i.map((({value:e})=>e)),sizes:i.map((({size:e})=>(0,o.d2)(e)))}}function gt(e){return t=>{const{state:i}=t;return{unitValueToPixelsRatio:(0,o.cm)(i.spatialReference)/o.qY[e.valueUnit??"meters"]/i.resolution}}}function vt(e,t){const i=t.length;if(e<t[0].value||1===i)return t[0].size;for(let s=1;s<i;s++)if(e<t[s].value){const i=(e-t[s-1].value)/(t[s].value-t[s-1].value);return t[s-1].size+i*(t[s].size-t[s-1].size)}return t[i-1].size}function wt(e){const{minDataValue:t,maxDataValue:i,minSize:s,maxSize:a}=e;if("object"==typeof s&&"object"==typeof a)return(e,r)=>{const n=e.state.scale,l=(0,o.d2)(vt(n,s.stops)),u=(0,o.d2)(vt(n,a.stops));return{minMaxValueAndSize:[t,i,l,u]}};if("object"==typeof s||"object"==typeof a)throw new Error("InternalError: Found a partial VisualVariableSizeMinMaxValue");return{minMaxValueAndSize:[t,i,(0,o.d2)(s),(0,o.d2)(a)]}}const St={visualVariableColor:null,visualVariableOpacity:null,visualVariableRotation:null,visualVariableSizeStops:null,visualVariableSizeScaleStops:null,visualVariableSizeOutlineScaleStops:null,visualVariableSizeUnitValue:null,visualVariableSizeMinMaxValue:null};function Vt(e,t=ht,i=dt){if(e.visualVariableSizeMinMaxValue)return e.visualVariableSizeMinMaxValue instanceof Function?ft:Math.max(e.visualVariableSizeMinMaxValue.minMaxValueAndSize[3]*i,t);if(e.visualVariableSizeScaleStops){if(e.visualVariableSizeScaleStops instanceof Function)return ft;const s=e.visualVariableSizeScaleStops.sizes;return Math.max(s[s.length-1]*i,t)}if(e.visualVariableSizeStops){if(e.visualVariableSizeStops instanceof Function)return ft;const s=e.visualVariableSizeStops.sizes;return Math.max(s[s.length-1]*i,t)}return e.visualVariableSizeUnitValue?2*ft:0}function zt(e){const t={...St};if(!e||!("visualVariables"in e)||!e.visualVariables)return t;for(const i of st(e.visualVariables))switch(i.type){case"color":t.visualVariableColor=mt(i);break;case"opacity":t.visualVariableOpacity=bt(i);break;case"rotation":t.visualVariableRotation=yt(i);break;case"size":switch(_t(i)){case"field-stops":t.visualVariableSizeStops=xt(i);break;case"scale-stops":"outline"===i.target?t.visualVariableSizeOutlineScaleStops=xt(i):t.visualVariableSizeScaleStops=xt(i);break;case"min-max":t.visualVariableSizeMinMaxValue=wt(i);break;case"unit-value":t.visualVariableSizeUnitValue=gt(i)}break}return t}function _t(e){return"number"==typeof e.minDataValue&&"number"==typeof e.maxDataValue&&null!=e.minSize&&null!=e.maxSize?"min-max":"$view.scale"===e?.valueExpression&&Array.isArray(e.stops)?"scale-stops":null==e.field&&"$view.scale"===e?.valueExpression||!(Array.isArray(e.stops)||"levels"in e&&e.levels)?null!=e.field||"$view.scale"!==e?.valueExpression?"unit-value":null:"field-stops"}function Ct(e){return!!(e.visualVariableSizeMinMaxValue||e.visualVariableSizeScaleStops||e.visualVariableSizeStops||e.visualVariableSizeUnitValue||e.visualVariableSizeOutlineScaleStops)}function Tt(e){return!!e.visualVariableRotation}function Pt(e){return e.minScale||e.maxScale?{minScale:e.minScale??0,maxScale:e.maxScale??0}:null}function Mt(e){if(null==e)return null;if(Array.isArray(e)){const[t,i,s,o]=e;return[t,i,s,255*o]}return"string"==typeof e?e:{...e,defaultValue:Mt(e?.defaultValue)}}async function At(e,t){const{cimResourceManager:i,cimAnalyzer:o,scaleExpression:a}=t.schemaOptions;await Promise.all(s.k.fetchResources(e.symbol,i,[]));const r=o.analyzeSymbolReference(e,!1),n={scaleInfo:Pt(e),scaleExpression:a},l=[];for(const s of r)switch(s.type){case"marker":l.push(...Rt(s,t,n));break;case"fill":l.push(...Dt(s,t,n));break;case"line":l.push(...Lt(s,t,n));break;case"text":l.push(...kt(s,t,n))}return l}function Rt(e,t,i){const{uniforms:s,schemaOptions:o}=t,{store:a}=o,r=e.isOutline?{...St,visualVariableSizeScaleStops:s.visualVariableSizeOutlineScaleStops}:{visualVariableColor:s.visualVariableColor,visualVariableOpacity:s.visualVariableOpacity,visualVariableSizeMinMaxValue:s.visualVariableSizeMinMaxValue,visualVariableSizeScaleStops:s.visualVariableSizeScaleStops,visualVariableSizeStops:s.visualVariableSizeStops,visualVariableSizeUnitValue:s.visualVariableSizeUnitValue,visualVariableRotation:s.visualVariableRotation};return e.animationParams?jt(a.ensureInstance($e.animatedMarker,{uniforms:r,optionalAttributes:{zoomRange:!0}}),e,St,i):It(a.ensureInstance($e.marker,{uniforms:r,optionalAttributes:{zoomRange:!!i.scaleInfo}}),e,s,i)}function jt(e,t,i,s){return t.animationParams?[e.createMeshInfo({pixelDimensions:t.pixelDimensions,texelDimensions:t.texelDimensions,effects:t.effects?{type:"cim-effect-infos",effectInfos:t.effects}:null,sprite:t.spriteRasterizationParam,animations:t.animationParams,scaleInfo:s.scaleInfo,scaleSymbolsProportionally:t.scaleSymbolsProportionally,strokeWidth:t.outlineWidth,isMapAligned:t.alignment===o.qE.MAP,colorLocked:t.colorLocked,isStroke:t.isStroke,baseSize:t.baseSize,referenceSize:t.referenceSize,angleToLine:!!t.markerPlacement&&t.markerPlacement.placement&&"angleToLine"in t.markerPlacement.placement&&t.markerPlacement.placement.angleToLine,sizeRatio:t.sizeRatio})]:[]}function It(e,t,i,{scaleInfo:s,scaleExpression:a}){const r=Ct(i);return[e.createMeshInfo({size:t.size,scaleX:t.scaleX,anchorX:t.anchorPoint.x,anchorY:t.anchorPoint.y,angle:t.rotation,color:Mt(t.color)??[0,0,0,0],colorLocked:t.colorLocked,frameHeight:t.frameHeight,widthRatio:t.widthRatio,scaleInfo:s,offsetX:t.offsetX,offsetY:t.offsetY,outlineColor:Mt(t.outlineColor)??[0,0,0,0],outlineSize:t.outlineWidth,referenceSize:t.referenceSize||o.rr.CIMVectorMarker.size,rotateClockwise:t.rotateClockwise,scaleFactor:a??1,sizeRatio:t.sizeRatio,alignment:t.alignment,isAbsoluteAnchorPoint:t.isAbsoluteAnchorPoint,scaleSymbolsProportionally:t.scaleSymbolsProportionally,sprite:t.spriteRasterizationParam,hasSizeVV:r,placement:t.markerPlacement,effects:t.effects?{type:"cim-effect-infos",effectInfos:t.effects}:null,transforms:t.transform,minPixelBuffer:Vt(i)})]}function Ot(e,t,i){const{uniforms:s,schemaOptions:o}=t,{store:a}=o;return Ft(a.ensureInstance($e.fill,{uniforms:{visualVariableColor:e.colorLocked?null:s.visualVariableColor,visualVariableOpacity:s.visualVariableOpacity},optionalAttributes:{zoomRange:!!i.scaleInfo}}),e,i)}function Ft(e,t,{scaleInfo:i}){return[e.createMeshInfo({color:Mt(t.color)??[0,0,0,0],scaleInfo:i,effects:t.effects?{type:"cim-effect-infos",effectInfos:t.effects}:null})]}function Dt(e,t,i){if(!e.spriteRasterizationParam)return Ot(e,t,i);const{uniforms:s,schemaOptions:o}=t,{store:a}=o;return Et(a.ensureInstance($e.complexFill,{uniforms:{visualVariableColor:e.colorLocked?null:s.visualVariableColor,visualVariableOpacity:s.visualVariableOpacity},optionalAttributes:{zoomRange:!!i.scaleInfo}}),e,null!=s.visualVariableColor,i)}function Et(e,t,i,{scaleInfo:s}){if(!t.spriteRasterizationParam)throw new Error("InternalError: Sprite should always be defined");const o=!!t.hasUnresolvedReplacementColor&&(!i||t.colorLocked),a=t.sampleAlphaOnly&&!o,r=t.spriteRasterizationParam;return[e.createMeshInfo({color:Mt(t.color)??[0,0,0,0],height:t.height,aspectRatio:t.scaleX,offsetX:t.offsetX,offsetY:t.offsetY,scaleX:1,scaleY:1,angle:t.angle,applyRandomOffset:t.applyRandomOffset,sampleAlphaOnly:a,scaleProportionally:"CIMHatchFill"===r.resource.type,sprite:r,scaleInfo:s,effects:t.effects?{type:"cim-effect-infos",effectInfos:t.effects}:null})]}function Lt(e,t,i){const{uniforms:s,schemaOptions:o}=t,{store:a}=o,r=e.isOutline?{...St,visualVariableSizeScaleStops:s.visualVariableSizeOutlineScaleStops}:{visualVariableColor:e.colorLocked?null:s.visualVariableColor,visualVariableOpacity:s.visualVariableOpacity,visualVariableSizeMinMaxValue:s.visualVariableSizeMinMaxValue,visualVariableSizeScaleStops:s.visualVariableSizeScaleStops,visualVariableSizeStops:s.visualVariableSizeStops,visualVariableSizeUnitValue:s.visualVariableSizeUnitValue},n={uniforms:r,optionalAttributes:{zoomRange:!!i.scaleInfo}},l=!!(r.visualVariableSizeMinMaxValue||r.visualVariableSizeScaleStops||r.visualVariableSizeStops||r.visualVariableSizeUnitValue);return e.spriteRasterizationParam?Gt(a.ensureInstance($e.texturedLine,n),e,l,i):Nt(a.ensureInstance($e.line,n),e,l,i)}function Ht(e,t,{scaleInfo:i}){return{color:Mt(e.color)??[0,0,0,0],width:e.width,referenceWidth:e.referenceWidth,capType:e.cap,joinType:e.join,miterLimit:e.miterLimit,scaleInfo:i,hasSizeVV:t,effects:e.effects?{type:"cim-effect-infos",effectInfos:e.effects}:null}}function Nt(e,t,i,s){if(t.spriteRasterizationParam)throw new Error("InternalError: Sprite should not be defined");const o=Ht(t,i,s);return[e.createMeshInfo(o)]}function Gt(e,t,i,s){const{spriteRasterizationParam:o,scaleDash:a,sampleAlphaOnly:r}=t;if(!o)throw new Error("InternalError: Sprite should be defined");return[e.createMeshInfo({...Ht(t,i,s),offsetAlongLine:t.offsetAlongLine??0,shouldScaleDash:a??!1,shouldSampleAlphaOnly:r,isSDF:"CIMPictureStroke"!==o.resource.type,sprite:o})]}function kt(e,t,i){const{uniforms:s,schemaOptions:o}=t,{store:a}=o;return Bt(a.ensureInstance($e.text,{uniforms:{visualVariableColor:e.colorLocked?null:s.visualVariableColor,visualVariableOpacity:s.visualVariableOpacity,visualVariableRotation:s.visualVariableRotation,visualVariableSizeMinMaxValue:s.visualVariableSizeMinMaxValue,visualVariableSizeScaleStops:s.visualVariableSizeScaleStops,visualVariableSizeStops:s.visualVariableSizeStops,visualVariableSizeUnitValue:s.visualVariableSizeUnitValue},optionalAttributes:{zoomRange:!!i.scaleInfo,referenceSymbol:!1,clipAngle:!1}}),e,s,i)}function Bt(e,t,i,{scaleInfo:s,scaleExpression:o}){return[e.createMeshInfo({boxBackgroundColor:Mt(t.backgroundColor),boxBorderLineColor:Mt(t.borderLineColor),boxBorderLineSize:t.borderLineWidth??0,color:Mt(t.color)??[0,0,0,0],offsetX:t.offsetX,offsetY:t.offsetY,postAngle:t.angle,fontSize:t.size,referenceSize:t.referenceSize,decoration:t.decoration,haloColor:Mt(t.haloColor)??[0,0,0,0],haloSize:t.haloSize??0,outlineColor:Mt(t.outlineColor)??[0,0,0,0],outlineSize:t.outlineSize,lineWidth:t.lineWidth||512,lineHeightRatio:1,horizontalAlignment:t.horizontalAlignment??"center",verticalAlignment:t.verticalAlignment??"baseline",useCIMAngleBehavior:!1,glyphs:t.textRasterizationParam,scaleInfo:s,effects:t.effects?{type:"cim-effect-infos",effectInfos:t.effects}:null,placement:t.markerPlacement,transforms:t.transform,scaleFactor:o??1,minPixelBuffer:Vt(i),repeatLabel:null,repeatLabelDistance:null,allowOverrun:null,labelPosition:null})]}function qt(e,t){return{type:"simple",filters:t,capabilities:{maxTextureSize:(0,o.nX)().maxTextureSize},bindings:Kt(e)}}function Ut(e){switch(e){case"opacity":return o.q8.OPACITY;case"color":return o.q8.COLOR;case"rotation":return o.q8.ROTATION;case"size":return o.q8.SIZE;default:return null}}function Kt(e){if(!e)return[];switch(e.type){case"simple":case"class-breaks":case"unique-value":case"dictionary":return Zt(e);case"dot-density":return Xt(e);case"pie-chart":return Wt(e);case"heatmap":return $t(e)}}function Xt(e){const t=[];for(const i of e.attributes)t.push({binding:t.length,expression:i.valueExpression,field:i.field});return t}function Wt(e){const t=Zt(e);let i=4;for(const s of e.attributes)t.push({binding:i++,expression:s.valueExpression,field:s.field});return t}function $t({valueExpression:e,field:t}){return e||t?[{binding:0,expression:e,field:t}]:[]}function Zt(e){return"visualVariables"in e&&e.visualVariables?.length?st(e.visualVariables).map((e=>ti(e))).filter(o.ci):[]}function Yt(e){return"$view.scale"===e.valueExpression?null:{binding:Ut(e.type),field:e.field,normalizationField:e.normalizationField,expression:e.valueExpression,valueRepresentation:e.valueRepresentation}}function Qt(e){return{binding:Ut(e.type),field:e.field,normalizationField:e.normalizationField,expression:e.valueExpression}}function Jt(e){return{binding:Ut(e.type),field:e.field,normalizationField:e.normalizationField,expression:e.valueExpression}}function ei(e){return{binding:Ut(e.type),expression:e.valueExpression,field:e.field}}function ti(e){switch(e.type){case"size":return Yt(e);case"color":return Qt(e);case"opacity":return Jt(e);case"rotation":return ei(e)}}class ii{constructor(e){this.updateTracking=new s.i({debugName:"FeatureCommandQueue"}),this._queueProcessor=new o.oO({concurrency:1,process:e.process})}destroy(){this.updateTracking.destroy(),this._queueProcessor.destroy(),this.clear()}clear(){this._queueProcessor.clear()}async push(e){return(0,o.gL)(this.updateTracking.addPromise(this._doPush(e)))}async _doPush(e){const t=this._queueProcessor,i=t.last();switch(e.type){case"update":case"highlight":return i?.type===e.type?void 0:t.push(e);case"edit-by-id":case"edit-by-feature":return t.push(e)}}}}}]);
//# sourceMappingURL=8253.a6fa449e.js.map