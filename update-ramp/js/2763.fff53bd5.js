"use strict";(self["webpackChunkramp_website"]=self["webpackChunkramp_website"]||[]).push([[2763],{66080:function(e,t,i){i.d(t,{E:function(){return s}});var r=i(44444);const n=()=>r.G.getLogger("esri.views.webgl.BufferObject");class s{static createIndex(e,t,i){return new s(e,r.ay.ELEMENT_ARRAY_BUFFER,t,i)}static createVertex(e,t,i){return new s(e,r.ay.ARRAY_BUFFER,t,i)}static createUniform(e,t,i){return new s(e,r.ay.UNIFORM_BUFFER,t,i)}static createPixelPack(e,t=r.az.STREAM_READ,i){const n=new s(e,r.ay.PIXEL_PACK_BUFFER,t);return i&&n.setSize(i),n}static createPixelUnpack(e,t=r.az.STREAM_DRAW,i){return new s(e,r.ay.PIXEL_UNPACK_BUFFER,t,i)}static createTransformFeedback(e,t=r.az.STATIC_DRAW,i){const n=new s(e,r.ay.TRANSFORM_FEEDBACK_BUFFER,t);return n.setSize(i),n}constructor(e,t,i,n){this._context=e,this.bufferType=t,this.usage=i,this._glName=null,this._size=-1,this._indexType=void 0,e.instanceCounter.increment(r.aA.BufferObject,this),this._glName=this._context.gl.createBuffer(),(0,r.aB)(this._context.gl),n&&this.setData(n)}get glName(){return this._glName}get size(){return this._size}get indexType(){return this._indexType}get usedMemory(){if(this.bufferType===r.ay.ELEMENT_ARRAY_BUFFER){if(this._indexType===r.aC.UNSIGNED_INT)return 4*this._size;if(this._indexType===r.aC.UNSIGNED_SHORT)return 2*this._size}return this._size}get _isVAOAware(){return this.bufferType===r.ay.ELEMENT_ARRAY_BUFFER||this.bufferType===r.ay.ARRAY_BUFFER}dispose(){this._context?.gl?(this._glName&&(this._context.gl.deleteBuffer(this._glName),this._glName=null),this._context.instanceCounter.decrement(r.aA.BufferObject,this),this._context=null):this._glName&&n().warn("Leaked WebGL buffer object")}setSize(e,t=null){if(this.bufferType===r.ay.ELEMENT_ARRAY_BUFFER&&null!=t)switch(this._indexType=t,t){case r.aC.UNSIGNED_SHORT:e*=2;break;case r.aC.UNSIGNED_INT:e*=4}this._setBufferData(e)}setData(e){if(!e)return;let t=e.byteLength;this.bufferType===r.ay.ELEMENT_ARRAY_BUFFER&&((0,r.aD)(e)?this._indexType=r.aC.UNSIGNED_BYTE:(0,r.aE)(e)?(t/=2,this._indexType=r.aC.UNSIGNED_SHORT):(0,r.aF)(e)&&(t/=4,this._indexType=r.aC.UNSIGNED_INT)),this._setBufferData(t,e)}_setBufferData(e,t=null){this._size=e;const i=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const n=this._context.gl;null!=t?n.bufferData(this.bufferType,t,this.usage):n.bufferData(this.bufferType,e,this.usage),(0,r.aB)(n),this._isVAOAware&&this._context.bindVAO(i)}setSubData(e,t,i,n){if(!e)return;const s=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const{gl:o}=this._context;o.bufferSubData(this.bufferType,t*e.BYTES_PER_ELEMENT,e,i,n-i),(0,r.aB)(o),this._isVAOAware&&this._context.bindVAO(s)}getSubData(e,t=0,i,s){if(i<0||s<0)return;const a=o(e)?e.BYTES_PER_ELEMENT:1;if(a*((i??0)+(s??0))>e.byteLength)return;t+a*(s??0)>this.usedMemory&&n().warn("Potential problem getting subdata: requested data exceeds buffer size!");const l=this._context.gl;this.bufferType===r.ay.TRANSFORM_FEEDBACK_BUFFER?(this._context.bindBuffer(this,r.ay.TRANSFORM_FEEDBACK_BUFFER),l.getBufferSubData(r.ay.TRANSFORM_FEEDBACK_BUFFER,t,e,i,s),this._context.unbindBuffer(r.ay.TRANSFORM_FEEDBACK_BUFFER)):(this._context.bindBuffer(this,r.ay.COPY_READ_BUFFER),l.getBufferSubData(r.ay.COPY_READ_BUFFER,t,e,i,s),this._context.unbindBuffer(r.ay.COPY_READ_BUFFER))}async getSubDataAsync(e,t=0,i,r){await this._context.clientWaitAsync(),this.getSubData(e,t,i,r)}}function o(e){return(0,r.aG)(e)}},12763:function(e,t,i){i.r(t),i.d(t,{D:function(){return En},F:function(){return On},R:function(){return Sn},S:function(){return Rn},a:function(){return An}});var r=i(44444),n=i(95599),s=i(46993),o=i(32707),a=i(67026),l=i(15317),c=i(10717),h=i(50094),d=i(36012),u=i(77485),f=i(77703),p=i(52454),_=i(71807),m=i(43038),g=i(25865),y=i(38837),v=i(81203),b=i(90326),w=i(10769),T=i(50940),x=i(66080),O=i(97975),R=i(56499),A=i(40102),E=i(51800),S=i(64235),I=i(3930),C=i(73411),M=(i(65332),i(80152)),D=i(9498),F=(i(30726),i(7137)),B=i(32443),P=i(76328),L=i(55334);function N(e){e.code.add(P.o`const float MAX_RGBA_FLOAT =
255.0 / 256.0 +
255.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 / 256.0;
const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);
vec4 float2rgba(const float value) {
float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);
vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);
const float toU8AsFloat = 1.0 / 255.0;
return fixedPointU8 * toU8AsFloat;
}`),e.code.add(P.o`const vec4 RGBA_2_FLOAT_FACTORS = vec4(
255.0 / (256.0),
255.0 / (256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0 * 256.0)
);
float rgba2float(vec4 rgba) {
return dot(rgba, RGBA_2_FLOAT_FACTORS);
}`),e.code.add(P.o`const vec4 uninterpolatedRGBAToFloatFactors = vec4(
1.0 / 256.0,
1.0 / 256.0 / 256.0,
1.0 / 256.0 / 256.0 / 256.0,
1.0 / 256.0 / 256.0 / 256.0 / 256.0
);
float uninterpolatedRGBAToFloat(vec4 rgba) {
return (dot(round(rgba * 255.0), uninterpolatedRGBAToFloatFactors) - 0.5) * 2.0;
}`)}let z=class extends l.d{constructor(e,t){super(e,"vec4",L.a.Draw,((i,r,n)=>i.setUniform4fv(e,t(r,n))))}},G=class extends r.e9{constructor(e){super(e),this._removing=0,this._tiles=new r.j2}destroy(){for(const e of this._tiles.values())e.remove();this._tiles.clear()}get updating(){if(this._removing>0)return!0;for(const e of this._tiles.values())if(!e.finished)return!0;return!1}async onTileTreeChange(e){const{added:t,removed:i}=e,n=this._tiles,s=[];for(const r of i){const e=n.get(r);null!=e&&(e.abort(),n.delete(r),s.push({tileId:r}))}for(const o of t)n.has(o.id)||n.set(o.id,(0,r.dg)((e=>this._addTile(o,e))));await this._removeTiles(s)}async _addTile(e,t){const i=await this.addTile(e,t);return(0,r.J)(t),i}async _removeTiles(e){this._removing++,await this.removeTiles(e),this._removing--}};(0,r.bt)([(0,r.bu)()],G.prototype,"updating",null),(0,r.bt)([(0,r.bu)({constructOnly:!0})],G.prototype,"addTile",void 0),(0,r.bt)([(0,r.bu)({constructOnly:!0})],G.prototype,"removeTiles",void 0),(0,r.bt)([(0,r.bu)()],G.prototype,"_removing",void 0),G=(0,r.bt)([(0,r.bv)("esri.views.3d.layers.graphics.pipeline.Tile3DManager")],G);let V=class{constructor(e,t){this._index=e,this._view=t}getObjectId(){return this._view.getObjectId(this._index)}getAttribute(e){return this._view.getAttribute(this._index,e)}getAttributeAsTimestamp(e){return this._view.getAttributeAsTimestamp(this._index,e)}getAttributes(){return this._view.getAttributes(this._index)}getOptimizedGeometry(){return this._view.getOptimizedGeometry(this._index)}getCentroid(e){return this._view.getCentroid(this._index,e)}getBounds(){return this._view.getBounds(this._index)}getBoundingBox(){return this._view.getBoundingBox(this._index)}cloneWithGeometry(e){return new H(this._index,this._view,e)}},H=class extends V{constructor(e,t,i){super(e,t),this._geometryOverride=i}getOptimizedGeometry(){return this._geometryOverride}getCentroid(e){return(0,o.n)(new r.d9,this._geometryOverride,e.hasZ,e.hasM)}},j=class{constructor(){this._storedTiles=new Map,this._pageBounds=new Map,this.events=new r.d4,this.featureAdapter=U.shared}addTile(e){this._storedTiles.set(e.descriptor.id,e);for(const t of e.pages)this._addPage(t)}removeTile(e){const t=this._storedTiles,i=t.get(e);if(null!=i){t.delete(e);for(const e of i.pages)this._removePage(e)}}_addPage(e){const{featureCount:t}=e;if(0===t)return;const i=new s.h(9,(t=>e.getBounds(t))),r=new Array;for(let n=0;n<t;++n)r[n]=n;i.load(r),this._pageBounds.set(e,i),this.events.emit("changed")}_removePage(e){this._pageBounds.delete(e),this.events.emit("changed")}clear(){this._storedTiles.clear(),this._pageBounds.clear(),this.events.emit("changed")}forEach(e){for(const[t,i]of this._pageBounds)i.all((i=>e(new V(i,t))))}forEachInBounds(e,t){Y.minX=e[0],Y.minY=e[1],Y.maxX=e[2],Y.maxY=e[3];for(const[i,r]of this._pageBounds)r.search(Y,(e=>t(new V(e,i))))}forEachBounds(e,t){for(const i of e)t(i.getBoundingBox())}getFullExtent(e){let t=1/0,i=1/0,r=-1/0,n=-1/0;for(const s of this._pageBounds.values()){const{minX:e,minY:o,maxX:a,maxY:l}=s.toJSON();t=Math.min(t,e),i=Math.min(i,o),r=Math.min(r,a),n=Math.min(n,l)}return{xmin:t,ymin:i,xmax:r,ymax:n,spatialReference:e}}},U=class{getObjectId(e){return e.getObjectId()}getAttribute(e,t){return e.getAttribute(t)}getAttributeAsTimestamp(e,t){return e.getAttributeAsTimestamp(t)}getAttributes(e){return e.getAttributes()}getGeometry(e){return e.getOptimizedGeometry()}getCentroid(e,t){return e.getCentroid(t)}cloneWithGeometry(e,t){return e.cloneWithGeometry(t)}};U.shared=new U;const Y=new s.E;let q=class{constructor(e,t){this.descriptor=e,this.pages=t}},k=class{constructor(e){const t=new r.oI(new Uint8Array(e),new DataView(e));this._reader=t,this._index=X(t)}get featureCount(){return this._index.featureIndices.length}get exceededTransferLimit(){return this._index.exceededTransferLimit}getObjectId(e){return this.getAttribute(e,this._index.objectIdFieldName)}getAttribute(e,t){const{_index:{fieldsIndex:i,attributeIndices:r}}=this,n=i.get(t)?.index;if(null==n)return;const s=r[e*i.fields.length+n],o=this._reader;return o.move(s),J(o)}getAttributeAsTimestamp(e,t){const i=this.getAttribute(e,t);return"string"==typeof i?new Date(i).getTime():"number"==typeof i||null==i?i:null}getAttributes(e){const{_index:{fieldsIndex:t,attributeIndices:i}}=this,r=e*t.fields.length,n=this._reader,s={};for(const o of t.fields){const e=i[r+o.index];n.move(e),s[o.name]=J(n)}return s}getCoordinates(e,t,i=0){const r=this._reader,{transform:n,featureIndices:s}=this._index,{scale:o,translate:a}=n;r.move(s[e]),this._readCoordinates(o,a,t,i)}getOptimizedGeometry(e){const t=(0,r.ap)();return this.getCoordinates(e,t),new r.d9([],t)}getCentroid(e,{hasZ:t,hasM:i}){this.getCoordinates(e,Z);const[n,s,o]=Z,a=[n,s];return t&&(a[3]=o),i&&(a[t?4:3]=0),new r.d9([],a)}getBounds(e){this.getCoordinates(e,Z);const[t,i]=Z,r=new s.E;return r.minX=t,r.minY=i,r.maxX=t,r.maxY=i,r}getBoundingBox(e){this.getCoordinates(e,Z);const[t,i,n]=Z;return(0,r.kD)(t,i,n,t,i,n)}readAllObjectIds(e,t=0){const i=this._reader,{_index:r,featureCount:n}=this,{objectIdFieldName:s,attributeIndices:o,fieldsIndex:a}=r,l=a.get(s).index,c=a.fields.length;for(let h=0;h<n;++h){const r=o[h*c+l];i.move(r),e[t++]=J(i)}return t}readAllCoordinates(e,t=0){const i=this._reader,{transform:r,featureIndices:n}=this._index,{scale:s,translate:o}=r;for(const a of n)i.move(a),t=this._readCoordinates(s,o,e,t);return t}_readCoordinates([e,t,i],[r,n,s],o,a){const l=this._reader,c=l.getLength(),h=l.pos()+c;for(;l.pos()<h&&l.next();)switch(l.tag()){case 2:{const c=l.getLength(),h=l.pos()+c;for(;l.pos()<h&&l.next();)3===l.tag()?(l.getUInt32(),o[a++]=r+e*l.getSInt64(),o[a++]=n+t*l.getSInt64(),o[a++]=s+i*l.getSInt64()):l.skip();break}default:l.skip()}return a}};function X(e){for(;e.next();){if(2===e.tag())return W(e.getMessage());e.skip()}$()}function W(e){for(;e.next();){if(1===e.tag())return Q(e.getMessage());e.skip()}$()}function Q(e){let t,i,n=!1,s=!1,o=0;const a=new Array,l=new Array,c=new Array;for(;e.next();)switch(e.tag()){case 1:i=e.getString();break;case 7:0!==e.getEnum()&&$();break;case 9:n=e.getBool()??!1;break;case 12:t=(0,r.vc)(e.processMessage(r.sv));break;case 13:{const t=e.processMessage(r.su);t.index=o++,a.push(t);break}case 15:{l.push(e.pos());const t=e.getUInt32(),i=e.pos()+t;for(;e.pos()<i&&e.next();)1===e.tag()&&c.push(e.pos()),e.skip();break}case 10:s=e.getBool()??!1;break;default:e.skip()}const h=new r.db(a);return null!=t&&s&&null!=i&&h.has(i)||$(),{transform:t,exceededTransferLimit:n,fieldsIndex:h,objectIdFieldName:i,featureIndices:l,attributeIndices:c}}function $(){const e=new r.s("pbf-parsing-failed","Error while parsing PBF",new Error);throw console.error(e),e}function J(e){const t=e.getLength(),i=e.pos()+t;for(;e.pos()<i&&e.next();)switch(e.tag()){case 1:return e.getString();case 2:return e.getFloat();case 3:return e.getDouble();case 4:return e.getSInt32();case 5:return e.getUInt32();case 6:return e.getInt64();case 7:return e.getUInt64();case 8:return e.getSInt64();case 9:return e.getBool();default:return e.skip(),null}return null}const Z=(0,r.ap)(),K=8e3,ee=4,te=4;let ie=class{constructor(e,t,i,r,n){this.spatialReference=e,this.url=i,this.objectIdField=r,this.capabilities=n;const{supportsMaxRecordCountFactor:s,maxRecordCount:o}=this.capabilities.query,a=s?ee:1,l=(o??K)*a;this._pageSize=Math.min(K,l);const c=t.clone();c.cacheHint=!0,c.resultType="tile",c.outSpatialReference=e,c.returnGeometry=!0,c.returnZ=!0,c.maxRecordCountFactor=a,c.num=this._pageSize,c.outFields=[r],this._baseQuery=c}async fetch(e,t){const{spatialReference:i}=this,n=(0,r.eU)(e.extent,i),s=this._baseQuery.clone();s.geometry=n;const o=new Array;let a=0,l=!1,c=1;for(;!l;){const e=[];for(let r=0;r<c;++r)e.push(this._fetchPage(s,a++,t));const i=await Promise.all(e);(0,r.J)(t);for(const t of i){const e=0!==t.featureCount;l||=!t.exceededTransferLimit||!e,e&&o.push(t)}c=Math.min(c+1,te)}return new q(e,o)}async _fetchPage(e,t,i){const n=e.clone();n.start=t*this._pageSize;const s=(await(0,r.sw)(this.url,n,{signal:i})).data;return(0,r.J)(i),new k(s)}};var re;(function(e){e[e.Left=0]="Left",e[e.Center=1]="Center",e[e.Right=2]="Right"})(re||(re={}));const ne=Object.freeze({"bottom-left":(0,r.o5)(0,0),bottom:(0,r.o5)(.5,0),"bottom-right":(0,r.o5)(1,0),left:(0,r.o5)(0,.5),center:(0,r.o5)(.5,.5),right:(0,r.o5)(1,.5),"top-left":(0,r.o5)(0,1),top:(0,r.o5)(.5,1),"top-right":(0,r.o5)(1,1)}),se={required:[]};h.b.Depth;let oe=class extends r.e9{precompile(e){const t=this.acquireTechniques(e);return ce(t),null!=t}consumes(){return se}get usedMemory(){return 0}get isDecoration(){return!1}get running(){return!1}modify(e){}get numGeometries(){return 0}get hasOccludees(){return!1}get hasEmissions(){return!1}forEachGeometry(e){}queryRenderOccludedState(e){return!1}},ae=class extends oe{},le=class extends oe{};function ce(e){Array.isArray(e)?e.forEach((e=>e?.release())):e?.release()}let he=class{constructor(e,t){this._material=e,this._repository=t,this._map=new Map}dispose(){this._map.forEach(((e,t)=>{null!=e&&this._repository.release(this._material,t)}))}load(e,t,i){if(!this._material.produces.get(t)?.(i))return null;this._map.has(i)||this._map.set(i,this._repository.acquire(this._material,t,i));const r=this._map.get(i);if(null!=r){if(r.ensureResources(e)===d.O.LOADED)return r;this._repository.requestRender()}return null}},de=class extends l.f{constructor(e=(0,r.ap)()){super(),this.origin=e}get slicePlaneLocalOrigin(){return this.origin}};var ue,fe;(function(e){e[e.ADD=0]="ADD",e[e.UPDATE=1]="UPDATE",e[e.REMOVE=2]="REMOVE"})(ue||(ue={})),function(e){e[e.NONE=0]="NONE",e[e.VISIBILITY=1]="VISIBILITY",e[e.GEOMETRY=2]="GEOMETRY",e[e.TRANSFORMATION=4]="TRANSFORMATION",e[e.HIGHLIGHT=8]="HIGHLIGHT",e[e.OCCLUDEE=16]="OCCLUDEE"}(fe||(fe={}));let pe=class{constructor(e=0,t=0){this.from=e,this.to=t}get numElements(){return this.to-this.from}};function _e(e){const t=new Map;e.forAll((e=>t.set(e.from,e)));let i=!0;for(;i;){i=!1;for(let r=0;r<e.length;++r){const n=e.data[r],s=t.get(n.to);if(!s)return;n.to=s.to,t.delete(s.from),e.removeUnordered(s),i=!0}}}let me=class extends pe{constructor(e,t,i){super(t,i),this.geometry=e}get isVisible(){return this.geometry.visible}get hasHighlights(){return this.isVisible&&this.geometry.hasHighlights}foreachHighlightGroup(e){this.isVisible&&this.geometry.foreachHighlightGroup(e)}get hasOccludees(){return null!=this.geometry.occludees}},ge=class{constructor(){this.first=0,this.count=0}},ye=class{constructor(){this._numElements=0,this._instances=new Map,this.holes=new r.cM({allocator:e=>e||new pe,deallocator:null}),this.hasHiddenInstances=!1,this.hasOccludees=!1,this.drawCommandsDirty=!0,this.highlightGroups=new Set,this.drawCommandsDefault=be(),this.drawCommandsHighlights=new Map,this.drawCommandsOccludees=be(),this.drawCommandsShadowHighlightRest=be()}get numElements(){return this._numElements}get instances(){return this._instances}get hasHighlights(){return this.highlightGroups.size>0}resetInstanceSummary(){this.hasHiddenInstances=!1,this.hasOccludees=!1,this.highlightGroups.clear()}updateIfDrawCommandsDirty(e){if(this.drawCommandsDirty){this.resetInstanceSummary();for(const e of this.instances.values())this.updateDrawState(e);this.updateDrawCommands(e)}}addInstance(e,t){this.deleteInstance(e),this._instances.set(e,t),this._numElements+=t.numElements}deleteInstance(e){const t=this._instances.get(e);t&&(this._numElements-=t.numElements,this._instances.delete(e))}updateInstance(e,t,i){const r=this._instances.get(e);r&&(this._numElements-=r.numElements,r.from=t,r.to=i,this._numElements+=r.numElements)}updateDrawState(e){e.isVisible?(e.foreachHighlightGroup((e=>this.highlightGroups.add(e))),e.hasOccludees&&(this.hasOccludees=!0)):this.hasHiddenInstances=!0}updateDrawCommands(e){if(this.drawCommandsDefault.clear(),this.drawCommandsHighlights.clear(),this.drawCommandsOccludees.clear(),this.drawCommandsShadowHighlightRest.clear(),this.drawCommandsDirty=!1,0===this._instances.size)return;if(!this.needsMultipleCommands()){const t=this.drawCommandsDefault.pushNew(),i=this.holes.front();return null!=this.vao&&1===this.holes.length&&i.to===Math.floor(this.vao.byteSize/e)?(t.first=0,void(t.count=i.from)):(t.first=1/0,t.count=0,this._instances.forEach((e=>{t.first=Math.min(t.first,e.from),t.count=Math.max(t.count,e.to)})),void(t.count-=t.first))}const t=Array.from(this._instances.values()).sort(((e,t)=>e.from===t.from?e.to-t.to:e.from-t.from)),{drawCommandsHighlights:i}=this;for(const r of t)r.isVisible&&(we(r.hasOccludees?this.drawCommandsOccludees:this.drawCommandsDefault,r),r.hasHighlights?r.foreachHighlightGroup((e=>{let t=i.get(e);t||(t=be(),i.set(e,t)),we(t,r)})):we(this.drawCommandsShadowHighlightRest,r))}needsMultipleCommands(){return this.hasOccludees||this.hasHighlights||this.hasHiddenInstances}};function ve(e){return null!=e.vao}function be(){return new r.cM({allocator:e=>e||new ge,deallocator:e=>e})}function we(e,t){const i=e.back();if(null==i){const i=e.pushNew();return i.first=t.from,void(i.count=t.numElements)}if(Te(i,t)){const e=t.from-i.first+t.numElements;i.count=e}else{const i=e.pushNew();i.first=t.from,i.count=t.numElements}}function Te(e,t){return e.first+e.count>=t.from}let xe=class{constructor(e){this.origin=e,this.buffers=new Array}dispose(){this.buffers.forEach((e=>e.vao.dispose())),this.buffers.length=0}findBuffer(e){return this.buffers.find((t=>t.instances.has(e)))}},Oe=class extends ae{get _hasAnyHighlight(){return this._highlightGroups.size>0}constructor(e){super(e),this._dataByOrigin=new Map,this._drawParameters=new de,this._highlightGroups=new Set,this.drapedPriority=0,this._produces=new Map,this._hasOccludees=!1}destroy(){this._glMaterials=(0,r.aI)(this._glMaterials),this._dataByOrigin.forEach((e=>e.dispose())),this._dataByOrigin.clear(),this._vaoCache=null}initialize(){this.material.produces.forEach(((e,t)=>{this._produces.set(t,(t=>!(0===this._dataByOrigin.size||!(t!==h.b.Highlight&&t!==h.b.ShadowHighlight||this._hasAnyHighlight))&&e(t)))}))}initializeRenderContext(e,t){this._glMaterials=new he(this.material,t??e.materials),this._bufferWriter=this.material.createBufferWriter(),this._vaoCache=e.renderContext.rctx.getVaoCache(this.material.vertexAttributeLocations,(0,c.t)(this._bufferWriter.vertexBufferLayout))}uninitializeRenderContext(){}get produces(){return this._produces}get hasOccludees(){return this._hasOccludees}get hasEmissions(){return this.material.hasEmissions}get isDecoration(){return this.material.parameters.isDecoration}queryRenderOccludedState(e){return this.material.queryRenderOccludedState(e)}get numGeometries(){let e=0;return this._dataByOrigin.forEach((t=>e+=t.buffers.reduce(((e,t)=>e+t.instances.size),0))),e}get usedMemory(){let e=0;return this._dataByOrigin.forEach((t=>e+=t.buffers.reduce(((e,t)=>e+t.vao.usedMemory),0))),e}forEachGeometry(e){this._dataByOrigin.forEach((t=>t.buffers.forEach((t=>t.instances.forEach((({geometry:t})=>e(t)))))))}modify(e){this._updateGeometries(e.updates),this._addAndRemoveGeometries(e.adds,e.removes),this._updateDrawCommands()}_updateGeometries(e){const t=this._bufferWriter;if(null==t)return;const i=t.vertexBufferLayout.stride/4;for(const r of e){const e=r.renderGeometry,n=this._dataByOrigin.get(e.localOrigin.id),s=n?.findBuffer(e.id);if(null==s)return;const o=s.instances.get(e.id);if(r.updateType&(fe.GEOMETRY|fe.TRANSFORMATION)){const r=Le(t.elementCount(o.geometry.geometry.attributes)*i),n=t.vertexBufferLayout.createView(r.buffer);this._writeGeometry(e,n,0),s.vao.vertexBuffers.get("geometry").setSubData(r,o.from*i,0,o.numElements*i)}r.updateType&(fe.HIGHLIGHT|fe.OCCLUDEE|fe.VISIBILITY)&&(s.drawCommandsDirty=!0)}}_computeDeltas(e,t){const i=new u.t;for(const r of e){const e=r.localOrigin;if(null==e)continue;let t=i.get(e.id,null);null==t&&(t=new Re(e.vec3),i.set(e.id,null,t)),t.changes.push(r)}for(const r of t){const e=r.localOrigin;if(null==e)continue;const t=this._dataByOrigin.get(e.id),n=t?.findBuffer(r.id);if(null==n)continue;let s=i.get(e.id,n);null==s&&(s=new Re(e.vec3),i.set(e.id,n,s)),s.changes.push(r)}return i}_addAndRemoveGeometries(e,t){if(null==this._bufferWriter||null==this._vaoCache)return;const{_bufferWriter:i,_dataByOrigin:n}=this,s=i.vertexBufferLayout.stride/4,o=this._computeDeltas(e,t);o.forEach(((e,t)=>{const a=e.get(null),l=a?.changes??[];o.delete(t,null);let c=n.get(t);if(e.forEach(((e,a)=>{if(o.delete(t,a),null==a)return void(0,p.s)(!1,"No VAO for removed geometries");if(a.instances.size===e.changes.length)return this._vaoCache.deleteVao(a.vao),(0,r.vd)(c.buffers,a),void(0===c.buffers.length&&0===l.length&&n.delete(t));const h=a.numElements,d=a.vao.byteSize/4,u=l.reduce(((e,t)=>e+i.elementCount(t.geometry.attributes)),0),f=e.changes.reduce(((e,t)=>e+i.elementCount(t.geometry.attributes)),0),_=Math.min((h+u-f)*s,Be),m=_>d;_>Ce&&_<d/2?(e.changes.forEach((({id:e})=>a.deleteInstance(e))),a.instances.forEach((({geometry:e})=>l.push(e))),this._vaoCache.deleteVao(a.vao),(0,r.vd)(c.buffers,a)):m?this._applyAndRebuild(a,l,e):this._applyRemoves(a,e)})),l.length>0)for(null==c&&(c=new xe(a.origin),n.set(t,c)),c.buffers.forEach((e=>this._applyAdds(e,l)));l.length>0;)c.buffers.push(this._applyAndRebuild(new ye,l,null))}))}_updateDrawCommands(){this._highlightGroups.clear(),this._hasOccludees=!1,this._dataByOrigin.forEach((e=>{e.buffers.forEach((e=>{e.updateIfDrawCommandsDirty(this._bufferWriter.vertexBufferLayout.stride),e.hasHighlights&&(0,r.ve)(this._highlightGroups,e.highlightGroups),this._hasOccludees=this._hasOccludees||e.hasOccludees}))}))}_applyAndRebuild(e,t,i){if(i)for(const f of i.changes)e.deleteInstance(f.id);const r=this._bufferWriter,n=r.vertexBufferLayout.stride,s=n/4,o=Math.floor(Be/s);let a=e.numElements;for(;t.length>0;){const i=t.pop(),n=r.elementCount(i.geometry.attributes);if(a+n>o&&a>0){t.push(i);break}a+=n;const s=new me(i,0,0);(0,p.s)(null==e.instances.get(i.id)),e.addInstance(i.id,s)}const l=a*s,c=Le(l),h=r.vertexBufferLayout.createView(c.buffer);let d=0;e.resetInstanceSummary(),e.instances.forEach(((t,i)=>{this._writeGeometry(t.geometry,h,d);const n=d;d+=r.elementCount(t.geometry.geometry.attributes),e.updateInstance(i,n,d),e.updateDrawState(t)})),this._vaoCache.deleteVao(e.vao),e.vao=this._vaoCache.newVao(Ne(l)),e.vao.vertexBuffers.get("geometry").setSubData(c,0,0,d*s),e.holes.clear();const u=e.holes.pushNew();return u.from=d,u.to=Math.floor(e.vao.byteSize/n),e.updateDrawCommands(n),e}_applyRemoves(e,t){if(0===t.changes.length||null==this._bufferWriter)return;for(const o of t.changes){const t=o.id,i=e.instances.get(t);if(!i)continue;e.deleteInstance(t);const r=Ie.back();if(r){if(r.to===i.from){r.to=i.to;continue}if(r.from===i.to){r.from=i.from;continue}}const n=Ie.pushNew();n.from=i.from,n.to=i.to}_e(Ie);const i=this._bufferWriter.vertexBufferLayout.stride/4,r=Ie.reduce(((e,t)=>Math.max(e,t.numElements)),0)*i,n=Le(r);n.fill(0,0,r);const s=e.vao.vertexBuffers.get("geometry");Ie.forAll((e=>s.setSubData(n,e.from*i,0,e.numElements*i))),e.holes.pushArray(Ie.data,Ie.length),Ie.forAll(((e,t)=>Ie.data[t]=null)),Ie.clear(),e.drawCommandsDirty=!0}_applyAdds(e,t){if(0===t.length||null==this._bufferWriter)return;if(!ve(e))return void this._applyAndRebuild(e,t,null);const i=this._bufferWriter,n=i.vertexBufferLayout.stride/4,s=e.numElements,o=t.reduce(((e,t)=>e+i.elementCount(t.geometry.attributes)),0),a=Math.min((s+o)*n,Be),l=4*a;if(e.vao.byteSize<Ne(Be-Ce)&&l>e.vao.byteSize)return void this._applyAndRebuild(e,t,null);_e(e.holes);const c=new Array;for(const r of t){const t=i.elementCount(r.geometry.attributes),n=Ae(e.holes,t);c.push(n)}const h=e.vao.vertexBuffers.get("geometry");let d=0,u=0,f=0;const _=Le(a),m=i.vertexBufferLayout.createView(_.buffer);t.forEach(((t,r)=>{const s=c[r];if(null==s)return;if(f!==s){const e=f-u;e>0&&h.setSubData(_,u*n,0,e*n),u=s,d=0}const o=i.elementCount(t.geometry.attributes);this._writeGeometry(t,m,d),d+=o,f=s+o;const a=new me(t,s,s+o);(0,p.s)(null==e.instances.get(t.id)),e.addInstance(t.id,a),e.drawCommandsDirty=!0}));const g=f-u;g>0&&h.setSubData(_,u*n,0,g*n),(0,r.vf)(t,((e,t)=>null==c[t]))}_writeGeometry(e,t,i){null!=this._bufferWriter&&((0,r.gk)(Ee,e.transformation),Ee[12]-=e.localOrigin.vec3[0],Ee[13]-=e.localOrigin.vec3[1],Ee[14]-=e.localOrigin.vec3[2],(0,r.dV)(Se,Ee),(0,r.dW)(Se,Se),this._bufferWriter.write(Ee,Se,e.geometry.attributes,e.geometry.objectAndLayerIdColor,t,i))}updateAnimation(e){return this.material.update(e)}acquireTechniques(e){if(!this.material.shouldRender(e))return null;const{output:t,bind:i}=e;if(!this.material.produces.get(i.slot)?.(t))return null;const{highlightGroupName:r,slot:n}=i,s=t===h.b.ShadowHighlight,o=t===h.b.Highlight,a=o||s,l=e=>a&&(0===this._highlightGroups.size||o&&!!r&&!e.has(r));if(l(this._highlightGroups))return null;const c=t===h.b.ShadowExcludeHighlight,d=!(a||c);for(const{buffers:h}of this._dataByOrigin.values())for(const o of h){if(l(o.highlightGroups))continue;const h=s?o.drawCommandsHighlights.size>0:a?r?o.drawCommandsHighlights.get(r):o.drawCommandsHighlights.size>0:((c&&o.needsMultipleCommands()?o.drawCommandsShadowHighlightRest:o.drawCommandsDefault)||null)?.length??!1,u=d&&o.drawCommandsOccludees||null;if(h||u?.length){const r=this._glMaterials.load(e.rctx,n,t),s=r?.beginSlot(i);if(s)return s}}return null}render(e,t){const{output:i,bind:r}=e,{slot:n,highlightGroupName:s}=r,o=i===h.b.Highlight;if(o&&!s)return;const a=i===h.b.ShadowHighlight,c=o||a,d=i===h.b.ShadowExcludeHighlight,u=!(c||d),f=n===l.A.OCCLUDER_MATERIAL||n===l.A.TRANSPARENT_OCCLUDER_MATERIAL?n:null,{rctx:p}=e;p.runAppleAmdDriverHelper();const _=p.bindTechnique(t,r,this.material.parameters);for(const l of this._dataByOrigin.values())for(const e of l.buffers){if(o&&(!e.hasHighlights||!e.drawCommandsHighlights.has(s))||a&&!e.hasHighlights)continue;const i=()=>{const t=[];for(const i of e.drawCommandsHighlights.values())t.push(i);return t},n=c&&!a?e.drawCommandsHighlights.get(s)??null:null,h=a?i():c?n?[n]:ze:(d&&e.needsMultipleCommands()?[e.drawCommandsShadowHighlightRest]:[e.drawCommandsDefault])||ze,m=h.some((e=>e.length>0)),g=u&&e.drawCommandsOccludees||null;if(m||g?.length){if(this._drawParameters.origin=l.origin,_.bindDraw(r,this.material.parameters,this._drawParameters),t.ensureAttributeLocations(e.vao),p.bindVAO(e.vao),m)for(const e of h)p.setPipelineState(t.getPipeline(!1,f)),e.forAll((e=>p.drawArrays(t.primitiveType,e.first,e.count)));g?.length&&(p.setPipelineState(t.getPipeline(!0,f)),g.forAll((e=>p.drawArrays(t.primitiveType,e.first,e.count))))}}}get test(){}};(0,r.bt)([(0,r.bu)({constructOnly:!0})],Oe.prototype,"material",void 0),Oe=(0,r.bt)([(0,r.bv)("esri.views.3d.webgl-engine.materials.renderers.MergedRenderer")],Oe);let Re=class{constructor(e){this.origin=e,this.changes=new Array}};function Ae(e,t){const i=e.find((e=>e.numElements>=t));if(null==i)return null;const r=i.from;return i.from+=t,i.from>=i.to&&e.removeUnordered(i),r}const Ee=(0,f.e)(),Se=(0,f.e)(),Ie=new r.cM({allocator:e=>e||new pe,deallocator:null}),Ce=65536,Me=4*Ce,De=1024,Fe=16777216,Be=Fe/4;let Pe=new Float32Array(Ce);function Le(e){return Pe.length<e&&(Pe=new Float32Array(e)),Pe}function Ne(e){const t=4*e;return t<=De?De:t<Me?(0,r.bC)(t):Math.max(Math.min(Math.ceil(1.5*t/Me)*Me,Fe),t)}const ze=[];let Ge=class extends ae{constructor(e){super(e),this._hasHighlights=!1,this._glMaterials=null,this._produces=new Map,this._renderGeometries=new Map,this._vaoCache=null,this._drawParameters=new de,this._bufferWriter=null}get produces(){return this._produces}initialize(){this._bufferWriter=this.material.createBufferWriter(),this.material.produces.forEach(((e,t)=>{this._produces.set(t,(t=>!!(t!==h.b.Highlight&&t!==h.b.ShadowHighlight||this._hasHighlights)&&e(t)))}))}destroy(){this._glMaterials.dispose();const e=this._renderGeometries.keys();for(const t of e)this.removeRenderGeometry(t)}acquireTechniques(e){const t=this.material;if(!t.shouldRender(e))return null;const{output:i,bind:r}=e;return t.produces.get(r.slot)?.(i)&&(i!==h.b.Highlight&&i!==h.b.ShadowHighlight||this._hasHighlights)?this._glMaterials.load(e.rctx,r.slot,i)?.beginSlot(r):null}render(e,t){const i=this._renderGeometries;if(0===i.size)return;const{bind:r}=e,n=r.slot===l.A.OCCLUDER_MATERIAL||r.slot===l.A.TRANSPARENT_OCCLUDER_MATERIAL?r.slot:null,s=e.rctx;s.runAppleAmdDriverHelper(),s.bindTechnique(t,r,this.material.parameters);const o=t.program;for(const[a,l]of i)this._drawParameters.origin=l.localOrigin,o.bindDraw(r,this.material.parameters,this._drawParameters),t.ensureAttributeLocations(l.vao),s.bindVAO(l.vao),s.setPipelineState(t.getPipeline(!1,n)),s.drawArrays(t.primitiveType,0,l.numElements)}initializeRenderContext(e,t){this._glMaterials=new he(this.material,e.materials);const i=e.renderContext.rctx.getVaoCache(this.material.vertexAttributeLocations,(0,c.t)(this._bufferWriter.vertexBufferLayout));this._vaoCache=i}uninitializeRenderContext(){}addRenderGeometry(e,t,i){this.removeRenderGeometry(e);const r=this._bufferWriter.vertexBufferLayout.stride,n=this._vaoCache.newVao(Ne(t.data.byteLength));n.vertexBuffers.get("geometry").setSubData(new Uint8Array(t.data),0,0,t.elementCount*r);const s={localOrigin:i,vao:n,numElements:t.elementCount};return this._renderGeometries.set(e,s),s}removeRenderGeometry(e){const t=this._renderGeometries.get(e);null!=t&&(this._vaoCache.deleteVao(t.vao),this._renderGeometries.delete(e))}};function Ve(e,t,i){return 2*Math.atan(Math.sqrt(t*t+i*i)*Math.tan(.5*e)/t)}function He(e,t,i){return 2*Math.atan(Math.sqrt(t*t+i*i)*Math.tan(.5*e)/i)}function je(e,t,i){return 2*Math.atan(t*Math.tan(.5*e)/Math.sqrt(t*t+i*i))}function Ue(e,t,i){return 2*Math.atan(i*Math.tan(.5*e)/Math.sqrt(t*t+i*i))}var Ye,qe,ke;(0,r.bt)([(0,r.bu)({constructOnly:!0})],Ge.prototype,"material",void 0),Ge=(0,r.bt)([(0,r.bv)("esri.views.3d.layers.graphics.pipeline.rendering.DirectRenderer")],Ge),function(e){e[e.Default=0]="Default",e[e.Screenshot=1]="Screenshot",e[e.ObjectAndLayerID=2]="ObjectAndLayerID"}(Ye||(Ye={})),function(e){e[e.TOP=0]="TOP",e[e.RIGHT=1]="RIGHT",e[e.BOTTOM=2]="BOTTOM",e[e.LEFT=3]="LEFT"}(qe||(qe={}));let Xe=ke=class extends r.e9{constructor(e){super(e),this._ray=(0,y.b)(),this._viewport=(0,r.iV)(0,0,1,1),this._padding=(0,r.iV)(0,0,0,0),this._fov=55/180*Math.PI,this._nearFar=(0,r.o5)(1,1e3),this._viewDirty=!0,this._viewMatrix=(0,f.e)(),this._viewProjectionDirty=!0,this._viewProjectionMatrix=(0,f.e)(),this._viewInverseTransposeMatrixDirty=!0,this._viewInverseTransposeMatrix=(0,f.e)(),this._frustumDirty=!0,this._frustum=(0,g.H)(),this._fullViewport=(0,r.iB)(),this._pixelRatio=1,this.row=0,this.column=0,this._rows=1,this._columns=1,this._center=(0,r.ap)(),this._up=(0,r.ap)(),this.relativeElevation=0}get pixelRatio(){return this._pixelRatio}set pixelRatio(e){this._pixelRatio=e>0?e:1}get rows(){return this._rows}set rows(e){this._rows=Math.max(1,e)}get columns(){return this._columns}set columns(e){this._columns=Math.max(1,e)}get eye(){return this._ray.origin}set eye(e){this._compareAndSetView(e,this._ray.origin)}get center(){return this._center}set center(e){this._compareAndSetView(e,this._center,"_center")}get ray(){return(0,r.dB)(this._ray.direction,this.center,this.eye),this._ray}get up(){return this._up}set up(e){this._compareAndSetView(e,this._up,"_up")}get viewMatrix(){return this._ensureViewClean(),this._viewMatrix}set viewMatrix(e){(0,r.gk)(this._viewMatrix,e),this.notifyChange("_viewMatrix"),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get viewForward(){return this._ensureViewClean(),(0,r.dQ)((0,r.ap)(),-this._viewMatrix[2],-this._viewMatrix[6],-this._viewMatrix[10])}get viewUp(){return this._ensureViewClean(),(0,r.dQ)((0,r.ap)(),this._viewMatrix[1],this._viewMatrix[5],this._viewMatrix[9])}get viewRight(){return this._ensureViewClean(),(0,r.dQ)((0,r.ap)(),this._viewMatrix[0],this._viewMatrix[4],this._viewMatrix[8])}get nearFar(){return this._nearFar}get near(){return this._nearFar[0]}set near(e){this._nearFar[0]!==e&&(this._nearFar[0]=e,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_nearFar"))}get far(){return this._nearFar[1]}set far(e){this._nearFar[1]!==e&&(this._nearFar[1]=e,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_nearFar"))}get viewport(){return this._viewport}set viewport(e){this.x=e[0],this.y=e[1],this.width=e[2],this.height=e[3]}get screenViewport(){if(1===this.pixelRatio)return this._viewport;const e=(0,r.ad)((0,r.iB)(),this._viewport,1/this.pixelRatio),t=this._get("screenViewport");return t&&(0,r.ak)(e,t)?t:e}get screenPadding(){if(1===this.pixelRatio)return this._padding;const e=(0,r.ad)((0,r.iB)(),this._padding,1/this.pixelRatio),t=this._get("screenPadding");return t&&(0,r.ak)(e,t)?t:e}get x(){return this._viewport[0]}set x(e){e+=this._padding[qe.LEFT],this._viewport[0]!==e&&(this._viewport[0]=e,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get y(){return this._viewport[1]}set y(e){e+=this._padding[qe.BOTTOM],this._viewport[1]!==e&&(this._viewport[1]=e,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get width(){return this._viewport[2]}set width(e){this._viewport[2]!==e&&(this._viewport[2]=e,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get height(){return this._viewport[3]}set height(e){this._viewport[3]!==e&&(this._viewport[3]=e,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get fullWidth(){return this._viewport[2]+this._padding[qe.RIGHT]+this._padding[qe.LEFT]}set fullWidth(e){this.width=e-(this._padding[qe.RIGHT]+this._padding[qe.LEFT])}get fullHeight(){return this._viewport[3]+this._padding[qe.TOP]+this._padding[qe.BOTTOM]}set fullHeight(e){this.height=e-(this._padding[qe.TOP]+this._padding[qe.BOTTOM])}get fullViewport(){return this._fullViewport[0]=this._viewport[0]-this._padding[qe.LEFT],this._fullViewport[1]=this._viewport[1]-this._padding[qe.BOTTOM],this._fullViewport[2]=this.fullWidth,this._fullViewport[3]=this.fullHeight,this._fullViewport}get _aspect(){return this.width/this.height}get padding(){return this._padding}set padding(e){(0,r.aj)(this._padding,e)||(this._viewport[0]+=e[qe.LEFT]-this._padding[qe.LEFT],this._viewport[1]+=e[qe.BOTTOM]-this._padding[qe.BOTTOM],this._viewport[2]-=e[qe.RIGHT]+e[qe.LEFT]-(this._padding[qe.RIGHT]+this._padding[qe.LEFT]),this._viewport[3]-=e[qe.TOP]+e[qe.BOTTOM]-(this._padding[qe.TOP]+this._padding[qe.BOTTOM]),(0,r.aa)(this._padding,e),this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_padding"),this.notifyChange("_viewport"))}get viewProjectionMatrix(){return this._viewProjectionDirty&&((0,r.gm)(this._viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),this._viewProjectionDirty=!1),this._viewProjectionMatrix}get projectionMatrix(){return this._projectionMatrixInternal}get inverseProjectionMatrix(){return(0,r.dV)((0,f.e)(),this.projectionMatrix)||this._get("inverseProjectionMatrix")||(0,f.e)()}get fov(){return this._fov}set fov(e){this._fov=e,this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovX(){return je(this._fov,this.width,this.height)}set fovX(e){this._fov=Ve(e,this.width,this.height),this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovY(){return Ue(this._fov,this.width,this.height)}set fovY(e){this._fov=He(e,this.width,this.height),this._viewProjectionDirty=!0,this._frustumDirty=!0}get distance(){return(0,r.dR)(this.center,this.eye)}get frustum(){return this._recomputeFrustum(),this._frustum}get viewInverseTransposeMatrix(){return(this._viewInverseTransposeMatrixDirty||this._viewDirty)&&((0,r.dV)(this._viewInverseTransposeMatrix,this.viewMatrix),(0,r.dW)(this._viewInverseTransposeMatrix,this._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),this._viewInverseTransposeMatrix}depthNDCToWorld(e){const t=2*e-1;return 2*this.near*this.far/(this.far+this.near-t*(this.far-this.near))}get perRenderPixelRatio(){return Math.tan(this.fovX/2)/(this.width/2)}get perScreenPixelRatio(){return this.perRenderPixelRatio*this.pixelRatio}get aboveGround(){return null!=this.relativeElevation&&this.relativeElevation>=0}get _projectionMatrixInternal(){const e=this.width,t=this.height,i=this.near*Math.tan(this.fovY/2)*2,n=i*this._aspect,s=i/this.rows,o=n/this.columns,a=-n/2+this.column*o,l=a+o,c=-i/2+this.row*s,h=c+s,d=(0,r.vg)((0,f.e)(),a*(1+2*this._padding[qe.LEFT]/e),l*(1+2*this._padding[qe.RIGHT]/e),c*(1+2*this._padding[qe.BOTTOM]/t),h*(1+2*this._padding[qe.TOP]/t),this.near,this.far),u=this._get("projectionMatrix");return u&&(0,r.vh)(u,d)?u:d}copyFrom(e){(0,r.dF)(this._ray.origin,e.eye),this.center=e.center,this.up=e.up,(0,r.aa)(this._viewport,e.viewport),this.notifyChange("_viewport"),(0,r.aa)(this._padding,e.padding),this.notifyChange("_padding"),(0,r.qj)(this._nearFar,e.nearFar),this.notifyChange("_nearFar"),this._fov=e.fov,this.row=e.row,this.column=e.column,this.rows=e.rows,this.columns=e.columns,this.relativeElevation=e.relativeElevation;const t=e;return this._viewDirty=t._viewDirty,this._viewDirty||((0,r.gk)(this._viewMatrix,e.viewMatrix),this.notifyChange("_viewMatrix")),this._viewProjectionDirty=!0,this._frustumDirty=t._frustumDirty,this._frustumDirty||((0,g.N)(this._frustum,e.frustum),this._frustumDirty=!1),t._viewInverseTransposeMatrixDirty?this._viewInverseTransposeMatrixDirty=!0:((0,r.gk)(this._viewInverseTransposeMatrix,e.viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),(0,r.aa)(this._fullViewport,e.fullViewport),this.pixelRatio=e.pixelRatio,this}copyViewFrom(e){this.eye=e.eye,this.center=e.center,this.up=e.up,this.fov=e.fov}clone(){return(new ke).copyFrom(this)}equals(e){return(0,r.H)(this.eye,e.eye)&&(0,r.H)(this.center,e.center)&&(0,r.H)(this.up,e.up)&&(0,r.aj)(this._viewport,e.viewport)&&(0,r.aj)(this._padding,e.padding)&&(0,r.uH)(this.nearFar,e.nearFar)&&this._fov===e.fov&&this.pixelRatio===e.pixelRatio&&this.relativeElevation===e.relativeElevation&&this.row===e.row&&this.column===e.column&&this.rows===e.rows&&this.columns===e.columns}almostEquals(e){const t=Math.max(1,1/this.pixelRatio,1/e.pixelRatio);if(Math.abs(e.fov-this._fov)>=.001||(0,r.vi)(e.screenPadding,this.screenPadding)>=t||(0,r.vi)(this.screenViewport,e.screenViewport)>=t||this.row!==e.row||this.column!==e.column||this.rows!==e.rows||this.columns!==e.columns)return!1;(0,r.ew)(Je,e.eye,e.center),(0,r.ew)(Ze,this.eye,this.center);const i=(0,r.al)(Je,Ze),n=(0,r.iw)(Je),s=(0,r.iw)(Ze),o=5e-4;return i*i>=(1-1e-10)*n*s&&(0,r.iv)(e.eye,this.eye)<Math.max(n,s)*o*o}computeRenderPixelSizeAt(e){return this.computeRenderPixelSizeAtDist(this._viewDirectionDistance(e))}computeRenderPixelSizeAtDist(e){return e*this.perRenderPixelRatio}computeScreenPixelSizeAt(e){return this.computeScreenPixelSizeAtDist(this._viewDirectionDistance(e))}_viewDirectionDistance(e){return Math.abs((0,v.f)(this.viewForward,(0,r.dB)(Je,e,this.eye)))}computeScreenPixelSizeAtDist(e){return e*this.perScreenPixelRatio}computeDistanceFromRadius(e,t){return e/Math.tan(Math.min(this.fovX,this.fovY)/(2*(t||1)))}getScreenCenter(e=(0,r.qd)()){return e[0]=(this.padding[qe.LEFT]+this.width/2)/this.pixelRatio,e[1]=(this.padding[qe.TOP]+this.height/2)/this.pixelRatio,e}getRenderCenter(e,t=.5,i=.5){return e[0]=this.padding[qe.LEFT]+this.width*t,e[1]=this.padding[qe.BOTTOM]+this.height*i,e[2]=.5,e}setGLViewport(e){const t=this.viewport,i=this.padding;e.setViewport(t[0]-i[3],t[1]-i[2],t[2]+i[1]+i[3],t[3]+i[0]+i[2])}applyProjection(e,t){e!==Qe&&(0,r.dF)(Qe,e),Qe[3]=1,(0,r.iy)(Qe,Qe,this.projectionMatrix);const i=Math.abs(Qe[3]);(0,r.dC)(Qe,Qe,1/i);const n=this.fullViewport;t[0]=(0,r.qm)(0,n[0]+n[2],.5+.5*Qe[0]),t[1]=(0,r.qm)(0,n[1]+n[3],.5+.5*Qe[1]),t[2]=.5*(Qe[2]+1),t[3]=i}unapplyProjection(e,t){const i=this.fullViewport;Qe[0]=(e[0]/(i[0]+i[2])*2-1)*e[3],Qe[1]=(e[1]/(i[1]+i[3])*2-1)*e[3],Qe[2]=(2*e[2]-1)*e[3],Qe[3]=e[3],null!=this.inverseProjectionMatrix&&((0,r.iy)(Qe,Qe,this.inverseProjectionMatrix),t[0]=Qe[0],t[1]=Qe[1],t[2]=Qe[2])}projectToScreen(e,t){return this.projectToRenderScreen(e,Ke),this.renderToScreen(Ke,t),t}projectToRenderScreen(e,t){if(Qe[0]=e[0],Qe[1]=e[1],Qe[2]=e[2],Qe[3]=1,(0,r.iy)(Qe,Qe,this.viewProjectionMatrix),0===Qe[3])return null;const i=Qe;(0,r.dC)(i,i,1/Math.abs(Qe[3]));const n=this.fullViewport,s=(0,r.qm)(0,n[0]+n[2],.5+.5*i[0]),o=(0,r.qm)(0,n[1]+n[3],.5+.5*i[1]);return"x"in t?(t.x=s,t.y=o):(t[0]=s,t[1]=o,t.length>2&&(t[2]=.5*(i[2]+1))),t}unprojectFromScreen(e,t){return this.unprojectFromRenderScreen(this.screenToRender(e,Ke),t)}unprojectFromRenderScreen(e,t){if((0,r.gm)($e,this.projectionMatrix,this.viewMatrix),!(0,r.dV)($e,$e))return null;const i=this.fullViewport;return Qe[0]=2*(e[0]-i[0])/i[2]-1,Qe[1]=2*(e[1]-i[1])/i[3]-1,Qe[2]=2*e[2]-1,Qe[3]=1,(0,r.iy)(Qe,Qe,$e),0===Qe[3]?null:(t[0]=Qe[0]/Qe[3],t[1]=Qe[1]/Qe[3],t[2]=Qe[2]/Qe[3],t)}constrainWindowSize(e,t,i,r){const n=e*this.pixelRatio,s=t*this.pixelRatio,o=Math.max(n-i/2,0),a=Math.max(this.fullHeight-s-r/2,0),l=-Math.min(n-i/2,0),c=-Math.min(this.fullHeight-s-r/2,0),h=i-l- -Math.min(this.fullWidth-n-i/2,0),d=r-c- -Math.min(s-r/2,0);return[Math.round(o),Math.round(a),Math.round(h),Math.round(d)]}computeUp(e){e===r.iE.Global?this._computeUpGlobal():this._computeUpLocal()}screenToRender(e,t){const i=e[0]*this.pixelRatio,r=this.fullHeight-e[1]*this.pixelRatio;return t[0]=i,t[1]=r,t}renderToScreen(e,t){const i=e[0]/this.pixelRatio,r=(this.fullHeight-e[1])/this.pixelRatio;t[0]=i,t[1]=r}_computeUpGlobal(){(0,r.dB)(Je,this.center,this.eye);const e=(0,r.dS)(this.center);e<1?((0,r.dQ)(this._up,0,0,1),this._markViewDirty(),this.notifyChange("_up")):Math.abs((0,r.al)(Je,this.center))>.9999*(0,r.dS)(Je)*e||((0,r.am)(this._up,Je,this.center),(0,r.am)(this._up,this._up,Je),(0,r.ao)(this._up,this._up),this.notifyChange("_up"),this._markViewDirty())}_computeUpLocal(){(0,r.dT)(Je,this.eye,this.center),Math.abs(Je[2])<=.9999&&((0,r.dC)(Je,Je,Je[2]),(0,r.dQ)(this._up,-Je[0],-Je[1],1-Je[2]),(0,r.ao)(this._up,this._up),this.notifyChange("_up"),this._markViewDirty())}_compareAndSetView(e,t,i=""){"number"==typeof e[0]&&isFinite(e[0])&&"number"==typeof e[1]&&isFinite(e[1])&&"number"==typeof e[2]&&isFinite(e[2])?(0,r.H)(e,t)||((0,r.dF)(t,e),this._markViewDirty(),i.length&&this.notifyChange(i)):r.G.getLogger("esri.views.3d.webgl-engine.lib.RenderCamera").warn("RenderCamera vector contains invalid number, ignoring value")}_markViewDirty(){this._viewDirty=!0,this._frustumDirty=!0,this._viewProjectionDirty=!0}_recomputeFrustum(){this._frustumDirty&&((0,g.L)(this.viewMatrix,this.projectionMatrix,this._frustum),this._frustumDirty=!1)}_ensureViewClean(){this._viewDirty&&((0,r.vj)(this._viewMatrix,this.eye,this.center,this.up),this.notifyChange("_viewMatrix"),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0)}};(0,r.bt)([(0,r.bu)()],Xe.prototype,"_viewport",void 0),(0,r.bt)([(0,r.bu)()],Xe.prototype,"_padding",void 0),(0,r.bt)([(0,r.bu)()],Xe.prototype,"_fov",void 0),(0,r.bt)([(0,r.bu)()],Xe.prototype,"_nearFar",void 0),(0,r.bt)([(0,r.bu)()],Xe.prototype,"_viewDirty",void 0),(0,r.bt)([(0,r.bu)()],Xe.prototype,"_viewMatrix",void 0),(0,r.bt)([(0,r.bu)()],Xe.prototype,"_pixelRatio",void 0),(0,r.bt)([(0,r.bu)()],Xe.prototype,"pixelRatio",null),(0,r.bt)([(0,r.bu)()],Xe.prototype,"row",void 0),(0,r.bt)([(0,r.bu)()],Xe.prototype,"column",void 0),(0,r.bt)([(0,r.bu)()],Xe.prototype,"_rows",void 0),(0,r.bt)([(0,r.bu)()],Xe.prototype,"rows",null),(0,r.bt)([(0,r.bu)()],Xe.prototype,"_columns",void 0),(0,r.bt)([(0,r.bu)()],Xe.prototype,"columns",null),(0,r.bt)([(0,r.bu)()],Xe.prototype,"eye",null),(0,r.bt)([(0,r.bu)()],Xe.prototype,"center",null),(0,r.bt)([(0,r.bu)()],Xe.prototype,"_center",void 0),(0,r.bt)([(0,r.bu)()],Xe.prototype,"up",null),(0,r.bt)([(0,r.bu)()],Xe.prototype,"_up",void 0),(0,r.bt)([(0,r.bu)()],Xe.prototype,"viewMatrix",null),(0,r.bt)([(0,r.bu)({readOnly:!0})],Xe.prototype,"viewForward",null),(0,r.bt)([(0,r.bu)({readOnly:!0})],Xe.prototype,"viewUp",null),(0,r.bt)([(0,r.bu)({readOnly:!0})],Xe.prototype,"viewRight",null),(0,r.bt)([(0,r.bu)({readOnly:!0})],Xe.prototype,"nearFar",null),(0,r.bt)([(0,r.bu)()],Xe.prototype,"near",null),(0,r.bt)([(0,r.bu)()],Xe.prototype,"far",null),(0,r.bt)([(0,r.bu)()],Xe.prototype,"viewport",null),(0,r.bt)([(0,r.bu)({readOnly:!0})],Xe.prototype,"screenViewport",null),(0,r.bt)([(0,r.bu)({readOnly:!0})],Xe.prototype,"screenPadding",null),(0,r.bt)([(0,r.bu)()],Xe.prototype,"x",null),(0,r.bt)([(0,r.bu)()],Xe.prototype,"y",null),(0,r.bt)([(0,r.bu)()],Xe.prototype,"width",null),(0,r.bt)([(0,r.bu)()],Xe.prototype,"height",null),(0,r.bt)([(0,r.bu)()],Xe.prototype,"fullWidth",null),(0,r.bt)([(0,r.bu)()],Xe.prototype,"fullHeight",null),(0,r.bt)([(0,r.bu)({readOnly:!0})],Xe.prototype,"_aspect",null),(0,r.bt)([(0,r.bu)()],Xe.prototype,"padding",null),(0,r.bt)([(0,r.bu)({readOnly:!0})],Xe.prototype,"projectionMatrix",null),(0,r.bt)([(0,r.bu)({readOnly:!0})],Xe.prototype,"inverseProjectionMatrix",null),(0,r.bt)([(0,r.bu)()],Xe.prototype,"fov",null),(0,r.bt)([(0,r.bu)()],Xe.prototype,"fovX",null),(0,r.bt)([(0,r.bu)()],Xe.prototype,"fovY",null),(0,r.bt)([(0,r.bu)()],Xe.prototype,"viewInverseTransposeMatrix",null),(0,r.bt)([(0,r.bu)({readOnly:!0})],Xe.prototype,"_projectionMatrixInternal",null),(0,r.bt)([(0,r.bu)()],Xe.prototype,"relativeElevation",void 0),Xe=ke=(0,r.bt)([(0,r.bv)("esri.views.3d.webgl.RenderCamera")],Xe);const We=Xe,Qe=(0,r.iB)(),$e=(0,f.e)(),Je=(0,r.ap)(),Ze=(0,r.ap)(),Ke=(0,r.vk)();let et=class{constructor(e,t,i){this._elementSize=t,this._buffer=x.E.createVertex(e,r.az.STATIC_DRAW),this.resize(i)}destroy(){this._buffer.dispose()}get elementSize(){return this._elementSize}get capacity(){return this._capacity}get array(){return this._array}get buffer(){return this._buffer}get usedMemory(){return this._array.byteLength+this._buffer.usedMemory}copyRange(e,t,i,r=0){const n=new Uint8Array(this.array,e*this.elementSize,(t-e)*this.elementSize);new Uint8Array(i.array,r*this.elementSize).set(n)}transferAll(){this._buffer.setData(this._array)}transferRange(e,t){const i=e*this._elementSize,r=t*this._elementSize;this._buffer.setSubData(new Uint8Array(this._array),i,i,r)}resize(e){const t=e*this._elementSize,i=new ArrayBuffer(t);this._array&&(e>=this._capacity?new Uint8Array(i).set(new Uint8Array(this._array)):new Uint8Array(i).set(new Uint8Array(this._array).subarray(0,e*this._elementSize))),this._array=i,this._buffer.setSize(t),this._capacity=e}},tt=class{constructor(e){this.modelOriginHi=e.getField(_.e.INSTANCEMODELORIGINHI,T.i),this.modelOriginLo=e.getField(_.e.INSTANCEMODELORIGINLO,T.i),this.model=e.getField(_.e.INSTANCEMODEL,T.l),this.modelNormal=e.getField(_.e.INSTANCEMODELNORMAL,T.l),this.featureAttribute=e.getField(_.e.INSTANCEFEATUREATTRIBUTE,T.c),this.color=e.getField(_.e.INSTANCECOLOR,T.x),this.objectAndLayerIdColor=e.getField(_.e.INSTANCEOBJECTANDLAYERIDCOLOR,T.x)}},it=class{constructor(e,t){this._rctx=e,this._instanceBufferLayout=t,this._headIndex=0,this._tailIndex=0,this._firstIndex=null,this._captureFirstIndex=!0,this._updating=!1,this._prevHeadIndex=0,this._resized=!1,this._capacity=1}destroy(){this._buffer&&this._buffer.destroy()}get buffer(){return this._buffer.buffer}get view(){return this._view}get capacity(){return this._capacity}get size(){const e=this._headIndex,t=this._tailIndex;return e>=t?e-t:e+this._capacity-t}get isEmpty(){return this._headIndex===this._tailIndex}get isFull(){return this._tailIndex===(this._headIndex+1)%this._capacity}get headIndex(){return this._headIndex}get tailIndex(){return this._tailIndex}get firstIndex(){return this._firstIndex}get usedMemory(){return this._buffer?.usedMemory??0}reset(){this._headIndex=0,this._tailIndex=0,this._firstIndex=null}startUpdateCycle(){this._captureFirstIndex=!0}beginUpdate(){(0,p.s)(!this._updating,"already updating"),this._updating=!0,this._prevHeadIndex=this._headIndex}endUpdate(){(0,p.s)(this._updating,"not updating"),this.size<r.vl*this.capacity&&this._shrink(),this._resized?(this._buffer.transferAll(),this._resized=!1):this._transferRange(this._prevHeadIndex,this._headIndex),this._updating=!1}allocateHead(){(0,p.s)(this._updating,"not updating"),this.isFull&&this._grow();const e=this.headIndex;return this._captureFirstIndex&&(this._firstIndex=e,this._captureFirstIndex=!1),this._incrementHead(),(0,p.s)(this._headIndex!==this._tailIndex,"invalid pointers"),e}freeTail(){(0,p.s)(this._updating,"not updating"),(0,p.s)(this.size>0,"invalid size");const e=this._tailIndex===this._firstIndex;this._incrementTail(),e&&(this._firstIndex=this._tailIndex)}_grow(){const e=Math.max(rt,Math.floor(this._capacity*r.vm));this._resize(e)}_shrink(){const e=Math.max(rt,Math.floor(this._capacity*r.vn));this._resize(e)}_resize(e){if((0,p.s)(this._updating,"not updating"),e===this._capacity)return;const t=new et(this._rctx,this._instanceBufferLayout.stride,e);if(this._buffer){this._firstIndex&&(this._firstIndex=(this._firstIndex+this._capacity-this._tailIndex)%this._capacity);const e=this.size,i=this._compactInstances(t);(0,p.s)(i===e,"invalid compaction"),this._buffer.destroy(),this._tailIndex=0,this._headIndex=i,this._prevHeadIndex=0}this._resized=!0,this._capacity=e,this._buffer=t,this._view=new tt(this._instanceBufferLayout.createView(this._buffer.array))}_compactInstances(e){const t=this._headIndex,i=this._tailIndex;return i<t?(this._buffer.copyRange(i,t,e),t-i):i>t?(this._buffer.copyRange(i,this._capacity,e),t>0&&this._buffer.copyRange(0,t,e,this._capacity-i),t+(this._capacity-i)):0}_incrementHead(e=1){this._headIndex=(this._headIndex+e)%this._capacity}_incrementTail(e=1){this._tailIndex=(this._tailIndex+e)%this._capacity}_transferRange(e,t){e<t?this._buffer.transferRange(e,t):e>t&&(t>0&&this._buffer.transferRange(0,t),this._buffer.transferRange(e,this._capacity))}};const rt=64;var nt;function st(e){let t=(0,m.H)().mat4f64(_.e.LOCALTRANSFORM).mat4f64(_.e.GLOBALTRANSFORM).vec4f64(_.e.BOUNDINGSPHERE).vec3f64(_.e.MODELORIGIN).mat3f(_.e.INSTANCEMODEL).mat3f(_.e.INSTANCEMODELNORMAL).vec2f(_.e.MODELSCALEFACTORS);return e.includes(_.e.FEATUREATTRIBUTE)&&(t=t.vec4f(_.e.FEATUREATTRIBUTE)),e.includes(_.e.COLOR)&&(t=t.vec4u8(_.e.COLOR)),e.includes(_.e.OBJECTANDLAYERIDCOLOR)&&(t=t.vec4u8(_.e.OBJECTANDLAYERIDCOLOR)),t=t.u8(_.e.STATE).u8(_.e.LODLEVEL),t}(function(e){e[e.ALLOCATED=1]="ALLOCATED",e[e.DEFAULT_ACTIVE=2]="DEFAULT_ACTIVE",e[e.VISIBLE=4]="VISIBLE",e[e.HIGHLIGHT=8]="HIGHLIGHT",e[e.HIGHLIGHT_ACTIVE=16]="HIGHLIGHT_ACTIVE",e[e.REMOVE=32]="REMOVE",e[e.TRANSFORM_CHANGED=64]="TRANSFORM_CHANGED",e[e.ACTIVE=18]="ACTIVE"})(nt||(nt={}));let ot=class{constructor(e){this.localTransform=e.getField(_.e.LOCALTRANSFORM,T.b),this.globalTransform=e.getField(_.e.GLOBALTRANSFORM,T.b),this.modelOrigin=e.getField(_.e.MODELORIGIN,T.T),this.model=e.getField(_.e.INSTANCEMODEL,T.l),this.modelNormal=e.getField(_.e.INSTANCEMODELNORMAL,T.l),this.modelScaleFactors=e.getField(_.e.MODELSCALEFACTORS,T.u),this.boundingSphere=e.getField(_.e.BOUNDINGSPHERE,T.h),this.featureAttribute=e.getField(_.e.FEATUREATTRIBUTE,T.c),this.color=e.getField(_.e.COLOR,T.x),this.objectAndLayerIdColor=e.getField(_.e.OBJECTANDLAYERIDCOLOR,T.x),this.state=e.getField(_.e.STATE,T.d),this.lodLevel=e.getField(_.e.LODLEVEL,T.d)}},at=class extends r.e9{constructor(e,t){super(e),this.events=new r.d4,this._capacity=0,this._size=0,this._next=0,this._highlightGroupMap=new Map,this._highlightGroupMapPrev=new Map,this._layout=st(t),this._capacity=rt,this._buffer=this._layout.createBuffer(this._capacity),this._view=new ot(this._buffer)}get capacity(){return this._capacity}get size(){return this._size}get view(){return this._view}addInstance(){this._size+1>this._capacity&&this._grow();const e=this._findSlot();return this._view.state.set(e,nt.ALLOCATED),this._size++,this.events.emit("instances-changed"),e}removeInstance(e){const t=this._view.state;(0,p.s)(e>=0&&e<this._capacity&&!!(t.get(e)&nt.ALLOCATED),"invalid instance handle"),this._getStateFlag(e,nt.ACTIVE)?this._setStateFlags(e,nt.REMOVE):this.freeInstance(e),this.events.emit("instances-changed")}freeInstance(e){const t=this._view.state;(0,p.s)(e>=0&&e<this._capacity&&!!(t.get(e)&nt.ALLOCATED),"invalid instance handle"),t.set(e,0),this._size--}setLocalTransform(e,t,i=!0){this._view.localTransform.setMat(e,t),i&&this.updateModelTransform(e)}getLocalTransform(e,t){this._view.localTransform.getMat(e,t)}setGlobalTransform(e,t,i=!0){this._view.globalTransform.setMat(e,t),i&&this.updateModelTransform(e)}getGlobalTransform(e,t){this._view.globalTransform.getMat(e,t)}updateModelTransform(e){const t=this._view,i=ct,n=ht;t.localTransform.getMat(e,dt),t.globalTransform.getMat(e,ut);const s=(0,r.gm)(ut,ut,dt);(0,r.dQ)(i,s[12],s[13],s[14]),t.modelOrigin.setVec(e,i),(0,r.ge)(n,s),t.model.setMat(e,n);const o=(0,v.g)(ct,s);o.sort(),t.modelScaleFactors.set(e,0,o[1]),t.modelScaleFactors.set(e,1,o[2]),(0,r.o2)(n,n),(0,r.gU)(n,n),t.modelNormal.setMat(e,n),this._setStateFlags(e,nt.TRANSFORM_CHANGED),this.events.emit("instance-transform-changed",{index:e})}getModelTransform(e,t){const i=this._view;i.model.getMat(e,ht),i.modelOrigin.getVec(e,ct),t[0]=ht[0],t[1]=ht[1],t[2]=ht[2],t[3]=0,t[4]=ht[3],t[5]=ht[4],t[6]=ht[5],t[7]=0,t[8]=ht[6],t[9]=ht[7],t[10]=ht[8],t[11]=0,t[12]=ct[0],t[13]=ct[1],t[14]=ct[2],t[15]=1}applyShaderTransformation(e,t){null!=this.shaderTransformation&&this.shaderTransformation.applyTransform(this,e,t)}getCombinedModelTransform(e,t){return this.getModelTransform(e,t),null!=this.shaderTransformation&&this.shaderTransformation.applyTransform(this,e,t),t}getCombinedLocalTransform(e,t){this._view.localTransform.getMat(e,t),null!=this.shaderTransformation&&this.shaderTransformation.applyTransform(this,e,t)}getCombinedMaxScaleFactor(e){let t=this._view.modelScaleFactors.get(e,1);return null!=this.shaderTransformation&&(this.shaderTransformation.scaleFactor(ct,this,e),t*=Math.max(ct[0],ct[1],ct[2])),t}getCombinedMedianScaleFactor(e){let t=this._view.modelScaleFactors.get(e,0);return null!=this.shaderTransformation&&(this.shaderTransformation.scaleFactor(ct,this,e),t*=lt(ct[0],ct[1],ct[2])),t}getModel(e,t){this._view.model.getMat(e,t)}setFeatureAttribute(e,t){this._view.featureAttribute.setVec(e,t)}getFeatureAttribute(e,t){this._view.featureAttribute.getVec(e,t)}setColor(e,t){this._view.color.setVec(e,t)}setObjectAndLayerIdColor(e,t){this._view.objectAndLayerIdColor.setVec(e,t)}setVisible(e,t){t!==this.getVisible(e)&&(this._setStateFlag(e,nt.VISIBLE,t),this.events.emit("instance-visibility-changed",{index:e}))}getVisible(e){return this._getStateFlag(e,nt.VISIBLE)}setHighlight(e,t,i){let r=this._highlightGroupMap.get(e);t?(r||(r=new Set,this._highlightGroupMap.set(e,r)),r.add(i)&&(this._setStateFlag(e,nt.HIGHLIGHT,!0),this.events.emit("instance-highlight-changed"))):r?.delete(i)&&(0===r.size&&(this._highlightGroupMap.delete(e),this._setStateFlag(e,nt.HIGHLIGHT,!1)),this.events.emit("instance-highlight-changed"))}getHighlight(e){return this._getStateFlag(e,nt.HIGHLIGHT)}foreachHighlightGroupPrev(e,t){this._highlightGroupMapPrev.get(e)?.forEach(t),this._highlightGroupMapPrev.delete(e)}foreachHighlightGroup(e,t){const i=this._highlightGroupMap.get(e);i?.forEach(t),i?this._highlightGroupMapPrev.set(e,new Set(i)):this._highlightGroupMapPrev.delete(e)}getState(e){return this._view.state.get(e)}getLodLevel(e){return this._view.lodLevel.get(e)}countFlags(e){let t=0;for(let i=0;i<this._capacity;++i)this.getState(i)&e&&++t;return t}_setStateFlags(e,t){const i=this._view.state;t=i.get(e)|t,i.set(e,t)}_clearStateFlags(e,t){const i=this._view.state;t=i.get(e)&~t,i.set(e,t)}_setStateFlag(e,t,i){i?this._setStateFlags(e,t):this._clearStateFlags(e,t)}_getStateFlag(e,t){return!!(this._view.state.get(e)&t)}_grow(){this._capacity=Math.max(rt,Math.floor(this._capacity*r.vm)),this._buffer=this._layout.createBuffer(this._capacity).copyFrom(this._buffer),this._view=new ot(this._buffer)}_findSlot(){const e=this._view.state;let t=this._next;for(;e.get(t)&nt.ALLOCATED;)t=t+1===this._capacity?0:t+1;return this._next=t+1===this._capacity?0:t+1,t}};function lt(e,t,i){return Math.max(Math.min(e,t),Math.min(Math.max(e,t),i))}(0,r.bt)([(0,r.bu)({constructOnly:!0})],at.prototype,"shaderTransformation",void 0),(0,r.bt)([(0,r.bu)()],at.prototype,"_size",void 0),(0,r.bt)([(0,r.bu)({readOnly:!0})],at.prototype,"size",null),at=(0,r.bt)([(0,r.bv)("esri.views.3d.webgl-engine.lib.lodRendering.InstanceData")],at);const ct=(0,r.ap)(),ht=(0,w.e)(),dt=(0,f.e)(),ut=(0,f.e)();let ft=class extends g.Y{constructor(e,t){super((e=>(0,y.T)(this._instanceData.view.boundingSphere.getVec(e,this._tmpSphere))),{maximumDepth:25}),this._instanceData=e,this._boundingSphere=t,this._tmpSphere=(0,y.E)(),this._tmpMat4=(0,f.e)()}addInstance(e){const t=this._instanceData.view.boundingSphere,i=this._instanceData.getCombinedModelTransform(e,this._tmpMat4);(0,r.dX)((0,y.U)(this._tmpSphere),this._boundingSphere.center,i),this._tmpSphere[3]=this._boundingSphere.radius*(0,v.m)(i),t.setVec(e,this._tmpSphere),this.add([e])}removeInstance(e){this.remove([e])}},pt=class{constructor(e,t){this._worldSpaceRadius=e,this._minScreenSpaceRadii=t}selectLevel(e,t,i){const r=i.computeScreenPixelSizeAt(e),n=this._worldSpaceRadius*t/r;let s=0;for(let o=1;o<this._minScreenSpaceRadii.length;++o)n>=this._minScreenSpaceRadii[o]&&(s=o);return s}},_t=class{constructor(e){this.layerUid=e}},mt=class extends _t{constructor(e,t){super(e),this.graphicUid=t}};function gt(e){return null!=e?.dist}let yt=class{get ray(){return this._ray}get distanceInRenderSpace(){return null!=this.dist?((0,r.dC)(bt,this.ray.direction,this.dist),(0,r.dS)(bt)):null}getIntersectionPoint(e){return!!gt(this)&&((0,r.dC)(bt,this.ray.direction,this.dist),(0,r.dE)(e,this.ray.origin,bt),!0)}getTransformedNormal(e){return(0,r.dF)(wt,this.normal),wt[3]=0,(0,r.iy)(wt,wt,this.transformation),(0,r.dF)(e,wt),(0,r.ao)(e,e)}constructor(e){this.intersector=b.i.OBJECT,this.normal=(0,r.ap)(),this.transformation=(0,f.e)(),this._ray=(0,y.b)(),this.init(e)}init(e){this.dist=null,this.target=null,this.drapedLayerOrder=null,this.drapedLayerGraphicOrder=null,this.intersector=b.i.OBJECT,(0,y.v)(e,this._ray)}set(e,t,i,n,s,o,a){this.intersector=e,this.dist=i,(0,r.dF)(this.normal,n??r.fz),(0,r.gk)(this.transformation,s??f.o),this.target=t,this.drapedLayerOrder=o,this.drapedLayerGraphicOrder=a}copy(e){(0,y.v)(e.ray,this._ray),this.intersector=e.intersector,this.dist=e.dist,this.target=e.target,this.drapedLayerOrder=e.drapedLayerOrder,this.drapedLayerGraphicOrder=e.drapedLayerGraphicOrder,(0,r.dF)(this.normal,e.normal),(0,r.gk)(this.transformation,e.transformation)}};function vt(e){return new yt(e)}const bt=(0,r.ap)(),wt=(0,r.iB)();let Tt=class extends R.o{},xt=class extends mt{constructor(e,t,i,r,n,s){super(e,t),this.layerUid=e,this.graphicUid=t,this.geometryId=i,this.triangleNr=r,this.baseBoundingSphere=n,this.numLodLevels=s}};function Ot(e,t,i,r=null){const n=e.createBufferWriter(),s=n.vertexBufferLayout,o=n.elementCount(t),a=s.createBuffer(o);return n.write(null,null,t,r,a,0),{material:e,vertexBufferLayout:s,buffer:a.buffer,elementCount:o,boundingInfo:i}}let Rt=class{constructor(e,t){const i=e.renderContext.rctx,n=t.geometry;let s=null;s=n instanceof l.r?Ot(n.material,n.attributes,n.boundingInfo):n;const o=s.material;this._materials=e.materials,o.setParameters({instancedDoublePrecision:!0}),this.geometry=n,this.material=o,this.glMaterials=new he(o,this._materials),this.vertexBufferLayout=s.vertexBufferLayout,this.vbo=x.E.createVertex(i,r.az.STATIC_DRAW,s.buffer),this.vao=new Tt(i,l.O,new Map([["geometry",(0,c.t)(s.vertexBufferLayout)]]),new Map([["geometry",this.vbo]])),this.vertexCount=s.elementCount}destroy(){this.glMaterials.dispose(),this.vbo.dispose(),this.vao.dispose()}get boundingInfo(){return this.geometry.boundingInfo}get triangleCount(){return this.vertexCount/3}intersect(e,t,i,r,n,s,o,a){if(!(this.geometry instanceof l.r))return;const c=this.geometry.id;this.material.intersect(this.geometry,e.transform.transform,e,i,r,((i,r,l,h,d)=>{if(i>=0){if(null!=t&&!t(e.rayBegin,e.rayEnd,i))return;const h=new xt(s.layerUid,s.graphicUid(n),c,l,o,a);if((null==e.results.min.drapedLayerOrder||d>=e.results.min.drapedLayerOrder)&&(null==e.results.min.dist||i<e.results.min.dist)&&e.results.min.set(b.i.LOD,h,i,r,e.transform.transform,d),e.options.store!==b.e.MIN&&(null==e.results.max.drapedLayerOrder||d>=e.results.max.drapedLayerOrder)&&(null==e.results.max.dist||i>e.results.max.dist)&&e.results.max.set(b.i.LOD,h,i,r,e.transform.transform,d),e.options.store===b.e.ALL){const t=vt(e.results.min.ray);t.set(b.i.LOD,h,i,r,e.transform.transform,d),e.results.all.push(t)}}}))}},At=class e{static async create(t,i,n){const s=await Promise.allSettled(i.components.map((e=>t.controller.schedule((()=>new Rt(t,e)),n)))),o=s.map((e=>"fulfilled"===e.status?e.value:null)).filter(r.ci);if((0,r.la)(n)||o.length!==s.length){o.forEach((e=>e.destroy())),(0,r.J)(n);for(const e of s)if("rejected"===e.status)throw e.reason}return new e(i.minScreenSpaceRadius,o)}constructor(e,t){this.minScreenSpaceRadius=e,this.components=t}destroy(){this.components.forEach((e=>e.destroy()))}intersect(e,t,i,r,n,s,o){this.components.forEach((a=>a.intersect(e,t,i,r,n,s,this.boundingSphere,o)))}get boundingBox(){if(null==this._boundingBox){const e=(0,r.mp)();this.components.forEach((t=>{null!=t.boundingInfo&&((0,r.kE)(e,t.boundingInfo.bbMin),(0,r.kE)(e,t.boundingInfo.bbMax))})),this._boundingBox=e}return this._boundingBox}get boundingSphere(){if(null==this._boundingSphere){const e=this.boundingBox,t=(0,r.ap)();(0,r.vo)(e,t),this._boundingSphere={center:t,radius:.5*(0,r.vp)(e)}}return this._boundingSphere}get triangleCount(){return this.components.reduce(((e,t)=>e+t.triangleCount),0)}};function Et(e,t,i,r,n){St[0]=e.get(t,0),St[1]=e.get(t,1),St[2]=e.get(t,2),(0,A.t)(St,It,3),i.set(n,0,It[0]),r.set(n,0,It[1]),i.set(n,1,It[2]),r.set(n,1,It[3]),i.set(n,2,It[4]),r.set(n,2,It[5])}const St=(0,r.ap)(),It=new Float32Array(6),Ct=e=>{const t=e.baseBoundingSphere.radius,i=e.levels.map((e=>e.minScreenSpaceRadius));return new pt(t,i)};let Mt=class extends le{constructor(e,t){super(e),this.type=b.i.LOD,this.isGround=!1,this._levels=[],this._defaultRenderInstanceData=new Array,this._highlightRenderInstanceDataMap=new Map,this._instanceIndex=0,this._cycleStartIndex=0,this._slicePlane=!1,this._camera=new We,this._updateCyclesWithStaticCamera=-1,this._needFullCycle=!1,this.produces=new Map([[l.A.OPAQUE_MATERIAL,e=>this._produces(e)],[l.A.TRANSPARENT_MATERIAL,e=>!!this._hasTransparentLevels()&&this._produces(e)]]),this._instanceData=new at({shaderTransformation:e.shaderTransformation},e.optionalFields),this.addHandles(t.registerTask(r.c5.LOD_RENDERER,this))}initialize(){this._instanceBufferLayout=Bt(this.optionalFields),this._glInstanceBufferLayout=(0,c.t)(this._instanceBufferLayout,1),this.addHandles([this._instanceData.events.on("instances-changed",(()=>this._requestUpdateCycle())),this._instanceData.events.on("instance-transform-changed",(({index:e})=>{this._requestUpdateCycle(),this.metadata.notifyGraphicGeometryChanged(e)})),this._instanceData.events.on("instance-visibility-changed",(({index:e})=>{this._requestUpdateCycle(!0),this.metadata.notifyGraphicVisibilityChanged(e)})),this._instanceData.events.on("instance-highlight-changed",(()=>this._requestUpdateCycle(!0)))])}get _allRenderInstanceData(){const e=[this._defaultRenderInstanceData];for(const t of this._highlightRenderInstanceDataMap)e.push(t[1]);return e}get _enableLevelSelection(){return this.symbol.levels.length>1}get levels(){return this._levels}get baseBoundingBox(){return this._levels[this._levels.length-1].boundingBox}get baseBoundingSphere(){return this._levels[this._levels.length-1].boundingSphere}get baseMaterial(){return this._levels[this._levels.length-1].components[0].material}get slicePlaneEnabled(){return this._slicePlane}set slicePlaneEnabled(e){this._slicePlane=e}get layerUid(){return this.metadata.layerUid}get instanceData(){return this._instanceData}get hasEmissions(){return this.baseMaterial.hasEmissions}get usedMemory(){return this._allRenderInstanceData.reduce(((e,t)=>t.reduce(((e,t)=>e+t.usedMemory),e)),0)}get renderStats(){const e=this._instanceData.size,t=[];return this._levels.forEach(((e,i)=>{const r=this._allRenderInstanceData[0][i].size+this._allRenderInstanceData[1][i].size,n=e.triangleCount;t.push({renderedInstances:r,renderedTriangles:r*n,trianglesPerInstance:n})})),{totalInstances:e,renderedInstances:t.reduce(((e,t)=>e+t.renderedInstances),0),renderedTriangles:t.reduce(((e,t)=>e+t.renderedTriangles),0),levels:t}}_createRenderInstanceDataArray(e=[]){const{rctx:t}=this._context.renderContext;return this.symbol.levels.map((i=>{e.push(new it(t,this._instanceBufferLayout))})),e}async initializeRenderContext(e,t){this._context=e,this._createRenderInstanceDataArray(this._defaultRenderInstanceData);const i=await Promise.allSettled(this.symbol.levels.map((i=>At.create(e,i,t)))),n=i.map((e=>"fulfilled"===e.status?e.value:null)).filter(r.ci);if((0,r.la)(t)||n.length!==i.length){n.forEach((e=>e.destroy())),(0,r.J)(t);for(const e of i)if("rejected"===e.status)throw e.reason}this._levels=n,this._levelSelector=Ct(this)}uninitializeRenderContext(){this._invalidateOctree(),this._levels.forEach((e=>e.destroy())),this._defaultRenderInstanceData.forEach((e=>e.destroy())),this._highlightRenderInstanceDataMap.forEach((e=>e.forEach((e=>e.destroy()))))}_hasTransparentLevels(){return this._levels.some((e=>e.components.some((e=>e.material.produces.get(l.A.TRANSPARENT_MATERIAL)?.(h.b.Color)))))}hasHighlights(){return(0,r.j4)(this._highlightRenderInstanceDataMap,(e=>e.some((e=>e.size>0))))}_produces(e){return e!==h.b.Highlight&&e!==h.b.ShadowHighlight||this.hasHighlights()}prepareRender(e){if(!l.g.LOD_INSTANCE_RENDERER_DISABLE_UPDATES){if(this._enableLevelSelection){const t=e.bind.contentCamera.equals(this._camera);this._camera.copyFrom(e.bind.contentCamera),t||this._requestUpdateCycle()}this._needFullCycle&&(this.runTask(r.mD),this._needFullCycle=!1)}}acquireTechniques(e){if(!this.baseMaterial.visible||!this.baseMaterial.isVisibleForOutput(e.output))return null;const t=this._getInstanceDatas(e);if(!t)return null;const i=new Array,r=this.levels;return t.forEach((t=>r.forEach((({components:r},n)=>r.forEach((r=>i.push(this._beginComponent(e,t[n],r)))))))),i}render(e,t){const i=this._getInstanceDatas(e);if(!i||null==t)return;let r=0;e.rctx.bindVAO();const n=this.levels;i.forEach((i=>n.forEach((({components:n},s)=>n.forEach((n=>this._renderComponent(e,t[r++],i[s],n,s)))))))}_getInstanceDatas(e){const{output:t,bind:i}=e,r=t===h.b.Highlight,n=!r&&t!==h.b.ShadowHighlight,s=t!==h.b.ShadowExcludeHighlight;if(n)return s?this._allRenderInstanceData:[this._defaultRenderInstanceData];if(s){if(r){const{highlightGroupName:e}=i;if(!e)return null;const t=this._highlightRenderInstanceDataMap.get(e);return t?[t]:null}const e=[];for(const t of this._highlightRenderInstanceDataMap)e.push(t[1]);return e}return null}intersect(e,t,i,n){if(!this.baseMaterial.visible||null==this._octree)return;const s=(0,r.ap)();(0,r.dB)(s,n,i);const o=s=>{this._instanceData.getCombinedModelTransform(s,Nt),e.transform.set(Nt),(0,r.dX)(zt,i,e.transform.inverse),(0,r.dX)(Gt,n,e.transform.inverse);const o=this._instanceData.getState(s),a=this._instanceData.getLodLevel(s),l=this._levels.length;(0,p.s)(!!(o&nt.ACTIVE),"invalid instance state"),(0,p.s)(a>=0&&a<l,"invaid lod level"),this._levels[a].intersect(e,t,zt,Gt,s,this.metadata,l)};this.baseMaterial.parameters.verticalOffset?this._octree.forEach(o):this._octree.forEachAlongRay(i,s,o)}notifyShaderTransformationChanged(){this._invalidateOctree(),this._requestUpdateCycle()}get _octree(){if(null==this._octreeCached){const e=this._instanceData,t=e.view?.state;if(!t)return null;this._octreeCached=new ft(e,this.baseBoundingSphere);for(let i=0;i<e.capacity;++i)t.get(i)&nt.ACTIVE&&this._octreeCached.addInstance(i)}return this._octreeCached}_invalidateOctree(){this._octreeCached=(0,r.ch)(this._octreeCached)}queryDepthRange(e){if(null==this._octree)return{near:1/0,far:-1/0};const t=e.viewForward,i=this._octree.findClosest(t,g.Y.DepthOrder.FRONT_TO_BACK,e.frustum),n=this._octree.findClosest(t,g.Y.DepthOrder.BACK_TO_FRONT,e.frustum);if(null==i||null==n)return{near:1/0,far:-1/0};const s=e.eye,o=this._instanceData.view;o.boundingSphere.getVec(i,Lt),(0,r.dB)(Lt,Lt,s);const a=(0,r.al)(Lt,t)-Lt[3];o.boundingSphere.getVec(n,Lt),(0,r.dB)(Lt,Lt,s);const l=(0,r.al)(Lt,t)+Lt[3];return{near:Math.max(e.near,a),far:Math.min(e.far,l)}}_requestUpdateCycle(e=!1){this._updateCyclesWithStaticCamera=-1,this._cycleStartIndex=this._instanceIndex,e&&(this._needFullCycle=!0,this._context.requestRender())}_startUpdateCycle(){this._updateCyclesWithStaticCamera++,this._allRenderInstanceData.forEach((e=>e.forEach((e=>e.startUpdateCycle()))))}get running(){return this._instanceData.size>0&&this._updateCyclesWithStaticCamera<1}runTask(e){const{_enableLevelSelection:t,_camera:i,_levelSelector:n}=this;this._allRenderInstanceData.forEach((e=>e.forEach((e=>e.beginUpdate()))));const s=this._instanceData,o=s.view;let a=s.size;const l=s.capacity;let c=this._instanceIndex;const h=Math.ceil(l/500);for(let d=0;d<a&&!e.done;++d){c===this._cycleStartIndex&&this._startUpdateCycle();const d=o.state.get(c);let u=0;if(!(d&nt.ALLOCATED)){c=c+1===l?0:c+1,a++;continue}const f=o.lodLevel.get(c);if(d&nt.DEFAULT_ACTIVE&&this._defaultRenderInstanceData[f].freeTail(),d&nt.HIGHLIGHT_ACTIVE&&s.foreachHighlightGroupPrev(c,(e=>{const t=this._highlightRenderInstanceDataMap.get(e);if(!t)throw new r.s("Internal error in lodRenderer");t[f].freeTail()})),d&nt.REMOVE)s.freeInstance(c);else if(d&nt.VISIBLE){let e=0;t&&(o.modelOrigin.getVec(c,Pt),e=n.selectLevel(Pt,s.getCombinedMedianScaleFactor(c),i)),u=d&~(nt.ACTIVE|nt.TRANSFORM_CHANGED),e>=0&&(d&nt.HIGHLIGHT?(s.foreachHighlightGroup(c,(t=>{let i=this._highlightRenderInstanceDataMap.get(t);if(i||(i=this._createRenderInstanceDataArray(),i.forEach((e=>e.beginUpdate())),this._highlightRenderInstanceDataMap.set(t,i)),e>=i.length)throw new r.s(`LodRenderer internal error - missing lodLevel ${e}`);Dt(i[e],o,c)})),u|=nt.HIGHLIGHT_ACTIVE):(Dt(this._defaultRenderInstanceData[e],o,c),u|=nt.DEFAULT_ACTIVE)),o.state.set(c,u),o.lodLevel.set(c,e)}else u=d&~(nt.ACTIVE|nt.TRANSFORM_CHANGED),o.state.set(c,u);if(null!=this._octreeCached){const e=!!(d&nt.ACTIVE),t=!!(u&nt.ACTIVE);!e&&t?this._octreeCached.addInstance(c):e&&!t?this._octreeCached.removeInstance(c):e&&t&&d&nt.TRANSFORM_CHANGED&&(this._octreeCached.removeInstance(c),this._octreeCached.addInstance(c))}c=c+1===l?0:c+1,c%h==0&&e.madeProgress()}this._instanceIndex=c,this._allRenderInstanceData.forEach((e=>e.forEach((e=>e.endUpdate())))),this._context.requestRender()}_beginComponent(e,t,i){return 0===t.size?null:i.glMaterials.load(e.rctx,e.bind.slot,e.output)?.beginSlot(e.bind)}_renderComponent(e,t,i,n,s){if(!t)return;const{bind:o,rctx:a}=e;a.runAppleAmdDriverHelper();const c=a.bindTechnique(t,o,n.material.parameters,Ht);a.bindVAO(n.vao),t.ensureAttributeLocations(n.vao),l.g.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL&&e.output===h.b.Color&&(c.setUniform4fv("externalColor",Vt[Math.min(s,Vt.length-1)]),c.setUniform1i("colorMixMode",l.h.replace));const d=i.capacity,u=i.headIndex,f=i.tailIndex,_=i.firstIndex,m=this._glInstanceBufferLayout,g=(e,s)=>{(0,r.aJ)(a,l.O,i.buffer,m,e),a.drawArraysInstanced(t.primitiveType,0,n.vertexCount,s-e),(0,r.vq)(a,l.O,i.buffer,m)};n.material.parameters.transparent&&null!=_?u>f?((0,p.s)(_>=f&&_<=u,"invalid firstIndex"),g(_,u),g(f,_)):u<f&&(_<=u?((0,p.s)(_>=0&&_<=u,"invalid firstIndex"),g(_,u),g(f,d),g(0,_)):((0,p.s)(_>=f&&_<=d,"invalid firstIndex"),g(_,d),g(0,u),g(f,_))):u>f?g(f,u):u<f&&(g(0,u),g(f,d)),a.bindVAO(null)}};function Dt(e,t,i){const r=e.allocateHead();Ft(t,i,e.view,r)}function Ft(e,t,i,r){Et(e.modelOrigin,t,i.modelOriginHi,i.modelOriginLo,r),i.model.copyFrom(r,e.model,t),i.modelNormal.copyFrom(r,e.modelNormal,t),e.color&&i.color&&i.color.copyFrom(r,e.color,t),e.objectAndLayerIdColor&&i.objectAndLayerIdColor&&i.objectAndLayerIdColor.copyFrom(r,e.objectAndLayerIdColor,t),e.featureAttribute&&i.featureAttribute&&i.featureAttribute.copyFrom(r,e.featureAttribute,t)}function Bt(e){let t=(0,m.H)().vec3f(_.e.INSTANCEMODELORIGINHI).vec3f(_.e.INSTANCEMODELORIGINLO).mat3f(_.e.INSTANCEMODEL).mat3f(_.e.INSTANCEMODELNORMAL);return null!=e&&e.includes("featureAttribute")&&(t=t.vec4f(_.e.INSTANCEFEATUREATTRIBUTE)),null!=e&&e.includes("color")&&(t=t.vec4u8(_.e.INSTANCECOLOR)),null!=e&&e.includes("objectAndLayerIdColor")&&(t=t.vec4u8(_.e.INSTANCEOBJECTANDLAYERIDCOLOR)),t}(0,r.bt)([(0,r.bu)({constructOnly:!0})],Mt.prototype,"symbol",void 0),(0,r.bt)([(0,r.bu)({constructOnly:!0})],Mt.prototype,"optionalFields",void 0),(0,r.bt)([(0,r.bu)({constructOnly:!0})],Mt.prototype,"metadata",void 0),(0,r.bt)([(0,r.bu)({constructOnly:!0})],Mt.prototype,"shaderTransformation",void 0),(0,r.bt)([(0,r.bu)()],Mt.prototype,"_instanceData",void 0),(0,r.bt)([(0,r.bu)()],Mt.prototype,"_cycleStartIndex",void 0),(0,r.bt)([(0,r.bu)({readOnly:!0})],Mt.prototype,"_enableLevelSelection",null),(0,r.bt)([(0,r.bu)()],Mt.prototype,"_updateCyclesWithStaticCamera",void 0),(0,r.bt)([(0,r.bu)({readOnly:!0})],Mt.prototype,"running",null),Mt=(0,r.bt)([(0,r.bv)("esri.views.3d.webgl-engine.lib.lodRendering.LodRenderer")],Mt);const Pt=(0,r.ap)(),Lt=(0,r.iB)(),Nt=(0,f.e)(),zt=(0,r.ap)(),Gt=(0,r.ap)(),Vt=[(0,r.iV)(1,0,1,1),(0,r.iV)(0,0,1,1),(0,r.iV)(0,1,0,1),(0,r.iV)(1,1,0,1),(0,r.iV)(1,0,0,1)],Ht=new l.N;let jt=class{constructor(e,t=null){this.geometry=e,this.textures=t}get material(){return this.geometry.material}get numTriangles(){return this.geometry instanceof l.r?this.geometry.indexCount/3:this.geometry.elementCount/3}};function Ut(e){return e instanceof l.r?e.attributes.get(_.e.POSITION).indices.length:e.elementCount}let Yt=class{constructor(e,t,i){this.components=e,this.minScreenSpaceRadius=t,this.pivotOffset=i;const n=(0,r.tn)(this.components.map((e=>e.geometry)));this.numVertices=n.reduce(((e,t)=>e+Ut(t)),0)}},qt=class{constructor(e){this.levels=e,this.levels.sort(((e,t)=>e.minScreenSpaceRadius===t.minScreenSpaceRadius?e.numVertices-t.numVertices:e.minScreenSpaceRadius-t.minScreenSpaceRadius))}};function kt(e){const t=[];return e.levels.forEach((e=>e.components.forEach((e=>t.push(e.geometry.material))))),(0,r.tn)(t)}function Xt(e){const t=new Array;return e.levels.forEach((e=>e.components.forEach((e=>{null!=e.textures&&t.push(...e.textures)})))),(0,r.tn)(t)}let Wt=class{constructor(e){this._optionalFields=new Array,this._instanceIndexToFeatureId=new Map,this._featureIdToInstanceIndex=new Map,this._disposeResourceHandles=new Array,this._lodRendererResources=null,this.layerUid=e.layerUid,this.view=e.view,this.sharedResources=this.view.sharedSymbolResources,this.scheduler=this.view.resourceController.scheduler}async doLoad(e,t,i){(0,r.Q)("enable-feature:objectAndLayerId-rendering")&&this._optionalFields.push(_.e.OBJECTANDLAYERIDCOLOR);const n=Qt((e=>t(e)),e),s=this.view._stage,o=kt(n);s.addMany(o),this._addDisposeResource((()=>s.removeMany(o)));const a=Xt(n);s.addMany(a),this._addDisposeResource((()=>{a.forEach((e=>e.unload())),s.removeMany(a)})),await Promise.all(a.map((e=>this.view._stage.schedule((()=>e.load(s.renderView.renderingContext)),i)))),(0,r.J)(i);const l=await this._createLodRenderer(n,i);this._lodRendererResources={lodRenderer:l,materials:o,textures:a}}addInstances(e){const t=this._lodRendererResources;if(null==t)return;const{featureIds:i,localTransforms:r,globalTransforms:n}=e,s=t.lodRenderer;if(null==s)return;const o=s.instanceData,a=i.length;for(let l=0;l<a;++l){const e=i[l],t=o.addInstance(),s=o.view,a=16*l;s.localTransform.copyFromTypedBuffer(t,r,a),s.globalTransform.copyFromTypedBuffer(t,n,a),o.updateModelTransform(t),o.setVisible(t,!0),this._instanceIndexToFeatureId.set(t,e),this._featureIdToInstanceIndex.set(e,t)}}removeInstances(e){const t=this._lodRendererResources;if(null==t)return;const i=t?.lodRenderer,r=i.instanceData,n=this._instanceIndexToFeatureId,s=this._featureIdToInstanceIndex,o=e.length;for(let a=0;a<o;++a){const t=e[a],i=s.get(t);null!=i&&(r.removeInstance(i),n.delete(i),s.delete(t))}}_addDisposeResource(e){this._disposeResourceHandles.push(e)}async _createLodRenderer(e,t){const i=this.view._stage,r={layerUid:this.layerUid,graphicUid:e=>1,notifyGraphicGeometryChanged:e=>1,notifyGraphicVisibilityChanged:e=>1},n=new Mt({symbol:e,optionalFields:this._optionalFields,metadata:r,shaderTransformation:null},this.scheduler);return n.slicePlaneEnabled=!1,this._addDisposeResource((()=>{i.removeRenderPlugin(n),n.destroy()})),await i.addRenderPlugin(n,t),n}};function Qt(e,t){const i=t.levels.map((t=>{const i=t.components.map((t=>{const i=e(t.materialId);if(!$t(i))throw new Error("LodRenderer only supports DefaultMaterial");const r=i.createBufferWriter(),n={material:i,vertexBufferLayout:r.vertexBufferLayout,buffer:t.renderGeometryBuffer.data,elementCount:t.renderGeometryBuffer.elementCount,boundingInfo:t.boundingInfo};return new jt(n)}));return new Yt(i,t.minScreenSpaceRadius)}));return new qt(i)}function $t(e){return null!=e&&"materialType"in e&&"default"===e.materialType}Wt=(0,r.bt)([(0,r.bv)("esri.views.3d.layers.graphics.pipeline.rendering.LodRenderer")],Wt);const Jt=128,Zt=.5;function Kt(e){return"cross"===e||"x"===e}function ei(e,t=Jt,i=t*Zt,n=0){const s=ti(e,t,i,n);return new l.C(s,{mipmap:!1,wrap:{s:r.cx.CLAMP_TO_EDGE,t:r.cx.CLAMP_TO_EDGE},width:t,height:t,components:4,noUnpackFlip:!0,reloadable:!0})}function ti(e,t=Jt,i=t*Zt,r=0){switch(e){case"circle":default:return ii(t,i);case"square":return ri(t,i);case"cross":return si(t,i,r);case"x":return oi(t,i,r);case"kite":return ni(t,i);case"triangle":return ai(t,i);case"arrow":return li(t,i)}}function ii(e,t){const i=e/2-.5;return fi(e,di(i,i,t/2))}function ri(e,t){return ci(e,t,!1)}function ni(e,t){return ci(e,t,!0)}function si(e,t,i=0){return hi(e,t,!1,i)}function oi(e,t,i=0){return hi(e,t,!0,i)}function ai(e,t){return fi(e,ui(e/2,t,t/2))}function li(e,t){const i=t,r=t/2,n=e/2,s=.8*i,o=di(n,(e-t)/2-s,Math.sqrt(s*s+r*r)),a=ui(n,i,r);return fi(e,((e,t)=>Math.max(a(e,t),-o(e,t))))}function ci(e,t,i){return i&&(t/=Math.SQRT2),fi(e,((r,n)=>{let s=r-.5*e+.25,o=.5*e-n-.75;if(i){const e=(s+o)/Math.SQRT2;o=(o-s)/Math.SQRT2,s=e}return Math.max(Math.abs(s),Math.abs(o))-.5*t}))}function hi(e,t,i,r=0){t-=r,i&&(t*=Math.SQRT2);const n=.5*t;return fi(e,((t,s)=>{let o,a=t-.5*e,l=.5*e-s-1;if(i){const e=(a+l)/Math.SQRT2;l=(l-a)/Math.SQRT2,a=e}return a=Math.abs(a),l=Math.abs(l),o=a>l?a>n?Math.sqrt((a-n)*(a-n)+l*l):l:l>n?Math.sqrt(a*a+(l-n)*(l-n)):a,o-=r/2,o}))}function di(e,t,i){return(r,n)=>{const s=r-e,o=n-t;return Math.sqrt(s*s+o*o)-i}}function ui(e,t,i){const r=Math.sqrt(t*t+i*i);return(n,s)=>{const o=Math.abs(n-e)-i,a=s-e+t/2+.75,l=(t*o+i*a)/r,c=-a;return Math.max(l,c)}}function fi(e,t){const i=new Uint8Array(4*e*e);for(let r=0;r<e;r++)for(let n=0;n<e;n++){const s=n+e*r;let o=t(n,r);o=o/e+.5,(0,E.o)(o,i,4*s)}return i}function pi(e){return e instanceof Float32Array&&e.length>=16}function _i(e){return Array.isArray(e)&&e.length>=16}function mi(e){return pi(e)||_i(e)}const gi=.5;function yi(e,t){e.include(l.i),e.attributes.add(_.e.POSITION,"vec3"),e.attributes.add(_.e.NORMAL,"vec3"),e.attributes.add(_.e.CENTEROFFSETANDDISTANCE,"vec4");const i=e.vertex;(0,l.j)(i,t),(0,l.k)(i,t),i.uniforms.add(new l.l("viewport",((e,t)=>t.camera.fullViewport)),new l.m("polygonOffset",(e=>e.shaderPolygonOffset)),new l.m("cameraGroundRelative",((e,t)=>t.camera.aboveGround?1:-1))),t.hasVerticalOffset&&(0,l.p)(i),i.constants.add("smallOffsetAngle","float",.984807753012208),i.code.add(P.o`struct ProjectHUDAux {
vec3 posModel;
vec3 posView;
vec3 vnormal;
float distanceToCamera;
float absCosAngle;
};`),i.code.add(P.o`
    float applyHUDViewDependentPolygonOffset(float pointGroundDistance, float absCosAngle, inout vec3 posView) {
      float pointGroundSign = ${t.terrainDepthTest?P.o.float(0):P.o`sign(pointGroundDistance)`};
      if (pointGroundSign == 0.0) {
        pointGroundSign = cameraGroundRelative;
      }

      // cameraGroundRelative is -1 if camera is below ground, 1 if above ground
      // groundRelative is 1 if both camera and symbol are on the same side of the ground, -1 otherwise
      float groundRelative = cameraGroundRelative * pointGroundSign;

      // view angle dependent part of polygon offset emulation: we take the absolute value because the sign that is
      // dropped is instead introduced using the ground-relative position of the symbol and the camera
      if (polygonOffset > .0) {
        float cosAlpha = clamp(absCosAngle, 0.01, 1.0);
        float tanAlpha = sqrt(1.0 - cosAlpha * cosAlpha) / cosAlpha;
        float factor = (1.0 - tanAlpha / viewport[2]);

        // same side of the terrain
        if (groundRelative > 0.0) {
          posView *= factor;
        }
        // opposite sides of the terrain
        else {
          posView /= factor;
        }
      }

      return groundRelative;
    }
  `),t.draped&&!t.hasVerticalOffset||(0,l.q)(i),t.draped||(i.uniforms.add(new l.m("perDistancePixelRatio",((e,t)=>Math.tan(t.camera.fovY/2)/(t.camera.fullViewport[2]/2)))),i.code.add(P.o`
    void applyHUDVerticalGroundOffset(vec3 normalModel, inout vec3 posModel, inout vec3 posView) {
      float distanceToCamera = length(posView);

      // Compute offset in world units for a half pixel shift
      float pixelOffset = distanceToCamera * perDistancePixelRatio * ${P.o.float(gi)};

      // Apply offset along normal in the direction away from the ground surface
      vec3 modelOffset = normalModel * cameraGroundRelative * pixelOffset;

      // Apply the same offset also on the view space position
      vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;

      posModel += modelOffset;
      posView += viewOffset;
    }
  `)),t.screenCenterOffsetUnitsEnabled&&(0,l.w)(i),t.hasScreenSizePerspective&&(0,l.u)(i),i.code.add(P.o`
    vec4 projectPositionHUD(out ProjectHUDAux aux) {
      vec3 centerOffset = centerOffsetAndDistance.xyz;
      float pointGroundDistance = centerOffsetAndDistance.w;

      aux.posModel = position;
      aux.posView = (view * vec4(aux.posModel, 1.0)).xyz;
      aux.vnormal = normal;
      ${t.draped?"":"applyHUDVerticalGroundOffset(aux.vnormal, aux.posModel, aux.posView);"}

      // Screen sized offset in world space, used for example for line callouts
      // Note: keep this implementation in sync with the CPU implementation, see
      //   - MaterialUtil.verticalOffsetAtDistance
      //   - HUDMaterial.applyVerticalOffsetTransformation

      aux.distanceToCamera = length(aux.posView);

      vec3 viewDirObjSpace = normalize(cameraPosition - aux.posModel);
      float cosAngle = dot(aux.vnormal, viewDirObjSpace);

      aux.absCosAngle = abs(cosAngle);

      ${t.hasScreenSizePerspective&&(t.hasVerticalOffset||t.screenCenterOffsetUnitsEnabled)?"vec3 perspectiveFactor = screenSizePerspectiveScaleFactor(aux.absCosAngle, aux.distanceToCamera, screenSizePerspectiveAlignment);":""}

      ${t.hasVerticalOffset?t.hasScreenSizePerspective?"float verticalOffsetScreenHeight = applyScreenSizePerspectiveScaleFactorFloat(verticalOffset.x, perspectiveFactor);":"float verticalOffsetScreenHeight = verticalOffset.x;":""}

      ${t.hasVerticalOffset?P.o`
            float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * aux.distanceToCamera, verticalOffset.z, verticalOffset.w);
            vec3 modelOffset = aux.vnormal * worldOffset;
            aux.posModel += modelOffset;
            vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;
            aux.posView += viewOffset;
            // Since we elevate the object, we need to take that into account
            // in the distance to ground
            pointGroundDistance += worldOffset;`:""}

      float groundRelative = applyHUDViewDependentPolygonOffset(pointGroundDistance, aux.absCosAngle, aux.posView);

      ${t.screenCenterOffsetUnitsEnabled?"":P.o`
            // Apply x/y in view space, but z in screen space (i.e. along posView direction)
            aux.posView += vec3(centerOffset.x, centerOffset.y, 0.0);

            // Same material all have same z != 0.0 condition so should not lead to
            // branch fragmentation and will save a normalization if it's not needed
            if (centerOffset.z != 0.0) {
              aux.posView -= normalize(aux.posView) * centerOffset.z;
            }
          `}

      vec4 posProj = proj * vec4(aux.posView, 1.0);

      ${t.screenCenterOffsetUnitsEnabled?t.hasScreenSizePerspective?"float centerOffsetY = applyScreenSizePerspectiveScaleFactorFloat(centerOffset.y, perspectiveFactor);":"float centerOffsetY = centerOffset.y;":""}

      ${t.screenCenterOffsetUnitsEnabled?"posProj.xy += vec2(centerOffset.x, centerOffsetY) * pixelRatio * 2.0 / viewport.zw * posProj.w;":""}

      // constant part of polygon offset emulation
      posProj.z -= groundRelative * polygonOffset * posProj.w;
      return posProj;
    }
  `)}let vi=class{constructor(){this.factor=new bi,this.factorAlignment=new bi}},bi=class{constructor(){this.scale=0,this.factor=0,this.minScaleFactor=0}};function wi(e){e.uniforms.add(new l.v("alignPixelEnabled",((e,t)=>t.alignPixelEnabled))),e.code.add(P.o`vec4 alignToPixelCenter(vec4 clipCoord, vec2 widthHeight) {
if (!alignPixelEnabled)
return clipCoord;
vec2 xy = vec2(0.500123) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = (floor(xy * widthHeight) + vec2(0.5)) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`),e.code.add(P.o`vec4 alignToPixelOrigin(vec4 clipCoord, vec2 widthHeight) {
if (!alignPixelEnabled)
return clipCoord;
vec2 xy = vec2(0.5) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = floor((xy + 0.5 * pixelSz) * widthHeight) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`)}function Ti(e,t){const{vertex:i,fragment:r}=e;e.include(l.x,t),i.include(wi),t.terrainDepthTest&&e.varyings.add("depth","float"),i.main.add(P.o`
    vec4 posProjCenter;
    if (dot(position, position) > 0.0) {
      // Render single point to center of the pixel to avoid subpixel filtering to affect the marker color
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);
      posProjCenter = alignToPixelCenter(posProj, viewport.zw);

      ${t.terrainDepthTest?P.o`depth = projectAux.posView.z;`:""}
      vec3 vpos = projectAux.posModel;
      if (rejectBySlice(vpos)) {
        // Project out of clip space
        posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
      }

    } else {
      // Project out of clip space
      posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
    }

    gl_Position = posProjCenter;
    gl_PointSize = 1.0;
  `),r.main.add(P.o`fragColor = vec4(1);
if(terrainDepthTest(depth)) {
fragColor.g = 0.5;
}`)}var xi;function Oi(e){e.vertex.uniforms.add(new l.m("renderTransparentlyOccludedHUD",((e,t)=>t.hudRenderStyle===xi.Occluded?1:t.hudRenderStyle===xi.NotOccluded?0:.75)),new l.l("viewport",((e,t)=>t.camera.fullViewport)),new l.y("hudVisibilityTexture",((e,t)=>t.hudVisibility?.getTexture()))),e.vertex.include(wi),e.vertex.code.add(P.o`bool testHUDVisibility(vec4 posProj) {
vec4 posProjCenter = alignToPixelCenter(posProj, viewport.zw);
vec4 occlusionPixel = texture(hudVisibilityTexture, .5 + .5 * posProjCenter.xy / posProjCenter.w);
if (renderTransparentlyOccludedHUD > 0.5) {
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g * renderTransparentlyOccludedHUD < 1.0;
}
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g == 1.0;
}`)}(function(e){e[e.Occluded=0]="Occluded",e[e.NotOccluded=1]="NotOccluded",e[e.Both=2]="Both",e[e.COUNT=3]="COUNT"})(xi||(xi={}));const Ri={occludedFadeFactor:.6};function Ai(e){const t=new l.z,i=e.signedDistanceFieldEnabled;if(t.include(yi,e),t.include(l.P,e),e.occlusionPass)return t.include(Ti,e),t;const{vertex:n,fragment:s}=t;t.include(l.i),t.include(l.D,e),t.include(l.E,e),t.include(Oi),s.include(N),s.include(l.F),t.varyings.add("vcolor","vec4"),t.varyings.add("vtc","vec2"),t.varyings.add("vsize","vec2"),t.varyings.add("voccluded","float"),n.uniforms.add(new l.l("viewport",((e,t)=>t.camera.fullViewport)),new l.G("screenOffset",((e,t)=>(0,r.gV)(Ci,2*e.screenOffset[0]*t.camera.pixelRatio,2*e.screenOffset[1]*t.camera.pixelRatio))),new l.G("anchorPosition",(e=>Si(e))),new l.l("materialColor",(e=>e.color)),new l.m("materialRotation",(e=>e.rotation))),(0,l.w)(n),i&&(n.uniforms.add(new l.l("outlineColor",(e=>e.outlineColor))),s.uniforms.add(new l.l("outlineColor",(e=>Ei(e)?e.outlineColor:r.vr)),new l.m("outlineSize",(e=>Ei(e)?e.outlineSize:0)))),e.horizonCullingEnabled&&n.uniforms.add(new z("pointDistanceSphere",((e,t)=>{const i=t.camera.eye,n=e.origin;return(0,r.iV)(n[0]-i[0],n[1]-i[1],n[2]-i[2],r.nZ.radius)}))),e.pixelSnappingEnabled&&n.include(wi),e.hasScreenSizePerspective&&((0,l.H)(n),(0,l.u)(n)),e.debugDrawLabelBorder&&t.varyings.add("debugBorderCoords","vec4"),t.attributes.add(_.e.UV0,"vec2"),t.attributes.add(_.e.COLOR,"vec4"),t.attributes.add(_.e.SIZE,"vec2"),t.attributes.add(_.e.ROTATION,"float"),t.attributes.add(_.e.FEATUREATTRIBUTE,"vec4"),n.code.add(e.horizonCullingEnabled?P.o`bool behindHorizon(vec3 posModel) {
vec3 camToEarthCenter = pointDistanceSphere.xyz - localOrigin;
vec3 camToPos = pointDistanceSphere.xyz + posModel;
float earthRadius = pointDistanceSphere.w;
float a = dot(camToPos, camToPos);
float b = dot(camToPos, camToEarthCenter);
float c = dot(camToEarthCenter, camToEarthCenter) - earthRadius * earthRadius;
return  b > 0.0 && b < a && b * b  > a * c;
}`:P.o`bool behindHorizon(vec3 posModel) { return false; }`),n.main.add(P.o`
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);
      forwardObjectAndLayerIdColor();

      if (rejectBySlice(projectAux.posModel)) {
        // Project outside of clip plane
        gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
        return;
      }

      if (behindHorizon(projectAux.posModel)) {
        // Project outside of clip plane
        gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
        return;
      }

      vec2 inputSize;
      ${(0,P.r)(e.hasScreenSizePerspective,P.o`
          inputSize = screenSizePerspectiveScaleVec2(size, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspective);
          vec2 screenOffsetScaled = screenSizePerspectiveScaleVec2(screenOffset, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);`,P.o`
          inputSize = size;
          vec2 screenOffsetScaled = screenOffset;`)}
      ${(0,P.r)(e.vvSize,P.o`inputSize *= vvScale(featureAttribute).xx;`)}

      vec2 combinedSize = inputSize * pixelRatio;
      vec4 quadOffset = vec4(0.0);
      bool visible = testHUDVisibility(posProj);
      voccluded = visible ? 0.0 : 1.0;
    `);const o=P.o`
      vec2 uv01 = floor(uv0);
      vec2 uv = uv0 - uv01;
      quadOffset.xy = (uv01 - anchorPosition) * 2.0 * combinedSize;

      ${(0,P.r)(e.hasRotation,P.o`
          float angle = radians(materialRotation + rotation);
          float cosAngle = cos(angle);
          float sinAngle = sin(angle);
          mat2 rotate = mat2(cosAngle, -sinAngle, sinAngle,  cosAngle);

          quadOffset.xy = rotate * quadOffset.xy;
        `)}

      quadOffset.xy = (quadOffset.xy + screenOffsetScaled) / viewport.zw * posProj.w;
  `,a=e.pixelSnappingEnabled?i?P.o`posProj = alignToPixelOrigin(posProj, viewport.zw) + quadOffset;`:P.o`posProj += quadOffset;
if (inputSize.x == size.x) {
posProj = alignToPixelOrigin(posProj, viewport.zw);
}`:P.o`posProj += quadOffset;`;n.main.add(P.o`
    ${(0,P.r)(e.occlusionTestEnabled,P.o`
      if (!visible) {
        vtc = vec2(0.0);
        ${(0,P.r)(e.debugDrawLabelBorder,"debugBorderCoords = vec4(0.5, 0.5, 1.5 / combinedSize);")}
        return;
      }`)}
    ${o}
    ${e.vvColor?"vcolor = interpolateVVColor(featureAttribute.y) * materialColor;":"vcolor = color / 255.0 * materialColor;"}

    ${(0,P.r)(e.output===h.b.ObjectAndLayerIdColor,P.o`vcolor.a = 1.0;`)}

    bool alphaDiscard = vcolor.a < ${P.o.float(r.ug)};
    ${(0,P.r)(i,`alphaDiscard = alphaDiscard && outlineColor.a < ${P.o.float(r.ug)};`)}
    if (alphaDiscard) {
      // "early discard" if both symbol color (= fill) and outline color (if applicable) are transparent
      gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
      return;
    } else {
      ${a}
      gl_Position = posProj;
    }

    vtc = uv;

    ${(0,P.r)(e.debugDrawLabelBorder,P.o`debugBorderCoords = vec4(uv01, 1.5 / combinedSize);`)}
    vsize = inputSize;
  `),s.uniforms.add(new l.y("tex",(e=>e.texture))),e.occludedFragmentFade&&(s.uniforms.add(new l.y("depthMap",((e,t)=>t.mainDepth))),s.uniforms.add(new l.m("fadeFactor",(()=>Ri.occludedFadeFactor))));const c=e.debugDrawLabelBorder?P.o`(isBorder > 0.0 ? 0.0 : ${P.o.float(r.ug)})`:P.o.float(r.ug),d=e.output===h.b.Highlight,u=P.o`
    ${(0,P.r)(e.debugDrawLabelBorder,P.o`float isBorder = float(any(lessThan(debugBorderCoords.xy, debugBorderCoords.zw)) || any(greaterThan(debugBorderCoords.xy, 1.0 - debugBorderCoords.zw)));`)}

    ${(0,P.r)(e.sampleSignedDistanceFieldTexelCenter,P.o`
      float txSize = float(textureSize(tex, 0).x);
      float texelSize = 1.0 / txSize;

      // Calculate how much we have to add/subtract to/from each texel to reach the size of an onscreen pixel
      vec2 scaleFactor = (vsize - txSize) * texelSize;
      vec2 samplePos = vtc + (vec2(1.0, -1.0) * texelSize) * scaleFactor;`,P.o`vec2 samplePos = vtc;`)}

    ${i?P.o`
      vec4 fillPixelColor = vcolor;

      // Get distance and map it into [-0.5, 0.5]
      float d = rgba2float(texture(tex, samplePos)) - 0.5;

      // Distance in output units (i.e. pixels)
      float dist = d * vsize.x;

      // Create smooth transition from the icon into its outline
      float fillAlphaFactor = clamp(0.5 - dist, 0.0, 1.0);
      fillPixelColor.a *= fillAlphaFactor;

      if (outlineSize > 0.25) {
        vec4 outlinePixelColor = outlineColor;
        float clampedOutlineSize = min(outlineSize, 0.5*vsize.x);

        // Create smooth transition around outline
        float outlineAlphaFactor = clamp(0.5 - (abs(dist) - 0.5*clampedOutlineSize), 0.0, 1.0);
        outlinePixelColor.a *= outlineAlphaFactor;

        if (
          outlineAlphaFactor + fillAlphaFactor < ${c} ||
          fillPixelColor.a + outlinePixelColor.a < ${P.o.float(r.ug)}
        ) {
          discard;
        }

        // perform un-premultiplied over operator (see https://en.wikipedia.org/wiki/Alpha_compositing#Description)
        float compositeAlpha = outlinePixelColor.a + fillPixelColor.a * (1.0 - outlinePixelColor.a);
        vec3 compositeColor = vec3(outlinePixelColor) * outlinePixelColor.a +
          vec3(fillPixelColor) * fillPixelColor.a * (1.0 - outlinePixelColor.a);

        ${(0,P.r)(!d,P.o`fragColor = vec4(compositeColor, compositeAlpha);`)}
      } else {
        if (fillAlphaFactor < ${c}) {
          discard;
        }

        ${(0,P.r)(!d,P.o`fragColor = premultiplyAlpha(fillPixelColor);`)}
      }

      // visualize SDF:
      // fragColor = vec4(clamp(-dist/vsize.x*2.0, 0.0, 1.0), clamp(dist/vsize.x*2.0, 0.0, 1.0), 0.0, 1.0);
      `:P.o`
          vec4 texColor = texture(tex, vtc, -0.5);
          if (texColor.a < ${c}) {
            discard;
          }
          ${(0,P.r)(!d,P.o`fragColor = texColor * premultiplyAlpha(vcolor);`)}
          `}

    ${(0,P.r)(e.occludedFragmentFade&&!d,P.o`
        float zSample = texelFetch(depthMap, ivec2(gl_FragCoord.xy), 0).x;
        if (zSample < gl_FragCoord.z) {
          fragColor *= fadeFactor;
        }
        `)}

    ${(0,P.r)(!d&&e.debugDrawLabelBorder,P.o`fragColor = mix(fragColor, vec4(1.0, 0.0, 1.0, 1.0), isBorder * 0.5);`)}
  `;switch(e.output){case h.b.Color:e.oitPass===l.J.ColorAlpha&&(t.outputs.add("fragColor","vec4",0),t.outputs.add("fragAlpha","float",1)),s.main.add(P.o`
        ${u}
        ${(0,P.r)(e.oitPass===l.J.FrontFace,P.o`fragColor.rgb /= fragColor.a;`)}
        ${(0,P.r)(e.oitPass===l.J.ColorAlpha,P.o`fragAlpha = fragColor.a;`)}`);break;case h.b.ObjectAndLayerIdColor:s.main.add(P.o`
        ${u}
        outputObjectAndLayerIdColor();`);break;case h.b.Highlight:t.include(l.I,e),s.main.add(P.o`
        ${u}
        outputHighlight(voccluded == 1.0);`)}return t}function Ei(e){return e.outlineColor[3]>0&&e.outlineSize>0}function Si(e,t=Ci){return e.textureIsSignedDistanceField?Ii(e.anchorPosition,e.distanceFieldBoundingBox,t):(0,r.qj)(t,e.anchorPosition),t}function Ii(e,t,i){null!=t?(0,r.gV)(i,e[0]*(t[2]-t[0])+t[0],e[1]*(t[3]-t[1])+t[1]):(0,r.gV)(i,0,0)}const Ci=(0,r.g_)(),Mi=Object.freeze(Object.defineProperty({__proto__:null,build:Ai,calculateAnchorPosForRendering:Si,shaderSettings:Ri},Symbol.toStringTag,{value:"Module"}));let Di=class extends l.K{constructor(e,t,i){super(e,t,new l.L(Mi,(()=>Promise.resolve().then((()=>In)))),i),this.primitiveType=t.occlusionPass?r.hW.POINTS:r.hW.TRIANGLES}initializePipeline(e){const{oitPass:t,hasPolygonOffset:i,draped:n,output:s,depthTestEnabled:o}=e,a=t===l.J.NONE,c=i?Fi:null,d=t===l.J.ColorAlpha,u=n||!o||d||s===h.b.Highlight?null:S.p;return(0,S.B)({blending:s===h.b.Color?a?S.o:(0,l.T)(t):null,depthTest:o&&!n?{func:r.id.LEQUAL}:null,depthWrite:u,drawBuffers:(0,l.M)(t,s),colorWrite:S.g,polygonOffset:c})}};const Fi={factor:0,units:-4};let Bi=class extends l.R{constructor(e){super(),this.spherical=e,this.screenCenterOffsetUnitsEnabled=!1,this.occlusionTestEnabled=!0,this.signedDistanceFieldEnabled=!1,this.sampleSignedDistanceFieldTexelCenter=!1,this.vvSize=!1,this.vvColor=!1,this.hasVerticalOffset=!1,this.hasScreenSizePerspective=!1,this.hasRotation=!1,this.debugDrawLabelBorder=!1,this.hasSlicePlane=!1,this.hasPolygonOffset=!1,this.depthTestEnabled=!0,this.pixelSnappingEnabled=!0,this.draped=!1,this.terrainDepthTest=!1,this.cullAboveTerrain=!1,this.occlusionPass=!1,this.occludedFragmentFade=!1,this.objectAndLayerIdColorInstanced=!1,this.horizonCullingEnabled=!0,this.textureCoordinateType=l.S.None,this.emissionSource=l.U.None,this.discardInvisibleFragments=!0,this.hasSliceInVertexProgram=!0,this.hasVvInstancing=!1}};(0,r.bt)([(0,l.Q)()],Bi.prototype,"screenCenterOffsetUnitsEnabled",void 0),(0,r.bt)([(0,l.Q)()],Bi.prototype,"occlusionTestEnabled",void 0),(0,r.bt)([(0,l.Q)()],Bi.prototype,"signedDistanceFieldEnabled",void 0),(0,r.bt)([(0,l.Q)()],Bi.prototype,"sampleSignedDistanceFieldTexelCenter",void 0),(0,r.bt)([(0,l.Q)()],Bi.prototype,"vvSize",void 0),(0,r.bt)([(0,l.Q)()],Bi.prototype,"vvColor",void 0),(0,r.bt)([(0,l.Q)()],Bi.prototype,"hasVerticalOffset",void 0),(0,r.bt)([(0,l.Q)()],Bi.prototype,"hasScreenSizePerspective",void 0),(0,r.bt)([(0,l.Q)()],Bi.prototype,"hasRotation",void 0),(0,r.bt)([(0,l.Q)()],Bi.prototype,"debugDrawLabelBorder",void 0),(0,r.bt)([(0,l.Q)()],Bi.prototype,"hasSlicePlane",void 0),(0,r.bt)([(0,l.Q)()],Bi.prototype,"hasPolygonOffset",void 0),(0,r.bt)([(0,l.Q)()],Bi.prototype,"depthTestEnabled",void 0),(0,r.bt)([(0,l.Q)()],Bi.prototype,"pixelSnappingEnabled",void 0),(0,r.bt)([(0,l.Q)()],Bi.prototype,"draped",void 0),(0,r.bt)([(0,l.Q)()],Bi.prototype,"terrainDepthTest",void 0),(0,r.bt)([(0,l.Q)()],Bi.prototype,"cullAboveTerrain",void 0),(0,r.bt)([(0,l.Q)()],Bi.prototype,"occlusionPass",void 0),(0,r.bt)([(0,l.Q)()],Bi.prototype,"occludedFragmentFade",void 0),(0,r.bt)([(0,l.Q)()],Bi.prototype,"objectAndLayerIdColorInstanced",void 0),(0,r.bt)([(0,l.Q)()],Bi.prototype,"horizonCullingEnabled",void 0);class Pi extends l.V{constructor(e,t){super(e,or),this.produces=new Map([[l.A.HUD_MATERIAL,e=>(0,h.d)(e)&&!this.parameters.drawInSecondSlot],[l.A.LABEL_MATERIAL,e=>(0,h.d)(e)&&this.parameters.drawInSecondSlot],[l.A.OCCLUSION_PIXELS,()=>this.parameters.occlusionTest],[l.A.DRAPED_MATERIAL,e=>this.parameters.draped&&(0,h.d)(e)]]),this._visible=!0,this._configuration=new Bi(t)}getConfiguration(e,t){return this._configuration.output=e,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasVerticalOffset=!!this.parameters.verticalOffset,this._configuration.hasScreenSizePerspective=!!this.parameters.screenSizePerspective,this._configuration.screenCenterOffsetUnitsEnabled="screen"===this.parameters.centerOffsetUnits,this._configuration.hasPolygonOffset=this.parameters.polygonOffset,this._configuration.draped=this.parameters.draped,this._configuration.occlusionTestEnabled=this.parameters.occlusionTest,this._configuration.pixelSnappingEnabled=this.parameters.pixelSnappingEnabled,this._configuration.signedDistanceFieldEnabled=this.parameters.textureIsSignedDistanceField,this._configuration.sampleSignedDistanceFieldTexelCenter=this.parameters.sampleSignedDistanceFieldTexelCenter,this._configuration.hasRotation=this.parameters.hasRotation,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.occlusionPass=t.slot===l.A.OCCLUSION_PIXELS,this._configuration.occludedFragmentFade=this.parameters.occludedFragmentFade,this._configuration.horizonCullingEnabled=this.parameters.horizonCullingEnabled,this._configuration.depthTestEnabled=this.parameters.depthEnabled||t.slot===l.A.OCCLUSION_PIXELS,e===h.b.Color&&(this._configuration.debugDrawLabelBorder=!!l.g.LABELS_SHOW_BORDER),this._configuration.oitPass=t.oitPass,this._configuration.terrainDepthTest=t.terrainDepthTest,this._configuration.cullAboveTerrain=t.cullAboveTerrain,this._configuration}intersect(e,t,i,n,s,o){const{options:{selectionMode:a,hud:c,excludeLabels:h},point:d,camera:u}=i,{parameters:f}=this;if(!a||!c||h&&f.isLabel||!e.visible||!d)return;const{scaleX:m,scaleY:g}=this._getScreenScale(e,u.pixelRatio);(0,r.ge)(Qi,t),e.attributes.has(_.e.FEATUREATTRIBUTE)&&Gi(Qi);const y=e.attributes.get(_.e.POSITION),v=e.attributes.get(_.e.SIZE),b=e.attributes.get(_.e.NORMAL),w=e.attributes.get(_.e.ROTATION),T=e.attributes.get(_.e.CENTEROFFSETANDDISTANCE);(0,p.s)(y.size>=3);const x=Si(f),O="screen"===this.parameters.centerOffsetUnits;for(let p=0;p<y.data.length/y.size;p++){const e=p*y.size;(0,r.dQ)(ji,y.data[e],y.data[e+1],y.data[e+2]),(0,r.dX)(ji,ji,t),(0,r.dX)(ji,ji,u.viewMatrix);const n=p*T.size;if((0,r.dQ)(Zi,T.data[n],T.data[n+1],T.data[n+2]),!O&&(ji[0]+=Zi[0],ji[1]+=Zi[1],0!==Zi[2])){const e=Zi[2];(0,r.ao)(Zi,ji),(0,r.dB)(ji,ji,(0,r.dC)(Zi,Zi,e))}const s=p*b.size;if((0,r.dQ)(Ui,b.data[s],b.data[s+1],b.data[s+2]),zi(Ui,Qi,u,tr),this._applyVerticalOffsetTransformationView(ji,tr,u,Hi),u.applyProjection(ji,Yi),Yi[0]>-1){O&&(Zi[0]||Zi[1])&&(Yi[0]+=Zi[0]*u.pixelRatio,0!==Zi[1]&&(Yi[1]+=(0,l.W)(Zi[1],Hi.factorAlignment)*u.pixelRatio),u.unapplyProjection(Yi,ji)),Yi[0]+=this.parameters.screenOffset[0]*u.pixelRatio,Yi[1]+=this.parameters.screenOffset[1]*u.pixelRatio,Yi[0]=Math.floor(Yi[0]),Yi[1]=Math.floor(Yi[1]);const e=p*v.size;nr[0]=v.data[e],nr[1]=v.data[e+1],(0,l.X)(nr,Hi.factor,nr);const t=ir*u.pixelRatio;let n=0;f.textureIsSignedDistanceField&&(n=Math.min(f.outlineSize,.5*nr[0])*u.pixelRatio/2),nr[0]*=m,nr[1]*=g;const s=p*w.size,a=f.rotation+w.data[s];if(Vi(d,Yi[0],Yi[1],nr,t,n,a,f,x)){const e=i.ray;if((0,r.dX)(ki,ji,(0,r.dV)(Ji,u.viewMatrix)),Yi[0]=d[0],Yi[1]=d[1],u.unprojectFromRenderScreen(Yi,ji)){const t=(0,r.ap)();(0,r.dF)(t,e.direction);const i=1/(0,r.dS)(t);(0,r.dC)(t,t,i),o((0,r.dR)(e.origin,ji)*i,t,-1,!0,1,ki)}}}}}intersectDraped(e,t,i,r,n,s){const o=e.attributes.get(_.e.POSITION),a=e.attributes.get(_.e.SIZE),l=e.attributes.get(_.e.ROTATION),c=this.parameters,h=Si(c),{scaleX:d,scaleY:u}=this._getScreenScale(e,e.screenToWorldRatio),f=rr*e.screenToWorldRatio;for(let p=0;p<o.data.length/o.size;p++){const t=p*o.size,i=o.data[t],_=o.data[t+1],m=p*a.size;nr[0]=a.data[m],nr[1]=a.data[m+1];let g=0;c.textureIsSignedDistanceField&&(g=Math.min(c.outlineSize,.5*nr[0])*e.screenToWorldRatio/2),nr[0]*=d,nr[1]*=u;const y=p*l.size,v=c.rotation+l.data[y];Vi(r,i,_,nr,f,g,v,c,h)&&n(s.dist,s.normal,-1,!1)}}createBufferWriter(){return new cr}_updateScaleInfo(e,t,i){const r=this.parameters;null!=r.screenSizePerspective?(0,l.Y)(i,t,r.screenSizePerspective,e.factor):(e.factor.scale=1,e.factor.factor=0,e.factor.minScaleFactor=0),null!=r.screenSizePerspectiveAlignment?(0,l.Y)(i,t,r.screenSizePerspectiveAlignment,e.factorAlignment):(e.factorAlignment.factor=e.factor.factor,e.factorAlignment.scale=e.factor.scale,e.factorAlignment.minScaleFactor=e.factor.minScaleFactor)}applyShaderOffsetsView(e,t,i,r,n,s,o){const a=zi(t,i,n,tr);return this._applyVerticalGroundOffsetView(e,a,n,o),this._applyVerticalOffsetTransformationView(o,a,n,s),this._applyPolygonOffsetView(o,a,r[3],n,o),this._applyCenterOffsetView(o,r,o),o}applyShaderOffsetsNDC(e,t,i,n,s){return this._applyCenterOffsetNDC(e,t,i,n),null!=s&&(0,r.dF)(s,n),this._applyPolygonOffsetNDC(n,t,i,n),n}_applyPolygonOffsetView(e,t,i,n,s){const o=n.aboveGround?1:-1;let a=Math.sign(i);0===a&&(a=o);const l=o*a;if(this.parameters.shaderPolygonOffset<=0)return(0,r.dF)(s,e);const c=(0,r.b0)(Math.abs(t.cosAngle),.01,1),h=1-Math.sqrt(1-c*c)/c/n.viewport[2];return(0,r.dC)(s,e,l>0?h:1/h),s}_applyVerticalGroundOffsetView(e,t,i,n){const s=(0,r.dS)(e),o=i.aboveGround?1:-1,a=i.computeRenderPixelSizeAtDist(s)*gi,l=(0,r.dC)(ji,t.normal,o*a);return(0,r.dE)(n,e,l),n}_applyVerticalOffsetTransformationView(e,t,i,n){const s=this.parameters;if(!s.verticalOffset?.screenLength){if(s.screenSizePerspective||s.screenSizePerspectiveAlignment){const i=(0,r.dS)(e);this._updateScaleInfo(n,i,t.cosAngle)}else n.factor.scale=1,n.factorAlignment.scale=1;return e}const o=(0,r.dS)(e),a=s.screenSizePerspectiveAlignment??s.screenSizePerspective,c=(0,l.Z)(i,o,s.verticalOffset,t.cosAngle,a);return this._updateScaleInfo(n,o,t.cosAngle),(0,r.dC)(t.normal,t.normal,c),(0,r.dE)(e,e,t.normal)}_applyCenterOffsetView(e,t,i){const n="screen"!==this.parameters.centerOffsetUnits;return i!==e&&(0,r.dF)(i,e),n&&(i[0]+=t[0],i[1]+=t[1],t[2]&&((0,r.ao)(Ui,i),(0,r.dE)(i,i,(0,r.dC)(Ui,Ui,t[2])))),i}_applyCenterOffsetNDC(e,t,i,n){const s="screen"!==this.parameters.centerOffsetUnits;return n!==e&&(0,r.dF)(n,e),s||(n[0]+=t[0]/i.fullWidth*2,n[1]+=t[1]/i.fullHeight*2),n}_applyPolygonOffsetNDC(e,t,i,n){const s=this.parameters.shaderPolygonOffset;if(e!==n&&(0,r.dF)(n,e),s){const e=i.aboveGround?1:-1,r=e*Math.sign(t[3]);n[2]-=(r||e)*s}return n}set visible(e){this._visible=e}get visible(){const{color:e,outlineSize:t,outlineColor:i}=this.parameters,n=e[3]>=r.ug||t>=r.ug&&i[3]>=r.ug;return this._visible&&n}createGLMaterial(e){return new Li(e)}calculateRelativeScreenBounds(e,t,i=(0,r.b2)()){return Ni(this.parameters,e,t,i),i[2]=i[0]+e[0],i[3]=i[1]+e[1],i}_getScreenScale(e,t){const i=e.attributes.get(_.e.FEATUREATTRIBUTE);if(null==i)return{scaleX:t,scaleY:t};const n=(0,r.v0)(i.data,er);return(0,l._)(Ki,this.parameters,n),{scaleX:Ki[0]*t,scaleY:Ki[1]*t}}}class Li extends l.${constructor(e){super({...e,...e.material.parameters})}beginSlot(e){return this.updateTexture(this._material.parameters.textureId),this._material.setParameters(this.textureBindParameters),this.acquireTechnique(Di,e)}}function Ni(e,t,i,r){r[0]=e.anchorPosition[0]*-t[0]+e.screenOffset[0]*i,r[1]=e.anchorPosition[1]*-t[1]+e.screenOffset[1]*i}function zi(e,t,i,n){return mi(t)&&(t=(0,r.ge)($i,t)),(0,r.gf)(n.normal,e,t),(0,r.dX)(n.normal,n.normal,i.viewInverseTransposeMatrix),n.cosAngle=(0,r.al)(qi,sr),n}function Gi(e){const t=e[0],i=e[1],r=e[2],n=e[3],s=e[4],o=e[5],a=e[6],l=e[7],c=e[8],h=1/Math.sqrt(t*t+i*i+r*r),d=1/Math.sqrt(n*n+s*s+o*o),u=1/Math.sqrt(a*a+l*l+c*c);return e[0]=t*h,e[1]=i*h,e[2]=r*h,e[3]=n*d,e[4]=s*d,e[5]=o*d,e[6]=a*u,e[7]=l*u,e[8]=c*u,e}function Vi(e,t,i,n,s,o,a,l,c){let h=t-s-n[0]*c[0],d=h+n[0]+2*s,u=i-s-n[1]*c[1],f=u+n[1]+2*s;const p=l.distanceFieldBoundingBox;return l.textureIsSignedDistanceField&&null!=p&&(h+=n[0]*p[0],u+=n[1]*p[1],d-=n[0]*(1-p[2]),f-=n[1]*(1-p[3]),h-=o,d+=o,u-=o,f+=o),(0,r.gV)(Wi,t,i),(0,r.o3)(Xi,e,Wi,(0,r.fA)(a)),Xi[0]>h&&Xi[0]<d&&Xi[1]>u&&Xi[1]<f}const Hi=new vi,ji=(0,r.ap)(),Ui=(0,r.ap)(),Yi=(0,r.iB)(),qi=(0,r.ap)(),ki=(0,r.ap)(),Xi=(0,r.g_)(),Wi=(0,r.g_)(),Qi=(0,w.e)(),$i=(0,w.e)(),Ji=(0,f.e)(),Zi=(0,r.ap)(),Ki=(0,r.ap)(),er=(0,r.iB)(),tr={normal:qi,cosAngle:0},ir=1,rr=2,nr=[0,0],sr=(0,r.aq)(0,0,1);class or extends l.a0{constructor(){super(...arguments),this.renderOccluded=l.a1.Occlude,this.isDecoration=!1,this.color=(0,r.vs)(1,1,1,1),this.polygonOffset=!1,this.anchorPosition=(0,r.o5)(.5,.5),this.screenOffset=[0,0],this.shaderPolygonOffset=1e-5,this.textureIsSignedDistanceField=!1,this.sampleSignedDistanceFieldTexelCenter=!1,this.outlineColor=(0,r.vs)(1,1,1,1),this.outlineSize=0,this.rotation=0,this.hasRotation=!1,this.vvSizeEnabled=!1,this.vvSize=null,this.vvColor=null,this.vvOpacity=null,this.vvSymbolAnchor=null,this.vvSymbolRotationMatrix=null,this.hasSlicePlane=!1,this.pixelSnappingEnabled=!0,this.occlusionTest=!0,this.occludedFragmentFade=!1,this.horizonCullingEnabled=!1,this.centerOffsetUnits="world",this.drawInSecondSlot=!1,this.depthEnabled=!0,this.draped=!1,this.isLabel=!1}}const ar=(0,m.H)().vec3f(_.e.POSITION).vec3f(_.e.NORMAL).vec2f(_.e.UV0).vec4u8(_.e.COLOR).vec2f(_.e.SIZE).f32(_.e.ROTATION).vec4f(_.e.CENTEROFFSETANDDISTANCE).vec4f(_.e.FEATUREATTRIBUTE),lr=ar.clone().vec4u8(_.e.OBJECTANDLAYERIDCOLOR);class cr{constructor(){this.vertexBufferLayout=(0,l.a2)()?lr:ar}elementCount(e){return 6*e.get(_.e.POSITION).indices.length}write(e,t,i,r,n,s){(0,l.a3)(i.get(_.e.POSITION),e,n.position,s,6),(0,l.a4)(i.get(_.e.NORMAL),t,n.normal,s,6);const o=i.get(_.e.UV0)?.data;let a=0,c=0,h=1,d=1;o&&o.length>=4&&(a=o[0],c=o[1],h=o[2],d=o[3]),h=Math.min(1.99999,h+1),d=Math.min(1.99999,d+1);let u=i.get(_.e.POSITION).indices.length,f=s;const p=n.uv0;for(let l=0;l<u;++l)p.set(f,0,a),p.set(f,1,c),f++,p.set(f,0,h),p.set(f,1,c),f++,p.set(f,0,h),p.set(f,1,d),f++,p.set(f,0,h),p.set(f,1,d),f++,p.set(f,0,a),p.set(f,1,d),f++,p.set(f,0,a),p.set(f,1,c),f++;(0,l.a5)(i.get(_.e.COLOR),4,n.color,s,6);const{data:m,indices:g}=i.get(_.e.SIZE);u=g.length;const y=n.size;f=s;for(let l=0;l<u;++l){const e=m[2*g[l]],t=m[2*g[l]+1];for(let i=0;i<6;++i)y.set(f,0,e),y.set(f,1,t),f++}if((0,l.a6)(i.get(_.e.ROTATION),n.rotation,s,6),i.get(_.e.CENTEROFFSETANDDISTANCE)?(0,l.a7)(i.get(_.e.CENTEROFFSETANDDISTANCE),n.centerOffsetAndDistance,s,6):(0,l.a8)(n.centerOffsetAndDistance,s,6*u),i.get(_.e.FEATUREATTRIBUTE)?(0,l.a7)(i.get(_.e.FEATUREATTRIBUTE),n.featureAttribute,s,6):(0,l.a8)(n.featureAttribute,s,6*u),null!=r){const e=i.get(_.e.POSITION)?.indices;if(e){const t=e.length,i=n.getField(_.e.OBJECTANDLAYERIDCOLOR,T.x);(0,l.a9)(r,i,t,s,6)}}}}let hr=class extends r.e9{constructor(e){super(),this.view=null,this.layerUid=null,this._renderGeometries=new Map,this._materials=new Map,this._directRenderers=new Map,this._lodRenderers=new Map,this.view=e.view,this.layerUid=e.layerUid}initialize(){}destroy(){}async executeRenderCommands(e){for(const t of e)switch(t.id){case"create-material":await this._createMaterial(t);break;case"create-direct-renderer":await this._createDirectRenderer(t);break;case"add-direct-renderer-geometry":await this._addDirectRendererGeometry(t);break;case"remove-direct-renderer-geometry":await this._removeDirectRendererGeometry(t);break;case"create-lod-renderer":await this._createLodRenderer(t);break;case"add-lod-instances":await this._addLodInstances(t);break;case"remove-lod-instances":await this._removeLodInstances(t)}}async _createMaterial(e){const{view:t}=this,{sharedSymbolResources:i}=t;if(null==i)throw new Error("No shared symbol resources found!");const{textures:n}=i,s=t.state.viewingMode===r.iE.Global;let o=null;switch(e.type){case"default":o=ur(i,{physicalBasedRenderingEnabled:!0,slicePlaneEnabled:!1,castShadows:!0,isPrimitive:!0,screenSizePerspectiveEnabled:!0,doublePrecisionRequiresObfuscation:t._stage.renderView.renderingContext.driverTest.doublePrecisionRequiresObfuscation.result},s);break;case"hud":{const[e,t]=dr(n,s);this.addHandles([(0,r.bh)((()=>(0,r.jQ)(t)))]),o=e}break;default:throw new Error(`unable to create unknown material type ${e.type}`)}this._materials.set(e.materialId,o)}_getMaterial(e){return this._materials.get(e)}async _createDirectRenderer(e){const t=e.materialId,i=this._getMaterial(t);if(null==i)throw new Error(`material not found ${t}`);const{view:r}=this,n=new Ge({material:i});this._directRenderers.set(t,n),r._stage.addRenderPlugin(n),r._stage.renderView.renderer.updateHasFlags()}async _addDirectRendererGeometry(e){const t=e.renderGeometryId,i=e.materialId;null!=this._renderGeometries.get(t)&&await this._removeDirectRendererGeometry({renderGeometryId:t});const r=this._directRenderers.get(i);if(null==r)return void console.error("no renderer assigned to provided material");const n=r.addRenderGeometry(t,e.renderGeometryBuffer,e.localOrigin);this._renderGeometries.set(t,{renderGeometry:n,materialId:i}),this.view._stage.renderView.requestRender()}async _removeDirectRendererGeometry(e){const t=e.renderGeometryId,i=this._renderGeometries.get(t);if(null==i)return;const r=i.materialId,n=this._directRenderers.get(r);null!=n?n.removeRenderGeometry(e.renderGeometryId):console.error("no renderer assigned to provided material")}async _createLodRenderer(e){const t=new Wt({view:this.view,layerUid:this.layerUid}),i=new AbortController,r=e=>this._getMaterial(e);await t.doLoad(e.lodRenderGeometry,r,i.signal),this._lodRenderers.set(e.lodRendererId,t)}async _addLodInstances(e){const t=this._lodRenderers.get(e.lodRendererId);if(null==t)throw new Error("no lod renderer assigned to provided lod renderer Id");t.addInstances(e.data)}async _removeLodInstances(e){const t=this._lodRenderers.get(e.lodRendererId);if(null==t)throw new Error("no lod renderer assigned to provided lod renderer Id");t.removeInstances(e.featureIds)}};function dr(e,t){const i={anchorPosition:ne.center,occlusionTest:!0,hasSlicePlane:!1},r=i,n=1;r.color=[1,0,0,1],r.outlineColor=[0,0,0,1],r.outlineSize=n;const s=null;if(null!=e){const t=e.fromData("circle-icon",(()=>ei("circle")));r.textureId=t.texture.id,r.textureIsSignedDistanceField=!0,r.sampleSignedDistanceFieldTexelCenter=Kt("circle")}return r.distanceFieldBoundingBox=pr,[new Pi(i,t),s]}function ur(e,t,i){const n={usePBR:t.physicalBasedRenderingEnabled,isSchematic:!0,mrrFactors:l.b,ambient:r.ot,diffuse:r.ot,hasSlicePlane:t.slicePlaneEnabled,hasSliceHighlight:!1,castShadows:t.castShadows,offsetTransparentBackfaces:!t.isPrimitive};return fr(n),n.screenSizePerspective=e.screenSizePerspectiveSettings,n.externalColor=r.vt,n.isInstanced=!0,new l.B(n,{spherical:i,doublePrecisionRequiresObfuscation:!0})}function fr(e){const t=e.opacity??1,i=t<1;return e.transparent=i,e.opacity=t,e.cullFace=i?d.e.None:d.e.Back,e}hr=(0,r.bt)([(0,r.bv)("esri.views.3d.layers.graphics.pipeline.rendering.FeaturePipelineRenderManager")],hr);const pr=[Zt/2,Zt/2,1-Zt/2,1-Zt/2];let _r=class{constructor(e){this._bufferWriter=null,this._bufferWriter=e.createBufferWriter()}createBuffer(e,t){const i=this._bufferWriter;let n=null;if(e.transformation&&t)(0,r.gk)(mr,e.transformation),mr[12]-=t[0],mr[13]-=t[1],mr[14]-=t[2],n=mr;else{if(t)throw new Error("not implemented");e.transformation&&(n=e.transformation)}let s=null;n&&((0,r.dV)(gr,mr),(0,r.dW)(gr,gr),s=gr);const o=e.attributes,a=i.elementCount(o),l=i.vertexBufferLayout.stride/4;a>Math.floor(yr/l)&&console.warn("geometry with very large number of elements encountered");const c=i.vertexBufferLayout.createBuffer(a);return i.write(n,s,o,e.objectAndLayerIdColor,c,0),{data:c.buffer,elementCount:a}}};const mr=(0,f.e)(),gr=(0,f.e)(),yr=4194304;let vr=class{constructor(e){this._context=e,this._commands=[],this._transferables=new Set}createMaterial(e){const t=this._context,i=t.generateId("material");switch(e){case"default":{const e=new l.B({},{spherical:this._context.globalViewingMode,doublePrecisionRequiresObfuscation:!0}),r=new _r(e);t.registerRenderGeometryBufferWriter(i,r)}break;case"hud":{const e=dr(null,this._context.globalViewingMode)[0],r=new _r(e);t.registerRenderGeometryBufferWriter(i,r)}}return this._commands.push({id:"create-material",type:e,materialId:i}),i}createDirectRenderer(e){const t=this._context.generateId("material-renderer");return this._commands.push({id:"create-direct-renderer",materialRendererId:t,materialId:e}),t}addDirectRendererGeometry(e,t,i){const r=t.materialId,n=this._context.getRenderGeometryBufferWriter(r);if(null==n)throw new Error(`no bufferwriter found for material ${r}`);const s=n.createBuffer(t,i);this._transferables.add(s.data),this._commands.push({id:"add-direct-renderer-geometry",renderGeometryId:e,materialId:r,renderGeometryBuffer:s,localOrigin:i})}removeDirectRendererGeometry(e){this._commands.push({id:"remove-direct-renderer-geometry",renderGeometryId:e})}createLodRenderer(e){const t=this._context.generateId("lod-renderer"),i={levels:e.levels.map((e=>({components:e.components.map((e=>{const t=e.attributes.get(_.e.POSITION);if(!t||0===t.indices.length)throw new Error("positions attribute expected");const i=3,r=(0,a.l)(t.indices.length/i),n=new l.a(r,i,t),s=this._context.getRenderGeometryBufferWriter(e.materialId);if(null==s)throw new Error("writer not found");const o=s.createBuffer(e,null);return this._transferables.add(o.data),{materialId:e.materialId,renderGeometryBuffer:o,boundingInfo:{bbMax:n.bbMax,bbMin:n.bbMin}}})),minScreenSpaceRadius:e.minScreenSpaceRadius})))};return this._commands.push({id:"create-lod-renderer",lodRendererId:t,lodRenderGeometry:i}),t}addLodInstances(e,t){this._commands.push({id:"add-lod-instances",lodRendererId:e,data:t}),this._transferables.add(t.featureIds.buffer),this._transferables.add(t.globalTransforms.buffer),this._transferables.add(t.localTransforms.buffer)}removeLodInstances(e,t){this._commands.push({id:"remove-lod-instances",lodRendererId:e,featureIds:t}),this._transferables.add(t.buffer)}async dispatch(){const e=this._commands,t=Array.from(this._transferables);this._clearCommandBuffer(),this._context.dispatchRenderCommands(e,t)}_clearCommandBuffer(){this._commands=[],this._transferables.clear()}},br=class{constructor(e){this._idCounter=0,this._bufferWriters=new Map,this._dispatchRenderCommandsCallback=async()=>{},this.globalViewingMode=!1,this.globalViewingMode=e.viewingMode===r.iE.Global,this._dispatchRenderCommandsCallback=e.dispatchRenderCommandsCallback}generateId(e=""){return`${e}${this._idCounter++}`}createEncoder(){return new vr(this)}async dispatchRenderCommands(e,t){this._dispatchRenderCommandsCallback(e,t)}registerRenderGeometryBufferWriter(e,t){this._bufferWriters.set(e,t)}getRenderGeometryBufferWriter(e){return this._bufferWriters.get(e)}};var wr;async function Tr(e,t){const{numFeatures:i,tile:r,partitionInfo:n}=e,{pages:s}=r;if(0===s.length||0===i)return new Uint32Array;const o=new Uint32Array(i);if(n){const e=s.reduce(((e,{featureCount:t})=>e+t),0),t=new Uint32Array(e);let r=0;for(const i of s)r=i.readAllObjectIds(t,r);const a=n.tileIndices;for(let n=0;n<i;++n){const e=t[a[n]];o[n]=e}}else{let e=0;for(const t of s)e=t.readAllObjectIds(o,e)}return o}async function xr(e,t){const{numFeatures:i,tile:r,partitionInfo:n}=e,{pages:s}=r;if(0===s.length||0===i)return new Float64Array;const o=new Float64Array(3*i);if(n){const e=s.reduce(((e,{featureCount:t})=>e+t),0),t=new Float64Array(3*e);let r=0;for(const i of s)r=i.readAllCoordinates(t,r);const a=n.tileIndices;for(let n=0;n<i;++n){const e=a[n],i=t[3*e+0],r=t[3*e+1],s=t[3*e+2];o[3*n+0]=i,o[3*n+1]=r,o[3*n+2]=s}}else{let e=0;for(const t of s)e=t.readAllCoordinates(o,e)}return o}async function Or(e,t){await e.provision([wr.GEOMETRY_MAP_COORDINATES],t);const{numFeatures:i,tile:n,mapCoordinates:s}=e,{pages:o}=n;if(0===o.length||0===i)return new Float64Array;const a=t.viewSpatialReference,l=t.renderSpatialReference,c=new Float64Array(3*i);if(!(0,r.bE)(s,a,0,c,l,0,i))throw new Error("Failed to project coordinates");return c}async function Rr(e,t){const i=t.viewSpatialReference,n=t.renderSpatialReference,s=e.tile.descriptor.extent,o=(0,r.vu)(s),a=(0,r.ap)();return(0,I.a)([o[0],o[1],0],i,a,n),a}(function(e){e[e.OBJECT_ID=0]="OBJECT_ID",e[e.PARTITION_ID=1]="PARTITION_ID",e[e.GEOMETRY_MAP_COORDINATES=2]="GEOMETRY_MAP_COORDINATES",e[e.GEOMETRY_RENDER_COORDINATES=3]="GEOMETRY_RENDER_COORDINATES",e[e.TILE_CENTER_RENDER_COORDINATES=4]="TILE_CENTER_RENDER_COORDINATES"})(wr||(wr={}));let Ar=class{constructor(e,t,i=null){this._tile=e,this._numFeatures=t,this._partitionInfo=i}get partitionInfo(){return this._partitionInfo}get tile(){return this._tile}get numFeatures(){return this._numFeatures}get tileId(){return this._tile.descriptor.id}get objectIds(){if(null==this._objectIds)throw new Error("objectIds haven't been provisioned yet");return this._objectIds}get partitionIds(){if(null==this._partitionIds)throw new Error("partitionIds haven't been provisioned yet");return this._partitionIds}get mapCoordinates(){if(null==this._mapCoordinates)throw new Error("mapCoordinates haven't been provisioned yet");return this._mapCoordinates}get renderCoordinates(){if(null==this._renderCoordinates)throw new Error("renderCoordinates haven't been provisioned yet");return this._renderCoordinates}get tileCenterRenderCoordinates(){if(null==this._tileCenterRenderCoordinates)throw new Error("tileCenterRenderCoordinates hasn't been provisioned yet");return this._tileCenterRenderCoordinates}async provision(e,t){for(const i of e)switch(i){case wr.OBJECT_ID:if(this._objectIds)return;this._objectIds=await Tr(this);break;case wr.PARTITION_ID:if(this._partitionIds)return;this._partitionIds=new Uint32Array(this._numFeatures);break;case wr.GEOMETRY_MAP_COORDINATES:if(this._mapCoordinates)return;this._mapCoordinates=await xr(this);break;case wr.GEOMETRY_RENDER_COORDINATES:if(this._renderCoordinates)return;this._renderCoordinates=await Or(this,t);break;case wr.TILE_CENTER_RENDER_COORDINATES:if(this._tileCenterRenderCoordinates)return;this._tileCenterRenderCoordinates=await Rr(this,t);break;default:throw new Error("not implemented")}}dispose(){if(this.partitions){for(const e of this.partitions)e.dispose();this.partitions=void 0}}};function Er(e=r.ot,t,i,n=1){const s=new Array(3);if(null==t||null==i)s[0]=1,s[1]=1,s[2]=1;else{let r,n=0;for(let o=2;o>=0;o--){const a=e[o];let l;const c=null!=a,h=0===o&&!r&&!c,d=i[o];"symbol-value"===a||h?l=0!==d?t[o]/d:1:c&&"proportional"!==a&&isFinite(a)&&(l=0!==d?a/d:1),null!=l&&(s[o]=l,r=l,n=Math.max(n,Math.abs(l)))}for(let e=2;e>=0;e--)null==s[e]?s[e]=r:0===s[e]&&(s[e]=.001*n)}for(let r=2;r>=0;r--)s[r]/=n;return(0,r.fC)(s)}function Sr(e){const t=new Map;for(const[i,r]of e)t.set(i,{...r,indices:(0,a.t)(r.indices)});return t}var Ir;(function(e){function t(e,t){const i=e[t],r=e[t+1],n=e[t+2];return Math.sqrt(i*i+r*r+n*n)}function i(e,t){const i=e[t],r=e[t+1],n=e[t+2],s=1/Math.sqrt(i*i+r*r+n*n);e[t]*=s,e[t+1]*=s,e[t+2]*=s}function r(e,t,i){e[t]*=i,e[t+1]*=i,e[t+2]*=i}function n(e,t,i,r,n,s=t){(n=n||e)[s]=e[t]+i[r],n[s+1]=e[t+1]+i[r+1],n[s+2]=e[t+2]+i[r+2]}function s(e,t,i,r,n,s=t){(n=n||e)[s]=e[t]-i[r],n[s+1]=e[t+1]-i[r+1],n[s+2]=e[t+2]-i[r+2]}e.length=t,e.normalize=i,e.scale=r,e.add=n,e.subtract=s})(Ir||(Ir={}));const Cr=new Array(36);for(let Cn=0;Cn<6;Cn++)for(let e=0;e<6;e++)Cr[6*Cn+e]=Cn;const Mr=new Array(36);for(let Cn=0;Cn<6;Cn++)Mr[6*Cn]=0,Mr[6*Cn+1]=1,Mr[6*Cn+2]=2,Mr[6*Cn+3]=2,Mr[6*Cn+4]=3,Mr[6*Cn+5]=0;const Dr=(0,M.r)(-.5,0,-.5),Fr=(0,M.r)(.5,0,-.5),Br=(0,M.r)(0,0,.5),Pr=(0,M.r)(0,.5,0),Lr=(0,M.n)(),Nr=(0,M.n)(),zr=(0,M.n)(),Gr=(0,M.n)(),Vr=(0,M.n)();function Hr(e,t,i,r,n=!0,s=!0){let o=0;const a=t,c=e;let h=(0,M.r)(0,o,0),d=(0,M.r)(0,o+c,0),u=(0,M.r)(0,-1,0),f=(0,M.r)(0,1,0);const p=[d,h],m=[u,f],g=i+2,y=Math.sqrt(c*c+a*a);for(let l=0;l<i;l++){const e=l*(2*Math.PI/i),t=(0,M.r)(Math.cos(e)*a,o,Math.sin(e)*a);p.push(t);const r=(0,M.r)(c*Math.cos(e)/y,a/y,c*Math.sin(e)/y);m.push(r)}const v=new Array,b=new Array;if(n){for(let e=3;e<p.length;e++)v.push(1),v.push(e-1),v.push(e),b.push(0),b.push(0),b.push(0);v.push(p.length-1),v.push(2),v.push(1),b.push(0),b.push(0),b.push(0)}if(s){for(let e=3;e<p.length;e++)v.push(e),v.push(e-1),v.push(0),b.push(e),b.push(e-1),b.push(1);v.push(0),v.push(2),v.push(p.length-1),b.push(1),b.push(2),b.push(m.length-1)}const w=(0,l.c)(3*g);for(let l=0;l<g;l++)w[3*l]=p[l][0],w[3*l+1]=p[l][1],w[3*l+2]=p[l][2];const T=(0,l.c)(3*g);for(let l=0;l<g;l++)T[3*l]=m[l][0],T[3*l+1]=m[l][1],T[3*l+2]=m[l][2];return[[_.e.POSITION,new D.t(w,v,3,!0)],[_.e.NORMAL,new D.t(T,b,3,!0)]]}function jr(e,t){const i=(e,i,r=!1)=>({levels:e.map((e=>{const n=Sr(i(e.tesselation));return r&&Ur(n),{components:[{attributes:n,objectAndLayerIdColor:void 0,transformation:null,materialId:t}],minScreenSpaceRadius:e.minScreenSpaceRadius}}))});switch(e){case"cone":return i(qr,(e=>Hr(1,.5,e)),!0);case"sphere":case"cube":case"inverted-cone":case"cylinder":case"tetrahedron":case"diamond":throw new Error("not implemented");default:return}}function Ur(e){const t=e,i=t.get(_.e.POSITION).data,r=t.get(_.e.NORMAL).data;if(r){const t=Yr(e,_.e.NORMAL).data;for(let e=0;e<r.length;e+=3){const i=r[e+1];t[e+1]=-r[e+2],t[e+2]=i}}if(i){const t=Yr(e,_.e.POSITION).data;for(let e=0;e<i.length;e+=3){const r=i[e+1];t[e+1]=-i[e+2],t[e+2]=r}}}function Yr(e,t){let i=e.get(t);return i&&!i.exclusive&&(i={...i,exclusive:!0,data:(0,l.o)(i.data)},e.set(t,i)),i}(0,r.dB)(Lr,Dr,Pr),(0,r.dB)(Nr,Dr,Fr),(0,r.am)(zr,Lr,Nr),(0,r.ao)(zr,zr),(0,r.dB)(Lr,Fr,Pr),(0,r.dB)(Nr,Fr,Br),(0,r.am)(Gr,Lr,Nr),(0,r.ao)(Gr,Gr),(0,r.dB)(Lr,Br,Pr),(0,r.dB)(Nr,Br,Dr),(0,r.am)(Vr,Lr,Nr),(0,r.ao)(Vr,Vr),zr[0],zr[1],zr[2],Gr[0],Gr[1],Gr[2],Vr[0],Vr[1],Vr[2];const qr=[{tesselation:6,minScreenSpaceRadius:0},{tesselation:18,minScreenSpaceRadius:7},{tesselation:64,minScreenSpaceRadius:65}];let kr=class extends r.e9{constructor(e){super(),this._context=e,this.lodRendererId=null,this._loaded=!1}get loaded(){return this._loaded}async load(e){const t=e.createMaterial("default"),i=jr("cone",t);this.lodRendererId=e.createLodRenderer(i),this._loaded=!0}async add(e,t){if(null==this.lodRendererId)throw new Error("expected lod renderer id to not be null");await this._provisionFeatureData(e);const i=e.numFeatures,n=!0,s=(0,r.cE)((0,r.e0)("cone")),o=(0,r.fC)((0,r.d$)(s)),a=(0,r.fC)((0,r.vv)(o,{isPrimitive:n,width:100,depth:null,height:null})),l=new Float64Array(16*i),c=new Float64Array(16*i),h=e.mapCoordinates;for(let r=0;r<i;++r){const e=r,t=h[3*r+0],i=h[3*r+1],n=h[3*r+2],s=this._computeGlobalTransform(t,i,n,this._context.viewSpatialReference,Qr),d=this._computeLocalTransform(a,o,Wr);this._writeMatrixToTypedBuffer(l,e,d),this._writeMatrixToTypedBuffer(c,e,s)}const d={featureIds:new Uint32Array(e.objectIds),localTransforms:l,globalTransforms:c};t.addLodInstances(this.lodRendererId,d)}async remove(e,t){if(null==this.lodRendererId)return;const i=new Uint32Array(e.objectIds);t.removeLodInstances(this.lodRendererId,i)}async _provisionFeatureData(e){await e.provision([wr.GEOMETRY_MAP_COORDINATES,wr.OBJECT_ID],this._context)}_writeMatrixToTypedBuffer(e,t,i){let r=16*t;for(let n=0;n<16;n++)e[r++]=i[n]}_computeGlobalTransform(e,t,i,r,n){return Xr[0]=e,Xr[1]=t,Xr[2]=i,(0,C.C)(r,Xr,n,this._context.renderSpatialReference),n}_computeLocalTransform(e,t,i){return(0,r.gw)(i),this._applyObjectScale(e,t,i),i}_applyObjectScale(e,t,i){const n=Er(e,e,t,this._context.renderCoordsHelper.unitInMeters);1===n[0]&&1===n[1]&&1===n[2]||(0,r.gn)(i,i,n)}};kr=(0,r.bt)([(0,r.bv)("esri.views.3d.layers.graphics.pipeline.symbolization.TestObjectSymbol")],kr);const Xr=(0,r.ap)(),Wr=(0,f.e)(),Qr=(0,f.e)();let $r=class extends r.e9{constructor(e){super(),this._context=e,this.materialId=null,this._loaded=!1}get loaded(){return this._loaded}async load(e){this.materialId=e.createMaterial("hud"),e.createDirectRenderer(this.materialId),this._loaded=!0}async add(e,t){if(null==this.materialId)throw new Error("expected material not to be null");await this._provisionFeatureData(e);const{numFeatures:i,tileId:r,renderCoordinates:n,tileCenterRenderCoordinates:s}=e,o=new Float64Array([0,0,1]),a=new Float64Array([255,255,255,255]),l=new Float64Array([24,24]),c=new Float64Array([0,0,0,1]),h=new Float64Array([0,0]),d=new Float64Array([0]),u=new Uint32Array(i);for(let f=0;f<i;++f)u[f]=f;const p=new Uint32Array(i);for(let f=0;f<i;++f)p[f]=0;const m=new D.t(n,u,3,!0),g=new D.t(o,p,3,!0),y=new D.t(h,p,2,!0),v=new D.t(a,p,4,!0),b=new D.t(d,p,1,!0),w=new D.t(l,p,2,!0),T=new D.t(c,p,4,!0),x=[[_.e.POSITION,m],[_.e.NORMAL,g],[_.e.UV0,y],[_.e.COLOR,v],[_.e.ROTATION,b],[_.e.SIZE,w],[_.e.CENTEROFFSETANDDISTANCE,T]],O={attributes:Sr(x),objectAndLayerIdColor:void 0,transformation:(0,f.e)(),materialId:this.materialId};t.addDirectRendererGeometry(r,O,s)}async remove(e,t){t.removeDirectRendererGeometry(e.tileId)}async _provisionFeatureData(e){await e.provision([wr.GEOMETRY_RENDER_COORDINATES,wr.TILE_CENTER_RENDER_COORDINATES],this._context)}};$r=(0,r.bt)([(0,r.bv)("esri.views.3d.layers.graphics.pipeline.symbolization.TestSymbol")],$r);class Jr{constructor(e){this._symbols=new Map,this._context=e}async load(){this._symbols.set(0,new $r(this._context)),this._symbols.set(1,new kr(this._context))}async add(e,t){await this._provisionFeatureData(e,this._context);const i=this._partition(e);await Promise.all(i.map((async e=>{const i=await this._provisionSymbol(e.partitionInfo?.index,t);i&&await i.add(e,t)})))}async remove(e,t){const i=e.partitions;if(!i)throw new Error("partitioned featureset expected");await Promise.all(i.map((async e=>{const i=await this._provisionSymbol(e.partitionInfo?.index,t);i&&await i.remove(e,t)})))}async _provisionFeatureData(e,t){await e.provision([wr.PARTITION_ID,wr.OBJECT_ID],t)}async _provisionSymbol(e,t){if(null==e)return null;const i=this._symbols.get(e);return i?(i.loaded||await i.load(t),i):null}_partition(e){const{numFeatures:t,objectIds:i,partitionIds:r}=e,n=[[],[]];for(let s=0;s<t;++s){const e=i[s]%2;n[e].push(s),r[s]=e}return e.partitions=n.filter((e=>e.length>0)).map(((t,i)=>{const r=t.length,n={index:i,tileIndices:new Uint32Array(t)};return new Ar(e.tile,r,n)})),e.partitions}}function Zr(e,t,i){return!!(0,I.a)(e,t,Kr,i.spatialReference)&&(i.x=Kr[0],i.y=Kr[1],i.z=Kr[2],!0)}const Kr=(0,r.ap)();function en(e){const{value:t,operations:i}=e;return{operations:i,value:i.create(t)}}function tn(e,t,i){return e.operations.setExtent(e.value,t,i.value),i}function rn(e,t){return e.operations.getExtent(e.value,t),t}function nn(e){return{operations:e,value:e.create()}}function sn(e,t,i=nn(e)){return i.operations=e,e.copy(t,i.value),i}function on(e){return sn(y.f,(0,y.V)(0,0,0,(0,r.iC)(e).radius))}const an=2**50;function ln(){return sn(O.k,(0,O.J)([0,0,0],[an,0,0],[0,an,0]))}function cn(e,t,i){return e.operations.axisAt(e.value,t,r.dZ.Z,i)}function hn(e,t,i,r){return e.operations.axisAt(e.value,t,i,r)}function dn(e,t,i){return e.operations.intersectRay(e.value,t,i)}function un(e,t,i){return e.operations.intersectRayClosestSilhouette(e.value,t,i)}function fn(e,t){return e.operations.altitudeAt(e.value,t)}function pn(e,t,i,r){return e.operations.setAltitudeAt(e.value,t,i,r)}function _n(e,t,i,n){return t!==n&&(0,r.gk)(n,t),(0,r.dQ)(gn,n[12],n[13],n[14]),pn(e,gn,i,gn),n[12]=gn[0],n[13]=gn[1],n[14]=gn[2],n}function mn(e,t,i){return e.operations.elevate(e.value,t,i.value)}const gn=(0,r.ap)();function yn(e){return"point"===e.type}class vn{constructor(e,t,i,n){this.viewingMode=e,this.spatialReference=t,this.unitInMeters=i,this._coordinateSystem=n,this._tmpCoordinateSystem=en(n),this.referenceEllipsoid=(0,r.iC)(t),this.sphericalPCPF=(0,F.a)(t)}set extent(e){e&&tn(this._coordinateSystem,e,this._coordinateSystem)}get extent(){return rn(this._coordinateSystem,(0,r.b2)())}getAltitude(e){return fn(this._coordinateSystem,e)}setAltitude(e,t,i=e){return pn(this._coordinateSystem,i,t,e)}setAltitudeOfTransformation(e,t){_n(this._coordinateSystem,t,e,t)}worldUpAtPosition(e,t){return cn(this._coordinateSystem,e,t)}worldBasisAtPosition(e,t,i){return hn(this._coordinateSystem,e,t,i)}basisMatrixAtPosition(e,t){const i=this.worldBasisAtPosition(e,r.dZ.X,v.c.get()),n=this.worldBasisAtPosition(e,r.dZ.Y,v.c.get()),s=this.worldBasisAtPosition(e,r.dZ.Z,v.c.get());return(0,r.vw)(t,i[0],i[1],i[2],0,n[0],n[1],n[2],0,s[0],s[1],s[2],0,0,0,0,1),t}headingAtPosition(e,t){const i=this.worldUpAtPosition(e,v.c.get()),n=this.worldBasisAtPosition(e,r.dZ.Y,v.c.get()),s=(0,v.u)(t,n,i);return(0,r.et)(s)}intersectManifoldClosestSilhouette(e,t,i){return mn(this._coordinateSystem,t,this._tmpCoordinateSystem),un(this._tmpCoordinateSystem,e,i),i}intersectManifold(e,t,i){mn(this._coordinateSystem,t,this._tmpCoordinateSystem);const n=v.c.get();return dn(this._tmpCoordinateSystem,e,n)?(0,r.dF)(i,n):null}intersectInfiniteManifold(e,t,i){if(this.viewingMode===r.iE.Global)return this.intersectManifold(e,t,i);mn(this._coordinateSystem,t,this._tmpCoordinateSystem);const n=this._tmpCoordinateSystem.value,s=v.c.get();return(0,v.x)(n.plane,e,s)?(0,r.dF)(i,s):null}toRenderCoords(e,t,i){return yn(e)?(0,B.c)(e,t,this.spatialReference):(0,I.a)(e,t,i,this.spatialReference)}fromRenderCoords(e,t,i=null){return yn(t)?(null!=i&&(t.spatialReference=i),Zr(e,this.spatialReference,t)?t:null):(0,I.a)(e,this.spatialReference,t,i)?t:null}static create(e,t){switch(e){case r.iE.Local:return new vn(r.iE.Local,t,(0,r.cm)(t),ln());case r.iE.Global:return new vn(r.iE.Global,t,1,on(t))}}static renderUnitScaleFactor(e,t){return(0,r.ff)(e)/(0,r.ff)(t)}}class bn{constructor(e){this._tileFeatureData=new Map,this._context={viewSpatialReference:e.viewSpatialReference,renderSpatialReference:e.renderSpatialReference,renderCoordsHelper:vn.create(e.viewingMode,e.renderSpatialReference)}}async add(e,t){this._featureRenderer||(this._featureRenderer=new Jr(this._context),await this._featureRenderer.load());const i=this._addTileFeatureData(e);await this._featureRenderer.add(i,t)}async remove(e,t){const i=this._getFeatureSetFromTileId(e);i&&(this._featureRenderer&&this._featureRenderer.remove(i,t),this._removeTileFeatureData(e))}_getFeatureSetFromTileId(e){return this._tileFeatureData.get(e)}_addTileFeatureData(e){const t=e.descriptor.id,i=e.pages.reduce(((e,{featureCount:t})=>e+t),0),r=new Ar(e,i);return this._tileFeatureData.set(t,r),r}_removeTileFeatureData(e){const t=this._tileFeatureData.get(e);t&&(t.dispose(),this._tileFeatureData.delete(e))}}let wn=class extends r.d4.EventedAccessor{constructor(){super(...arguments),this.remoteClient=null,this._featureStore=new j,this._tileManager=new G({addTile:(e,t)=>this._addTile(e,t),removeTiles:e=>this._removeTiles(e)}),this._renderCommandContext=null,this._fetcher=null,this._symbolizer=null,this._queryEngine=null,this._defaultQueryJSON=null}get updating(){return this._tileManager.updating}destroy(){this._featureStore.clear(),this._tileManager.destroy()}async setup({viewSpatialReference:e,renderSpatialReference:t,viewingMode:i,baseQuery:s,url:o,objectIdField:a,capabilities:l,fieldsIndex:c,timeInfo:h}){this._renderCommandContext=new br({viewingMode:i,dispatchRenderCommandsCallback:(e,t)=>this.remoteClient.invoke("dispatchRenderCommands",e,{transferList:t})});const d=r.aY.fromJSON(e),u=r.aY.fromJSON(t);return this._fetcher=new ie(d,r.fv.fromJSON(s),o,a,l),this._symbolizer=new bn({viewSpatialReference:d,renderSpatialReference:u,viewingMode:i}),this._queryEngine=new n.V({hasZ:!0,hasM:!1,geometryType:"esriGeometryPoint",objectIdField:a,fieldsIndex:c,availableFields:[a],spatialReference:e,featureStore:this._featureStore,timeInfo:h}),this._defaultQueryJSON=new r.fv({outSpatialReference:d}).toJSON(),this.addHandles((0,r.cc)((()=>this.updating),(async e=>{this.emit("notify-updating",{updating:e})})),r.cd),xn}async executeQuery(e,t){return{result:await this._queryEngine.executeQuery(this._ensureQuery(e),t)}}async executeQueryForIds(e,t){const i=await this._queryEngine.executeQueryForIdSet(this._ensureQuery(e),t);return{result:Array.from(i)}}async executeQueryForCount(e,t){return{result:await this._queryEngine.executeQueryForCount(this._ensureQuery(e),t)}}async executeQueryForExtent(e,t){return{result:await this._queryEngine.executeQueryForExtent(this._ensureQuery(e),t)}}async executeQueryForLatestObservations(e,t){return{result:await this._queryEngine.executeQueryForLatestObservations(this._ensureQuery(e),t)}}async onTileTreeChange(e){return await this._tileManager.onTileTreeChange(e),xn}async _addTile(e,t){const i=await this._fetcher.fetch(e,t);(0,r.J)(t),this._featureStore.addTile(i);const n=this._renderCommandContext.createEncoder();return await this._symbolizer.add(i,n),await n.dispatch(),i}async _removeTiles(e){const t=this._renderCommandContext.createEncoder(),i=this._featureStore,r=this._symbolizer;for(const n of e)i.removeTile(n.tileId),await r.remove(n.tileId,t);await t.dispatch()}_ensureQuery(e){return e??this._defaultQueryJSON}};(0,r.bt)([(0,r.bu)()],wn.prototype,"updating",null),wn=(0,r.bt)([(0,r.bv)("esri.views.3d.layers.graphics.pipeline.Feature3DPipelineWorker")],wn);const Tn=wn,xn={result:void 0},On=Object.freeze(Object.defineProperty({__proto__:null,default:Tn},Symbol.toStringTag,{value:"Module"})),Rn=Object.freeze(Object.defineProperty({__proto__:null,build:l.aa},Symbol.toStringTag,{value:"Module"})),An=Object.freeze(Object.defineProperty({__proto__:null,build:l.ab,getRadius:l.ac},Symbol.toStringTag,{value:"Module"})),En=Object.freeze(Object.defineProperty({__proto__:null,build:l.ad},Symbol.toStringTag,{value:"Module"})),Sn=Object.freeze(Object.defineProperty({__proto__:null,build:l.ae},Symbol.toStringTag,{value:"Module"})),In=Object.freeze(Object.defineProperty({__proto__:null,build:Ai,calculateAnchorPosForRendering:Si,shaderSettings:Ri},Symbol.toStringTag,{value:"Module"}))},90326:function(e,t,i){var r,n;i.d(t,{e:function(){return n},i:function(){return r}}),function(e){e[e.OBJECT=0]="OBJECT",e[e.HUD=1]="HUD",e[e.TERRAIN=2]="TERRAIN",e[e.OVERLAY=3]="OVERLAY",e[e.I3S=4]="I3S",e[e.PCL=5]="PCL",e[e.LOD=6]="LOD",e[e.VOXEL=7]="VOXEL",e[e.TILES3D=8]="TILES3D"}(r||(r={})),function(e){e[e.MIN=0]="MIN",e[e.MINMAX=1]="MINMAX",e[e.ALL=2]="ALL"}(n||(n={}))},65332:function(e,t,i){i.d(t,{a:function(){return l},b:function(){return o}});var r,n=i(44444);let s=r=class extends((0,n.cQ)(n.bw)){constructor(e){super(e),this.type="georeferenced",this.origin=null}};s.absolute=new r,(0,n.bt)([(0,n.e3)({georeferenced:"georeferenced"},{readOnly:!0})],s.prototype,"type",void 0),(0,n.bt)([(0,n.bu)({type:[Number],nonNullable:!1,json:{write:!0}})],s.prototype,"origin",void 0),s=r=(0,n.bt)([(0,n.bv)("esri.geometry.support.MeshGeoreferencedVertexSpace")],s);const o=s;let a=class extends((0,n.cQ)(n.bw)){constructor(e){super(e),this.type="local",this.origin=(0,n.ap)()}};(0,n.bt)([(0,n.e3)({local:"local"},{readOnly:!0})],a.prototype,"type",void 0),(0,n.bt)([(0,n.bu)({type:[Number],nonNullable:!0,json:{write:!0}})],a.prototype,"origin",void 0),a=(0,n.bt)([(0,n.bv)("esri.geometry.support.MeshLocalVertexSpace")],a);const l=a},25865:function(e,t,i){i.d(t,{H:function(){return h},L:function(){return f},N:function(){return u},Y:function(){return ee}});var r,n,s=i(44444),o=i(38837),a=i(81203),l=i(52454);function c(e){return e?{ray:(0,o.b)(e.ray),c0:e.c0,c1:e.c1}:{ray:(0,o.b)(),c0:0,c1:Number.MAX_VALUE}}function h(e){return e?[(0,a.M)(e[0]),(0,a.M)(e[1]),(0,a.M)(e[2]),(0,a.M)(e[3]),(0,a.M)(e[4]),(0,a.M)(e[5])]:[(0,a.M)(),(0,a.M)(),(0,a.M)(),(0,a.M)(),(0,a.M)(),(0,a.M)()]}function d(){return[(0,s.ap)(),(0,s.ap)(),(0,s.ap)(),(0,s.ap)(),(0,s.ap)(),(0,s.ap)(),(0,s.ap)(),(0,s.ap)()]}function u(e,t){for(let i=0;i<m;i++)(0,a.h)(e[i],t[i]);return e}function f(e,t,i,r=v){const n=(0,s.gm)(a.a.get(),t,e);(0,s.dV)(n,n);for(let o=0;o<g;++o){const e=(0,s.iy)(a.r.get(),y[o],n);(0,s.dQ)(r[o],e[0]/e[3],e[1]/e[3],e[2]/e[3])}p(i,r)}function p(e,t){(0,a.p)(t[n.FAR_BOTTOM_LEFT],t[n.NEAR_BOTTOM_LEFT],t[n.NEAR_TOP_LEFT],e[r.LEFT]),(0,a.p)(t[n.NEAR_BOTTOM_RIGHT],t[n.FAR_BOTTOM_RIGHT],t[n.FAR_TOP_RIGHT],e[r.RIGHT]),(0,a.p)(t[n.FAR_BOTTOM_LEFT],t[n.FAR_BOTTOM_RIGHT],t[n.NEAR_BOTTOM_RIGHT],e[r.BOTTOM]),(0,a.p)(t[n.NEAR_TOP_LEFT],t[n.NEAR_TOP_RIGHT],t[n.FAR_TOP_RIGHT],e[r.TOP]),(0,a.p)(t[n.NEAR_BOTTOM_LEFT],t[n.NEAR_BOTTOM_RIGHT],t[n.NEAR_TOP_RIGHT],e[r.NEAR]),(0,a.p)(t[n.FAR_BOTTOM_RIGHT],t[n.FAR_BOTTOM_LEFT],t[n.FAR_TOP_LEFT],e[r.FAR])}function _(e,t){for(let i=0;i<m;i++){const r=e[i];if(r[0]*t[0]+r[1]*t[1]+r[2]*t[2]+r[3]>=t[3])return!1}return!0}new o.s((()=>c())),function(e){e[e.LEFT=0]="LEFT",e[e.RIGHT=1]="RIGHT",e[e.BOTTOM=2]="BOTTOM",e[e.TOP=3]="TOP",e[e.NEAR=4]="NEAR",e[e.FAR=5]="FAR"}(r||(r={})),function(e){e[e.NEAR_BOTTOM_LEFT=0]="NEAR_BOTTOM_LEFT",e[e.NEAR_BOTTOM_RIGHT=1]="NEAR_BOTTOM_RIGHT",e[e.NEAR_TOP_RIGHT=2]="NEAR_TOP_RIGHT",e[e.NEAR_TOP_LEFT=3]="NEAR_TOP_LEFT",e[e.FAR_BOTTOM_LEFT=4]="FAR_BOTTOM_LEFT",e[e.FAR_BOTTOM_RIGHT=5]="FAR_BOTTOM_RIGHT",e[e.FAR_TOP_RIGHT=6]="FAR_TOP_RIGHT",e[e.FAR_TOP_LEFT=7]="FAR_TOP_LEFT"}(n||(n={})),n.FAR_BOTTOM_RIGHT,n.NEAR_BOTTOM_RIGHT,n.NEAR_BOTTOM_LEFT,n.FAR_BOTTOM_LEFT,n.NEAR_BOTTOM_LEFT,n.NEAR_BOTTOM_RIGHT,n.NEAR_TOP_RIGHT,n.NEAR_TOP_LEFT,n.FAR_BOTTOM_RIGHT,n.FAR_BOTTOM_LEFT,n.FAR_TOP_LEFT,n.FAR_TOP_RIGHT,n.NEAR_BOTTOM_RIGHT,n.FAR_BOTTOM_RIGHT,n.FAR_TOP_RIGHT,n.NEAR_TOP_RIGHT,n.FAR_BOTTOM_LEFT,n.NEAR_BOTTOM_LEFT,n.NEAR_TOP_LEFT,n.FAR_TOP_LEFT,n.FAR_TOP_LEFT,n.NEAR_TOP_LEFT,n.NEAR_TOP_RIGHT,n.FAR_TOP_RIGHT;const m=6,g=8,y=[(0,s.iV)(-1,-1,-1,1),(0,s.iV)(1,-1,-1,1),(0,s.iV)(1,1,-1,1),(0,s.iV)(-1,1,-1,1),(0,s.iV)(-1,-1,1,1),(0,s.iV)(1,-1,1,1),(0,s.iV)(1,1,1,1),(0,s.iV)(-1,1,1,1)];new o.s(c);const v=d();class b{get bounds(){return this._root.bounds}get halfSize(){return this._root.halfSize}get root(){return this._root.node}get maximumObjectsPerNode(){return this._maximumObjectsPerNode}get maximumDepth(){return this._maximumDepth}get objectCount(){return this._objectCount}constructor(e,t){this.objectToBoundingSphere=e,this._maximumObjectsPerNode=10,this._maximumDepth=20,this._degenerateObjects=new Set,this._root=new w,this._objectCount=0,t&&(void 0!==t.maximumObjectsPerNode&&(this._maximumObjectsPerNode=t.maximumObjectsPerNode),void 0!==t.maximumDepth&&(this._maximumDepth=t.maximumDepth))}destroy(){this._degenerateObjects.clear(),w.clearPool(),V[0]=null,k.prune(),Z.prune()}add(e,t=e.length){this._objectCount+=t,this._grow(e,t);const i=w.acquire();for(let r=0;r<t;r++){const t=e[r];this._isDegenerate(t)?this._degenerateObjects.add(t):(i.init(this._root),this._add(t,i))}w.release(i)}remove(e,t=null){this._objectCount-=e.length;const i=w.acquire();for(const r of e){const e=t??(0,o.a)(this.objectToBoundingSphere(r),X);L(e[3])?(i.init(this._root),O(r,e,i)):this._degenerateObjects.delete(r)}w.release(i),this._shrink()}update(e,t){if(!L(t[3])&&this._isDegenerate(e))return;const i=H(e);this.remove(i,t),this.add(i)}forEachAlongRay(e,t,i){const r=(0,o.k)(e,t);T(this._root,(e=>{if(!A(r,e))return!1;const t=e.node;return t.terminals.forAll((e=>{this._intersectsObject(r,e)&&i(e)})),null!==t.residents&&t.residents.forAll((e=>{this._intersectsObject(r,e)&&i(e)})),!0}))}forEachAlongRayWithVerticalOffset(e,t,i,r){const n=(0,o.k)(e,t);T(this._root,(e=>{if(!E(n,e,r))return!1;const t=e.node;return t.terminals.forAll((e=>{this._intersectsObjectWithOffset(n,e,r)&&i(e)})),null!==t.residents&&t.residents.forAll((e=>{this._intersectsObjectWithOffset(n,e,r)&&i(e)})),!0}))}forEach(e){T(this._root,(t=>{const i=t.node;return i.terminals.forAll(e),null!==i.residents&&i.residents.forAll(e),!0})),this._degenerateObjects.forEach(e)}forEachDegenerateObject(e){this._degenerateObjects.forEach(e)}findClosest(e,t,i,r=()=>!0,n=1/0){let a=1/0,l=1/0,c=null;const h=B(e,t),d=s=>{if(--n,!r(s))return;const h=this.objectToBoundingSphere(s);if(!_(i,h))return;const d=P(e,t,(0,o.U)(h)),u=d-h[3],f=d+h[3];u<a&&(a=u,l=f,c=s)};return x(this._root,(r=>{if(n<=0||!_(i,r.bounds)||((0,s.dC)(U,h,r.halfSize),(0,s.dE)(U,U,(0,o.U)(r.bounds)),P(e,t,U)>l))return!1;const a=r.node;return a.terminals.forAll((e=>d(e))),null!==a.residents&&a.residents.forAll((e=>d(e))),!0}),e,t),c}forEachInDepthRange(e,t,i,r,n,a,l){let c=-1/0,h=1/0;const d={setRange:e=>{i===b.DepthOrder.FRONT_TO_BACK?(c=Math.max(c,e.near),h=Math.min(h,e.far)):(c=Math.max(c,-e.far),h=Math.min(h,-e.near))}};d.setRange(r);const u=P(t,i,e),f=B(t,i),p=B(t,-i),m=e=>{if(!l(e))return;const r=this.objectToBoundingSphere(e),s=(0,o.U)(r),f=P(t,i,s)-u,p=f-r[3],m=f+r[3];p>h||m<c||!_(a,r)||n(e,d)};x(this._root,(e=>{if(!_(a,e.bounds)||((0,s.dC)(U,f,e.halfSize),(0,s.dE)(U,U,(0,o.U)(e.bounds)),P(t,i,U)-u>h)||((0,s.dC)(U,p,e.halfSize),(0,s.dE)(U,U,(0,o.U)(e.bounds)),P(t,i,U)-u<c))return!1;const r=e.node;return r.terminals.forAll((e=>m(e))),null!==r.residents&&r.residents.forAll((e=>m(e))),!0}),t,i)}forEachNode(e){T(this._root,(t=>e(t.node,t.bounds,t.halfSize,t.depth)))}forEachNeighbor(e,t){const i=(0,o.N)(t),r=(0,o.U)(t),n=t=>{const n=this.objectToBoundingSphere(t),a=(0,o.N)(n),l=i+a;return!((0,s.iY)((0,o.U)(n),r)-l*l<=0)||e(t)};let a=!0;const l=e=>{a&&(a=n(e))};T(this._root,(e=>{const t=(0,o.N)(e.bounds),n=i+t;if((0,s.iY)((0,o.U)(e.bounds),r)-n*n>0)return!1;const c=e.node;return c.terminals.forAll(l),a&&null!==c.residents&&c.residents.forAll(l),a})),a&&this.forEachDegenerateObject(l)}_intersectsObject(e,t){const i=this.objectToBoundingSphere(t);return!(i[3]>0)||(0,o.H)(i,e)}_intersectsObjectWithOffset(e,t,i){const r=this.objectToBoundingSphere(t);return!(r[3]>0)||(0,o.H)(i.applyToBoundingSphere(r),e)}_add(e,t){t.advanceTo(this.objectToBoundingSphere(e))?t.node.terminals.push(e):(t.node.residents.push(e),t.node.residents.length>this._maximumObjectsPerNode&&t.depth<this._maximumDepth&&this._split(t))}_split(e){const t=e.node.residents;e.node.residents=null;for(let i=0;i<t.length;i++){const r=w.acquire().init(e);this._add(t.at(i),r),w.release(r)}}_grow(e,t){if(0!==t&&(D(e,t,(e=>this.objectToBoundingSphere(e)),W),L(W[3])&&!this._fitsInsideTree(W)))if(S(this._root.node))(0,o.a)(W,this._root.bounds),this._root.halfSize=1.25*this._root.bounds[3],this._root.updateBoundsRadiusFromHalfSize();else{const e=this._rootBoundsForRootAsSubNode(W);this._placingRootViolatesMaxDepth(e)?this._rebuildTree(W,e):this._growRootAsSubNode(e),w.release(e)}}_rebuildTree(e,t){(0,s.dF)((0,o.U)(Q),(0,o.U)(t.bounds)),Q[3]=t.halfSize,D([e,Q],2,(e=>e),$);const i=w.acquire().init(this._root);this._root.initFrom(null,$,$[3]),this._root.increaseHalfSize(1.25),T(i,(e=>(this.add(e.node.terminals.data,e.node.terminals.length),null!==e.node.residents&&this.add(e.node.residents.data,e.node.residents.length),!0))),w.release(i)}_placingRootViolatesMaxDepth(e){const t=Math.log(e.halfSize/this._root.halfSize)*Math.LOG2E;let i=0;return T(this._root,(e=>(i=Math.max(i,e.depth),i+t<=this._maximumDepth))),i+t>this._maximumDepth}_rootBoundsForRootAsSubNode(e){const t=e[3],i=e;let r=-1/0;const n=this._root.bounds,s=this._root.halfSize;for(let a=0;a<3;a++){const e=n[a]-s-(i[a]-t),o=i[a]+t-(n[a]+s),l=Math.max(0,Math.ceil(e/(2*s))),c=Math.max(0,Math.ceil(o/(2*s)))+1,h=2**Math.ceil(Math.log(l+c)*Math.LOG2E);r=Math.max(r,h),J[a].min=l,J[a].max=c}for(let a=0;a<3;a++){let e=J[a].min,t=J[a].max;const i=(r-(e+t))/2;e+=Math.ceil(i),t+=Math.floor(i);const o=n[a]-s-e*s*2;j[a]=o+(t+e)*s}const o=r*s;return j[3]=o*G,w.acquire().initFrom(null,j,o,0)}_growRootAsSubNode(e){const t=this._root.node;(0,s.dF)((0,o.U)(W),(0,o.U)(this._root.bounds)),W[3]=this._root.halfSize,this._root.init(e),e.advanceTo(W,null,!0),e.node.children=t.children,e.node.residents=t.residents,e.node.terminals=t.terminals}_shrink(){for(;;){const e=this._findShrinkIndex();if(-1===e)break;this._root.advance(e),this._root.depth=0}}_findShrinkIndex(){if(0!==this._root.node.terminals.length||this._root.isLeaf())return-1;let e=null;const t=this._root.node.children;let i=0,r=0;for(;r<t.length&&null==e;)i=r++,e=t[i];for(;r<t.length;)if(t[r++])return-1;return i}_isDegenerate(e){return!L(this.objectToBoundingSphere(e)[3])}_fitsInsideTree(e){const t=this._root.bounds,i=this._root.halfSize;return e[3]<=i&&e[0]>=t[0]-i&&e[0]<=t[0]+i&&e[1]>=t[1]-i&&e[1]<=t[1]+i&&e[2]>=t[2]-i&&e[2]<=t[2]+i}toJSON(){const{maximumDepth:e,maximumObjectsPerNode:t,_objectCount:i}=this,r=this._nodeToJSON(this._root.node);return{maximumDepth:e,maximumObjectsPerNode:t,objectCount:i,root:{bounds:this._root.bounds,halfSize:this._root.halfSize,depth:this._root.depth,node:r}}}_nodeToJSON(e){const t=e.children.map((e=>e?this._nodeToJSON(e):null)),i=e.residents?.map((e=>this.objectToBoundingSphere(e))),r=e.terminals?.map((e=>this.objectToBoundingSphere(e)));return{children:t,residents:i,terminals:r}}static fromJSON(e){const t=new b((e=>e),{maximumDepth:e.maximumDepth,maximumObjectsPerNode:e.maximumObjectsPerNode});return t._objectCount=e.objectCount,t._root.initFrom(e.root.node,e.root.bounds,e.root.halfSize,e.root.depth),t}}class w{constructor(){this.bounds=(0,o.E)(),this.halfSize=0,this.initFrom(null,null,0,0)}init(e){return this.initFrom(e.node,e.bounds,e.halfSize,e.depth)}initFrom(e,t,i,r=this.depth){return this.node=e??w.createEmptyNode(),t&&(0,o.a)(t,this.bounds),this.halfSize=i,this.depth=r,this}increaseHalfSize(e){this.halfSize*=e,this.updateBoundsRadiusFromHalfSize()}updateBoundsRadiusFromHalfSize(){this.bounds[3]=this.halfSize*G}advance(e){let t=this.node.children[e];t||(t=w.createEmptyNode(),this.node.children[e]=t),this.node=t,this.halfSize/=2,this.depth++;const i=N[e];return this.bounds[0]+=i[0]*this.halfSize,this.bounds[1]+=i[1]*this.halfSize,this.bounds[2]+=i[2]*this.halfSize,this.updateBoundsRadiusFromHalfSize(),this}advanceTo(e,t,i=!1){for(;;){if(this.isTerminalFor(e))return t&&t(this,-1),!0;if(this.isLeaf()){if(!i)return t&&t(this,-1),!1;this.node.residents=null}const r=this._childIndex(e);t&&t(this,r),this.advance(r)}}isLeaf(){return null!=this.node.residents}isTerminalFor(e){return e[3]>this.halfSize/2}_childIndex(e){const t=this.bounds;return(t[0]<e[0]?1:0)+(t[1]<e[1]?2:0)+(t[2]<e[2]?4:0)}static createEmptyNode(){return{children:[null,null,null,null,null,null,null,null],terminals:new s.cM({shrink:!0}),residents:new s.cM({shrink:!0})}}static acquire(){return w._pool.acquire()}static release(e){w._pool.release(e)}static clearPool(){w._pool.prune()}}function T(e,t){let i=w.acquire().init(e);const r=[i];for(;0!==r.length;){if(i=r.pop(),t(i)&&!i.isLeaf())for(let e=0;e<i.node.children.length;e++)i.node.children[e]&&r.push(w.acquire().init(i).advance(e));w.release(i)}}function x(e,t,i,r=b.DepthOrder.FRONT_TO_BACK){let n=w.acquire().init(e);const s=[n];for(F(i,r,K);0!==s.length;){if(n=s.pop(),t(n)&&!n.isLeaf())for(let e=7;e>=0;--e){const t=K[e];n.node.children[t]&&s.push(w.acquire().init(n).advance(t))}w.release(n)}}function O(e,t,i){k.clear();const r=i.advanceTo(t,((e,t)=>{k.push(e.node),k.push(t)}))?i.node.terminals:i.node.residents;if(r.removeUnordered(e),0===r.length)for(let n=k.length-2;n>=0&&R(k.data[n],k.data[n+1]);n-=2);}function R(e,t){return t>=0&&(e.children[t]=null),!!S(e)&&(null===e.residents&&(e.residents=new s.cM({shrink:!0})),!0)}function A(e,t){return M((0,o.U)(t.bounds),2*-t.halfSize,Y),M((0,o.U)(t.bounds),2*t.halfSize,q),(0,l.i)(e.origin,e.direction,Y,q)}function E(e,t,i){return M((0,o.U)(t.bounds),2*-t.halfSize,Y),M((0,o.U)(t.bounds),2*t.halfSize,q),i.applyToMinMax(Y,q),(0,l.i)(e.origin,e.direction,Y,q)}function S(e){if(0!==e.terminals.length)return!1;if(null!==e.residents)return 0===e.residents.length;for(let t=0;t<e.children.length;t++)if(e.children[t])return!1;return!0}function I(e,t){e[0]=Math.min(e[0],t[0]-t[3]),e[1]=Math.min(e[1],t[1]-t[3]),e[2]=Math.min(e[2],t[2]-t[3])}function C(e,t){e[0]=Math.max(e[0],t[0]+t[3]),e[1]=Math.max(e[1],t[1]+t[3]),e[2]=Math.max(e[2],t[2]+t[3])}function M(e,t,i){i[0]=e[0]+t,i[1]=e[1]+t,i[2]=e[2]+t}function D(e,t,i,r){if(1===t){const t=i(e[0]);(0,o.a)(t,r)}else{Y[0]=1/0,Y[1]=1/0,Y[2]=1/0,q[0]=-1/0,q[1]=-1/0,q[2]=-1/0;for(let r=0;r<t;r++){const t=i(e[r]);L(t[3])&&(I(Y,t),C(q,t))}(0,s.iX)((0,o.U)(r),Y,q,.5),r[3]=Math.max(q[0]-Y[0],q[1]-Y[1],q[2]-Y[2])/2}}function F(e,t,i){if(!Z.length)for(let r=0;r<8;++r)Z.push({index:0,distance:0});for(let r=0;r<8;++r){const i=N[r];Z.data[r].index=r,Z.data[r].distance=P(e,t,i)}Z.sort(((e,t)=>e.distance-t.distance));for(let r=0;r<8;++r)i[r]=Z.data[r].index}function B(e,t){let i,r=1/0;for(let n=0;n<8;++n){const s=P(e,t,z[n]);s<r&&(r=s,i=z[n])}return i}function P(e,t,i){return t*(e[0]*i[0]+e[1]*i[1]+e[2]*i[2])}function L(e){return!isNaN(e)&&e!==-1/0&&e!==1/0&&e>0}w._pool=new s.iW(w),function(e){var t;(t=e.DepthOrder||(e.DepthOrder={}))[t.FRONT_TO_BACK=1]="FRONT_TO_BACK",t[t.BACK_TO_FRONT=-1]="BACK_TO_FRONT"}(b||(b={}));const N=[(0,s.aq)(-1,-1,-1),(0,s.aq)(1,-1,-1),(0,s.aq)(-1,1,-1),(0,s.aq)(1,1,-1),(0,s.aq)(-1,-1,1),(0,s.aq)(1,-1,1),(0,s.aq)(-1,1,1),(0,s.aq)(1,1,1)],z=[(0,s.aq)(-1,-1,-1),(0,s.aq)(-1,-1,1),(0,s.aq)(-1,1,-1),(0,s.aq)(-1,1,1),(0,s.aq)(1,-1,-1),(0,s.aq)(1,-1,1),(0,s.aq)(1,1,-1),(0,s.aq)(1,1,1)],G=Math.sqrt(3),V=[null];function H(e){return V[0]=e,V}const j=(0,o.E)(),U=(0,s.ap)(),Y=(0,s.ap)(),q=(0,s.ap)(),k=new s.cM,X=(0,o.E)(),W=(0,o.E)(),Q=(0,o.E)(),$=(0,o.E)(),J=[{min:0,max:0},{min:0,max:0},{min:0,max:0}],Z=new s.cM,K=[0,0,0,0,0,0,0,0],ee=b},46993:function(e,t,i){i.d(t,{E:function(){return O},h:function(){return n}});var r=i(44444);class n{constructor(e=9,t){this._compareMinX=d,this._compareMinY=u,this._toBBox=e=>e,this._maxEntries=Math.max(4,e||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),t&&("function"==typeof t?this._toBBox=t:this._initFormat(t)),this.clear()}destroy(){this.clear(),b.prune(),w.prune(),T.prune(),x.prune()}all(e){o(this._data,e)}search(e,t){let i=this._data;const r=this._toBBox;if(y(e,i))for(b.clear();i;){for(let n=0,s=i.children.length;n<s;n++){const s=i.children[n],a=i.leaf?r(s):s;y(e,a)&&(i.leaf?t(s):g(e,a)?o(s,t):b.push(s))}i=b.pop()}}collides(e){let t=this._data;const i=this._toBBox;if(!y(e,t))return!1;for(b.clear();t;){for(let r=0,n=t.children.length;r<n;r++){const n=t.children[r],s=t.leaf?i(n):n;if(y(e,s)){if(t.leaf||g(e,s))return!0;b.push(n)}}t=b.pop()}return!1}load(e){if(!e.length)return this;if(e.length<this._minEntries){for(let t=0,i=e.length;t<i;t++)this.insert(e[t]);return this}let t=this._build(e.slice(),0,e.length-1,0);if(this._data.children.length)if(this._data.height===t.height)this._splitRoot(this._data,t);else{if(this._data.height<t.height){const e=this._data;this._data=t,t=e}this._insert(t,this._data.height-t.height-1,!0)}else this._data=t;return this}insert(e){return e&&this._insert(e,this._data.height-1),this}clear(){return this._data=new A([]),this}remove(e){if(!e)return this;let t,i=this._data,n=null,s=0,o=!1;const a=this._toBBox(e);for(T.clear(),x.clear();i||T.length>0;){if(i||(i=T.pop(),n=T.data[T.length-1],s=x.pop()??0,o=!0),i.leaf&&(t=(0,r.cN)(i.children,e,i.children.length,i.indexHint),-1!==t))return i.children.splice(t,1),T.push(i),this._condense(T),this;o||i.leaf||!g(i,a)?n?(s++,i=n.children[s],o=!1):i=null:(T.push(i),x.push(s),s=0,n=i,i=i.children[0])}return this}toJSON(){return this._data}fromJSON(e){return this._data=e,this}_build(e,t,i,r){const n=i-t+1;let s=this._maxEntries;if(n<=s){const r=new A(e.slice(t,i+1));return l(r,this._toBBox),r}r||(r=Math.ceil(Math.log(n)/Math.log(s)),s=Math.ceil(n/s**(r-1)));const o=new E([]);o.height=r;const a=Math.ceil(n/s),c=a*Math.ceil(Math.sqrt(s));v(e,t,i,c,this._compareMinX);for(let l=t;l<=i;l+=c){const t=Math.min(l+c-1,i);v(e,l,t,a,this._compareMinY);for(let i=l;i<=t;i+=a){const n=Math.min(i+a-1,t);o.children.push(this._build(e,i,n,r-1))}}return l(o,this._toBBox),o}_insert(e,t,i){const r=this._toBBox,n=i?e:r(e);T.clear();const o=s(n,this._data,t,T);for(o.children.push(e),h(o,n);t>=0&&T.data[t].children.length>this._maxEntries;)this._split(T,t),t--;a(n,T,t)}_split(e,t){const i=e.data[t],r=i.children.length,n=this._minEntries;this._chooseSplitAxis(i,n,r);const s=this._chooseSplitIndex(i,n,r);if(!s)return;const o=i.children.splice(s,i.children.length-s),a=i.leaf?new A(o):new E(o);a.height=i.height,l(i,this._toBBox),l(a,this._toBBox),t?e.data[t-1].children.push(a):this._splitRoot(i,a)}_splitRoot(e,t){this._data=new E([e,t]),this._data.height=e.height+1,l(this._data,this._toBBox)}_chooseSplitIndex(e,t,i){let r,n,s;r=n=1/0;for(let o=t;o<=i-t;o++){const t=c(e,0,o,this._toBBox),a=c(e,o,i,this._toBBox),l=m(t,a),h=f(t)+f(a);l<r?(r=l,s=o,n=h<n?h:n):l===r&&h<n&&(n=h,s=o)}return s}_chooseSplitAxis(e,t,i){const r=e.leaf?this._compareMinX:d,n=e.leaf?this._compareMinY:u;this._allDistMargin(e,t,i,r)<this._allDistMargin(e,t,i,n)&&e.children.sort(r)}_allDistMargin(e,t,i,r){e.children.sort(r);const n=this._toBBox,s=c(e,0,t,n),o=c(e,i-t,i,n);let a=p(s)+p(o);for(let l=t;l<i-t;l++){const t=e.children[l];h(s,e.leaf?n(t):t),a+=p(s)}for(let l=i-t-1;l>=t;l--){const t=e.children[l];h(o,e.leaf?n(t):t),a+=p(o)}return a}_condense(e){for(let t=e.length-1;t>=0;t--){const i=e.data[t];if(0===i.children.length)if(t>0){const n=e.data[t-1],s=n.children;s.splice((0,r.cN)(s,i,s.length,n.indexHint),1)}else this.clear();else l(i,this._toBBox)}}_initFormat(e){const t=["return a"," - b",";"];this._compareMinX=new Function("a","b",t.join(e[0])),this._compareMinY=new Function("a","b",t.join(e[1])),this._toBBox=new Function("a","return {minX: a"+e[0]+", minY: a"+e[1]+", maxX: a"+e[2]+", maxY: a"+e[3]+"};")}}function s(e,t,i,r){for(;r.push(t),!0!==t.leaf&&r.length-1!==i;){let i,r=1/0,n=1/0;for(let s=0,o=t.children.length;s<o;s++){const o=t.children[s],a=f(o),l=_(e,o)-a;l<n?(n=l,r=a<r?a:r,i=o):l===n&&a<r&&(r=a,i=o)}t=i||t.children[0]}return t}function o(e,t){let i=e;for(w.clear();i;){if(!0===i.leaf)for(const e of i.children)t(e);else w.pushArray(i.children);i=w.pop()??null}}function a(e,t,i){for(let r=i;r>=0;r--)h(t.data[r],e)}function l(e,t){c(e,0,e.children.length,t,e)}function c(e,t,i,r,n){n||(n=new A([])),n.minX=1/0,n.minY=1/0,n.maxX=-1/0,n.maxY=-1/0;for(let s,o=t;o<i;o++)s=e.children[o],h(n,e.leaf?r(s):s);return n}function h(e,t){e.minX=Math.min(e.minX,t.minX),e.minY=Math.min(e.minY,t.minY),e.maxX=Math.max(e.maxX,t.maxX),e.maxY=Math.max(e.maxY,t.maxY)}function d(e,t){return e.minX-t.minX}function u(e,t){return e.minY-t.minY}function f(e){return(e.maxX-e.minX)*(e.maxY-e.minY)}function p(e){return e.maxX-e.minX+(e.maxY-e.minY)}function _(e,t){return(Math.max(t.maxX,e.maxX)-Math.min(t.minX,e.minX))*(Math.max(t.maxY,e.maxY)-Math.min(t.minY,e.minY))}function m(e,t){const i=Math.max(e.minX,t.minX),r=Math.max(e.minY,t.minY),n=Math.min(e.maxX,t.maxX),s=Math.min(e.maxY,t.maxY);return Math.max(0,n-i)*Math.max(0,s-r)}function g(e,t){return e.minX<=t.minX&&e.minY<=t.minY&&t.maxX<=e.maxX&&t.maxY<=e.maxY}function y(e,t){return t.minX<=e.maxX&&t.minY<=e.maxY&&t.maxX>=e.minX&&t.maxY>=e.minY}function v(e,t,i,n,s){const o=[t,i];for(;o.length;){const t=o.pop(),i=o.pop();if(t-i<=n)continue;const a=i+Math.ceil((t-i)/n/2)*n;(0,r.cO)(e,a,i,t,s),o.push(i,a,a,t)}}const b=new r.cM,w=new r.cM,T=new r.cM,x=new r.cM({deallocator:void 0});class O{constructor(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0}}class R extends O{constructor(){super(...arguments),this.height=1,this.indexHint=new r.cP}}class A extends R{constructor(e){super(),this.children=e,this.leaf=!0}}class E extends R{constructor(e){super(),this.children=e,this.leaf=!1}}},56499:function(e,t,i){i.d(t,{o:function(){return s}});var r=i(44444);const n=()=>r.G.getLogger("esri.views.webgl.VertexArrayObject");let s=class{constructor(e,t,i,r,n=null){this._context=e,this._locations=t,this._layout=i,this._buffers=r,this._indexBuffer=n,this._glName=null,this._initialized=!1}get glName(){return this._glName}get context(){return this._context}get vertexBuffers(){return this._buffers}get indexBuffer(){return this._indexBuffer}get byteSize(){return Array.from(this._buffers.values()).reduce(((e,t)=>e+t.usedMemory),null!=this._indexBuffer?this._indexBuffer.usedMemory:0)}get layout(){return this._layout}get locations(){return this._locations}get usedMemory(){return this.byteSize+(Object.keys(this._buffers).length+(this._indexBuffer?1:0))*r.aH}dispose(){this._context?(this._context.getBoundVAO()===this&&this._context.bindVAO(null),this._buffers.forEach((e=>e.dispose())),this._buffers.clear(),this._indexBuffer=(0,r.aI)(this._indexBuffer),this.disposeVAOOnly()):(this._glName||Object.getOwnPropertyNames(this._buffers).length>0)&&n().warn("Leaked WebGL VAO")}disposeVAOOnly(){this._glName&&(this._context.gl.deleteVertexArray(this._glName),this._glName=null,this._context.instanceCounter.decrement(r.aA.VertexArrayObject,this)),this._context=null}initialize(){if(this._initialized)return;const{gl:e}=this._context,t=e.createVertexArray();e.bindVertexArray(t),this._bindLayout(),e.bindVertexArray(null),this._glName=t,this._context.instanceCounter.increment(r.aA.VertexArrayObject,this),this._initialized=!0}bind(){this.initialize(),this._context.gl.bindVertexArray(this.glName)}_bindLayout(){const{_buffers:e,_layout:t,_indexBuffer:i}=this;e||n().error("Vertex buffer dictionary is empty!");const s=this._context.gl;this._buffers.forEach(((e,i)=>{const s=t.get(i);s?(0,r.aJ)(this._context,this._locations,e,s):n().error("Vertex element descriptor is empty!")})),null!=i&&s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,i.glName)}unbind(){this.initialize(),this._context.gl.bindVertexArray(null)}}},54396:function(e,t,i){i.d(t,{t:function(){return r}});class r{constructor(e,t,i,r,n,s=!1,o=0){this.name=e,this.count=t,this.type=i,this.offset=r,this.stride=n,this.normalized=s,this.divisor=o}}},51800:function(e,t,i){i.d(t,{o:function(){return n},r:function(){return s}});var r=i(44444);function n(e,t,i=0){const n=(0,r.b0)(e,0,l);for(let r=0;r<4;r++)t[i+r]=Math.floor(256*c(n*o[r]))}function s(e,t=0){let i=0;for(let r=0;r<4;r++)i+=e[t+r]*a[r];return i}const o=[1,256,65536,16777216],a=[1/256,1/65536,1/16777216,1/4294967296],l=s(new Uint8ClampedArray([255,255,255,255]));function c(e){return e-Math.floor(e)}},10717:function(e,t,i){i.d(t,{t:function(){return s}});var r=i(44444),n=i(54396);function s(e,t=0){const i=e.stride;return Array.from(e.fields.keys()).map((r=>{const s=e.fields.get(r),a=s.constructor.ElementCount,l=o(s.constructor.ElementType),c=s.offset,h=s.optional?.glNormalized??!1;return new n.t(r,a,l,c,i,h,t)}))}function o(e){const t=a[e];if(t)return t;throw new Error("BufferType not supported in WebGL")}const a={u8:r.aC.UNSIGNED_BYTE,u16:r.aC.UNSIGNED_SHORT,u32:r.aC.UNSIGNED_INT,i8:r.aC.BYTE,i16:r.aC.SHORT,i32:r.aC.INT,f32:r.aC.FLOAT}},32443:function(e,t,i){i.d(t,{c:function(){return n}});var r=i(44444);function n(e,t,i,n){if((0,r.bD)(e.spatialReference,i)){s[0]=e.x,s[1]=e.y;const o=e.z;return s[2]=o??n??0,(0,r.bE)(s,e.spatialReference,0,t,i,0)}const o=(0,r.bF)(e,i);return!!o&&(t[0]=o?.x,t[1]=o?.y,t[2]=o?.z??n??0,!0)}const s=(0,r.ap)()},3930:function(e,t,i){i.d(t,{a:function(){return a},e:function(){return s},n:function(){return o}});var r=i(44444),n=i(32443);function s(e,t,i,r){return{x:e,y:t,z:i,hasZ:null!=i,hasM:!1,spatialReference:r,type:"point"}}function o(e,t,i,r,n){e.x=t,e.y=i,e.z=r,e.hasZ=null!=r,e.spatialReference=n}function a(e,t,i,r,s){return!(null==t||null==r||e.length<2)&&(l.x=e[0],l.y=e[1],l.z=e[2],l.spatialReference=t,(0,n.c)(l,i,r,s))}const l=s(0,0,0,r.aY.WGS84)},80152:function(e,t,i){function r(){return new Float32Array(3)}function n(e){const t=new Float32Array(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function s(e,t,i){const r=new Float32Array(3);return r[0]=e,r[1]=t,r[2]=i,r}function o(e,t){return new Float32Array(e,t,3)}function a(){return r()}function l(){return s(1,1,1)}function c(){return s(1,0,0)}function h(){return s(0,1,0)}function d(){return s(0,0,1)}i.d(t,{n:function(){return r},r:function(){return s},t:function(){return n}});const u=a(),f=l(),p=c(),_=h(),m=d();Object.freeze(Object.defineProperty({__proto__:null,ONES:f,UNIT_X:p,UNIT_Y:_,UNIT_Z:m,ZEROS:u,clone:n,create:r,createView:o,fromValues:s,ones:l,unitX:c,unitY:h,unitZ:d,zeros:a},Symbol.toStringTag,{value:"Module"}))}}]);
//# sourceMappingURL=2763.fff53bd5.js.map