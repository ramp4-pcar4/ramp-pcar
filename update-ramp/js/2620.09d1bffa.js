"use strict";(self["webpackChunkramp_website"]=self["webpackChunkramp_website"]||[]).push([[239,2620],{92620:function(e,t,a){a.d(t,{save:function(){return $},saveAs:function(){return A}});var r=a(44444),n=a(5474),i=a(79597);const o="Feature Service",s="feature-layer-utils",l=`${s}-save`,u=`${s}-save-as`;function c(e){return{isValid:(0,r.L)(e)&&(!("dynamicDataSource"in e)||!e.dynamicDataSource),errorMessage:"Feature layer should be a layer or table in a map or feature service"}}function y(e){const t=[],a=[];for(const{layer:r,layerJSON:n}of e)r.isTable?a.push(n):t.push(n);return{layers:t,tables:a}}function d(e){return y([e])}async function f(e,t){return/\/\d+\/?$/.test(e.url)?d(t[0]):p(t,e)}async function p(e,t){if(e.reverse(),!t)return y(e);const a=await m(t,e);for(const r of e)O(r.layer,r.layerJSON,a);return b(a,e),a}async function m(e,t){let a=await e.fetchData("json");if(w(a))return a;a||={},h(a);const{layer:{url:r,customParameters:n,apiKey:i}}=t[0];return await I(a,{url:r??"",customParameters:n,apiKey:i},t.map((e=>e.layer.layerId))),a}function w(e){return!!(e&&Array.isArray(e.layers)&&Array.isArray(e.tables))}function h(e){e.layers||=[],e.tables||=[]}function b(e,t){const a=[],r=[];for(const{layer:n}of t){const{isTable:e,layerId:t}=n;e?r.push(t):a.push(t)}L(e.layers,a),L(e.tables,r)}function L(e,t){if(e.length<2)return;const a=[];for(const{id:r}of e)a.push(r);(0,r.c)(a.sort(v),t.slice().sort(v))&&e.sort(((e,a)=>{const r=t.indexOf(e.id),n=t.indexOf(a.id);return r<n?-1:r>n?1:0}))}function v(e,t){return e<t?-1:e>t?1:0}async function I(e,t,a){const{url:r,customParameters:n,apiKey:o}=t,{serviceJSON:s,layersJSON:l}=await(0,i.t)(r,{customParameters:n,apiKey:o}),u=P(e.layers,s.layers,a),c=P(e.tables,s.tables,a);e.layers=u.itemResources,e.tables=c.itemResources;const y=[...u.added,...c.added],d=l?[...l.layers,...l.tables]:[];await S(e,y,r,d)}function P(e,t,a){const n=(0,r.h)(e,t,((e,t)=>e.id===t.id));e=e.filter((e=>!n.removed.some((t=>t.id===e.id))));const i=n.added;return i.forEach((({id:t})=>{e.push({id:t})})),{itemResources:e,added:i.filter((({id:e})=>!a.includes(e)))}}async function S(e,t,a,r){const n=await g(t),i=t.map((({id:e,type:t})=>new(n.get(t))({url:a,layerId:e,sourceJSON:r.find((({id:t})=>t===e))})));await Promise.allSettled(i.map((e=>e.load()))),i.forEach((t=>{const{layerId:a,loaded:r,defaultPopupTemplate:n}=t;if(!r||null==n)return;const i={id:a,popupInfo:n.toJSON()};"ArcGISFeatureLayer"!==t.operationalLayerType&&(i.layerType=t.operationalLayerType),O(t,i,e)}))}async function g(e){const t=[];e.forEach((({type:e})=>{const a=(0,i.i)(e),r=i.a[a];t.push(r())}));const a=await Promise.all(t),r=new Map;return e.forEach((({type:e},t)=>{r.set(e,a[t])})),r}function O(e,t,a){e.isTable?T(a.tables,t):T(a.layers,t)}function T(e,t){const a=e.findIndex((({id:e})=>e===t.id));-1===a?e.push(t):e[a]=t}function E(e,t){const a=e.layers.some((e=>"OrientedImageryLayer"===e.layerType));(0,r.u)(t,r.f.ORIENTED_IMAGERY_LAYER,a)}function N(e,t){const a=e.some((e=>"oriented-imagery"===e.type));(0,r.u)(t,r.f.ORIENTED_IMAGERY_LAYER,a)}async function R(e,t,a){E(a,t)}async function M(e,t){const{url:a,layerId:n,title:i,fullExtent:o,isTable:s}=e,l=(0,r.d)(a);t.url=("FeatureServer"===l?.serverType?a:`${a}/${n}`)??null,t.title||=i,t.extent=null,s||null==o||(t.extent=await(0,r.l)(o)),(0,r.a)(t,r.f.METADATA),(0,r.a)(t,r.f.MULTI_LAYER),(0,r.i)(t,r.f.SINGLE_LAYER),(0,r.u)(t,r.f.TABLE,s),N([e],t)}async function $(e,t){return(0,n.P)({layer:e,itemType:o,validateLayer:c,createItemData:(e,t)=>f(t,[e]),errorNamePrefix:l,setItemProperties:R},t)}async function A(e,t,a){return(0,n.$)({layer:e,itemType:o,validateLayer:c,createItemData:(e,t)=>Promise.resolve(d(e)),errorNamePrefix:u,newItem:t,setItemProperties:M},a)}},79597:function(e,t,a){a.d(t,{a:function(){return i},b:function(){return n},i:function(){return p},t:function(){return s}});var r=a(44444);async function n(e,t){const{data:a}=await(0,r.U)(e,{responseType:"json",query:{f:"json",...t?.customParameters,token:t?.apiKey}});return a}const i={BingMapsLayer:async()=>(await a.e(1417).then(a.bind(a,41417))).default,BuildingSceneLayer:async()=>(await Promise.all([a.e(4400),a.e(8776),a.e(9399),a.e(999)]).then(a.bind(a,80999))).default,CSVLayer:async()=>(await a.e(4552).then(a.bind(a,24552))).default,CatalogLayer:async()=>(await Promise.all([a.e(8804),a.e(9902)]).then(a.bind(a,49902))).default,DimensionLayer:async()=>(await a.e(9782).then(a.bind(a,69782))).default,ElevationLayer:async()=>(await a.e(488).then(a.bind(a,50488))).default,FeatureLayer:async()=>(await Promise.resolve().then(a.bind(a,44444)).then((e=>e.vF))).default,GeoJSONLayer:async()=>(await a.e(8718).then(a.bind(a,18718))).default,GeoRSSLayer:async()=>(await a.e(395).then(a.bind(a,10395))).default,GroupLayer:async()=>(await a.e(9394).then(a.bind(a,89394))).default,ImageryLayer:async()=>(await Promise.resolve().then(a.bind(a,44444)).then((e=>e.vG))).default,ImageryTileLayer:async()=>(await Promise.all([a.e(5209),a.e(2790)]).then(a.bind(a,52790))).default,IntegratedMesh3DTilesLayer:async()=>(await a.e(4568).then(a.bind(a,64568))).default,IntegratedMeshLayer:async()=>(await Promise.all([a.e(8776),a.e(5818)]).then(a.bind(a,45818))).default,KMLLayer:async()=>(await a.e(426).then(a.bind(a,60426))).default,KnowledgeGraphLayer:async()=>(await Promise.all([a.e(4464),a.e(413),a.e(5599),a.e(1468),a.e(5050),a.e(4159)]).then(a.bind(a,44159))).default,LineOfSightLayer:async()=>(await a.e(2650).then(a.bind(a,12650))).default,LinkChartLayer:async()=>(await Promise.all([a.e(4464),a.e(413),a.e(5599),a.e(1468),a.e(5050),a.e(5902)]).then(a.bind(a,95902))).default,MapImageLayer:async()=>(await Promise.resolve().then(a.bind(a,44444)).then((e=>e.vH))).default,MapNotesLayer:async()=>(await a.e(2646).then(a.bind(a,42646))).default,MediaLayer:async()=>(await a.e(7309).then(a.bind(a,67309))).default,OGCFeatureLayer:async()=>(await a.e(6987).then(a.bind(a,46987))).default,OpenStreetMapLayer:async()=>(await Promise.resolve().then(a.bind(a,44444)).then((e=>e.vJ))).default,OrientedImageryLayer:async()=>(await a.e(9347).then(a.bind(a,29347))).default,PointCloudLayer:async()=>(await a.e(1976).then(a.bind(a,21976))).default,RouteLayer:async()=>(await Promise.all([a.e(1555),a.e(7339)]).then(a.bind(a,87339))).default,SceneLayer:async()=>(await Promise.all([a.e(4400),a.e(8711),a.e(8776),a.e(9399),a.e(7537),a.e(9279)]).then(a.bind(a,59279))).default,StreamLayer:async()=>(await a.e(9192).then(a.bind(a,19192))).default,SubtypeGroupLayer:async()=>(await a.e(4091).then(a.bind(a,4091))).default,TileLayer:async()=>(await Promise.resolve().then(a.bind(a,44444)).then((e=>e.vK))).default,UnknownLayer:async()=>(await a.e(9246).then(a.bind(a,99246))).default,UnsupportedLayer:async()=>(await a.e(4544).then(a.bind(a,54544))).default,VectorTileLayer:async()=>(await Promise.all([a.e(4789),a.e(9225)]).then(a.bind(a,82324))).default,VideoLayer:async()=>(await a.e(2113).then(a.bind(a,82113))).default,ViewshedLayer:async()=>(await a.e(256).then(a.bind(a,60256))).default,VoxelLayer:async()=>(await a.e(1267).then(a.bind(a,21267))).default,WFSLayer:async()=>(await a.e(2138).then(a.bind(a,42138))).default,WMSLayer:async()=>(await Promise.resolve().then(a.bind(a,44444)).then((e=>e.vL))).default,WMTSLayer:async()=>(await a.e(3249).then(a.bind(a,23249))).default,WebTileLayer:async()=>(await Promise.resolve().then(a.bind(a,44444)).then((e=>e.vI))).default},o=new Set(["Catalog Layer","Feature Layer","Oriented Imagery Layer"]);async function s(e,t){const{loadContext:a,...r}=t||{},i=a?await a.fetchServiceMetadata(e,r):await n(e,r);f(i),c(i);const o={serviceJSON:i};if((i.currentVersion??0)<10.5)return o;const s=`${e}/layers`,l=a?await a.fetchServiceMetadata(s,r):await n(s,r);return f(l),c(l),o.layersJSON={layers:l.layers,tables:l.tables},o}function l(e){const{type:t}=e;return!!t&&o.has(t)}function u(e){return"Table"===e.type}function c(e){e.layers=e.layers?.filter(l),e.tables=e.tables?.filter(u)}function y(e){e.type||="Feature Layer"}function d(e){e.type||="Table"}function f(e){e.layers?.forEach(y),e.tables?.forEach(d)}function p(e){switch(e){case"Feature Layer":case"Table":return"FeatureLayer";case"Oriented Imagery Layer":return"OrientedImageryLayer";case"Catalog Layer":return"CatalogLayer"}return"FeatureLayer"}},37181:function(e,t,a){a.d(t,{e:function(){return n},o:function(){return i}});var r=a(44444);function n(e,t){return{...o(e,t),readResourcePaths:[]}}function i(e,t,a){const n=(0,r.I)(e.itemUrl);return{...o(e,t),messages:[],writtenProperties:[],blockedRelativeUrls:[],verifyItemRelativeUrls:n?{rootPath:n.path,writtenUrls:[]}:null,resources:a?{toAdd:[],toUpdate:[],toKeep:[],pendingOperations:[]}:null}}function o(e,t){return{origin:t,url:(0,r.I)(e.itemUrl),portal:e.portal||r.e.getDefault(),portalItem:e}}},64835:function(e,t,a){function r(e){return e&&"getAtOrigin"in e&&"originOf"in e}a.d(t,{i:function(){return r}})},94752:function(e,t,a){a.d(t,{i:function(){return n}});var r=a(64835);function n(e){e?.writtenProperties&&e.writtenProperties.forEach((({target:e,propName:t,newOrigin:a})=>{(0,r.i)(e)&&a&&e.originOf(t)!==a&&e.updateOrigin(t,a)}))}},51126:function(e,t,a){a.d(t,{r:function(){return n},t:function(){return o}});var r=a(44444);async function n(e){const t=[];for(const a of e.allLayers)if("beforeSave"in a&&"function"==typeof a.beforeSave){const e=a.beforeSave();e&&t.push(e)}await Promise.allSettled(t)}const i=new Set(["layer:unsupported","property:unsupported","symbol:unsupported","symbol-layer:unsupported","url:unsupported"]);function o(e,t,a){let n=(e.messages??[]).filter((({type:e})=>"error"===e)).map((({name:e,message:t,details:a})=>new r.s(e,t,a)));if(e.blockedRelativeUrls&&(n=n.concat(e.blockedRelativeUrls.map((e=>new r.s("url:unsupported",`Relative url '${e}' is not supported`))))),a){const{ignoreUnsupported:e,supplementalUnsupportedErrors:t=[],requiredPropertyChecksDisabled:r}=a;e&&(n=n.filter((({name:e})=>!(i.has(e)||t.includes(e))))),r&&(n=n.filter((e=>"web-document-write:property-required"!==e.name)))}if(n.length>0)throw new r.s(t.errorName,"Failed to save due to unsupported or invalid content. See 'details.errors' for more detailed information",{errors:n})}},5474:function(e,t,a){a.d(t,{$:function(){return L},P:function(){return b}});var r=a(44444),n=a(94752),i=a(37181),o=a(51126);function s(e,t,a){const n=a(e);if(!n.isValid)throw new r.s(`${t}:invalid-parameters`,n.errorMessage,{layer:e})}async function l(e){const{layer:t,errorNamePrefix:a,validateLayer:r}=e;await t.load(),s(t,a,r)}function u(e,t){return`Layer (title: ${e.title}, id: ${e.id}) of type '${e.declaredClass}' ${t}`}function c(e){const{item:t,errorNamePrefix:a,layer:n,validateItem:i}=e;if(y(e),i){const e=i(t);if(!e.isValid)throw new r.s(`${a}:invalid-parameters`,e.errorMessage,{layer:n})}}function y(e){const{item:t,itemType:a,additionalItemType:n,errorNamePrefix:i,layer:o}=e,s=[a];if(n&&s.push(n),!s.includes(t.type)){const e=s.map((e=>`'${e}'`)).join(", ");throw new r.s(`${i}:portal-item-wrong-type`,`Portal item type should be one of: "${e}"`,{item:t,layer:o})}}function d(e){const{layer:t,errorNamePrefix:a}=e,{portalItem:n}=t;if(!n)throw new r.s(`${a}:portal-item-not-set`,u(t,"requires the portalItem property to be set"));if(!n.loaded)throw new r.s(`${a}:portal-item-not-loaded`,u(t,"cannot be saved to a portal item that does not exist or is inaccessible"));c({...e,item:n})}function f(e){const{newItem:t,itemType:a}=e;let n=r.S.from(t);return n.id&&(n=n.clone(),n.id=null),n.type??=a,n.portal??=r.e.getDefault(),c({...e,item:n}),n}function p(e){return(0,i.o)(e,"portal-item")}async function m(e,t,a){"beforeSave"in e&&"function"==typeof e.beforeSave&&await e.beforeSave();const r=e.write({},t);return await Promise.all(t.resources?.pendingOperations??[]),(0,o.t)(t,{errorName:"layer-write:unsupported"},a),r}function w(e){(0,r.i)(e,r.f.JSAPI),e.typeKeywords&&(e.typeKeywords=e.typeKeywords.filter(((e,t,a)=>a.indexOf(e)===t)))}async function h(e,t,a){const r=e.portal;await r.signIn(),await r.user.addItem({item:e,data:t,folder:a?.folder})}async function b(e,t){const{layer:a,createItemData:r,createJSONContext:i,setItemProperties:o,saveResources:s,supplementalUnsupportedErrors:u}=e;await l(e),d(e);const c=a.portalItem,y=i?i(c):p(c),f=await m(a,y,{...t,supplementalUnsupportedErrors:u}),h=await r({layer:a,layerJSON:f},c);return await(o?.(a,c,h)),w(c),await c.update({data:h}),(0,n.i)(y),await(s?.(c,y)),c}async function L(e,t){const{layer:a,createItemData:r,createJSONContext:i,setItemProperties:o,saveResources:s,supplementalUnsupportedErrors:u}=e;await l(e);const c=f(e),y=i?i(c):p(c),d=await m(a,y,{...t,supplementalUnsupportedErrors:u}),b=await r({layer:a,layerJSON:d},c);return await o(a,c,b),w(c),await h(c,b,t),a.portalItem=c,(0,n.i)(y),await(s?.(c,y)),c}}}]);
//# sourceMappingURL=2620.09d1bffa.js.map