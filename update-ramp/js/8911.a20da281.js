"use strict";(self["webpackChunkramp_website"]=self["webpackChunkramp_website"]||[]).push([[2518,7536,8911],{65332:function(t,e,n){n.d(e,{a:function(){return l},b:function(){return s}});var i,r=n(44444);let o=i=class extends((0,r.cQ)(r.bw)){constructor(t){super(t),this.type="georeferenced",this.origin=null}};o.absolute=new i,(0,r.bt)([(0,r.e3)({georeferenced:"georeferenced"},{readOnly:!0})],o.prototype,"type",void 0),(0,r.bt)([(0,r.bu)({type:[Number],nonNullable:!1,json:{write:!0}})],o.prototype,"origin",void 0),o=i=(0,r.bt)([(0,r.bv)("esri.geometry.support.MeshGeoreferencedVertexSpace")],o);const s=o;let a=class extends((0,r.cQ)(r.bw)){constructor(t){super(t),this.type="local",this.origin=(0,r.ap)()}};(0,r.bt)([(0,r.e3)({local:"local"},{readOnly:!0})],a.prototype,"type",void 0),(0,r.bt)([(0,r.bu)({type:[Number],nonNullable:!0,json:{write:!0}})],a.prototype,"origin",void 0),a=(0,r.bt)([(0,r.bv)("esri.geometry.support.MeshLocalVertexSpace")],a);const l=a},72329:function(t,e,n){n.d(e,{N:function(){return T},d:function(){return h},j:function(){return a},k:function(){return c},w:function(){return p},z:function(){return f}});var i=n(44444),r=n(77703),o=n(63655),s=n(83875);function a(t=m){return[t[0],t[1],t[2],t[3]]}function l(t,e,n=a()){return(0,i.dF)(n,t),n[3]=e,n}function c(t,e=a()){const n=(0,i.fB)(y,t);return g(e,(0,i.et)((0,o.v)(e,n))),e}function u(t,e,n=a()){return(0,o.b)(y,t,f(t)),(0,o.b)(_,e,f(e)),(0,o.x)(y,_,y),g(n,(0,i.et)((0,o.v)(n,y)))}function h(t,e,n,r=a()){return l(i.fx,t,v),l(i.fy,e,b),l(i.fz,n,x),u(v,b,v),u(v,x,r),r}function p(t){return t}function d(t){return t[3]}function f(t){return(0,i.fA)(t[3])}function g(t,e){return t[3]=e,t}const m=[0,0,1,0],y=(0,s.e)(),_=(0,s.e)();a();const v=a(),b=a(),x=a();var w;let M=w=class extends i.bw{constructor(t){super(t),this.translation=(0,i.ap)(),this.rotationAxis=(0,i.fC)(m),this.rotationAngle=0,this.scale=(0,i.aq)(1,1,1)}get rotation(){return l(this.rotationAxis,this.rotationAngle)}set rotation(t){this.rotationAxis=(0,i.dA)(t),this.rotationAngle=d(t)}get localMatrix(){const t=(0,r.e)();return(0,o.b)(E,this.rotation,f(this.rotation)),(0,i.fD)(t,E,this.translation,this.scale),t}get localMatrixInverse(){return(0,i.dV)((0,r.e)(),this.localMatrix)}equals(t){return this===t||null!=t&&(0,i.fE)(this.localMatrix,t.localMatrix)}clone(){const t={translation:(0,i.dA)(this.translation),rotationAxis:(0,i.dA)(this.rotationAxis),rotationAngle:this.rotationAngle,scale:(0,i.dA)(this.scale)};return new w(t)}};(0,i.bt)([(0,i.bu)({type:[Number],nonNullable:!0,json:{write:!0}})],M.prototype,"translation",void 0),(0,i.bt)([(0,i.bu)({type:[Number],nonNullable:!0,json:{write:!0}})],M.prototype,"rotationAxis",void 0),(0,i.bt)([(0,i.bu)({type:Number,nonNullable:!0,json:{write:!0}})],M.prototype,"rotationAngle",void 0),(0,i.bt)([(0,i.bu)({type:[Number],nonNullable:!0,json:{write:!0}})],M.prototype,"scale",void 0),(0,i.bt)([(0,i.bu)()],M.prototype,"rotation",null),(0,i.bt)([(0,i.bu)()],M.prototype,"localMatrix",null),(0,i.bt)([(0,i.bu)()],M.prototype,"localMatrixInverse",null),M=w=(0,i.bt)([(0,i.bv)("esri.geometry.support.MeshTransform")],M);const E=(0,s.e)(),T=M},42070:function(t,e,n){n.d(e,{$:function(){return P},B:function(){return T},D:function(){return v},F:function(){return w},M:function(){return S},T:function(){return O},U:function(){return f},a:function(){return s},b:function(){return c},c:function(){return m},d:function(){return M},e:function(){return d},f:function(){return u},g:function(){return y},h:function(){return E},i:function(){return o},j:function(){return C},k:function(){return p},l:function(){return a},m:function(){return h},n:function(){return g},o:function(){return l},p:function(){return _},s:function(){return D},w:function(){return R},x:function(){return b},y:function(){return x}});var i=n(44444);function r(t,e){return{type:(0,i.i1)(e),value:t,unit:e}}function o(t){return{value:t}}function s(t,e){return{type:(0,i.i1)(e),value:t,unit:e}}function a(t,e){return{type:(0,i.i1)(e),value:t,unit:e}}function l(t,e,n="arithmetic"){return{type:(0,i.i1)(e),value:t,unit:e,rotationType:n}}function c(t,e){const n=u(t,e);return"angle"===t.type?l(n,e,t.rotationType):r(n,e)}function u(t,e){return(0,i.aU)(t.value,t.unit,e)}function h(t,e,n){if(e===n)return t;switch(n){case"arithmetic":case"geographic":return 90-t}}const p=s(0,"meters"),d=a(0,"square-meters");l(0,"radians");const f=l(0,"degrees"),g=l(0,"degrees","geographic");function m(t,e,n){return t.units[e][n]}function y(t,e,n,r=2,o="abbr"){return`${(0,i.au)(e,{minimumFractionDigits:r,maximumFractionDigits:r,signDisplay:e>0?"never":"exceptZero"})} ${m(t,n,o)}`}function _(t,e,n,r=2,o="abbr"){return`${(0,i.au)(e,{minimumFractionDigits:r,maximumFractionDigits:r,signDisplay:"exceptZero"})} ${m(t,n,o)}`}function v(t,e,n,r=2,o="abbr"){const s=(0,i.i4)(e,n);return y(t,(0,i.aU)(e,n,s),s,r,o)}function b(t,e,n,r=2,o="abbr"){const s=(0,i.i4)(e,n);return _(t,(0,i.aU)(e,n,s),s,r,o)}function x(t,e,n,r=2,o="abbr"){const s=(0,i.i5)(e,n);return y(t,(0,i.aU)(e,n,s),s,r,o)}function w(t,e,n,r=2,o="abbr"){const s=(0,i.i5)(e,n);return _(t,(0,i.aU)(e,n,s),s,r,o)}function M(t,e,n,r=2,o="abbr"){const s=(0,i.i6)(e,n);return y(t,(0,i.aU)(e,n,s),s,r,o)}function E(t,e,n,r=2,o="abbr"){const s=(0,i.i6)(e,n);return _(t,(0,i.aU)(e,n,s),s,r,o)}function T(t,e,n,r=2,o="abbr"){const s=(0,i.i7)(e,n);return y(t,(0,i.aU)(e,n,s),s,r,o)}function S(t,e,n,r=2,o="abbr"){const s=(0,i.i7)(e,n);return _(t,(0,i.aU)(e,n,s),s,r,o)}function P(t,e,n,r=2,o="abbr"){const s=(0,i.i8)(e,n);return y(t,(0,i.aU)(e,n,s),s,r,o)}function C(t,e,n,r=2,o="abbr"){const s=(0,i.i9)(e,n);return y(t,(0,i.aU)(e,n,s),s,r,o)}const k=(t,e)=>({style:"unit",unitDisplay:"narrow",unit:"degree",maximumFractionDigits:e,minimumFractionDigits:e,signDisplay:t>0?"never":"exceptZero"});function R(t,e,n,r,o,s=i.i3,a=!0){let l=s.normalize(h((0,i.aU)(t,e,"degrees"),n,r),0,a);const c=k(l,o??2);return l=A(l,c),(0,i.au)(l,c)}const V=new Map;function A(t,e){const n=JSON.stringify(e);let i=V.get(n);return i||(i=new Intl.NumberFormat("en-US",e),V.set(n,i)),/^[-+]?360\.?0*°?$/.test(i.format(t))?0:t}const I=["B","kB","MB","GB","TB"];function O(t,e){let n=0===(e=Math.round(e))?0:Math.floor(Math.log(e)/Math.log(i.i2.KILOBYTES));n=(0,i.b0)(n,0,I.length-1);const r=(0,i.au)(e/i.i2.KILOBYTES**n,{maximumFractionDigits:2});return(0,i.as)(t.units.bytes[I[n]],{fileSize:r})}class D{constructor(t){this._observable=new i.ia,this._set=new Set(t)}get size(){return(0,i.ib)(this._observable),this._set.size}add(t){const e=this._set.size;return this._set.add(t),this._set.size!==e&&this._observable.notify(),this}clear(){this._set.size>0&&(this._set.clear(),this._observable.notify())}delete(t){const e=this._set.delete(t);return e&&this._observable.notify(),e}entries(){return(0,i.ib)(this._observable),this._set.entries()}forEach(t,e){(0,i.ib)(this._observable),this._set.forEach(((n,i)=>t.call(e,n,i,this)),e)}has(t){return(0,i.ib)(this._observable),this._set.has(t)}keys(){return(0,i.ib)(this._observable),this._set.keys()}values(){return(0,i.ib)(this._observable),this._set.values()}[Symbol.iterator](){return(0,i.ib)(this._observable),this._set[Symbol.iterator]()}get[Symbol.toStringTag](){return this._set[Symbol.toStringTag]}}},97975:function(t,e,n){n.d(e,{J:function(){return g},K:function(){return m},W:function(){return h},Z:function(){return d},k:function(){return J}});var i=n(44444),r=n(38837),o=n(77703),s=n(87792),a=n(81203);const l=()=>i.G.getLogger("esri.views.3d.support.geometryUtils.boundedPlane");class c{constructor(){this.plane=(0,a.M)(),this.origin=(0,i.ap)(),this.basis1=(0,i.ap)(),this.basis2=(0,i.ap)()}}const u=c;function h(t=q){return{plane:(0,a.M)(t.plane),origin:(0,i.dA)(t.origin),basis1:(0,i.dA)(t.basis1),basis2:(0,i.dA)(t.basis2)}}function p(t,e,n){const i=W.get();return i.origin=t,i.basis1=e,i.basis2=n,i.plane=(0,a.D)(0,0,0,0),m(i),i}function d(t,e=h()){return g(t.origin,t.basis1,t.basis2,e)}function f(t,e){(0,i.dF)(e.origin,t.origin),(0,i.dF)(e.basis1,t.basis1),(0,i.dF)(e.basis2,t.basis2),(0,a.h)(e.plane,t.plane)}function g(t,e,n,r=h()){return(0,i.dF)(r.origin,t),(0,i.dF)(r.basis1,e),(0,i.dF)(r.basis2,n),m(r),Z(r,"fromValues()"),r}function m(t){(0,a.P)(t.basis2,t.basis1,t.origin,t.plane)}function y(t,e,n){t!==n&&d(t,n);const r=(0,i.dC)(a.c.get(),z(t),e);return(0,i.dE)(n.origin,n.origin,r),n.plane[3]-=e,n}function _(t,e,n){return b(e,n),y(n,I(t,t.origin),n),n}function v(t,e){const n=t.basis1[0],r=t.basis2[1],[o,s]=t.origin;return(0,i.dP)(o-n,s-r,o+n,s+r,e)}function b(t,e=h()){const n=(t[2]-t[0])/2,r=(t[3]-t[1])/2;return(0,i.dQ)(e.origin,t[0]+n,t[1]+r,0),(0,i.dQ)(e.basis1,n,0,0),(0,i.dQ)(e.basis2,0,r,0),(0,a.U)(0,0,1,0,e.plane),e}function x(t,e,n){return!!(0,a.x)(t.plane,e,n)&&U(t,n)}function w(t,e,n){if(x(t,e,n))return n;const r=M(t,e,a.c.get());return(0,i.dE)(n,e.origin,(0,i.dC)(a.c.get(),e.direction,(0,i.dR)(e.origin,r)/(0,i.dS)(e.direction))),n}function M(t,e,n){const r=Y.get();B(t,e,r,Y.get());let o=Number.POSITIVE_INFINITY;for(const s of $){const l=F(t,s,X.get()),c=a.c.get();if((0,a.q)(r,l,c)){const t=(0,i.dT)(a.c.get(),e.origin,c),r=Math.abs((0,i.dU)((0,i.al)(e.direction,t)));r<o&&(o=r,(0,i.dF)(n,c))}}return o===Number.POSITIVE_INFINITY?T(t,e,n):n}function E(t,e){return(e-t)/e}function T(t,e,n){if(x(t,e,n))return n;const o=Y.get(),s=Y.get();B(t,e,o,s);let l=Number.POSITIVE_INFINITY;for(const c of $){const u=F(t,c,X.get()),h=a.c.get();if((0,a.w)(o,u,h)){const t=(0,r.w)(e,h);if(!(0,a.z)(s,h))continue;t<l&&(l=t,(0,i.dF)(n,h))}}return C(t,e.origin)<l&&S(t,e.origin,n),n}function S(t,e,n){const r=(0,a.H)(t.plane,e,a.c.get()),o=(0,s.A)(H(t,t.basis1),r,-1,1,a.c.get()),l=(0,s.A)(H(t,t.basis2),r,-1,1,a.c.get());return(0,i.dB)(n,(0,i.dE)(a.c.get(),o,l),t.origin),n}function P(t,e,n){const{origin:r,basis1:o,basis2:s}=t,l=(0,i.dB)(a.c.get(),e,r),c=(0,a.f)(o,l),u=(0,a.f)(s,l),h=(0,a.f)(z(t),l);return(0,i.dQ)(n,c,u,h)}function C(t,e){const n=P(t,e,a.c.get()),{basis1:r,basis2:o}=t,s=(0,i.dS)(r),l=(0,i.dS)(o),c=Math.max(Math.abs(n[0])-s,0),u=Math.max(Math.abs(n[1])-l,0),h=n[2];return c*c+u*u+h*h}function k(t,e){return Math.sqrt(C(t,e))}function R(t,e){let n=Number.NEGATIVE_INFINITY;for(const i of $){const r=F(t,i,X.get()),o=(0,s.M)(r,e);o>n&&(n=o)}return Math.sqrt(n)}function V(t,e){return(0,a.z)(t.plane,e)&&U(t,e)}function A(t,e,n,i){return N(t,n,i)}function I(t,e){const n=-t.plane[3];return(0,a.f)(z(t),e)-n}function O(t,e,n,r){const o=I(t,e),s=(0,i.dC)(j,z(t),n-o);return(0,i.dE)(r,e,s),r}function D(t,e){return(0,i.H)(t.basis1,e.basis1)&&(0,i.H)(t.basis2,e.basis2)&&(0,i.H)(t.origin,e.origin)}function G(t,e,n){return t!==n&&d(t,n),(0,i.dV)(Q,e),(0,i.dW)(Q,Q),(0,i.dX)(n.basis1,t.basis1,Q),(0,i.dX)(n.basis2,t.basis2,Q),(0,i.dX)((0,a.O)(n.plane),(0,a.O)(t.plane),Q),(0,i.dX)(n.origin,t.origin,e),(0,a.y)(n.plane,n.plane,n.origin),n}function L(t,e,n,r){return t!==r&&d(t,r),(0,i.dY)(K,e,n),(0,i.dX)(r.basis1,t.basis1,K),(0,i.dX)(r.basis2,t.basis2,K),m(r),r}function z(t){return(0,a.O)(t.plane)}function N(t,e,n){switch(e){case i.dZ.X:(0,i.dF)(n,t.basis1),(0,i.ao)(n,n);break;case i.dZ.Y:(0,i.dF)(n,t.basis2),(0,i.ao)(n,n);break;case i.dZ.Z:(0,i.dF)(n,z(t))}return n}function U(t,e){const n=(0,i.dB)(a.c.get(),e,t.origin),r=(0,i.dD)(t.basis1),o=(0,i.dD)(t.basis2),s=(0,i.al)(t.basis1,n),l=(0,i.al)(t.basis2,n);return-s-r<0&&s-r<0&&-l-o<0&&l-o<0}function H(t,e){const n=X.get();return(0,i.dF)(n.origin,t.origin),(0,i.dF)(n.vector,e),n}function F(t,e,n){const{basis1:r,basis2:o,origin:s}=t,l=(0,i.dC)(a.c.get(),r,e.origin[0]),c=(0,i.dC)(a.c.get(),o,e.origin[1]);(0,i.dE)(n.origin,l,c),(0,i.dE)(n.origin,n.origin,s);const u=(0,i.dC)(a.c.get(),r,e.direction[0]),h=(0,i.dC)(a.c.get(),o,e.direction[1]);return(0,i.dC)(n.vector,(0,i.dE)(u,u,h),2),n}function Z(t,e){Math.abs((0,i.al)(t.basis1,t.basis2)/((0,i.dS)(t.basis1)*(0,i.dS)(t.basis2)))>1e-6&&l().warn(e,"Provided basis vectors are not perpendicular"),Math.abs((0,i.al)(t.basis1,z(t)))>1e-6&&l().warn(e,"Basis vectors and plane normal are not perpendicular"),Math.abs(-(0,i.al)(z(t),t.origin)-t.plane[3])>1e-6&&l().warn(e,"Plane offset is not consistent with plane origin")}function B(t,e,n,i){const r=z(t);(0,a.P)(r,e.direction,e.origin,n),(0,a.P)((0,a.O)(n),r,e.origin,i)}const q={plane:(0,a.M)(),origin:(0,i.aq)(0,0,0),basis1:(0,i.aq)(1,0,0),basis2:(0,i.aq)(0,1,0)},Y=new r.s(a.M),X=new r.s(s.v),j=(0,i.ap)(),W=new r.s((()=>h())),$=[{origin:[-1,-1],direction:[1,0]},{origin:[1,-1],direction:[0,1]},{origin:[1,1],direction:[-1,0]},{origin:[-1,1],direction:[0,-1]}],Q=(0,o.e)(),K=(0,o.e)(),J=Object.freeze(Object.defineProperty({__proto__:null,BoundedPlaneClass:u,altitudeAt:I,axisAt:A,cameraFrustumCoverage:E,closestPoint:T,closestPointOnSilhouette:M,copy:d,copyWithoutVerify:f,create:h,distance:k,distance2:C,distanceToSilhouette:R,elevate:y,equals:D,extrusionContainsPoint:V,fromAABoundingRect:b,fromValues:g,getExtent:v,intersectRay:x,intersectRayClosestSilhouette:w,normal:z,projectPoint:S,projectPointLocal:P,rotate:L,setAltitudeAt:O,setExtent:_,transform:G,up:q,updateUnboundedPlane:m,wrap:p},Symbol.toStringTag,{value:"Module"}))},17437:function(t,e,n){n.d(e,{i:function(){return u},o:function(){return l},r:function(){return c}});var i=n(44444);function r(t,e){return e?"xoffset"in e&&e.xoffset?Math.max(t,Math.abs(e.xoffset)):"yoffset"in e&&e.yoffset?Math.max(t,Math.abs(e.yoffset||0)):t:t}function o(t){let e=0,n=0;for(let i=0;i<t.length;i++){const r=t[i].size;"number"==typeof r&&(e+=r,n++)}return e/n}function s(t,e){return"number"==typeof t?t:t?.stops?.length?o(t.stops):e}function a(t,e){if(!e)return t;const n=e.filter((t=>"size"===t.type)).map((e=>{const{maxSize:n,minSize:i}=e;return(s(n,t)+s(i,t))/2}));let i=0;const r=n.length;if(0===r)return t;for(let s=0;s<r;s++)i+=n[s];const o=Math.floor(i/r);return Math.max(o,t)}function l(t){const e=t?.renderer,n=t?.pointerType,i="touch"===n?9:6;if(!e)return i;const o="visualVariables"in e?a(i,e.visualVariables):i;if("simple"===e.type)return r(o,e.symbol);if("unique-value"===e.type){let t=o;return e.uniqueValueInfos?.forEach((e=>{t=r(t,e.symbol)})),t}if("class-breaks"===e.type){let t=o;return e.classBreakInfos.forEach((e=>{t=r(t,e.symbol)})),t}return"dot-density"===e.type||e.type,o}function c(t,e,n,r=new i.bn){let o=0;if("2d"===n.type)o=e*(n.resolution??0);else if("3d"===n.type){const r=n.overlayPixelSizeInMapUnits(t),s=n.basemapSpatialReference;o=null==s||s.equals(n.spatialReference)?e*r:(0,i.cm)(s)/(0,i.cm)(n.spatialReference)}const s=t.x-o,a=t.y-o,l=t.x+o,c=t.y+o,{spatialReference:u}=n;return r.xmin=Math.min(s,l),r.ymin=Math.min(a,c),r.xmax=Math.max(s,l),r.ymax=Math.max(a,c),r.spatialReference=u,r}function u(t,e,n){const i=n.toMap(t);return null!=i&&c(i,l(),n,h).intersects(e)}const h=new i.bn},28911:function(t,e,n){n.d(e,{ControlPointsTransformTool:function(){return gc},TransformTool:function(){return Uc}});var i,r=n(44444),o=n(3930),s=n(70632),a=n(63897),l=n(2518),c=n(63655),u=n(83875),h=n(42070),p=n(81203),d=n(38837),f=(n(72329),n(9794)),g=n(94381),m=n(30726),y=n(7137),_=(n(65332),n(32443)),v=n(17437),b=n(97975);function x(t,e){return t===e||null!=t&&null!=e&&(0,r.a5)(t.spatialReference,e.spatialReference)&&t.x===e.x&&t.y===e.y&&t.z===e.z&&t.m===e.m}function w(t,e,n){return t===e||null!=t&&null!=e&&(0,r.a5)(t.spatialReference,e.spatialReference)&&(0,r.r1)(t.x,e.x,n)&&(0,r.r1)(t.y,e.y,n)&&(0,r.r1)(t.z??0,e.z??0,n)&&(0,r.r1)(t.m??0,e.m??0,n)}function M(t){return"declaredClass"in t}function E(t,e){if(!t)return null;let n;return M(t)?t.clone():(n=(0,o.e)(t.x,t.y,t.z,t.spatialReference),t.hasM&&(n.m=t.m,n.hasM=!0),n)}function T(t,e,n){return S(t,e,n)}function S(t=0,e=0,n=0){return(0,r.aq)(t,e,n)}function P(t,e,n){return(0,r.aq)(t,e,n)}function C(t){const[e,n,i]=t;return t.length>3?[e,n,i,t[3]]:[e,n,i]}function k(t,e,n,i=S()){return i[0]=t.x,i[1]=t.y,i[2]=t.z??0,null==e||("2d"===e.type?i[2]=0:i[2]=(0,s.m)(e,t,n,s.j)??0),i}function R(t,e,{z:n,m:i},r,a){const{spatialReference:l,elevationInfo:c}=r;let u;u=null==n&&null==i?void 0:null==e||"2d"===e.type?n??void 0:(0,s.x)(e,t,l,s.j,c)??0;const[h,p]=t;return a?(0,o.n)(a,h,p,u,l):a=(0,o.e)(h,p,u,l),null!=i&&(a.m=i,a.hasM=!0),a}(function(t){t[t.NONE=0]="NONE",t[t.TARGET=1]="TARGET"})(i||(i={}));let V=class extends r.bw{constructor(){super(...arguments),this.enabled=!0}};(0,r.bt)([(0,r.bu)({type:Boolean})],V.prototype,"enabled",void 0),V=(0,r.bt)([(0,r.bv)("esri.views.interactive.snapping.Settings.DefaultSnappingAlgorithm")],V);let A=class extends r.bw{constructor(t){super(t),this.lineSnapper=new V,this.parallelLineSnapper=new V,this.rightAngleSnapper=new V,this.rightAngleTriangleSnapper=new V,this.shortLineThreshold=15,this.distance=5,this.pointThreshold=1e-6,this.intersectionParallelLineThreshold=1e-6,this.parallelLineThreshold=1e-6,this.verticalLineThresholdMeters=.3,this.touchSensitivityMultiplier=1.5,this.pointOnLineThreshold=1e-6,this.orange=new r.h2([255,127,0]),this.orangeTransparent=new r.h2([255,127,0,.5]),this.lineHintWidthReference=3,this.lineHintWidthTarget=3,this.lineHintFadedExtensions=.3,this.parallelLineHintWidth=2,this.parallelLineHintLength=24,this.parallelLineHintOffset=1.5,this.rightAngleHintSize=24,this.rightAngleHintOutlineSize=1.5,this.satisfiesConstraintScreenThreshold=1}};(0,r.bt)([(0,r.bu)({type:V,constructOnly:!0,nonNullable:!0,json:{write:!0}})],A.prototype,"lineSnapper",void 0),(0,r.bt)([(0,r.bu)({type:V,constructOnly:!0,nonNullable:!0,json:{write:!0}})],A.prototype,"parallelLineSnapper",void 0),(0,r.bt)([(0,r.bu)({type:V,constructOnly:!0,nonNullable:!0,json:{write:!0}})],A.prototype,"rightAngleSnapper",void 0),(0,r.bt)([(0,r.bu)({type:V,constructOnly:!0,nonNullable:!0,json:{write:!0}})],A.prototype,"rightAngleTriangleSnapper",void 0),(0,r.bt)([(0,r.bu)({type:Number,nonNullable:!0,range:{min:-1,max:50,step:1},json:{write:!0}})],A.prototype,"shortLineThreshold",void 0),(0,r.bt)([(0,r.bu)({type:Number,nonNullable:!0,range:{min:-1,max:50,step:1},json:{write:!0}})],A.prototype,"distance",void 0),(0,r.bt)([(0,r.bu)({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],A.prototype,"pointThreshold",void 0),(0,r.bt)([(0,r.bu)({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],A.prototype,"intersectionParallelLineThreshold",void 0),(0,r.bt)([(0,r.bu)({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],A.prototype,"parallelLineThreshold",void 0),(0,r.bt)([(0,r.bu)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],A.prototype,"verticalLineThresholdMeters",void 0),(0,r.bt)([(0,r.bu)({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],A.prototype,"touchSensitivityMultiplier",void 0),(0,r.bt)([(0,r.bu)({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],A.prototype,"pointOnLineThreshold",void 0),(0,r.bt)([(0,r.bu)({type:r.h2,nonNullable:!0})],A.prototype,"orange",void 0),(0,r.bt)([(0,r.bu)({type:r.h2,nonNullable:!0})],A.prototype,"orangeTransparent",void 0),(0,r.bt)([(0,r.bu)({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],A.prototype,"lineHintWidthReference",void 0),(0,r.bt)([(0,r.bu)({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],A.prototype,"lineHintWidthTarget",void 0),(0,r.bt)([(0,r.bu)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],A.prototype,"lineHintFadedExtensions",void 0),(0,r.bt)([(0,r.bu)({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],A.prototype,"parallelLineHintWidth",void 0),(0,r.bt)([(0,r.bu)({type:Number,nonNullable:!0,range:{min:0,max:50},json:{write:!0}})],A.prototype,"parallelLineHintLength",void 0),(0,r.bt)([(0,r.bu)({type:Number,nonNullable:!0,range:{min:0,max:5},json:{write:!0}})],A.prototype,"parallelLineHintOffset",void 0),(0,r.bt)([(0,r.bu)({type:Number,nonNullable:!0,range:{min:0,max:46},json:{write:!0}})],A.prototype,"rightAngleHintSize",void 0),(0,r.bt)([(0,r.bu)({type:Number,nonNullable:!0,range:{min:0,max:6},json:{write:!0}})],A.prototype,"rightAngleHintOutlineSize",void 0),(0,r.bt)([(0,r.bu)({type:Number,nonNullable:!0,range:{min:0,max:5},json:{write:!0}})],A.prototype,"satisfiesConstraintScreenThreshold",void 0),A=(0,r.bt)([(0,r.bv)("esri.views.interactive.snapping.Settings.Defaults")],A);const I=new A;var O;(function(t){t[t.FEATURE=1]="FEATURE",t[t.SELF=2]="SELF",t[t.ALL=3]="ALL"})(O||(O={}));let D=class{constructor(t,e){this.isDraped=t,this.domain=e}},G=class t extends D{constructor(t,e,n=O.ALL){super(e,n),this.intersectionPoint=t}equals(e){return e instanceof t&&(0,r.H)(this.intersectionPoint,e.intersectionPoint)}},L=class t extends D{constructor(t,e,n,i,r=O.ALL,o=!0,s=!0){super(i,r),this.type=t,this.lineStart=e,this.lineEnd=n,this.fadeLeft=o,this.fadeRight=s}equals(e){return e instanceof t&&this.type===e.type&&(0,r.H)(this.lineStart,e.lineStart)&&(0,r.H)(this.lineEnd,e.lineEnd)&&this.fadeLeft===e.fadeLeft&&this.fadeRight===e.fadeRight}get length(){return(0,r.dR)(this.lineStart,this.lineEnd)}},z=class t extends D{constructor(t,e,n,i=O.ALL){super(n,i),this.lineStart=t,this.lineEnd=e}equals(e){return e instanceof t&&(0,r.H)(this.lineStart,e.lineStart)&&(0,r.H)(this.lineEnd,e.lineEnd)}},N=class t extends D{constructor(t,e,n){super(e,n),this.point=t}equals(e){return e instanceof t&&(0,r.H)(this.point,e.point)}},U=class t extends D{constructor(t,e,n,i,r=O.ALL){super(i,r),this.previousVertex=t,this.centerVertex=e,this.nextVertex=n}equals(e){return e instanceof t&&(0,r.H)(this.previousVertex,e.previousVertex)&&(0,r.H)(this.centerVertex,e.centerVertex)&&(0,r.H)(this.nextVertex,e.nextVertex)}},H=class{draw(t,e){const n=F(t),i=this.sortUniqueHints(n),o=[];for(const r of i)r instanceof G&&o.push(this.visualizeIntersectionPoint(r,e)),r instanceof L&&o.push(this.visualizeLine(r,e)),r instanceof z&&o.push(this.visualizeParallelSign(r,e)),r instanceof U&&o.push(this.visualizeRightAngleQuad(r,e)),r instanceof N&&o.push(this.visualizePoint(r,e));return(0,r.gK)(o)}sortUniqueHints(t){return t}};function F(t){const e=[];for(const n of t){let t=!0;for(const i of e)if(n.equals(i)){t=!1;break}t&&e.push(n)}return e}let Z=class extends H{constructor(t){super(),this._graphicsLayer=t,this._symbolPairingsByType=new Map}visualizeIntersectionPoint(t,e){return this._visualizeSnappingIndicator(new r.D({x:t.intersectionPoint[0],y:t.intersectionPoint[1],spatialReference:e.spatialReference}),this._getOrCreateSymbol("intersectionPoint",e.view.effectiveTheme.accentColor))}visualizePoint(t,e){return this._visualizeSnappingIndicator(new r.D({x:t.point[0],y:t.point[1],spatialReference:e.spatialReference}),this._getOrCreateSymbol("point",e.view.effectiveTheme.accentColor))}visualizeLine(t,e){return this._visualizeSnappingIndicator(new r.a_({paths:[[[...t.lineStart],[...t.lineEnd]]],spatialReference:(0,r.aZ)(r.aY,e.spatialReference)}),this._getOrCreateSymbol("line",e.view.effectiveTheme.accentColor))}visualizeParallelSign(t,e){return this._visualizeSnappingIndicator(new r.a_({paths:[[[...t.lineStart],[...t.lineEnd]]],spatialReference:(0,r.aZ)(r.aY,e.spatialReference)}),this._getOrCreateSymbol("parallelSign",e.view.effectiveTheme.accentColor))}visualizeRightAngleQuad(t,e){const n=(0,r.g_)(),i=(0,r.g_)(),o=(0,r.ap)();(0,r.un)(n,t.centerVertex,t.previousVertex),(0,r.un)(i,t.nextVertex,t.previousVertex),(0,r.uo)(o,n,i);const s="rightAngleQuad"+(o[2]<0?45:225);return this._visualizeSnappingIndicator(new r.a_({paths:[[[...t.previousVertex],[...t.centerVertex],[...t.nextVertex]]],spatialReference:(0,r.aZ)(r.aY,e.spatialReference)}),this._getOrCreateSymbol(s,e.view.effectiveTheme.accentColor))}_visualizeSnappingIndicator(t,e){const n=new r.a1({geometry:t,symbol:e});return this._graphicsLayer.add(n),(0,r.bh)((()=>{this._graphicsLayer.remove(n)}))}_getOrCreateSymbol(t,e){const n=this._symbolPairingsByType;return n.get(t)?.color!==e&&n.set(t,{color:e,symbol:B(t,e)}),n.get(t).symbol}};function B(t,e){const n=[...e.toRgb(),255*e.a];switch(t){case"point":return new r.en({outline:{width:.5,color:[0,0,0,1]},size:10,color:e});case"intersectionPoint":return new r.en({outline:new r.el({width:1.5,color:e}),size:15,color:[0,0,0,0]});case"line":return new r.up({data:{type:"CIMSymbolReference",symbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",enable:!0,capStyle:r.qw.Butt,joinStyle:r.qx.Round,miterLimit:10,width:(0,r.kU)(I.lineHintWidthTarget),color:n}]}}});case"parallelSign":return new r.up({data:{type:"CIMSymbolReference",symbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,anchorPoint:{x:0,y:-1,z:0},anchorPointUnits:"Relative",size:5,markerPlacement:{type:"CIMMarkerPlacementOnLine",placePerPart:!0,angleToLine:!0,relativeTo:"LineMiddle"},frame:{xmin:-5,ymin:-1.5,xmax:5,ymax:1.5},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{rings:[[[7,0],[-7,0],[-7,1.5],[7,1.5]]]},symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:n}]}}],scaleSymbolsProportionally:!0,respectFrame:!0},{type:"CIMVectorMarker",enable:!0,anchorPoint:{x:0,y:1,z:0},anchorPointUnits:"Relative",size:5,markerPlacement:{type:"CIMMarkerPlacementOnLine",placePerPart:!0,angleToLine:!0,relativeTo:"LineMiddle"},frame:{xmin:-5,ymin:-1.5,xmax:5,ymax:1.5},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{rings:[[[7,0],[-7,0],[-7,-1.5],[7,-1.5]]]},symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:n}]}}],scaleSymbolsProportionally:!0,respectFrame:!0}]}}});case"rightAngleQuad45":case"rightAngleQuad225":{const i="rightAngleQuad45"===t?45:225;return new r.up({data:{type:"CIMSymbolReference",symbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,anchorPoint:{x:.5,y:.5,z:0},anchorPointUnits:"Relative",size:(0,r.kU)(I.rightAngleHintSize),rotation:i,markerPlacement:{type:"CIMMarkerPlacementOnVertices",placePerPart:!0,angleToLine:!0,placeOnEndPoints:!1},frame:{xmin:-5,ymin:-5,xmax:5,ymax:5},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{paths:[[[5,-5],[-5,-5],[-5,5],[5,5],[5,-5]]]},symbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",enable:!0,capStyle:"Butt",joinStyle:"Round",miterLimit:10,width:(0,r.kU)(I.rightAngleHintOutlineSize),color:n},{type:"CIMSolidFill",enable:!0,color:[...e.toRgb(),255*e.a*.4]}]}}],scaleSymbolsProportionally:!0,respectFrame:!0}]}}})}}}const q=new r.up({data:{type:"CIMSymbolReference",symbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",effects:[{type:"CIMGeometricEffectDashes",dashTemplate:[3.75,3.75],lineDashEnding:"HalfPattern",controlPointEnding:"NoConstraint"}],enable:!0,capStyle:"Butt",joinStyle:"Round",miterLimit:10,width:1.6,color:[255,255,255,255]},{type:"CIMSolidStroke",enable:!0,capStyle:"Butt",joinStyle:"Round",miterLimit:10,width:2,color:[0,0,0,255]}]}}}),Y=new r.en({style:"circle",size:6,color:[127,127,127,1],outline:{color:[50,50,50],width:1}}),X=new r.en({style:"circle",size:6,color:[255,127,0,1],outline:{color:[50,50,50],width:1}});var j,W;(function(t){t[t.NeverApplied=0]="NeverApplied",t[t.Applied=1]="Applied",t[t.Undone=2]="Undone"})(j||(j={})),function(t){t.UndoRedoUpdating="UndoRedoUpdating",t.UndoInvalidError="UndoInvalidError",t.RedoInvalidError="RedoInvalidError",t.ApplyInvalidError="ApplyInvalidError"}(W||(W={}));const $={[W.UndoRedoUpdating]:"Cannot perform operation whilst undo redo is updating",[W.UndoInvalidError]:"There are no items to Undo",[W.RedoInvalidError]:"There are no items to Redo",[W.ApplyInvalidError]:"Cannot apply an item that is already applied"};let Q=class extends Error{constructor(){super($[W.UndoRedoUpdating]),this.type="undo-redo-updating-error"}},K=class extends Error{constructor(){super($[W.UndoInvalidError]),this.type="undo-redo-undo-error"}},J=class extends Error{constructor(){super($[W.RedoInvalidError]),this.type="undo-redo-redo-error"}},tt=class extends Error{constructor(){super($[W.ApplyInvalidError]),this.type="undo-redo-apply-error"}};var et;(function(t){t[t.Apply=0]="Apply",t[t.Undo=1]="Undo",t[t.Redo=2]="Redo"})(et||(et={}));let nt=class extends r.e9{constructor(){super(...arguments),this.name="",this.tag=Symbol(),this.status=j.NeverApplied}get canUndo(){return this.status===j.Applied}get canRedo(){return this.status===j.Undone}async executeUndoRedoOperation(t){switch(t){case et.Apply:if(this.status!==j.NeverApplied)throw new tt;return await this.apply(),void(this.status=j.Applied);case et.Undo:if(this.status!==j.Applied)throw new K;return await this.undo(),void(this.status=j.Undone);case et.Redo:if(this.status!==j.Undone)throw new K;return await this.redo(),void(this.status=j.Applied)}}};(0,r.bt)([(0,r.bu)()],nt.prototype,"name",void 0),(0,r.bt)([(0,r.bu)()],nt.prototype,"tag",void 0),nt=(0,r.bt)([(0,r.bv)("esri.undoredo.UndoableOperation")],nt);let it=class extends r.e9{constructor(){super(...arguments),this._stack=new r.a8,this._stackPosition=-1,this._updatingHandles=new r.f7}get updating(){return this._updatingHandles.updating}get canUndo(){return this.hasUndo&&!this.updating}get hasUndo(){return this._stackPosition>=0}get canRedo(){return this.hasRedo&&!this.updating}get hasRedo(){return this._stackPosition<this._stack.length-1}_truncateForwardStack(){this._stack.splice(this._stackPosition+1,this._stack.length-this._stackPosition).forEach((t=>t.destroy()))}_drainStack(){this._stack.drain((t=>t.destroy())),this._stackPosition=-1}async undo(){if(!this.hasUndo)throw new K;if(this.updating)throw new Q;const t=this._stack.getItemAt(this._stackPosition);t&&await this._updatingHandles.addPromise((async()=>{await t.executeUndoRedoOperation(et.Undo),--this._stackPosition,t.canRedo||this._truncateForwardStack()})())}async redo(){if(!this.hasRedo)throw new J;if(this.updating)throw new Q;const t=this._stack.getItemAt(this._stackPosition+1);if(!t)throw new J;await this._updatingHandles.addPromise((async()=>{await t.executeUndoRedoOperation(et.Redo),++this._stackPosition})())}peekUndo(){if(this.canUndo)return this._stack.getItemAt(this._stackPosition)}peekRedo(){if(this.canRedo)return this._stack.getItemAt(this._stackPosition+1)}async inject(t){if(this.updating)throw new Q;await this._updatingHandles.addPromise((async()=>{t.status===j.NeverApplied&&await t.executeUndoRedoOperation(et.Apply),t.canUndo?(this._stack.splice(this._stackPosition+1,0,t),this._stackPosition++):this._stackPosition>-1&&(this._stack.splice(0,this._stackPosition+1).forEach((t=>t.destroy())),this._stackPosition=-1)})())}async add(t){if(this.updating)throw new Q;await this._updatingHandles.addPromise((async()=>{t.status===j.NeverApplied&&await t.executeUndoRedoOperation(et.Apply),this._stackPosition>=-1&&this._truncateForwardStack(),t.canUndo?(this._stack.push(t),this._stackPosition=this._stack.length-1):this._drainStack()})())}async removeTagged(t,e=!1){if(this.updating&&!e)return;await(0,r.hH)((()=>!this.updating));const n=new r.a8;for(let i=0;i<this._stack.length;i++){const e=this._stack.getItemAt(i);e&&(e.tag===t?(e.destroy(),i===this._stackPosition&&(this._stackPosition=n.length-1)):n.push(e))}this._stack=n,this._stackPosition>n.length-1&&(this._stackPosition=n.length-1)}async clear(t=!1){if(this.updating&&!t)throw new Q;await(0,r.hH)((()=>!this.updating)),this._drainStack()}};function rt(){return(0,r.ur)()}function ot(){return(0,r.uq)()}function st(t,e){const n=[];t=(t=(t=t.replaceAll(/[\u00B0\u00BA]/g,"^")).replaceAll("′","'")).replaceAll("″",'"');const i=ct(e);return r.us.dmsToGeog(i,1,[t],n)?new r.D(n[0][0],n[0][1],r.aY.WGS84):null}function at(t){return t&&rt()?(0,r.ut)(t)??st(`0° 0' 0" N | ${t}`)?.longitude??st(`0 | ${t}`)?.longitude??null:null}function lt(t){return t&&rt()?(0,r.ut)(t)??st(`${t} | 0° 0' 0" E`)?.latitude??st(`${t} | 0`)?.latitude??null:null}function ct(t){let e=null;if(t||(t=r.aY.WGS84),t.wkid){if(e=r.cn.geogcs(t.wkid),!e)throw new r.s("coordinate-formatter:invalid-spatial-reference","wkid is not valid")}else{if(!t.wkt2&&!t.wkt)throw new r.s("coordinate-formatter:invalid-spatial-reference","wkid and wkt are missing");if(e=r.cn.fromString(r.co.PE_TYPE_GEOGCS,t.wkt2||t.wkt),!e)throw new r.s("coordinate-formatter:invalid-spatial-reference","wkt is not valid")}return e}(0,r.bt)([(0,r.bu)()],it.prototype,"_stack",void 0),(0,r.bt)([(0,r.bu)()],it.prototype,"_stackPosition",void 0),(0,r.bt)([(0,r.bu)()],it.prototype,"updating",null),(0,r.bt)([(0,r.bu)({readOnly:!0})],it.prototype,"canUndo",null),(0,r.bt)([(0,r.bu)({readOnly:!0})],it.prototype,"hasUndo",null),(0,r.bt)([(0,r.bu)({readOnly:!0})],it.prototype,"canRedo",null),(0,r.bt)([(0,r.bu)({readOnly:!0})],it.prototype,"hasRedo",null),it=(0,r.bt)([(0,r.bv)("esri.UndoRedo")],it);let ut=class{constructor(){this.committedVertices=null,this.cursorVertex=null,this.full=null,this.outline=null,this.cursorEdge=null,this.circle=null,this.rectangle=null}};var ht;let pt=ht=class extends r.a${constructor(t){super(t),this.center=null,this.geodesic=!1,this.numberOfPoints=60,this.radius=1e3,this.radiusUnit="meters"}initialize(){const t=this.center,e=this.numberOfPoints;if(this.hasZ=t?.hasZ??!1,0!==this.rings.length||!t)return;const n=(0,r.aU)(this.radius,this.radiusUnit,"meters"),i=t.spatialReference;let o,s="geographic";if(i.isWebMercator?s="webMercator":(null!=(i.wkid&&r.kW[i.wkid])||(i.wkt2||i.wkt)&&(0,r.uu)(i.wkt2||i.wkt))&&(s="projected"),this.geodesic){let i;switch(s){case"webMercator":i=(0,r.f4)(t);break;case"projected":console.error("Creating a geodesic circle requires the center to be specified in web mercator or geographic coordinate system");break;case"geographic":i=t}o=this._createGeodesicCircle(i,n,e),"webMercator"===s&&(o=(0,r.f5)(o))}else{let i;"webMercator"===s||"projected"===s?i=n/(0,r.uv)(t.spatialReference):"geographic"===s&&(i=(0,r.uw)(n,"meters",(0,r.iC)(t.spatialReference).radius)),o=this._createPlanarCircle(t,i,e)}this.spatialReference=o.spatialReference,this.addRing(o.rings[0])}clone(){const{center:t,numberOfPoints:e,radius:n,radiusUnit:i,geodesic:r}=this;return new ht({center:t?.clone(),numberOfPoints:e,radius:n,radiusUnit:i,geodesic:r})}_createGeodesicCircle(t,e,n){let i=0;const o=[];for(;i<360;){const s=[0,0],l=[t.x,t.y];(0,a.j)(s,l,i,e,r.aY.WGS84),this.hasZ&&s.push(t.z),o.push(s),i+=360/n}return o.push(o[0]),new r.a$({rings:[o]})}_createPlanarCircle(t,e,n){const i=[],o=2*Math.PI/n;for(let r=0;r<n;++r){const n=o*r,s=[t.x+Math.cos(-n)*e,t.y+Math.sin(-n)*e];this.hasZ&&s.push(t.z),i.push(s)}return i.push(i[0]),new r.a$({spatialReference:t.spatialReference,rings:[i]})}};(0,r.bt)([(0,r.bu)({type:r.D})],pt.prototype,"center",void 0),(0,r.bt)([(0,r.bu)()],pt.prototype,"geodesic",void 0),(0,r.bt)([(0,r.bu)()],pt.prototype,"numberOfPoints",void 0),(0,r.bt)([(0,r.bu)()],pt.prototype,"radius",void 0),(0,r.bt)([(0,r.bu)()],pt.prototype,"radiusUnit",void 0),pt=ht=(0,r.bt)([(0,r.bv)("esri.geometry.Circle")],pt);const dt=pt;function ft(t,e,n=null){return null!=n?[t,e,n]:[t,e]}function gt(t,e,n=null){return null!=n?{x:t,y:e,z:n}:{x:t,y:e}}let mt=class{constructor(t){this.spatialReference=t}mapToLocalMultiple(t){return t.map((t=>this.mapToLocal(t))).filter(r.ci)}get doUnnormalization(){return!1}},yt=class extends mt{constructor(t,e,n=null){super(e),this._defaultZ=n,this.transform=(0,r.rN)(),this.transformInv=(0,r.rN)(),this.transform=(0,r.ux)(t),(0,r.uy)(this.transformInv,this.transform)}makeMapPoint(t,e){return ft(t,e,this._defaultZ)}mapToLocal(t){return gt(this.transform[0]*t[0]+this.transform[2]*t[1]+this.transform[4],this.transform[1]*t[0]+this.transform[3]*t[1]+this.transform[5])}localToMap(t){return ft(this.transformInv[0]*t.x+this.transformInv[2]*t.y+this.transformInv[4],this.transformInv[1]*t.x+this.transformInv[3]*t.y+this.transformInv[5],this._defaultZ)}},_t=class extends mt{constructor(t,e){super(t.spatialReference),this.view=t,this.defaultZ=null,this.pWS=(0,r.ap)(),this.tangentFrameUpWS=(0,r.ap)(),this.tangentFrameRightWS=(0,r.ap)(),this.tangentFrameForwardWS=(0,r.ap)(),this.localFrameRightWS=(0,r.ap)(),this.localFrameUpWS=(0,r.ap)(),this.worldToLocalTransform=(0,u.e)(),this.localToWorldTransform=(0,u.e)(),this.scale=1,this.scale=t.resolution,this.referenceMapPoint=e,this.defaultZ=e.hasZ?e.z:null;const n=t.state.camera.viewRight;this.view.renderCoordsHelper.toRenderCoords(this.referenceMapPoint,this.pWS),this.view.renderCoordsHelper.worldBasisAtPosition(this.pWS,r.dZ.X,this.tangentFrameRightWS),this.view.renderCoordsHelper.worldBasisAtPosition(this.pWS,r.dZ.Y,this.tangentFrameUpWS),this.view.renderCoordsHelper.worldBasisAtPosition(this.pWS,r.dZ.Z,this.tangentFrameForwardWS);const i=(0,r.ap)();(0,r.dC)(i,this.tangentFrameForwardWS,(0,r.al)(n,this.tangentFrameForwardWS)),(0,r.dB)(this.localFrameRightWS,n,i),(0,r.ao)(this.localFrameRightWS,this.localFrameRightWS),(0,r.am)(this.localFrameUpWS,this.tangentFrameForwardWS,this.localFrameRightWS),(0,c.R)(this.worldToLocalTransform,this.localFrameRightWS,this.tangentFrameRightWS),(0,c.L)(this.localToWorldTransform,this.worldToLocalTransform)}get doUnnormalization(){return"global"===this.view.viewingMode}makeMapPoint(t,e){return ft(t,e,this.defaultZ)}mapToLocal(t){const e=(0,r.ap)();this.view.renderCoordsHelper.toRenderCoords(new r.D({x:t[0],y:t[1],spatialReference:this.spatialReference}),e),(0,r.h8)(e,e,this.worldToLocalTransform);const n=this.view.renderCoordsHelper.fromRenderCoords(e,new r.D({spatialReference:this.view.spatialReference}));return null!=n?gt(n.x/this.scale,n.y/this.scale):null}localToMap(t){const e=(0,r.ap)();this.view.renderCoordsHelper.toRenderCoords(new r.D({x:t.x*this.scale,y:t.y*this.scale,spatialReference:this.spatialReference}),e),(0,r.h8)(e,e,this.localToWorldTransform);const n=this.view.renderCoordsHelper.fromRenderCoords(e,new r.D({spatialReference:this.view.spatialReference}));return null!=n?ft(n.x,n.y,this.defaultZ):null}};function vt(t,e){if("2d"===t.type)return new yt(t.state.transform,t.spatialReference,e.length>2?e[2]:null);if("3d"===t.type){const n=e.length>2?new r.D({x:e[0],y:e[1],z:e[2],spatialReference:t.spatialReference}):new r.D({x:e[0],y:e[1],spatialReference:t.spatialReference});return new _t(t,n)}return null}function bt(t,e){const n=new r.D({x:t[0],y:t[1],spatialReference:e});return t.length>2&&(n.z=t[2]),n}function xt(t,e){return new r.bU({points:t,spatialReference:e})}function wt(t,e,n){const i=new r.a_({paths:t,spatialReference:e});return n&&(0,r.uz)(i),i}function Mt(t,e,n,i=!0){const o=(0,r.T)(t);o.forEach((t=>{const e=t[0],n=t[t.length-1];(0,r.c)(e,n)&&1!==t.length||t.push(t[0])}));let s=new r.a$({rings:o,spatialReference:e});return s.rings.forEach((t=>{(0,r.lU)(t)||t.reverse()})),n&&(0,r.uz)(s),i&&s.isSelfIntersecting&&(0,r.du)(e)&&(s=(0,l.simplify)(s)),s}function Et(t,e,n){const i=e.mapToLocalMultiple(t),o=[],s={x:i[0].x,y:i[0].y},a={x:i[1].x,y:i[1].y},l=Math.round(a.x-s.x),c=Math.round(a.y-s.y),u=Math.max(Math.abs(l),Math.abs(c));if(n){const t={x:s.x+u,y:s.y+u},e={x:s.x-u,y:s.y-u};o.push(gt(t.x,e.y),gt(e.x,e.y),gt(e.x,t.y),gt(t.x,t.y))}else{const t={x:l>0?s.x+u:s.x-u,y:c>0?s.y+u:s.y-u};o.push(gt(s.x,s.y),gt(t.x,s.y),gt(t.x,t.y),gt(s.x,t.y))}return St(Mt([o.map((t=>e.localToMap(t))).filter(r.ci)],e.spatialReference,e.doUnnormalization,!0),o,e)}function Tt(t,e,n){let i=e.mapToLocalMultiple(t);if(1===i.length){const t=i[0];i=[gt(t.x-48,t.y+48),gt(t.x+48,t.y-48),gt(t.x+48,t.y-48),gt(t.x-48,t.y+48)]}const o=[],s={x:i[0].x,y:i[0].y},a={x:i[1].x,y:i[1].y};if(n){const t=Math.round(a.x-s.x),e=Math.round(a.y-s.y);o.push(gt(s.x-t,s.y-e),gt(a.x,s.y-e),gt(a.x,a.y),gt(s.x-t,a.y))}else o.push(gt(s.x,s.y),gt(a.x,s.y),gt(a.x,a.y),gt(s.x,a.y));return St(Mt([o.map((t=>e.localToMap(t))).filter(r.ci)],e.spatialReference,e.doUnnormalization,!0),o,e)}function St(t,e,n){const i=Pt(e[3],e[2],n),r=Pt(e[1],e[2],n),o=Pt(e[0],e[1],n),s=Pt(e[0],e[3],n);return{geometry:t,midpoints:null!=i&&null!=r&&null!=o&&null!=s?{top:i,right:r,bottom:o,left:s}:null}}function Pt(t,e,n){kt[0]=t.x,kt[1]=t.y,kt[2]=0,Rt[0]=e.x,Rt[1]=e.y,Rt[2]=0,(0,r.iX)(kt,kt,Rt,.5),Ct.x=kt[0],Ct.y=Rt[1],Ct.z=Rt[2];const i=n.localToMap(Ct);return null!=i?bt(i,n.spatialReference):null}const Ct=gt(0,0,0),kt=(0,r.ap)(),Rt=(0,r.ap)();function Vt(t,e,n,i){const o=e.mapToLocalMultiple(t);let s=null,a=null;if(n)s=o[0],a=o[1];else{const t=o[0],e=o[1],n=Math.round(e.x-t.x),i=Math.round(e.y-t.y),r=Math.max(Math.abs(n),Math.abs(i));s=gt(n>0?t.x+r/2:t.x-r/2,i>0?t.y+r/2:t.y-r/2),a=gt(Math.abs(n)>Math.abs(i)?s.x-r/2:s.x,Math.abs(n)>Math.abs(i)?s.y:s.y-r/2)}const c=e.localToMap(s),u=e.localToMap(a);if(null==c||null==u)return null;e.doUnnormalization&&(0,r.uA)([[c,u]],e.spatialReference);const h=bt(c,e.spatialReference),p=bt(u,e.spatialReference),d=(0,r.cm)(e.spatialReference);let f=0;if((0,r.du)(e.spatialReference))f=d*(0,l.distance)(h,p,null);else{const t=s.x-a.x,e=s.y-a.y;f=d*Math.sqrt(t*t+e*e)*1}const g=new dt({center:h,radius:f,radiusUnit:"meters",spatialReference:e.spatialReference});return{geometry:Mt(g.rings,g.spatialReference,!1),center:h,edge:p}}function At(t,e,n){const i=e.mapToLocalMultiple(t),o=i[0],s=i[1],a=Math.round(s.x-o.x),l=Math.round(s.y-o.y),c=gt(n?o.x:o.x+a/2,n?o.y:o.y+l/2),u=n?a:a/2,h=n?l:l/2,p=60,d=[],f=2*Math.PI/p;function g(t){const e=Math.cos(t),n=Math.sin(t);return gt(u*e+c.x,h*n+c.y)}for(let r=0;r<p;r++)d.push(g(r*f));d.push(d[0]);const{spatialReference:m,doUnnormalization:y}=e,_=Mt([d.map((t=>e.localToMap(t))).filter(r.ci)],m,y,!1),v=e.localToMap(g(Math.PI/2)),b=e.localToMap(g(0)),x=e.localToMap(g(-Math.PI/2)),w=e.localToMap(g(Math.PI));return{geometry:_,midpoints:null!=v&&null!=b&&null!=x&&null!=w?{top:bt(v,m),right:bt(b,m),bottom:bt(x,m),left:bt(w,m)}:null}}function It(t,e){switch(t){case"point":case"multipoint":return Ot();case"polyline":return Dt(e);case"polygon":return Gt(e);default:return}}function Ot(t){return"point"}function Dt(t){return(null!=t&&"polyline"===t.type&&t.paths.length?t.paths[0].length:0)<2?"polylineZeroVertices":"polylineOneVertex"}function Gt(t){const e=null!=t&&"polygon"===t.type&&t.rings.length?t.rings[0].length:0;return e<3?"polylineZeroVertices":e<4?"polygonOneVertex":"polygonTwoVertices"}function Lt(t,e){const n=t?.geometry;if(!t||"mesh"!==n?.type||!e)return;const{renderCoordsHelper:i,elevationProvider:o}=e,{camera:a}=e.state,{extent:l}=n,{center:c,spatialReference:u}=l,h=(0,r.cm)(u),p=(0,r.mG)(u),d=(0,r.cm)(i.spatialReference),f=l.width*h,g=l.height*p,m=(l.zmax??0)*p,y=m-(l.zmin??0)*p,_=Math.max(f,g,y)/d,{x:v,y:b}=c,x=c.z??0;(0,r.dQ)(Ht,v,b,x),i.toRenderCoords(Ht,u,Ht);const w=_/a.computeScreenPixelSizeAt(Ht);if(w>a.width*Nt)return"meshTooClose";if(w<zt)return"meshTooFar";const M=(0,s.a)(t),{absoluteZ:E}=(0,s.b)(v,b,m,u,e,M);return E<(o.getElevation(v,b,x,u,"ground")??0)*p+y*Ut?"meshUnderground":"mesh"}const zt=20,Nt=1,Ut=.1,Ht=(0,r.ap)();function Ft(t,e){return t[0]*e[1]-t[1]*e[0]}function Zt(t,e){const n=t.start,i=t.end,o=e.start,s=e.end,a=(0,r.un)(Xt,i,n),l=(0,r.un)(jt,s,o),c=Ft(a,l);if(Math.abs(c)<=Yt)return[];const u=(0,r.un)(Wt,n,o),h=Ft(l,u)/c,p=Ft(a,u)/c;if(h>=0){if(p>=0||e.type===qt.LINE)return[(0,r.uB)($t,n,a,h)]}else if(t.type===qt.LINE&&(p>=0||e.type===qt.LINE))return[(0,r.uB)($t,n,a,h)];return[]}function Bt(t,e,n){const i=[],o=(0,r.un)(Xt,t.end,t.start),s=(0,r.un)(jt,t.start,e),a=(0,r.uC)(o),l=2*(0,r.uD)(o,s),c=l*l-4*a*((0,r.uC)(s)-n*n);if(0===c){const e=-l/(2*a);(t.type===qt.LINE||e>=0)&&i.push((0,r.uB)($t,t.start,o,e))}else if(c>0){const e=Math.sqrt(c),n=(-l+e)/(2*a);(t.type===qt.LINE||n>=0)&&i.push((0,r.uB)($t,t.start,o,n));const s=(-l-e)/(2*a);(t.type===qt.LINE||s>=0)&&i.push((0,r.uB)(Wt,t.start,o,s))}return i}var qt;(function(t){t[t.RAY=0]="RAY",t[t.LINE=1]="LINE"})(qt||(qt={}));const Yt=1e-6,Xt=(0,r.g_)(),jt=(0,r.g_)(),Wt=(0,r.g_)(),$t=(0,r.g_)();function Qt({start:t,end:e,type:n},i,o){const s=[],a=(0,r.un)(me,e,t),l=(0,r.un)(ye,t,i),c=(0,r.uC)(a),u=2*(0,r.uD)(a,l),h=u*u-4*c*((0,r.uC)(l)-o*o);if(0===h){const e=-u/(2*c);(n===fe.PLANE||e>=0)&&s.push((0,r.uB)((0,r.g_)(),t,a,e))}else if(h>0){const e=Math.sqrt(h),i=(-u+e)/(2*c);(n===fe.PLANE||i>=0)&&s.push((0,r.uB)((0,r.g_)(),t,a,i));const o=(-u-e)/(2*c);(n===fe.PLANE||o>=0)&&s.push((0,r.uB)((0,r.g_)(),t,a,o))}return s}function Kt(t,e){const n=t.start,i=t.end,o=(0,r.un)(me,i,n),s=(0,r.dQ)(ve,-o[1],o[0],0),a=e.start,l=e.end,c=(0,r.ew)(be,l,a),u=(0,r.al)(c,s),h=(0,r.dQ)(xe,n[0],n[1],0),p=(0,r.ew)(we,h,a),d=(0,r.al)(p,s),f=(0,r.a9)();if(Math.abs(u)<f)return[];const g=(0,r.h9)(Me,a,c,d/u);if(e.type===qt.RAY){const t=(0,r.ew)(Ee,g,a);if((0,r.al)(t,c)<-f)return[]}if(t.type===fe.HALF_PLANE){const t=(0,r.ne)(ye,g,n);if((0,r.uD)(t,o)<-f)return[]}return[(0,r.dA)(g)]}function Jt(t,e){return ae(ce(Se,e[2],t),e)}function te(t,e){return se(ce(Se,0,t),ce(Pe,0,e)).map((([t,e])=>(0,r.o5)(t,e)))}function ee(t,e,n){return ie(t,ce(Se,t[2],e),n)}function ne(t,e,n,i=(0,r.ap)()){const o=(0,r.un)(me,t,e),s=(0,r.uE)(o);return(0,r.uB)(i,e,o,0===s?1:n/s),i[2]=t[2],i}function ie(t,{start:e,end:n,type:i},o=(0,r.ap)()){const s=(0,r.ew)(_e,t,e),a=(0,r.ew)(ve,n,e),l=(0,r.al)(s,a)/(0,r.al)(a,a);return(0,r.h9)(o,e,a,i===qt.RAY?Math.max(l,0):l)}const re=(()=>{const t=(0,r.ap)(),e=(0,r.ap)(),n=(0,r.ap)();return({start:i,end:o},{center:s,radius:a,normal:l,slicePlane:c})=>{const u=(0,p.l)(s,l,Te);if(he((0,p.Q)(u,i),0)&&he((0,p.Q)(u,o),0)){(0,p.d)(l,t,e);const u=(i,o)=>((0,r.dB)(n,o,s),(0,r.gV)(i,(0,r.al)(n,t),(0,r.al)(n,e)),i),h=Bt({start:u(me,i),end:u(ye,o),type:qt.LINE},r.cB,a),d=[];for(const[n,i]of h){const o=(0,r.dF)((0,r.ap)(),s);(0,r.h9)(o,o,t,n),(0,r.h9)(o,o,e,i),c&&!de(c,o)||d.push(o)}return d}const h=(0,r.ap)();return(0,p.k)(u,i,o,h)?!he((0,r.dR)(h,s),a)||c&&!de(c,h)?[]:[h]:[]}})();function oe({start:t,end:e,type:n},i,o){const s=[],a=(0,r.dB)(_e,e,t),l=(0,r.un)(ye,t,i),c=(0,r.uC)(a),u=2*(0,r.uD)(a,l),h=u*u-4*c*((0,r.uC)(l)-o*o);if(0===h){const e=-u/(2*c);(n===qt.LINE||e>=0)&&s.push((0,r.h9)((0,r.ap)(),t,a,e))}else if(h>0){const e=Math.sqrt(h),i=(-u+e)/(2*c);(n===qt.LINE||i>=0)&&s.push((0,r.h9)((0,r.ap)(),t,a,i));const o=(-u-e)/(2*c);(n===qt.LINE||o>=0)&&s.push((0,r.h9)((0,r.ap)(),t,a,o))}return s}function se(t,e){const n=t.start,i=t.end,o=e.start,s=e.end,a=(0,r.ew)(_e,i,n),l=(0,r.ew)(ve,s,o),c=(0,r.ew)(be,o,n),u=(0,r.am)(xe,a,l);if(!he((0,r.al)(c,u),0))return[];const h=(0,r.iw)(u);if(he(h,0))return[];const p=(0,r.am)(we,c,l),d=(0,r.al)(p,u)/h,f=(0,r.h9)(Me,n,a,d);if(t.type===qt.RAY){const t=(0,r.ew)(Ee,f,n);if((0,r.al)(a,t)<-(0,r.a9)())return[]}if(e.type===qt.RAY){const t=(0,r.ew)(Ee,f,o);if((0,r.al)(l,t)<-(0,r.a9)())return[]}return[(0,r.dA)(f)]}function ae({start:t,end:e,type:n},i){const o=(0,r.ew)(_e,i,t),s=(0,r.ew)(ve,e,t),a=(0,r.am)(be,s,o),l=(0,r.iw)(a)/(0,r.iw)(s),c=(0,r.a9)();if(l<c)switch(n){case qt.LINE:return[(0,r.dA)(i)];case qt.RAY:return(0,r.al)(s,o)<-c?[]:[(0,r.dA)(i)]}return[]}function le(t,e,n,i){const[o,s]=t,[a,l]=n,c=a-o,u=l-s,h=c*c+u*u,p=Math.sqrt(h);if(p>e+i)return[];if(p<Math.abs(e-i))return[];if(he(p,0)&&he(e,i))return[];const d=(e*e-i*i+h)/(2*p),f=Math.sqrt(e*e-d*d),g=f*u/p,m=f*c/p,[y,_]=(0,r.o4)(me,t,n,d/p);return he(g,m)?[(0,r.o5)(y,_)]:[(0,r.o5)(y+g,_-m),(0,r.o5)(y-g,_+m)]}function ce(t,e,{start:n,end:i,type:o}){return(0,r.dQ)(t.start,n[0],n[1],e),(0,r.dQ)(t.end,i[0],i[1],e),t.type=ge[o],t}function ue(t,e){return he(t[2],e[2])}function he(t,e){return(0,r.r1)(Math.abs(t-e),0,(0,r.a9)())}function pe(t,e){return e.filter((e=>de(t,e)))}function de(t,e){return(0,p.z)(t,e)}var fe;(function(t){t[t.PLANE=0]="PLANE",t[t.HALF_PLANE=1]="HALF_PLANE"})(fe||(fe={}));const ge={[fe.PLANE]:qt.LINE,[fe.HALF_PLANE]:qt.RAY},me=(0,r.g_)(),ye=(0,r.g_)(),_e=(0,r.ap)(),ve=(0,r.ap)(),be=(0,r.ap)(),xe=(0,r.ap)(),we=(0,r.ap)(),Me=(0,r.ap)(),Ee=(0,r.ap)(),Te=(0,p.M)(),Se={start:(0,r.ap)(),end:(0,r.ap)(),type:qt.LINE},Pe={start:(0,r.ap)(),end:(0,r.ap)(),type:qt.LINE};class Ce{intersect(t){return nn(this,t)}closestPoints(t){return[this.closestTo(t)]}}class ke extends Ce{constructor(t){super(),this.point=t}equals(t){return this===t||Tn(t)&&(0,r.H)(this.point,t.point)}closestTo(){return C(this.point)}}class Re extends Ce{constructor(t,e,n){super(),this.start=t,this.end=e,this.lineLike={start:t,end:e,type:n}}equals(t){return this===t||Sn(t)&&this.lineLike.type===t.lineLike.type&&(0,r.H)(this.start,t.start)&&(0,r.H)(this.end,t.end)}closestTo(t){const e=S();return ie(t,this.lineLike,e),e}}class Ve extends Re{constructor(t,e){super(t,e,qt.LINE)}}class Ae extends Re{constructor(t,e){super(t,e,qt.RAY)}}class Ie extends Ce{constructor(t){super(),this.constraints=t}equals(t){return this===t||En(t)&&(0,r.c)(this.constraints,t.constraints,((t,e)=>t.equals(e)))}closestTo(t){let e,n=1/0;for(const i of this.constraints){const o=i.closestTo(t),s=(0,r.iY)(t,o);s<n&&(n=s,e=o)}return C(e??t)}closestPoints(t){return this.constraints.flatMap((e=>e===this?[]:e.closestPoints(t)))}}class Oe extends Ce{constructor(t,e){super(),this.center=t,this.radius=e}equals(t){return this===t||kn(t)&&this.center[0]===t.center[0]&&this.center[1]===t.center[1]&&this.radius===t.radius}closestTo(t){const e=S();return ne(t,this.center,this.radius,e),e}}class De extends Ce{constructor(t,e){super(),this.center=t,this.radius=e}equals(t){return this===t||Rn(t)&&(0,r.H)(this.center,t.center)&&this.radius===t.radius}closestTo(t){const e=S();return ne(t,this.center,this.radius,e),e[2]=this.center[2],e}asCircle(){return new Ge(C(this.center),this.radius,P(0,0,1))}}class Ge extends Ce{constructor(t,e,n,i=void 0){super(),this.center=t,this.radius=e,this.normal=n,this.slicePlane=i}equals(t){return this===t||Vn(t)&&(0,r.H)(this.center,t.center)&&(0,r.H)(this.normal,t.normal)&&this.radius===t.radius}closestTo(t){const{center:e,radius:n}=this;(0,p.H)(this.getPlane(ze),t,Le);const i=(0,r.ew)(Le,Le,e),o=(0,r.dD)(i);if(he(o,0))return C(t);const s=n/Math.sqrt(o),a=S();(0,r.h9)(a,e,i,s);const{slicePlane:l}=this;return l&&!de(l,a)?an(l,this)?.closestTo(t)??C(t):a}getPlane(t=(0,p.M)()){return(0,p.l)(this.center,this.normal,t)}}const Le=(0,r.ap)(),ze=(0,p.M)();class Ne extends Ce{constructor(t){super(),this.z=t}equals(t){return this===t||Pn(t)&&this.z===t.z}closestTo(t){return P(t[0],t[1],this.z)}getPlane(t=(0,p.M)()){return(0,r.dQ)(Ue,0,0,this.z),(0,p.l)(Ue,r.fz,t)}}const Ue=(0,r.ap)();class He extends Ce{constructor(t,e,n){super(),this.start=t,this.end=e,this.planeLike={start:t,end:e,type:n}}equals(t){return this===t||Cn(t)&&this.planeLike.type===t.planeLike.type&&(0,r.H)(this.start,t.start)&&(0,r.H)(this.end,t.end)}closestTo(t){const e=S();return ee(t,this.planeLike,e),e}closestEndTo(t){const{start:e,end:n}=this.planeLike;return Math.sign((0,r.uD)((0,r.un)(Fe,n,e),(0,r.un)(Ze,t,e)))>0?this.end:this.start}getPlane(t=(0,p.M)()){const e=(0,r.dF)(Be,this.end);return e[2]+=1,(0,p.p)(this.start,this.end,e,t)}getSlicePlane(t=(0,p.M)()){const{start:e,end:n,type:i}=this.planeLike;if(i===fe.PLANE)return;const o=(0,r.dQ)(Be,e[0],e[1],0),s=(0,r.dQ)(qe,n[0],n[1],0),a=(0,r.dB)(qe,s,o);return(0,p.l)(o,a,t),t}}const Fe=(0,r.g_)(),Ze=(0,r.g_)(),Be=(0,r.ap)(),qe=(0,r.ap)();class Ye extends He{constructor(t,e){super(t,e,fe.HALF_PLANE)}}class Xe extends Ce{constructor(t,e){super(),this.sphere=(0,d.O)(t,e)}equals(t){return this===t||An(t)&&(0,d._)(this.sphere,t.sphere)}closestTo(t){const e=S();return(0,d.$)(this.sphere,t,e),e}get center(){return(0,d.U)(this.sphere)}get radius(){return this.sphere[3]}}class je extends Ce{constructor(t,e,n){super(),this.start=t,this.end=e,this.getZ=n,this.planeLike={start:t,end:e,type:fe.PLANE}}equals(t){return this===t||In(t)&&(0,r.H)(this.start,t.start)&&(0,r.H)(this.end,t.end)&&this.getZ===t.getZ}closestTo(t){return en(this,t)}addIfOnTheGround(t,e){for(const n of e){const e=this.getZ(n[0],n[1])??0;he(n[2],e)&&(n[2]=e,t.push(n))}}}class We extends Ce{constructor(t,e,n){super(),this._x=t,this._y=e,this._z=n}equals(t){return this===t||Dn(t)&&this._x===t._x&&this._y===t._y&&this._z===t._z}closestTo([t,e,n]){return T(this._x??t,this._y??e,this._z??n)}}class $e extends Ce{constructor(t,e,n,i,r){super(),this._origin=t,this._spatialReference=e,this._distanceMeters=n,this._z=i,this._directionDegrees=r}equals(t){return this===t||On(t)&&(0,r.uH)(this._origin,t._origin)&&this._spatialReference===t._spatialReference&&this._distanceMeters===t._distanceMeters&&this._z===t._z&&this._directionDegrees===t._directionDegrees}closestTo([t,e,n]){return(0,r.gV)(Qe,t,e),(0,r.uH)(Qe,this._origin)||this._applyDirectionAndDistance(Qe),T(Qe[0],Qe[1],this._z??n)}_applyDirectionAndDistance(t){if(null!=this._directionDegrees&&null!=this._distanceMeters)(0,a.j)(t,this._origin,this._directionDegrees,this._distanceMeters,this._spatialReference);else if(null!=this._directionDegrees)Je(t,this._origin,this._directionDegrees,t,this._spatialReference);else if(null!=this._distanceMeters){const{azimuth:e}=(0,a.q)(Ke,this._origin,t,this._spatialReference);(0,a.j)(t,this._origin,e??0,this._distanceMeters,this._spatialReference)}}}const Qe=[0,0],Ke=new a.b;function Je(t,e,n,i,o){let{azimuth:s,distance:l}=(0,a.q)(tn,e,i,o);s??=0;let c=l*Math.cos((s-n)*r.aV);c=Math.max(0,c),(0,a.j)(t,e,n,c,o)}const tn=new a.b;function en(t,e){const n=S();return ee(e,t.planeLike,n),n[2]=t.getZ(n[0],n[1])??Gn,n}function nn(t,e){if(En(t)){const n=[];for(const i of t.constraints){const t=i.intersect(e);t&&n.push(t)}return Mn(n)}if(En(e))return nn(e,t);if(In(t))return vn(t,e);if(In(e))return vn(e,t);if(Tn(t)){const{point:n}=t;if(Tn(e))return(0,r.H)(n,e.point)?t:void 0;const i=e.closestTo(n);return(0,r.uF)(i,n)?t:void 0}if(Sn(t)){if(Tn(e))return nn(e,t);if(Sn(e))return xn(se(t.lineLike,e.lineLike));if(Pn(e))return rn(t,e);if(Cn(e))return xn(Kt(e.planeLike,t.lineLike));if(kn(e))return xn(oe(t.lineLike,e.center,e.radius));if(Vn(e))return xn(re(t.lineLike,e));if(Rn(e))return on(t,e);if(An(e))return sn(t,e)}else if(Pn(t)){if(Tn(e)||Sn(e))return nn(e,t);if(Pn(e))return ln(t,e);if(Cn(e))return cn(t,e);if(kn(e))return un(t,e);if(Vn(e))return pn(t,e);if(Rn(e))return hn(t,e);if(An(e))return dn(t,e)}else if(Cn(t)){if(Tn(e)||Sn(e)||Pn(e))return nn(e,t);if(Cn(e))return bn(te(t.planeLike,e.planeLike));if(kn(e))return bn(Qt(t.planeLike,e.center,e.radius));if(Vn(e))return gn(t,e);if(Rn(e))return fn(t,e);if(An(e))return mn(t,e)}else if(kn(t)){if(Tn(e)||Sn(e)||Pn(e)||Cn(e))return nn(e,t);if(kn(e))return bn(le(t.center,t.radius,e.center,e.radius));if(Vn(e))return;if(Rn(e))return yn(t,e);if(An(e))return}else if(Vn(t)){if(Tn(e)||Sn(e)||Pn(e)||Cn(e)||kn(e))return nn(e,t);if(Vn(e))return;if(Rn(e))return void e.asCircle();if(An(e))return}else if(Rn(t)){if(Tn(e)||Sn(e)||Pn(e)||Cn(e)||kn(e)||Vn(e))return nn(e,t);if(Rn(e))return _n(e,t);if(An(e))return}else if(An(t)){if(Tn(e)||Sn(e)||Pn(e)||Cn(e)||kn(e)||Rn(e))return nn(e,t);if(An(e))return}}const rn=(()=>{const t=(0,p.M)();return(e,n)=>{const{start:i,end:r}=e;if(ue(i,r)&&he(i[2],n.z))return e;const o=S();return(0,p.k)(n.getPlane(t),i,r,o)?new ke(o):void 0}})();function on({lineLike:t},{center:e,radius:n}){const i=e[2];return xn(oe(t,e,n).filter((t=>he(t[2],i))))}function sn({lineLike:t},{sphere:e}){return xn((0,d.I)(e,t.start,t.end))}const an=(()=>{const t=(0,r.iB)(),e=(0,r.ap)(),n=(0,r.ap)();return(i,o,s)=>{const{normal:a,center:l,radius:c}=o;(0,p.d)(a,e,n);const u=(0,p.O)(i),h=c*(0,r.al)(u,e),d=c*(0,r.al)(u,n);(0,r.ab)(t,l[0],l[1],l[2],1);const f=(0,r.ae)(i,t),g=Math.hypot(h,d),m=he(g,0);if(he((0,p.Q)(i,l),0)){if(m)return o;if(he(c,0))return!s||de(s,l)?new ke(C(l)):void 0;(0,r.am)(e,u,a),(0,r.ao)(e,e);const t=new Array,n=(0,r.dA)(l);(0,r.h9)(n,n,e,c),s&&!de(s,n)||t.push(n);const i=(0,r.dA)(l);return(0,r.h9)(i,i,e,-c),s&&!de(s,i)||t.push(i),xn(t)}if(m)return;const y=-f/g;if(Math.abs(y)>1||he(y,1))return;const _=Math.atan(h/d),v=(0,r.kC)(y)-_,b=Math.PI-v,x=new Array,w=(0,r.ap)();(0,r.h9)(w,l,e,c*Math.cos(v)),(0,r.h9)(w,w,n,c*Math.sin(v)),x.push(w);const M=(0,r.ap)();return(0,r.h9)(M,l,e,c*Math.cos(b)),(0,r.h9)(M,M,n,c*Math.sin(b)),x.push(M),xn(s?pe(s,x):x)}})();function ln(t,e){return he(t.z,e.z)?t:void 0}function cn({z:t},{planeLike:e}){const[n,i]=e.start,[r,o]=e.end,s=P(n,i,t),a=P(r,o,t);return e.type===fe.PLANE?new Ve(s,a):new Ae(s,a)}function un(t,e){const[n,i]=e.center;return new De(P(n,i,t.z),e.radius)}function hn(t,e){return he(e.center[2],t.z)?e:void 0}const pn=(()=>{const t=(0,p.M)();return(e,n)=>an(e.getPlane(t),n,n.slicePlane)})();function dn(t,{center:e,radius:n}){const i=Math.abs(e[2]-t.z);if(i>n&&!he(i,n))return;const r=P(e[0],e[1],t.z),o=Math.sqrt(n**2-i**2);return he(o,0)?void 0:new De(r,o)}const fn=(()=>{const t=(0,p.M)();return(e,{center:n,radius:i})=>{const r=Qt(e.planeLike,n,i),o=n[2];e.getSlicePlane(t);const s=new Array;for(const[a,l]of r){const e=[a,l,o];de(t,e)&&s.push(e)}return xn(s)}})(),gn=(()=>{const t=(0,p.M)(),e=(0,p.M)();return(n,i)=>an(n.getPlane(t),i,n.getSlicePlane(e))})(),mn=(()=>{const t=(0,p.M)();return(e,{center:n,radius:i})=>{const o=e.getPlane(t),s=(0,p.V)(o,n),a=Math.abs(s);if(a>i&&!he(a,i))return;const l=Math.sqrt(i**2-s**2);if(he(l,0)){const t=S();return(0,p.H)(o,n,t),new ke(t)}const c=S(),u=(0,r.dA)((0,p.O)(o));return(0,r.h9)(c,n,u,s),new Ge(c,l,u,e.getSlicePlane())}})();function yn(t,e){const n=(0,r.uG)(t.center,e.center);return he(n,0)&&he(t.radius,e.radius)?e:wn(le(t.center,t.radius,e.center,e.radius),e.center[2])}function _n(t,e){if(!ue(t.center,e.center))return;const n=(0,r.uG)(t.center,e.center);return he(n,0)&&he(t.radius,e.radius)?t:wn(le(t.center,t.radius,e.center,e.radius),t.center[2])}function vn(t,e){const{planeLike:n,getZ:i}=t,o=new Array;if(Tn(e))t.addIfOnTheGround(o,Jt(n,e.point));else if(Sn(e))t.addIfOnTheGround(o,Kt(n,e.lineLike));else if(kn(e))for(const[s,a]of Qt(n,e.center,e.radius)){const t=i(s,a);null!=t&&o.push((0,r.aq)(s,a,t))}else if(Cn(e)||In(e))for(const[s,a]of te(n,e.planeLike)){const t=i(s,a)??Gn;o.push((0,r.aq)(s,a,t))}return xn(o)}function bn(t){return Mn(t.map((([t,e])=>{const n=P(t,e,0),i=P(t,e,1);return new Ve(n,i)})))}function xn(t){return Mn(t.map((t=>t?new ke(t):void 0)))}function wn(t,e){return xn(t.map((([t,n])=>[t,n,e])))}function Mn(t){if(0!==t.length)return 1===t.length?t[0]??void 0:new Ie(t.filter(r.ci))}function En(t){return t instanceof Ie}function Tn(t){return t instanceof ke}function Sn(t){return t instanceof Re}function Pn(t){return t instanceof Ne}function Cn(t){return t instanceof He}function kn(t){return t instanceof Oe}function Rn(t){return t instanceof De}function Vn(t){return t instanceof Ge}function An(t){return t instanceof Xe}function In(t){return t instanceof je}function On(t){return t instanceof $e}function Dn(t){return t instanceof We}const Gn=0;var Ln;function zn(t,e){if(null==t||null==e)return;const n=Nn(t,e);return null!=n?(0,h.o)(n,"radians","geographic"):void 0}(function(t){t.Absolute="absolute",t.Relative="relative",t.RelativeBilateral="relative-bilateral"})(Ln||(Ln={}));const Nn=(()=>{const t=(0,r.ap)(),e=(0,r.ap)();return(n,i)=>((0,r.dQ)(t,n.x,n.y,n.z??0),(0,r.dQ)(e,i.x,i.y,i.z??0),Un(t,e,n.spatialReference,i.spatialReference))})(),Un=(()=>{const t=(0,r.g_)(),e=(0,r.ap)(),n=(0,r.ap)();return(i,s,l,c)=>{if((0,r.H)(i,s))return;const u=(0,a.N)(l),h=(0,a.N)(c);if(u&&h&&(0,r.a5)(u,h)&&(0,o.a)(i,l,e,u)&&(0,o.a)(s,c,n,h)){const{azimuth:t}=(0,a.q)(jn,e,n,u);return null!=t?(0,r.aU)(t,"degrees","radians"):void 0}t[0]=s[0]-i[0],t[1]=s[1]-i[1];let p=(0,r.uJ)(r.uK,t);return t[0]<0&&(p=Wn-p),p}})();function Hn(t,e,n,i=Ln.Absolute){if(e&&n)switch(i){case Ln.Absolute:return zn(e,n);case Ln.Relative:return Zn(Fn(t,e,n),Ln.Relative);case Ln.RelativeBilateral:return Zn(Fn(t,e,n),Ln.RelativeBilateral)}}function Fn(t,e,n){if(!t||!e||!n)return;const i=Nn(t,e),r=Nn(e,n);return null!=i&&null!=r?(0,h.o)(r-i,"radians","geographic"):void 0}function Zn(t,e){if(null!=t)switch(e){case Ln.Absolute:return Bn(t);case Ln.Relative:{const e=Yn(t);let n=Qn.normalize(e,0,!0);return-180===n&&(n=180),(0,h.o)(n,"degrees","geographic")}case Ln.RelativeBilateral:{const e=Yn(t),n=Math.abs(Qn.normalize(e,0,!0));return(0,h.o)(n,"degrees","geographic")}}}function Bn(t){const e=Yn(t),n=$n.normalize(e,0,!0);return(0,h.o)(n,"degrees","geographic")}const qn=(()=>{const t=(0,r.ap)();return(e,n,i,s,l,c="geodesic")=>{(0,r.dF)(t,n);const u=Yn(l);if("geodesic"===c){const r=(0,a.N)(i);if(r&&(0,o.a)(t,i,t,r))return(0,a.j)(e,t,u,s,r),e[2]=n[2],!!(0,o.a)(e,r,e,i)}const p=(0,h.m)(u,"geographic","arithmetic"),d=(0,r.aU)(p,"degrees","radians"),f=n[0]+s*Math.cos(d),g=n[1]+s*Math.sin(d),m=n[2];return(0,r.dQ)(e,f,g,m),!0}})();function Yn(t){if(null!=t)return(0,h.m)(Xn(t),t.rotationType,"geographic")}function Xn(t){return(0,r.aU)(t.value,t.unit,"degrees")}const jn=new a.b,Wn=2*Math.PI,$n=r.i3,Qn=new r.uI(-180,180);function Kn(t,e,n,i,r,s){let l="geodesic",c=(0,a.N)(n);const u=S();return k(t,e,i,u),u[2]=0,c&&(0,o.a)(u,n,u,c)||(l="euclidean",c=n),{mode:l,view:e,elevationInfo:i,hasZ:r,directionMode:s,spatialReference:t.spatialReference,measurementSR:c,origin:u}}function Jn(t,e,n){if(null==e||null==t)return;const i=(0,r.uL)(n.measurementSR);if(null==i)return;const o=li(t,n);if(null==o)return;const s=(0,h.f)(e,i);return new Oe(o,s)}function ti(t,e,n,i){if(null==n||null==t)return;const r=li(t,i);if(null==r)return;const o=Yn(n),s=10,a=t=>{if(null==t)return;const e=S(),n=(0,h.o)(t,"degrees","geographic");return qn(e,r,i.measurementSR,s,n,i.mode)?new Ye(r,e):void 0},l=()=>{if(null!=e&&null!=t)return Yn(zn(e,t))};switch(i.directionMode){case Ln.Absolute:return a(o);case Ln.Relative:{const t=l();return null==t?void 0:a(t+o)}case Ln.RelativeBilateral:{const t=l();return null==t?void 0:Mn([a(t+o),a(t-o)])}}}function ei(t,e){const n=ui(t,e);return null!=n?new Ne(n):void 0}function ni(t,e,n){const{context:i,longitude:r,latitude:o,direction:s,distance:a,elevation:l}=n;if(null!=r||null!=o||null!=a||null!=l||null!=s){if(null!=r||null!=o){const t=Yn(r),e=Yn(o),n=ui(l,i);return new We(t,e,n)}return ii(t,e,n)}}function ii(t,e,{context:n,direction:i,distance:r,elevation:s}){if(null==e)return ei(s,n);const{view:a,elevationInfo:l,measurementSR:c}=n,u=k(e,a,l);if(!c||!(0,o.a)(u,e.spatialReference,pi,c))return;const[p,d]=pi,f=null!=r?(0,h.f)(r,"meters"):void 0,g=Yn(i),m=ui(s,n),y=t=>{const e=new $e([p,d],c,f,m,t);return null==f||null==t||null==m&&n.hasZ?e:new ke(e.closestTo(u))};if(null==g)return y(void 0);const _=()=>{if(null!=t&&null!=e)return Yn(zn(t,e))};switch(n.directionMode){case Ln.Absolute:return y(g);case Ln.Relative:{const t=_();return null==t?void 0:y(t+g)}case Ln.RelativeBilateral:{const t=_();return null==t?void 0:Mn([y(t+g),y(t-g)])}}}function ri(t){return"geodesic"===t.context.mode?ni(null,null,t):si(t)}function oi(t,e,n){const{context:i,x:r,y:o,distance:s,direction:a,elevation:l}=n;return"geodesic"===i.mode?ni(e,t,n):null!=r||null!=o?si(n):ai([Jn(t,s,i),ti(t,e,a,i),ei(l,i)])}function si({x:t,y:e,elevation:n,context:i}){gi.x=t?.value??0,gi.y=e?.value??0,gi.spatialReference=i.spatialReference;const r=li(gi,i,di);return new We(null!=t&&null!=r?r[0]:void 0,null!=e&&null!=r?r[1]:void 0,ui(n,i))}function ai(t){let e;for(const n of t)n&&(e=e?.intersect(n)??n);return e}function li(t,e,n=S()){const{view:i,elevationInfo:s,measurementSR:a,origin:l,mode:c}=e;if(k(t,i,s,n),(0,o.a)(n,t.spatialReference,n,a))return"geodesic"!==c&&(0,r.dB)(n,n,l),n}function ci(t,e,n,i){const{view:s,measurementSR:a,spatialReference:l,origin:c,mode:u}=n;if("geodesic"===u?(0,r.dF)(fi,t):(0,r.dE)(fi,t,c),(0,o.a)(fi,a,fi,l))return R(fi,s,e,n,i)}function ui(t,e){return hi(t,e)?.value??void 0}function hi(t,{view:e,origin:n,elevationInfo:i,hasZ:o,measurementSR:a}){if(null==t||!o)return;const l=(0,r.e1)(a);if(null==l)return;const[c,u]=n,p=(0,h.f)(t,l),d="3d"===e?.type?(0,s.E)(e,c,u,p,a,i):p;return null!=d?(0,h.a)(d,l):void 0}const pi=S(),di=S(),fi=S(),gi=(0,o.e)(0,0,0,r.aY.WGS84),mi="z",yi="r",_i={toggle:"Control"},vi={enterInputMode:"Tab",commit:"Enter",discard:"Escape",next:"Tab"},bi={moveUp:{key:"ArrowUp",modifier:"Shift",repeats:!0},moveDown:{key:"ArrowDown",modifier:"Shift",repeats:!0},moveLeft:{key:"ArrowLeft",modifier:"Shift",repeats:!0},moveRight:{key:"ArrowRight",modifier:"Shift",repeats:!0},scaleUp:{key:"+",modifier:"Shift"},scaleDown:{key:"-",modifier:"Shift"},factorModifier:{key:r.uM,continuePropagation:!0},toggleOpacity:"t",preserveAspectRatio:{key:"Shift",continuePropagation:!0},rotateIncrements:{key:"Shift",continuePropagation:!0},undo:mi,redo:yi};let xi=class{constructor(){this._bindings=new Map}add(t,e){return this.addToggle(t,(t=>{"key-down"===t.type&&e(t)}))}addToggle(t,e){const n=wi.fromDefinition(t,e),i=(0,r.bz)(this._bindings,n.key,(()=>[]));return i.push(n),(0,r.bh)((()=>(0,r.fs)(i,n)))}register(t,e=r.fa.WIDGET){return(0,r.gK)([t.on("key-down",(e=>this.dispatch(t.inputManager,e)),e),t.on("key-up",(e=>this.dispatch(t.inputManager,e)),e)])}dispatch(t,e){const n=e.key,i=this._bindings.get(n);if(i)for(const r of i)r.process(t,e)}},wi=class t{constructor(t,e,n,i,r){this.key=t,this.modifiers=e,this.repeats=n,this.continuePropagation=i,this.callback=r}process(t,e){if(!(e.key!==this.key||"repeat"in e&&e.repeat&&!this.repeats)){for(const e of this.modifiers)if(!t.isModifierKeyDown(e))return;this.continuePropagation||e.stopPropagation(),this.callback(e)}}static fromDefinition(e,n){if("string"==typeof e)return new t(e,[],!1,!1,n);const{key:i,modifier:r,repeats:o,continuePropagation:s}=e;return new t(i,r?Array.isArray(r)?r:[r]:[],!!o,!!s,n)}};const Mi="esri-tooltip",Ei=`${Mi}-content`,Ti=`${Mi}-content--input`,Si=`${Mi}-content__header`,Pi=`${Mi}-content__header__spacer`,Ci=`${Mi}-content__header__actions`,ki=`${Mi}-draw-header-actions`,Ri=`${Mi}-table`,Vi=`${Mi}-help-message`,Ai=`${Mi}-help-message__text`,Ii=`${Mi}-help-message__icon`,Oi=`${Mi}-field`,Di={base:Oi,inputMode:`${Oi}--input`,title:`${Oi}__title`,value:`${Oi}__value`};let Gi=class extends r.l3{constructor(){super(...arguments),this.hidden=!1,this.mode="feedback"}render(){return(0,r.l5)("div",{class:this.classes({[Di.base]:!0,[Di.inputMode]:"input"===this.mode})},(0,r.l5)("div",{class:Di.title,key:"title"},this.title),(0,r.l5)("div",{class:Di.value,key:"value"},this.value))}};(0,r.bt)([(0,r.bu)()],Gi.prototype,"hidden",void 0),(0,r.bt)([(0,r.bu)()],Gi.prototype,"mode",void 0),(0,r.bt)([(0,r.bu)()],Gi.prototype,"title",void 0),(0,r.bt)([(0,r.bu)()],Gi.prototype,"value",void 0),Gi=(0,r.bt)([(0,r.bv)("esri.views.interactive.tooltip.components.TooltipField")],Gi);const Li={base:`${Mi}-value-by-value`};let zi=class extends r.l3{constructor(){super(...arguments),this.divider="×"}render(){return(0,r.l5)("div",{class:Li.base},(0,r.l5)("span",null,this.left),(0,r.l5)("span",null,this.divider),(0,r.l5)("span",null,this.right))}};function Ni(t){let e,n,i=[],r=!1;function o(...o){return r&&e===this&&Ui(o,i)||(n=t.apply(this,o),e=this,i=o,r=!0),n}return o}function Ui(t,e){if(t.length!==e.length)return!1;for(let n=0;n<t.length;++n)if(t[n]!==e[n])return!1;return!0}function Hi(t){const e="metric";if(null==t)return e;const n=t.map,i=(n&&"portalItem"in n?n.portalItem?.portal:null)??r.e.getDefault();switch(i.user?.units??i.units){case e:return e;case"english":return"imperial"}return(0,r.uN)(t.spatialReference)??e}function Fi(t,e,n,i=2,r="abbr"){return(0,h.g)(t,(0,h.b)(e,n).value,n,i,r)}function Zi(t,e,n,i=2,r="abbr"){return(0,h.p)(t,(0,h.b)(e,n).value,n,i,r)}function Bi(t,e,n=2,i="abbr"){return(0,h.D)(t,e.value,e.unit,n,i)}function qi(t,e,n=2,i="abbr"){return(0,h.x)(t,e.value,e.unit,n,i)}function Yi(t,e,n=2,i="abbr"){return(0,h.y)(t,e.value,e.unit,n,i)}function Xi(t,e,n=2,i="abbr"){return(0,h.F)(t,e.value,e.unit,n,i)}function ji(t,e,n=2,i="abbr"){return(0,h.$)(t,e.value,e.unit,n,i)}function Wi(t,e,n=2,i="abbr"){return(0,h.d)(t,e.value,e.unit,n,i)}function $i(t,e,n=2,i="abbr"){return(0,h.h)(t,e.value,e.unit,n,i)}function Qi(t,e,n=2,i="abbr"){return(0,h.B)(t,e.value,e.unit,n,i)}function Ki(t,e,n=2,i="abbr"){return(0,h.M)(t,e.value,e.unit,n,i)}function Ji(t,e,n=2,i="abbr"){return(0,h.j)(t,e.value,e.unit,n,i)}function tr(t,e,n,i=r.i3,o=!0){return(0,h.w)(t.value,t.unit,t.rotationType,e,n,i,o)}function er(t,e,n,i,r="abbr"){switch(i=i??2,n){case"imperial":return Wi(t,e,i,r);case"metric":return Bi(t,e,i,r);default:return Fi(t,e,n,i,r)}}function nr(t,e,n,i=2,r="abbr"){switch(n){case"imperial":return $i(t,e,i,r);case"metric":return qi(t,e,i,r);default:return Zi(t,e,n,i,r)}}function ir(t,e,n,i=2,r="abbr"){switch(n){case"imperial":return Qi(t,e,i,r);case"metric":return Yi(t,e,i,r);default:return Fi(t,e,n,i,r)}}function rr(t,e,n,i=2,r="abbr"){switch(n){case"imperial":return Ki(t,e,i,r);case"metric":return Xi(t,e,i,r);default:return Zi(t,e,n,i,r)}}function or(t,e,n,i=2,r="abbr"){switch(n){case"imperial":return Ji(t,e,i,r);case"metric":return ji(t,e,i,r);default:return Fi(t,e,n,i,r)}}(0,r.bt)([(0,r.bu)()],zi.prototype,"left",void 0),(0,r.bt)([(0,r.bu)()],zi.prototype,"divider",void 0),(0,r.bt)([(0,r.bu)()],zi.prototype,"right",void 0),zi=(0,r.bt)([(0,r.bv)("esri.views.interactive.tooltip.components.ValueByValue")],zi);const sr=1,ar=6;function lr(t,e){return{angleRelative:cr,direction:ur,directionRelative:hr,directionRelativeBilateral:pr,latitudeDecimalDegrees:fr,longitudeDecimalDegrees:dr,area:(n,i)=>or(t,n,i??e.area),length:(n,i,r)=>er(t,n,i??e.length,r),lengthRelative:(n,i)=>nr(t,n,i??e.length),totalLength:(n,i)=>er(t,n,i??e.length),verticalLength:(n,i)=>ir(t,n,i??e.verticalLength),verticalLengthRelative:(n,i)=>rr(t,n,i??e.verticalLength),percentage:vr,scalar:xr,scale:br}}function cr(t){return(0,r.au)(t,{signDisplay:"exceptZero",...wr(sr)})}function ur(t){return tr(t,t.rotationType,sr)}function hr(t){const e=Yn(t);return(0,r.au)(e,{style:"unit",unitDisplay:"narrow",unit:"degree",signDisplay:e>0?"never":"exceptZero",...wr(sr)})}function pr(t){return tr(t,t.rotationType,sr)}function dr(t){return yr(t,Or)}function fr(t){return yr(t,Dr)}function gr(t){return _r(t,Or)}function mr(t){return _r(t,Dr)}function yr(t,e){return tr((0,h.b)(t,"degrees"),"geographic",ar,e,!1)}function _r(t,e){const n=e.normalize((0,h.b)(t,"degrees").value,void 0,!1);return xr((0,h.i)(n),ar)}function vr(t){return(0,r.au)(t.value,{style:"percent"})}function br(t){return(0,r.au)(t,{style:"percent",maximumFractionDigits:0})}function xr(t,e){return(0,r.au)(t.value,wr(e))}function wr(t){return{minimumFractionDigits:t,maximumFractionDigits:t}}function Mr({createQuantity:t,sanitize:e}){return(n,i)=>{if(null==n)return null;e&&(n=e(n));const o=(0,r.ut)(n);return null==o?null:t(o,i)}}function Er(t){return t.replaceAll(/[*^~°º]/g,"")}const Tr=t=>{let e=`[-+]?[0-9${t.thousands}]+`;return""!==t.decimal&&(e+=`${t.decimal}[0-9]+`),new RegExp(`^(${e}\\s*)${t.separator}(\\s*${e})$`,"i")},Sr=" ",Pr=[];for(const Zc of[",","\\|","\\s+"])for(const t of["\\.",",",""])for(const e of["",",","\\.",Sr,"\\s+"])Zc!==t&&Zc!==e&&t!==e&&Pr.push({separator:Zc,decimal:t,thousands:e,pattern:Tr({decimal:t,thousands:e,separator:Zc})});function Cr(t){for(const{decimal:e,thousands:n,pattern:i}of Pr){i.lastIndex=0;const o=t.match(i);if(!o)continue;const s=(0,r.ut)(kr(o[1],e,n)),a=(0,r.ut)(kr(o[2],e,n));if(null!=s&&null!=a)return{x:(0,h.i)(s),y:(0,h.i)(a)}}return null}function kr(t,e,n){let i=t.replaceAll(/[\s+]/g,"");return""!==n&&(i=i.replaceAll(n,"")),""!==e&&(i=i.replaceAll(e,".")),i}function Rr(t){if(!t||null!=(0,r.ut)(t)||!rt())return null;const e=st(t),n=Ir(e?.latitude),i=Ir(e?.longitude);return null!=i&&null!=n?{latitude:n,longitude:i}:null}function Vr(t){return Ir(at(t))}function Ar(t){return Ir(lt(t))}function Ir(t){return null!=t?(0,h.o)(t,"degrees","geographic"):null}const Or=new r.uI(-180,180),Dr=new r.uI(-90,90),Gr=Symbol("dragHandles");let Lr=class extends r.l3{constructor(){super(...arguments),this._focusAbortController=new AbortController,this._transitionInfo=null,this._mode="feedback",this._getFormatters=Ni(lr),this._onHeaderPointerDown=t=>{const e=t.target;e instanceof HTMLElement&&"calcite-button"!==e?.tagName?.toLowerCase()&&(this.removeHandles(Gr),e.setPointerCapture(t.pointerId),this.tooltip.onDragStart(t.clientX,t.clientY),this.addHandles([(0,r.h0)(e,"pointermove",(({clientX:t,clientY:e})=>{this.tooltip.onDrag(t,e)})),(0,r.h0)(e,["pointerup","pointercancel"],(n=>{this.removeHandles(Gr),e.releasePointerCapture(t.pointerId),this.tooltip.onDragEnd()})),(0,r.h0)(e,"touchstart",(t=>t.preventDefault()))],Gr))},this._onDiscard=()=>{this.destroyed||(this.tooltip.emit("discard"),this.info.clearInputValues(),this.exitInputMode())},this._onCommit=(t,e)=>{if(this.destroyed)return;if(this.tooltip.emit("commit",{type:e}),"commit-and-exit"===e)return void this.exitInputMode();if("commit-on-blur"===e)return;const n=this._getFocusableElements(),i=n.length,r=n.indexOf(t);if(-1===r)return void this.exitInputMode();const o=((r+("commit-and-next"===e?1:-1))%i+i)%i;zr(n.at(o))},this._onKeyDown=t=>{switch(t.code){case vi.next:return this._onNextKey(t);case vi.discard:return t.stopPropagation(),this._onDiscard()}}}get mode(){return this._mode}get _displayUnits(){const{displayUnits:t}=this.info.sketchOptions.values,e=Hi(this.tooltip.view);return{length:t.length??e,verticalLength:t.verticalLength??e,area:t.area??e}}get _inputUnitInfos(){const t=this._messagesUnits,e=e=>({unit:e,abbreviation:(0,h.c)(t,e,"abbr")}),{inputUnits:n}=this.info.sketchOptions.values,i=Hi(this.tooltip.view),o=n.length??i,s=n.verticalLength??i,a=n.area??i;return{length:e((0,r.uO)(o)),verticalLength:e((0,r.uP)(s)),area:e((0,r.uQ)(a)),angle:e("degrees")}}get _formatters(){return this._getFormatters(this._messagesUnits,this._displayUnits)}get fieldContext(){return{formatters:this._formatters,inputUnitInfos:this._inputUnitInfos,messages:this._messagesTooltip,sketchOptions:this.info.sketchOptions,onCommit:this._onCommit,onDiscard:this._onDiscard}}render(){const{visibleElements:t}=this.info.sketchOptions.tooltips,e=this._renderedContent,n=this._renderedActions,i=this._renderedHelpMessage,o=e.length>0,s=o||!!i,a="input"===this.mode;return(0,r.l5)("div",{class:(0,r.tk)(Ei,a&&Ti),onkeydown:this._onKeyDown,tabIndex:-1},a&&s&&t.header?(0,r.l5)("div",{class:Si,"data-testid":"tooltip-header",key:"header",onpointerdown:this._onHeaderPointerDown},(0,r.l5)("calcite-button",{appearance:"transparent","data-testid":"tooltip-back-button",iconFlipRtl:"both",iconStart:"chevron-left",key:"discard-button",kind:"neutral",onclick:this._onDiscard,scale:"s",tabIndex:-1}),n.length>0?(0,r.l5)(r.tw,null,(0,r.l5)("div",{class:Pi,key:"spacer"}),(0,r.l5)("div",{class:Ci,key:"actions"},n)):null):null,o?(0,r.l5)("div",{class:Ri,key:"content"},...e):null,i)}destroy(){this._focusAbortController.abort(),this._transitionInfo?.transition.skipTransition()}_renderActions(){return null}loadDependencies(){return(0,r.l4)({button:()=>Promise.all([n.e(5284),n.e(3115)]).then(n.bind(n,73115)),icon:()=>n.e(9958).then(n.bind(n,19958)),input:()=>Promise.all([n.e(5284),n.e(572),n.e(2087)]).then(n.bind(n,94468))})}async enterInputMode(t,e){try{await this._transitionTo("input",e),await this._focusField(t)}catch(n){(0,r.gG)(n)}}async exitInputMode({focusOnView:t=!0}={}){try{const{container:e,info:n}=this;n.clearInputValues();const i=t?e?.closest(".esri-view")?.querySelector(".esri-view-surface"):null;await this._transitionTo("feedback"),i instanceof HTMLElement&&i.focus()}catch(e){(0,r.gG)(e)}}_onNextKey(t){const e=this._getFocusableElements(),n=e.at(0),i=e.at(-1);n&&i&&(t.shiftKey?document.activeElement===n&&(t.preventDefault(),t.stopPropagation(),zr(i)):document.activeElement===i&&(t.preventDefault(),t.stopPropagation(),zr(n)))}get _renderedContent(){return Nr(this._renderContent())}get _renderedActions(){return Nr(this._renderActions())}get _renderedHelpMessage(){const{sketchOptions:t,visibleElements:e}=this.info;if(!e.helpMessage)return null;const n=t.tooltips.helpMessage??this._defaultHelpMessage;if(!n)return null;const i=t.tooltips.helpMessageIcon??"information";return(0,r.l5)("div",{class:Vi,key:"help-message"},i?(0,r.l5)("calcite-icon",{class:Ii,icon:i,scale:"s"}):null,(0,r.l5)("div",{class:Ai},n))}get _defaultHelpMessage(){const{helpMessage:t,viewType:e}=this.info;if(null==t)return null;const n="3d"===e?"helpMessages3d":"helpMessages2d";return this._messagesTooltip?.sketch?.[n]?.[t]}async _focusField(t){this._focusAbortController?.abort(),this._focusAbortController=new AbortController;const{signal:e}=this._focusAbortController;await this._waitForInputs(),(0,r.J)(e);const n=this._getFocusableInputs(),i=t?n.find((e=>e.getAttribute("data-field-name")===t)):n.at(0);await zr(i)}async _transitionTo(t,e){if(this._mode===t&&!this._transitionInfo)return;if(this._transitionInfo?.mode===t)return this._transitionInfo.transition.finished;this._transitionInfo?.transition.skipTransition();const n=async()=>{this.destroyed||(this._mode=t,await(0,r.uR)(),this.destroyed||(this.renderNow(),await(0,r.uR)(),this.destroyed||e?.()))};if(!this.domNode?.firstChild||!document.startViewTransition||(0,r.tp)())return void await n();this.autoRenderingEnabled=!1;const i=this._transitionInfo={transition:document.startViewTransition((async()=>{this.destroyed||i!==this._transitionInfo||(this.autoRenderingEnabled=!0,await n())})),mode:t};try{await i.transition.finished}finally{i===this._transitionInfo&&(this._transitionInfo=null)}}async _waitForInputs(){const t=()=>Array.from(this.domNode?.querySelectorAll("calcite-input")??[]);for(;0===t().length;)await(0,r.ft)(Ur);await(0,r.tG)()}_getFocusableInputs(){return Array.from(this.domNode?.querySelectorAll("calcite-input:not([read-only]):not([disabled])")??[])}_getFocusableElements(){const t=this.domNode?.querySelector(`.${ki}`);return[...Array.from(t?.querySelectorAll(`.${Ci} calcite-button:not([disabled])`)??[]),...this._getFocusableInputs()]}};async function zr(t){await(t?.setFocus())}function Nr(t){return(Array.isArray(t)?t:[t]).flat(10).filter((t=>!!t))}(0,r.bt)([(0,r.l2)("esri/core/t9n/Units"),(0,r.bu)()],Lr.prototype,"_messagesUnits",void 0),(0,r.bt)([(0,r.l2)("esri/views/interactive/tooltip/t9n/Tooltip"),(0,r.bu)()],Lr.prototype,"_messagesTooltip",void 0),(0,r.bt)([(0,r.bu)()],Lr.prototype,"info",void 0),(0,r.bt)([(0,r.bu)()],Lr.prototype,"tooltip",void 0),(0,r.bt)([(0,r.bu)()],Lr.prototype,"_mode",void 0),(0,r.bt)([(0,r.bu)()],Lr.prototype,"mode",null),(0,r.bt)([(0,r.bu)()],Lr.prototype,"_displayUnits",null),(0,r.bt)([(0,r.bu)()],Lr.prototype,"_inputUnitInfos",null),(0,r.bt)([(0,r.bu)()],Lr.prototype,"_formatters",null),(0,r.bt)([(0,r.bu)()],Lr.prototype,"fieldContext",null),(0,r.bt)([(0,r.bu)()],Lr.prototype,"_renderedContent",null),(0,r.bt)([(0,r.bu)()],Lr.prototype,"_renderedActions",null),(0,r.bt)([(0,r.bu)()],Lr.prototype,"_renderedHelpMessage",null),(0,r.bt)([(0,r.bu)()],Lr.prototype,"_defaultHelpMessage",null),Lr=(0,r.bt)([(0,r.bv)("esri.views.interactive.tooltip.content.TooltipContent")],Lr);const Ur=20;let Hr=class extends Lr{_renderContent(){const{area:t,radius:e,xSize:n,ySize:i,visibleElements:o}=this.info,s=this._messagesTooltip.sketch,a=this._formatters;return(0,r.l5)(r.tw,null,o.radius&&null!=e?(0,r.l5)(Gi,{title:s.radius,value:a.length(e)}):null,o.size&&null!=n&&null!=i?(0,r.l5)(Gi,{title:s.size,value:(0,r.l5)(zi,{left:a.length(n),right:a.length(i)})}):null,o.area?(0,r.l5)(Gi,{title:s.area,value:a.area(t)}):null)}};Hr=(0,r.bt)([(0,r.bv)("esri.views.interactive.tooltip.content.TooltipContentDrawCircle")],Hr);const Fr=`${Mi}-editable-field`,Zr={base:Fr,inputMode:`${Fr}--input`,feedbackMode:`${Fr}--feedback`,readOnly:`${Fr}--read-only`,locked:`${Fr}--locked`,title:`${Fr}__title`,value:`${Fr}__value`,valueContent:`${Fr}__value__content`,valueContentReadOnly:`${Fr}__value__content--read-only`,lockIcon:`${Fr}__lock-icon`,input:`${Fr}__input`,inputSuffix:`${Fr}__input-suffix`,button:`${Fr}__button`},Br={lock:"lock",unlock:"unlock"};let qr=class extends r.l3{constructor(){super(...arguments),this._input=null,this._lock=null,this._onLockClick=()=>{this.field.toggleLock(this.context)},this._onLockAfterCreate=t=>{this._lock=t},this._onLockAfterRemoved=()=>{this._lock=null},this._onKeyDown=t=>{t.key===vi.discard&&"input"===this.mode&&this._input&&this.context.onDiscard(this._input)},this._onInputKeyDown=t=>{const e=this._input;if(e)switch(t.key){case vi.commit:return this.field.onCommit("commit-and-exit",e,this.context);case vi.next:{t.preventDefault(),t.stopPropagation();const n=t.shiftKey?"commit-and-previous":"commit-and-next";return this.field.onCommit(n,e,this.context)}}},this._onInput=t=>{this.field.onInput(t.target.value)},this._onInputBlur=t=>{const e=this._input;e&&t.relatedTarget!==this._lock&&this.field.onCommit("commit-on-blur",e,this.context)},this._selectText=()=>{const t=()=>{this._input===document.activeElement&&this._input?.selectText()};t(),(0,r.tG)().then(t)},this._onAfterCreate=t=>{this._input=t,t.addEventListener("paste",this._onPaste),t.addEventListener("beforeinput",this._onBeforeInput)},this._onAfterRemoved=t=>{t.removeEventListener("paste",this._onPaste),t.removeEventListener("beforeinput",this._onBeforeInput)},this._onPaste=t=>{const e=t.clipboardData?.getData("text");e&&null!=this.field.parse(e,this.context)&&(t.stopPropagation(),this.field.onInput(e))},this._onBeforeInput=t=>{("historyUndo"===t.inputType||"historyRedo"===t.inputType)&&!this.field.dirty&&t.preventDefault()}}initialize(){this.addHandles((0,r.cc)((()=>this._rawDisplayValue),(()=>{const{committed:t,inputValue:e}=this.field;t||e||this._input!==document.activeElement||this._selectText()})))}loadDependencies(){return(0,r.l4)({button:()=>Promise.all([n.e(5284),n.e(3115)]).then(n.bind(n,73115)),icon:()=>n.e(9958).then(n.bind(n,19958)),input:()=>Promise.all([n.e(5284),n.e(572),n.e(2087)]).then(n.bind(n,94468))})}render(){const{field:t,mode:e}=this,n="input"===e,{locked:i,readOnly:o}=t;return(0,r.l5)("div",{class:this.classes({[Zr.base]:!0,[Zr.feedbackMode]:"feedback"===e,[Zr.inputMode]:"input"===e,[Zr.locked]:i,[Zr.readOnly]:o})},(0,r.l5)("div",{class:Zr.title,key:"title"},this._title),(0,r.l5)("div",{class:Zr.value,key:"value",onkeydown:this._onKeyDown},n?this._renderValueInputMode():this._renderValueFeedbackMode()))}get _formattedValue(){return this.field.getFormattedValue(this.context)||Yr}get _rawDisplayValue(){return this.field.getRawDisplayValue(this.context)}get _suffix(){return this.field.getSuffix(this.context)}get _title(){const{title:t}=this.field;return"string"==typeof t?t:t(this.context)}_renderValueFeedbackMode(){return(0,r.l5)(r.tw,null,(0,r.l5)("div",{class:Zr.valueContent,key:"value-feedback"},this._formattedValue),this.field.locked&&"input"!==this.mode?(0,r.l5)("calcite-icon",{class:Zr.lockIcon,icon:Br.lock,key:"icon",scale:"s"}):null)}_renderValueInputMode(){return this.field.readOnly?this._renderValueReadOnly():this._renderValueWritable()}_renderValueReadOnly(){return(0,r.l5)("div",{class:this.classes(Zr.valueContent,Zr.valueContentReadOnly),key:"value-read-only"},this._formattedValue)}_renderValueWritable(){const{field:t}=this,{name:e,invalid:n,locked:i}=t,o=this.context?.messages.sketch??{},s=i?o.unlockConstraint:o.lockConstraint;return(0,r.l5)(r.tw,null,(0,r.l5)("calcite-input",{afterCreate:this._onAfterCreate,afterRemoved:this._onAfterRemoved,class:Zr.input,"data-field-name":e,"data-testid":`tooltip-field-${e}`,key:"input",onblur:this._onInputBlur,onfocus:this._selectText,onkeydown:this._onInputKeyDown,scale:"s",status:n?"invalid":"idle",type:"text",value:this._rawDisplayValue??Yr,onCalciteInputInput:this._onInput}),(0,r.l5)("div",{class:Zr.inputSuffix,key:"suffix"},this._suffix),t.lockable?(0,r.l5)("calcite-button",{afterCreate:this._onLockAfterCreate,afterRemoved:this._onLockAfterRemoved,alignment:"center",appearance:"transparent",class:Zr.button,"data-testid":`tooltip-field-${e}-lock`,iconStart:i?Br.lock:Br.unlock,key:"lock",kind:"neutral",label:s,onclick:this._onLockClick,scale:"s",tabIndex:-1,title:s}):(0,r.l5)("div",{key:"lock-empty"}))}};(0,r.bt)([(0,r.bu)()],qr.prototype,"field",void 0),(0,r.bt)([(0,r.bu)()],qr.prototype,"context",void 0),(0,r.bt)([(0,r.bu)()],qr.prototype,"mode",void 0),(0,r.bt)([(0,r.bu)()],qr.prototype,"_input",void 0),(0,r.bt)([(0,r.bu)()],qr.prototype,"_lock",void 0),(0,r.bt)([(0,r.bu)()],qr.prototype,"_formattedValue",null),(0,r.bt)([(0,r.bu)()],qr.prototype,"_rawDisplayValue",null),(0,r.bt)([(0,r.bu)()],qr.prototype,"_suffix",null),(0,r.bt)([(0,r.bu)()],qr.prototype,"_title",null),qr=(0,r.bt)([(0,r.bv)("esri.views.interactive.tooltip.components.TooltipEditableField")],qr);const Yr="—";function Xr(t){const e=t.fields.filter((t=>!0===t?.visible));return 0===e.length?null:(0,r.l5)(r.tw,null,e.map((e=>(0,r.l5)(qr,{context:t.context,field:e,key:e.id,mode:t.mode}))))}let jr=class extends Lr{_renderContent(){const{fieldContext:t,info:e,mode:n}=this,{visibleElements:i}=e;return(0,r.l5)(Xr,{context:t,fields:[i.coordinates?e.effectiveX:void 0,i.coordinates?e.effectiveY:void 0,i.elevation?e.elevation:void 0,i.orientation?e.orientation:void 0,i.scale?e.scale:void 0],mode:n})}};jr=(0,r.bt)([(0,r.bv)("esri.views.interactive.tooltip.content.TooltipContentDrawMesh")],jr);let Wr=class extends Lr{_renderContent(){const{fieldContext:t,info:e,mode:n}=this,{elevation:i,visibleElements:o}=e;return(0,r.l5)(Xr,{context:t,fields:[o.coordinates?e.effectiveX:void 0,o.coordinates?e.effectiveY:void 0,o.elevation?i:void 0],mode:n})}};Wr=(0,r.bt)([(0,r.bv)("esri.views.interactive.tooltip.content.TooltipContentDrawPoint")],Wr);const $r={absolute:"absolute-direction",relative:"relative-direction"};let Qr=class extends r.l3{constructor(t){super(t),this.visibleElements={}}render(){return(0,r.l5)("div",{class:ki},this._isElementVisible("direction")?(0,r.l5)(Kr,{messages:this.messages,sketchOptions:this.sketchOptions}):null)}loadDependencies(){return(0,r.l4)({button:()=>Promise.all([n.e(5284),n.e(3115)]).then(n.bind(n,73115)),dropdown:()=>Promise.all([n.e(772),n.e(5769)]).then(n.bind(n,5769)),"dropdown-item":()=>n.e(9023).then(n.bind(n,79023)),"dropdown-group":()=>n.e(364).then(n.bind(n,70364))})}_isElementVisible(t){return this.visibleElements?.[t]??this.sketchOptions.tooltips.visibleElements[t]}};function Kr(t){const{directionMode:e}=t.sketchOptions.values,n=t.messages?.sketch,i=n?.directionModeSelect?.title,o="absolute",s="relative";return(0,r.l5)("calcite-dropdown",{key:"direction-mode",placement:"bottom-end",scale:"s",widthScale:"s",onCalciteDropdownSelect:e=>{const n=e.target.selectedItems?.[0]?.getAttribute("data-mode");t.sketchOptions.values.directionMode=n??"absolute"}},(0,r.l5)("calcite-button",{alignment:"end",appearance:"transparent",iconStart:$r[e],kind:"neutral",label:i,scale:"s",slot:"trigger",title:i}),(0,r.l5)("calcite-dropdown-group",{selectionMode:"single"},(0,r.l5)("calcite-dropdown-item",{"data-mode":s,"data-testid":"tooltip-direction-mode-relative",iconStart:$r.relative,key:"relative",selected:e===s},n?.directionModeSelect?.relative),(0,r.l5)("calcite-dropdown-item",{"data-mode":o,"data-testid":"tooltip-direction-mode-absolute",iconStart:$r.absolute,key:"absolute",selected:e===o},n?.directionModeSelect?.absolute)))}(0,r.bt)([(0,r.l2)("esri/views/interactive/tooltip/t9n/Tooltip"),(0,r.bu)()],Qr.prototype,"messages",void 0),(0,r.bt)([(0,r.bu)()],Qr.prototype,"sketchOptions",void 0),(0,r.bt)([(0,r.bu)()],Qr.prototype,"visibleElements",void 0),Qr=(0,r.bt)([(0,r.bv)("esri.views.interactive.tooltip.components.DrawHeaderActions")],Qr);let Jr=class extends Lr{_renderContent(){const{fieldContext:t,info:e,mode:n}=this,{xyMode:i,visibleElements:o}=e;return(0,r.l5)(Xr,{context:t,fields:[..."direction-distance"===i?[o.direction?e.direction:void 0,o.distance?e.distance:void 0]:[o.coordinates?e.effectiveX:void 0,o.coordinates?e.effectiveY:void 0],o.elevation?e.elevation:void 0,o.area?e.area:void 0],mode:n})}_renderActions(){const{xyMode:t,sketchOptions:e}=this.info;return(0,r.l5)(Qr,{sketchOptions:e,visibleElements:{direction:"direction-distance"===t}})}};Jr=(0,r.bt)([(0,r.bv)("esri.views.interactive.tooltip.content.TooltipContentDrawPolygon")],Jr);let to=class extends Lr{_renderContent(){const{fieldContext:t,info:e,mode:n}=this,{xyMode:i,visibleElements:o}=e;return(0,r.l5)(Xr,{context:t,fields:[..."direction-distance"===i?[o.direction?e.direction:void 0,o.distance?e.distance:void 0]:[o.coordinates?e.effectiveX:void 0,o.coordinates?e.effectiveY:void 0],o.elevation?e.elevation:void 0,o.totalLength?e.totalLength:void 0],mode:n})}_renderActions(){const{xyMode:t,sketchOptions:e}=this.info;return(0,r.l5)(Qr,{sketchOptions:e,visibleElements:{direction:"direction-distance"===t}})}};to=(0,r.bt)([(0,r.bv)("esri.views.interactive.tooltip.content.TooltipContentDrawPolyline")],to);let eo=class extends Lr{_renderContent(){const{area:t,xSize:e,ySize:n,visibleElements:i}=this.info,o=this._messagesTooltip.sketch,s=this._formatters;return(0,r.l5)(r.tw,null,i.size&&null!=e&&null!=n?(0,r.l5)(Gi,{title:o.size,value:(0,r.l5)(zi,{left:s.length(e),right:s.length(n)})}):null,i.area?(0,r.l5)(Gi,{title:o.area,value:s.area(t)}):null)}};eo=(0,r.bt)([(0,r.bv)("esri.views.interactive.tooltip.content.TooltipContentDrawRectangle")],eo);let no=class extends Lr{_renderContent(){const{angle:t,visibleElements:e}=this.info,n=this._messagesTooltip.sketch;return(0,r.l5)(r.tw,null,e.rotation?(0,r.l5)(Gi,{title:n.rotation,value:this._formatters.angleRelative(t)}):null)}};no=(0,r.bt)([(0,r.bv)("esri.views.interactive.tooltip.content.TooltipContentExtentRotate")],no);let io=class extends Lr{_renderContent(){const t=this.info,{visibleElements:e}=t,n=this._messagesTooltip.sketch,i=this._formatters;return(0,r.l5)(r.tw,null,e.size?(0,r.l5)(Gi,{title:n.size,value:(0,r.l5)(zi,{left:i.length(t.xSize),right:i.length(t.ySize)})}):null,e.scale?(0,r.l5)(Gi,{title:n.scale,value:(0,r.l5)(zi,{left:i.scale(t.xScale),right:i.scale(t.yScale)})}):null)}};io=(0,r.bt)([(0,r.bv)("esri.views.interactive.tooltip.content.TooltipContentExtentScale")],io);let ro=class extends Lr{_renderContent(){const{fieldContext:t,info:e,mode:n}=this,{visibleElements:i}=e;return(0,r.l5)(Xr,{context:t,fields:[i.coordinates?e.effectiveX:void 0,i.coordinates?e.effectiveY:void 0,i.elevation?e.elevation:void 0],mode:n})}};ro=(0,r.bt)([(0,r.bv)("esri.views.interactive.tooltip.content.TooltipContentMovePoint")],ro);let oo=class extends Lr{_renderContent(){const{fieldContext:t,info:e,mode:n}=this,{visibleElements:i}=e;return(0,r.l5)(Xr,{context:t,fields:[i.distance?e.distance:void 0,i.area?e.area:void 0,i.totalLength?e.totalLength:void 0],mode:n})}};oo=(0,r.bt)([(0,r.bv)("esri.views.interactive.tooltip.content.TooltipContentReshapeEdgeOffset")],oo);let so=class extends Lr{_renderContent(){const{fieldContext:t,info:e,mode:n}=this,{visibleElements:i}=e;return(0,r.l5)(Xr,{context:t,fields:[i.coordinates?e.effectiveX:void 0,i.coordinates?e.effectiveY:void 0,i.elevation?e.elevation:void 0,i.area&&"polygon"===e.geometryType?e.area:null,i.totalLength&&"polyline"===e.geometryType?e.totalLength:null],mode:n})}};so=(0,r.bt)([(0,r.bv)("esri.views.interactive.tooltip.content.TooltipContentSelectedVertex")],so);let ao=class extends Lr{_renderContent(){const{fieldContext:t,info:e,mode:n}=this,{visibleElements:i}=e;return(0,r.l5)(Xr,{context:t,fields:[i.coordinates?e.effectiveX:void 0,i.coordinates?e.effectiveY:void 0,i.elevation?e.elevation:void 0,i.orientation?e.orientation:void 0,i.scale?e.scale:void 0],mode:n})}};ao=(0,r.bt)([(0,r.bv)("esri.views.interactive.tooltip.content.TooltipContentTransformMesh")],ao);let lo=class extends Lr{_renderContent(){const{fieldContext:t,info:e,mode:n}=this,{visibleElements:i}=e;return(0,r.l5)(Xr,{context:t,fields:[i.coordinates?e.effectiveX:void 0,i.coordinates?e.effectiveY:void 0,i.elevation?e.elevation:void 0,i.orientation?e.orientation:void 0,i.size?e.size:void 0],mode:n})}};lo=(0,r.bt)([(0,r.bv)("esri.views.interactive.tooltip.content.TooltipContentTransformPoint")],lo);let co=class extends Lr{_renderContent(){const{info:t}=this,{visibleElements:e}=t,n=this._messagesTooltip.sketch,i=this._formatters;return(0,r.l5)(r.tw,null,e.distance?(0,r.l5)(Gi,{title:n.distance,value:i.length(t.distance)}):null)}};co=(0,r.bt)([(0,r.bv)("esri.views.interactive.tooltip.content.TooltipContentTranslate")],co);let uo=class extends Lr{_renderContent(){const{distance:t,elevation:e,area:n,totalLength:i,visibleElements:o}=this.info,s=this._messagesTooltip.sketch,a=this._formatters;return(0,r.l5)(r.tw,null,o.distance?(0,r.l5)(Gi,{title:s.distance,value:a.length(t)}):null,o.elevation&&null!=e?.actual?(0,r.l5)(Gi,{title:s.elevation,value:a.verticalLength(e.actual)}):null,o.area&&null!=n?(0,r.l5)(Gi,{title:s.area,value:a.area(n)}):null,o.totalLength&&null!=i?(0,r.l5)(Gi,{title:s.totalLength,value:a.length(i)}):null)}};uo=(0,r.bt)([(0,r.bv)("esri.views.interactive.tooltip.content.TooltipContentTranslateVertex")],uo);let ho=class extends Lr{_renderContent(){const{info:t}=this,{visibleElements:e}=t,n=this._messagesTooltip.sketch,i=this._formatters;return(0,r.l5)(r.tw,null,e.distance?(0,r.l5)(Gi,{title:n.distance,value:i.length(t.distance)}):null)}};ho=(0,r.bt)([(0,r.bv)("esri.views.interactive.tooltip.content.TooltipContentTranslateXY")],ho);let po=class extends Lr{_renderContent(){const{info:t}=this,{visibleElements:e}=t,n=this._messagesTooltip.sketch;return(0,r.l5)(r.tw,null,e.distance?(0,r.l5)(Gi,{title:n.distance,value:this._formatters.verticalLengthRelative(t.distance)}):null)}};function fo(t,e){if(null==e)return null;const n=document.createElement("div");switch(e.type){case"draw-point":return new Wr({tooltip:t,info:e,container:n});case"draw-polygon":return new Jr({tooltip:t,info:e,container:n});case"draw-polyline":return new to({tooltip:t,info:e,container:n});case"draw-mesh":return new jr({tooltip:t,info:e,container:n});case"draw-rectangle":return new eo({tooltip:t,info:e,container:n});case"draw-circle":return new Hr({tooltip:t,info:e,container:n});case"extent-rotate":return new no({tooltip:t,info:e,container:n});case"extent-scale":return new io({tooltip:t,info:e,container:n});case"move-point":return new ro({tooltip:t,info:e,container:n});case"selected-vertex":return new so({tooltip:t,info:e,container:n});case"transform-point":return new lo({tooltip:t,info:e,container:n});case"transform-mesh":return new ao({tooltip:t,info:e,container:n});case"translate":return new co({tooltip:t,info:e,container:n});case"translate-vertex":return new uo({tooltip:t,info:e,container:n});case"translate-z":return new po({tooltip:t,info:e,container:n});case"translate-xy":return new ho({tooltip:t,info:e,container:n});case"reshape-edge-offset":return new oo({tooltip:t,info:e,container:n})}}po=(0,r.bt)([(0,r.bv)("esri.views.interactive.tooltip.content.TooltipContentTranslateZ")],po);const go={base:`${Mi}`,ltr:`${Mi}--ltr`,rtl:`${Mi}--rtl`,debug:`${Mi}--debug`},mo=20,yo=16,_o="bottom-end";let vo=class extends r.d4.EventedAccessor{constructor(t){super(t),this.info=null,this.options=null,this.position=null,this.content=null,this._focused=!1,this.outerContainer=document.createElement("div"),this.debug=!1,this._lastPosition=null,this._rtl=!1,this._prevXY=[0,0]}initialize(){const{outerContainer:t}=this;this.addHandles([(0,r.cc)((()=>this.view.overlay?.surface),(e=>{t.remove(),e?.appendChild(t),this._rtl=(0,r.tj)(e)}),r.hG),(0,r.cc)((()=>this.info),((e,n)=>{if(null!=this.content&&null!=e&&null!=n&&e.type===n.type)this.content.info=e;else{(0,r.ch)(this.content);const n=fo(this,e);n?(this.content=n,n.container&&t.appendChild(n.container),this.exitInputMode()):this.content=null}}),r.hG),(0,r.cc)((()=>({container:this.outerContainer,style:this._outerContainerStyle})),(({container:t,style:e})=>{Object.assign(t.style,e)}),r.cd),(0,r.cc)((()=>({outerContainer:this.outerContainer,placement:this.effectivePlacement,effectiveOffset:this._effectiveOffset,rtl:this._rtl,debug:this.debug})),(({outerContainer:t,placement:e,effectiveOffset:n,rtl:i,debug:o})=>{const{classList:s}=t;s.add(go.base),s.toggle(go.rtl,i),s.toggle(go.ltr,!i),s.toggle(go.debug,o),this.outerContainer.style.setProperty("--offset",`${n}px`),(0,r.uS)(t),Mo(t,e)}),r.cd),(0,r.g$)((()=>"feedback"===this.mode),(()=>{this.position=null,this._clearOverride("effectivePlacement")}),r.eL),(0,r.h0)(this.outerContainer,"paste",(t=>{this.emit("paste",t)})),(0,r.h0)(this.outerContainer,["focusin","focusout"],(()=>{setTimeout((()=>{this._focused=this.content?.container?.contains(document.activeElement)??!1}))}))])}destroy(){this.info=null,this.content=(0,r.ch)(this.content),this.outerContainer.remove()}get mode(){return this.content?.mode??"feedback"}get focused(){return this._focused}get visible(){return"none"!==this._outerContainerStyle.display}get contentContainer(){return this.content?.container}get effectivePlacement(){const t=this.options?.placement;return"auto"===t?"bottom-end":t??_o}get _screenPoint(){const{inputManager:t}=this.view;return t?.multiTouchActive?null:t?.latestPointerLocation}get _effectiveOffset(){return this.options?.offset??mo}get _outerContainerStyle(){const t=this.position??this._screenPoint;return this._lastPosition=(0,r.uT)(t),null!=t&&null!=this.content?{display:"block",transform:`translate(${Math.round(t.x)}px, ${Math.round(t.y)}px)`}:{display:"none",transform:"none"}}clear(){this.info=null}async enterInputMode(t){const e=this.position??this._lastPosition??this._screenPoint,n=this.position=(0,r.uT)(e),{effectivePlacement:i}=this;this._override("effectivePlacement",i);const o=()=>{n&&(this.position=bo(this.contentContainer,n,this._effectiveOffset,this.view),Object.assign(this.outerContainer.style,this._outerContainerStyle))};await(this.content?.enterInputMode(t,o))}async exitInputMode(t){await(this.content?.exitInputMode(t))}onDragStart(t,e){this._prevXY=[t,e]}onDrag(t,e){const n=t-this._prevXY[0],i=e-this._prevXY[1];this._prevXY=[t,e];const{position:o}=this;if(o){const{view:s}=this,a=t-s.position[0],l=e-s.position[1];if(a<0||a>s.width||l<0||l>s.height-yo)return;this.position=(0,r.h1)(o.x+n,o.y+i)}}onDragEnd(){this._prevXY=[0,0]}};function bo(t,e,n,i){if(!t||!i.container)return e;const o=t.getBoundingClientRect(),{left:s,top:a}=i.container.getBoundingClientRect();let{x:l,y:c}=e;const u=o.left-s-n;u<0&&(l-=u);const h=o.right-s+n-i.width;h>0&&(l-=h);const p=o.top-a-n;p<0&&(c-=p);const d=o.bottom-a+n-i.height;return d>0&&(c-=d),(0,r.h1)(l,c)}(0,r.bt)([(0,r.bu)({nonNullable:!0})],vo.prototype,"view",void 0),(0,r.bt)([(0,r.bu)()],vo.prototype,"info",void 0),(0,r.bt)([(0,r.bu)()],vo.prototype,"options",void 0),(0,r.bt)([(0,r.bu)()],vo.prototype,"position",void 0),(0,r.bt)([(0,r.bu)()],vo.prototype,"content",void 0),(0,r.bt)([(0,r.bu)({readOnly:!0})],vo.prototype,"mode",null),(0,r.bt)([(0,r.bu)()],vo.prototype,"_focused",void 0),(0,r.bt)([(0,r.bu)({readOnly:!0})],vo.prototype,"focused",null),(0,r.bt)([(0,r.bu)({readOnly:!0})],vo.prototype,"outerContainer",void 0),(0,r.bt)([(0,r.bu)({readOnly:!0})],vo.prototype,"contentContainer",null),(0,r.bt)([(0,r.bu)({readOnly:!0})],vo.prototype,"effectivePlacement",null),(0,r.bt)([(0,r.bu)()],vo.prototype,"debug",void 0),(0,r.bt)([(0,r.bu)()],vo.prototype,"_lastPosition",void 0),(0,r.bt)([(0,r.bu)()],vo.prototype,"_screenPoint",null),(0,r.bt)([(0,r.bu)()],vo.prototype,"_rtl",void 0),(0,r.bt)([(0,r.bu)()],vo.prototype,"_effectiveOffset",null),(0,r.bt)([(0,r.bu)()],vo.prototype,"_outerContainerStyle",null),vo=(0,r.bt)([(0,r.bv)("esri.views.interactive.Tooltip")],vo);const xo=["top","bottom","leading","trailing"].flatMap((t=>[wo(`${t}-start`),wo(t),wo(`${t}-end`)]));function wo(t){return`${go.base}--${t}`}function Mo({classList:t},e){xo.forEach((e=>t.remove(e))),t.add(wo(e))}const Eo=vo;function To(t){const e=new Eo(t());return e.addHandles((0,r.cc)((()=>t()),(({view:t,options:n,info:i})=>{e.view=t,void 0!==n&&(e.options=n),void 0!==i&&(e.info=i)}))),e}function So(t,e){const n=(0,f.a)(e.vertexSpace),{scale:i,orientation:r}=t,{transform:o}=e,s=Po(o);n&&null!=s?(r.actual=(0,h.o)(s,"degrees","arithmetic"),r.visible=!0):(r.actual=null,r.visible=!1),n?(i.actual=(0,h.i)(Ro(o)),i.visible=!0):(i.actual=null,i.visible=!1)}function Po(t){if(!t)return 0;const e=Co(t.rotationAxis);return null!=e?e*t.rotationAngle:null}function Co(t){return(0,r.uF)(t,r.fz)?1:(0,r.uF)(t,ko)?-1:null}const ko=(0,r.gl)((0,r.ap)(),r.fz);function Ro(t){return t?Math.max(...t.scale):1}function Vo(t,e){return!("key-down"!==t.type||t.key!==vi.enterInputMode||!e||!Ao(e.info))&&(e.enterInputMode(),t.preventDefault(),t.stopPropagation(),!0)}function Ao(t){const e=t?.sketchOptions;if(!e)return!1;const{inputEnabled:n,visibleElements:i}=e.tooltips;return n&&!0===t.editableFields.some((({name:t})=>"x"===t||"y"===t?i.coordinates:i[t]))}function Io(t,e,n){if(!e||!("geographic"in e))return;const i=t.clipboardData?.getData("text");if(!i)return;const r=e=>{t.stopPropagation(),t.preventDefault(),e()};if(e.geographic){const t=Rr(i);t&&r((()=>{e.longitude.applyValue(t.longitude),e.latitude.applyValue(t.latitude)}))}else{const t=Cr(i);t&&r((()=>{e.x.applyValue(t.x),e.y.applyValue(t.y)}))}}let Oo=class extends r.e9{constructor(t){super(t),this.helpMessage=void 0,this.viewType=void 0}get visibleElements(){return this.sketchOptions.tooltips.visibleElements}get allFields(){return[]}get editableFields(){return this.allFields.filter((t=>t.visible&&!t.readOnly))}clearInputValues(){this.allFields.forEach((t=>t.clearInputValue()))}};(0,r.bt)([(0,r.bu)()],Oo.prototype,"sketchOptions",void 0),(0,r.bt)([(0,r.bu)()],Oo.prototype,"visibleElements",null),(0,r.bt)([(0,r.bu)()],Oo.prototype,"helpMessage",void 0),(0,r.bt)([(0,r.bu)()],Oo.prototype,"viewType",void 0),(0,r.bt)([(0,r.bu)()],Oo.prototype,"allFields",null),(0,r.bt)([(0,r.bu)()],Oo.prototype,"editableFields",null),Oo=(0,r.bt)([(0,r.bv)("esri.views.interactive.tooltip.infos.SketchTooltipInfo")],Oo);let Do=class extends Oo{constructor(t){super(t),this.type="draw-circle",this.radius=null,this.xSize=null,this.ySize=null,this.area=h.e}get allFields(){return[]}};(0,r.bt)([(0,r.bu)()],Do.prototype,"type",void 0),(0,r.bt)([(0,r.bu)()],Do.prototype,"radius",void 0),(0,r.bt)([(0,r.bu)()],Do.prototype,"xSize",void 0),(0,r.bt)([(0,r.bu)()],Do.prototype,"ySize",void 0),(0,r.bt)([(0,r.bu)()],Do.prototype,"area",void 0),(0,r.bt)([(0,r.bu)()],Do.prototype,"allFields",null),Do=(0,r.bt)([(0,r.bv)("esri.views.interactive.tooltip.infos.DrawCircleTooltipInfo")],Do);let Go=class extends r.e9{constructor(t){super(t),this.actual=null,this.lockable=!0,this.id=(0,r.e4)(),this.inputValue=null,this.readOnly=!1,this.suffix=null,this.visible=!0,this.invalid=!1,this.unlockOnVertexPlacement=!0}get committed(){return this.lockable?this._get("committed"):null}set committed(t){this.lockable&&this._set("committed",t)}get dirty(){return null!=this.inputValue}get locked(){return this.lockable&&null!=this.committed}onInput(t){this.inputValue=t}onCommit(t,e,n){this.lockable?this._onCommitLockable(t,n):this._onCommitNonLockable(n),this.invalid&&"commit-and-exit"===t||n.onCommit(e,t)}_onCommitLockable(t,e){const{inputValue:n,locked:i}=this;i&&Lo(n)?this.unlock():("commit-and-exit"===t&&!i||null!=n)&&this._parseInputAndLock(e)}_onCommitNonLockable(t){const{inputValue:e}=this;Lo(e)?this.setActual(null):null!=e&&this._parseInputAndSetActual(t)}applyValue(t){this.lockable?this.lock(t):this.setActual(t)}clearInputValue(){this.inputValue=null,this.invalid=!1}setActual(t){this.actual=t,this.clearInputValue()}lock(t){this.lockable&&(this.committed=t??this.actual,this.clearInputValue())}unlock(){this.lockable&&(this.committed=null,this.clearInputValue())}toggleLock(t){this.lockable&&(this.locked?this.unlock():this._parseInputAndLock(t))}getSuffix(t){const{suffix:e}=this;return"function"==typeof e?e(t):e}getFormattedValue(t){const{actual:e,committed:n,format:i}=this;return null!=n?i(n,t):null!=e?i(e,t):null}getRawDisplayValue(t){const{actual:e,committed:n,inputValue:i}=this;return i??(this.lockable&&null!=n?this.formatForInputMode(n,t):null!=e?this.formatForInputMode(e,t):null)}_parseInputAndSetActual(t){const{inputValue:e}=this;if(null==e||Lo(e))return this.setActual(null);const n=this.parse(e,t);null!=n?this.setActual(n):this.invalid=!0}_parseInputAndLock(t){const{inputValue:e,actual:n}=this;if(Lo(e))return this.unlock();if(null==e)return this.lock(n);const i=this.parse(e,t);null!=i?this.lock(i):this.invalid=!0}};function Lo(t){return null!=t&&""===t.trim()}(0,r.bt)([(0,r.bu)()],Go.prototype,"actual",void 0),(0,r.bt)([(0,r.bu)()],Go.prototype,"committed",null),(0,r.bt)([(0,r.bu)()],Go.prototype,"dirty",null),(0,r.bt)([(0,r.bu)()],Go.prototype,"format",void 0),(0,r.bt)([(0,r.bu)()],Go.prototype,"formatForInputMode",void 0),(0,r.bt)([(0,r.bu)()],Go.prototype,"lockable",void 0),(0,r.bt)([(0,r.bu)()],Go.prototype,"locked",null),(0,r.bt)([(0,r.bu)()],Go.prototype,"id",void 0),(0,r.bt)([(0,r.bu)()],Go.prototype,"inputValue",void 0),(0,r.bt)([(0,r.bu)()],Go.prototype,"name",void 0),(0,r.bt)([(0,r.bu)()],Go.prototype,"parse",void 0),(0,r.bt)([(0,r.bu)()],Go.prototype,"readOnly",void 0),(0,r.bt)([(0,r.bu)()],Go.prototype,"suffix",void 0),(0,r.bt)([(0,r.bu)()],Go.prototype,"title",void 0),(0,r.bt)([(0,r.bu)()],Go.prototype,"visible",void 0),(0,r.bt)([(0,r.bu)()],Go.prototype,"invalid",void 0),(0,r.bt)([(0,r.bu)()],Go.prototype,"unlockOnVertexPlacement",void 0),Go=(0,r.bt)([(0,r.bv)("esri.views.interactive.tooltip.fields.TooltipField")],Go);let zo=class extends Go{constructor(t){super(t),this.showAsZ=!1}normalizeCtorArgs(t){const e=t=>t.inputUnitInfos.verticalLength.unit;return{name:"elevation",actual:h.k,parse:Mr({createQuantity:(t,n)=>(0,h.a)(t,e(n))}),format:(t,e)=>e.formatters.verticalLength(t),formatForInputMode:(t,n)=>n.formatters.scalar((0,h.b)(t,e(n))),suffix:t=>t.inputUnitInfos.verticalLength.abbreviation,title:t=>t.messages.sketch[this.showAsZ?"z":"elevation"],unlockOnVertexPlacement:!1,...t}}};(0,r.bt)([(0,r.bu)()],zo.prototype,"showAsZ",void 0),zo=(0,r.bt)([(0,r.bv)("esri.views.interactive.tooltip.fields.TooltipFieldElevation")],zo);let No=class extends Go{constructor(t){super(t),this.precision=1}normalizeCtorArgs(t){const e=t=>t.inputUnitInfos.angle.unit;return{name:"orientation",actual:null,parse:Mr({createQuantity:(t,n)=>(0,h.o)(t,e(n),"geographic"),sanitize:Er}),format:t=>{const e=Bn(t);return tr(e,"geographic",this.precision)},formatForInputMode:(t,e)=>{const n=Bn(t);return e.formatters.scalar(n)},suffix:t=>t.inputUnitInfos.angle.abbreviation,title:t=>t.messages.sketch.orientation,...t}}};(0,r.bt)([(0,r.bu)()],No.prototype,"precision",void 0),No=(0,r.bt)([(0,r.bv)("esri.views.interactive.tooltip.fields.TooltipFieldOrientation")],No);let Uo=class extends Go{constructor(t){super(t),this.precision=null}normalizeCtorArgs(t){const e=t=>t.inputUnitInfos.length.unit;return{name:"size",actual:null,parse:Mr({createQuantity:(t,n)=>(0,h.a)(t,e(n))}),format:(t,e)=>e.formatters.length(t),formatForInputMode:(t,n)=>n.formatters.scalar((0,h.b)(t,e(n))),suffix:t=>t.inputUnitInfos.length.abbreviation,title:t=>t.messages.sketch.size,...t}}};function Ho(t){const e=t=>t.inputUnitInfos.angle.unit,n=t=>t.sketchOptions.values.effectiveDirectionMode;return new Go({name:"direction",actual:h.U,parse:Mr({createQuantity:(t,n)=>(0,h.o)(t,e(n),"geographic"),sanitize:Er}),format:(t,e)=>{const i=n(e),r=Zn(t,i);switch(i){case Ln.Absolute:return e.formatters.direction(r);case Ln.Relative:return e.formatters.directionRelative(r);case Ln.RelativeBilateral:return e.formatters.directionRelativeBilateral(r)}},formatForInputMode:(t,i)=>{const r=Zn(t,n(i));return i.formatters.scalar((0,h.b)(r,e(i)))},suffix:t=>t.inputUnitInfos.angle.abbreviation,title:t=>{const e=n(t),{absolute:i,relative:r}=t.messages.sketch.direction;switch(e){case Ln.Absolute:return i;case Ln.Relative:case Ln.RelativeBilateral:return r}},...t})}function Fo(t){const e=t=>t.inputUnitInfos.length.unit;return new Go({name:"distance",actual:h.k,parse:Mr({createQuantity:(t,n)=>(0,h.a)(Math.max(t,0),e(n))}),format:(t,e)=>e.formatters.length(t),formatForInputMode:(t,n)=>n.formatters.scalar((0,h.b)(t,e(n))),suffix:t=>t.inputUnitInfos.length.abbreviation,title:t=>t.messages.sketch.distance,...t})}function Zo(t){return Fo({format:(t,e)=>e.formatters.totalLength(t),title:t=>t.messages.sketch.totalLength,readOnly:!0,...t})}function Bo(t){return Fo({...t})}function qo(t){return new zo(t)}function Yo(t){return new No(t)}function Xo(t){return Jo("scale",{name:"scale",actual:null,parse:Mr({createQuantity:t=>(0,h.i)(Math.abs(t))}),...t})}function jo(t){const e=t=>t.inputUnitInfos.area.unit;return new Go({name:"area",actual:h.e,parse:Mr({createQuantity:(t,n)=>(0,h.l)(t,e(n))}),format:(t,e)=>e.formatters.area(t),formatForInputMode:(t,n)=>n.formatters.scalar((0,h.b)(t,e(n))),suffix:t=>t.inputUnitInfos.area.abbreviation,title:t=>t.messages.sketch.area,readOnly:!0,...t})}function Wo(t){return new Go({name:"x",actual:h.U,parse:Vr,format:(t,e)=>e.formatters.longitudeDecimalDegrees(t),formatForInputMode:t=>gr(t),suffix:t=>t.inputUnitInfos.angle.abbreviation,title:t=>t.messages.sketch.longitude,...t})}function $o(t){return new Go({name:"y",actual:h.U,parse:Ar,format:(t,e)=>e.formatters.latitudeDecimalDegrees(t),formatForInputMode:t=>mr(t),suffix:t=>t.inputUnitInfos.angle.abbreviation,title:t=>t.messages.sketch.latitude,...t})}function Qo(t){return Jo("x",{name:"x",...t})}function Ko(t){return Jo("y",{name:"y",...t})}function Jo(t,e){return new Go({actual:(0,h.i)(0),parse:Mr({createQuantity:t=>(0,h.i)(t)}),format:(t,e)=>e.formatters.scalar(t),formatForInputMode:(t,e)=>e.formatters.scalar(t),title:e=>e.messages.sketch[t],...e})}function ts(t){return(0,a.y)(t)||(0,r.a7)(t)}function es(t,e,n,...i){return(0,a.y)(t)?e.apply(void 0,i):(0,r.a7)(t)?n.apply(void 0,i):null}(0,r.bt)([(0,r.bu)()],Uo.prototype,"precision",void 0),Uo=(0,r.bt)([(0,r.bv)("esri.views.interactive.tooltip.fields.TooltipFieldSize")],Uo);const ns=t=>{let e=class extends t{constructor(){super(...arguments),this.longitude=Wo(),this.latitude=$o(),this.x=Qo(),this.y=Ko(),this.elevation=qo(),this.geographic=!1}get effectiveX(){return this.geographic?this.longitude:this.x}get effectiveY(){return this.geographic?this.latitude:this.y}get key(){return{longitude:this.longitude.actual,latitude:this.latitude.actual,x:this.x.actual,y:this.y.actual,elevation:this.elevation.actual,geographic:this.geographic}}setLocationFromPoint(t,e=t?.spatialReference){if(this.geographic=!!e&&ts(e),null==t)return this._setActualLonLat(null,null),void this._setActualXY(null,null);if(this.geographic){const e=(0,r.uU)(t,is);this._setActualLonLat(Ir(e?.[0]),Ir(e?.[1]))}else this._setActualXY((0,h.i)(t.x),(0,h.i)(t.y))}_setActualLonLat(t,e){this.longitude.actual=t,this.latitude.actual=e}_setActualXY(t,e){this.x.actual=t,this.y.actual=e}};return(0,r.bt)([(0,r.bu)()],e.prototype,"geographic",void 0),(0,r.bt)([(0,r.bu)()],e.prototype,"effectiveX",null),(0,r.bt)([(0,r.bu)()],e.prototype,"effectiveY",null),(0,r.bt)([(0,r.bu)()],e.prototype,"key",null),e=(0,r.bt)([(0,r.bv)("esri.views.interactive.tooltip.infos.TooltipInfoWithCoordinates")],e),e},is=[0,0];let rs=class extends(ns(Oo)){constructor(t){super(t),this.type="draw-mesh",this.orientation=Yo({lockable:!1}),this.scale=Xo({lockable:!1})}get allFields(){return[this.longitude,this.latitude,this.x,this.y,this.elevation,this.orientation,this.scale]}};(0,r.bt)([(0,r.bu)()],rs.prototype,"helpMessage",void 0),(0,r.bt)([(0,r.bu)()],rs.prototype,"allFields",null),rs=(0,r.bt)([(0,r.bv)("esri.views.interactive.tooltip.infos.DrawMeshTooltipInfo")],rs);let os=class extends(ns(Oo)){constructor(t){super(t),this.type="draw-point"}get allFields(){return[this.longitude,this.latitude,this.x,this.y,this.elevation]}};(0,r.bt)([(0,r.bu)()],os.prototype,"helpMessage",void 0),(0,r.bt)([(0,r.bu)()],os.prototype,"allFields",null),os=(0,r.bt)([(0,r.bv)("esri.views.interactive.tooltip.infos.DrawPointTooltipInfo")],os);let ss=class extends(ns(Oo)){constructor(t){super(t),this.type="draw-polygon",this.direction=Ho(),this.distance=Bo(),this.area=jo(),this.xyMode="direction-distance"}get allFields(){return[this.direction,this.distance,this.longitude,this.latitude,this.x,this.y,this.elevation,this.area]}};(0,r.bt)([(0,r.bu)()],ss.prototype,"xyMode",void 0),(0,r.bt)([(0,r.bu)()],ss.prototype,"helpMessage",void 0),(0,r.bt)([(0,r.bu)()],ss.prototype,"allFields",null),ss=(0,r.bt)([(0,r.bv)("esri.views.interactive.tooltip.infos.DrawPolygonTooltipInfo")],ss);let as=class extends(ns(Oo)){constructor(t){super(t),this.type="draw-polyline",this.direction=Ho(),this.distance=Bo(),this.totalLength=Zo(),this.xyMode="direction-distance"}get allFields(){return[this.direction,this.distance,this.longitude,this.latitude,this.x,this.y,this.elevation,this.totalLength]}};(0,r.bt)([(0,r.bu)()],as.prototype,"helpMessage",void 0),(0,r.bt)([(0,r.bu)()],as.prototype,"xyMode",void 0),(0,r.bt)([(0,r.bu)()],as.prototype,"allFields",null),as=(0,r.bt)([(0,r.bv)("esri.views.interactive.tooltip.infos.DrawPolylineTooltipInfo")],as);let ls=class extends Oo{constructor(t){super(t),this.type="draw-rectangle",this.xSize=h.k,this.ySize=h.k,this.area=h.e}get allFields(){return[]}};function cs(t){return(0,r.gp)(t)?(0,r.a6)(t)||(0,r.a7)(t)||(0,r.gh)(t)||(0,r.uV)(t)?y.w:t:(0,y.a)(t)}function us(t,e=fs()){return hs(t,e,!1)}function hs(t,e,n=t.hasZ){const i=cs(t.spatialReference),s=(0,r.uW)(i);if(null==s)return null;const a=(t,e)=>!(e.length<2)&&((0,r.dQ)(t,e[0],e[1],n&&e[2]||0),!0);let l=0;for(const c of t.rings){const n=c.length;if(n<3)continue;const{positionsWorldCoords:s}=e;for(;s.length<n;)s.push((0,r.ap)());const u=ps,h=(0,r.dQ)(ds,0,0,0),d=1/n;for(let e=0;e<n;e++){if(!a(u,c[e])||!(0,o.a)(u,t.spatialReference,s[e],i))return null;(0,r.h9)(h,h,s[e],d)}const f=(0,p.p)(s[0],s[1],h,(0,p.D)());if(0===(0,r.dD)((0,p.O)(f)))continue;for(let t=0;t<n;t++)(0,p.J)(f,h,s[t],s[t]);const g=gs(s);for(let t=0;t<g.length;t+=3)l+=(0,m.v)(s[g[t]],s[g[t+1]],s[g[t+2]])}return(0,h.l)(l,s)}(0,r.bt)([(0,r.bu)()],ls.prototype,"type",void 0),(0,r.bt)([(0,r.bu)()],ls.prototype,"xSize",void 0),(0,r.bt)([(0,r.bu)()],ls.prototype,"ySize",void 0),(0,r.bt)([(0,r.bu)()],ls.prototype,"area",void 0),(0,r.bt)([(0,r.bu)()],ls.prototype,"allFields",null),ls=(0,r.bt)([(0,r.bv)("esri.views.interactive.tooltip.infos.DrawRectangleTooltipInfo")],ls);const ps=(0,r.ap)(),ds=(0,r.ap)();function fs(){return{positionsWorldCoords:[]}}function gs(t){return(0,g.e)(ms(t),[],2)}function ms(t){const e=new Float64Array(2*t.length);for(let n=0;n<t.length;++n){const i=t[n],r=2*n;e[r]=i[0],e[r+1]=i[1]}return e}function ys(t){const{spatialReference:e}=t;return es(e,_s,vs,t)}function _s(t){return(0,h.l)(Math.abs((0,a.v)([t],"square-meters")[0]),"square-meters")}function vs(t){try{return(0,h.l)(Math.abs((0,l.geodesicArea)(t,"square-meters")),"square-meters")}catch{return null}}function bs(t,e,n=fs()){return ys(t)??us(t,n)}function xs(t,e=fs()){return bs(t,"on-the-ground",e)}var ws;function Ms(t){return Es(t,ws.Horizontal)}function Es(t,e){const{hasZ:n,spatialReference:i}=t,o=cs(i);let s=0;const a=(0,r.uL)(o);if(null==a)return null;const l=e===ws.Direct?Cs:ks;for(const r of t.paths){if(r.length<2)continue;const t=r.length-1;for(let e=0;e<t;++e){const t=r[e];Vs[0]=t[0],Vs[1]=t[1],Vs[2]=n?t[2]:0;const o=r[e+1];As[0]=o[0],As[1]=o[1],As[2]=n?o[2]:0;const a=l(Vs,As,i);if(null==a)return null;s+=a.value}}return(0,h.a)(s,a)}function Ts(t,e){const{spatialReference:n}=t;return(0,r.a5)(n,e.spatialReference)?(Vs[0]=t.x,Vs[1]=t.y,Vs[2]=t.hasZ?t.z:0,As[0]=e.x,As[1]=e.y,As[2]=e.hasZ?e.z:0,ks(Vs,As,n)):null}function Ss(t){return null!=t?Ps(t.hasZ?t.z:0,t.spatialReference):null}function Ps(t,e){const n=(0,r.e1)(e);return null!=n?(0,h.a)(t??0,n):null}function Cs(t,e,n){const i=Rs(t,e,n,ws.Direct);return null!=i?(0,h.a)(i.direct,i.unit):null}function ks(t,e,n){const i=Rs(t,e,n,ws.Horizontal);return null!=i?(0,h.a)(i.horizontal,i.unit):null}function Rs(t,e,n,i){const s=cs(n),a=(0,r.uL)(s);if(null==a)return null;const l=e[2]-t[2];if(i===ws.Vertical)return{verticalSigned:l,unit:a};if(!(0,o.a)(t,n,Is,s)||!(0,o.a)(e,n,Os,s))return null;if(i===ws.Direct)return{direct:(0,r.dR)(Os,Is),unit:a};if((0,r.dQ)(Ds,t[0],t[1],e[2]),!(0,o.a)(Ds,n,Ds,s))return null;const c=(0,r.dR)(Ds,Os);return i===ws.Horizontal?{horizontal:c,unit:a}:{direct:(0,r.dR)(Os,Is),horizontal:c,vertical:Math.abs(l),unit:a}}(function(t){t[t.Direct=0]="Direct",t[t.Horizontal=1]="Horizontal",t[t.Vertical=2]="Vertical"})(ws||(ws={}));const Vs=(0,r.ap)(),As=(0,r.ap)(),Is=(0,r.ap)(),Os=(0,r.ap)(),Ds=(0,r.ap)();function Gs(t){const{spatialReference:e}=t;return es(e,Hs,Fs,t)}function Ls(t,e){if(!(0,r.a5)(t.spatialReference,e.spatialReference))return null;const{spatialReference:n}=t;return qs[0]=t.x,qs[1]=t.y,qs[2]=t.hasZ?t.z:0,Ys[0]=e.x,Ys[1]=e.y,Ys[2]=e.hasZ?e.z:0,zs(qs,Ys,n)}function zs(t,e,n){return es(n,Ns,Us,t,e,n)}function Ns(t,e,n){return(0,h.a)((0,a.q)(Bs,t,e,n).distance,"meters")}function Us(t,e,n){return(0,h.a)((0,l.geodesicLength)(Zs(t,e,n),"meters"),"meters")}function Hs(t){return(0,h.a)((0,a.R)([t],"meters")[0],"meters")}function Fs(t){return(0,h.a)((0,l.geodesicLength)(t,"meters"),"meters")}function Zs(t,e,n){return{type:"polyline",spatialReference:n,paths:[[[...t],[...e]]]}}const Bs=new a.b,qs=(0,r.ap)(),Ys=(0,r.ap)();function Xs(t){return Gs(t)??Ms(t)}function js(t,e){return Ls(t,e)??Ts(t,e)}function Ws(t,e){return{point:new os({sketchOptions:e,viewType:t}),polyline:new as({sketchOptions:e,viewType:t}),polygon:new ss({sketchOptions:e,viewType:t}),mesh:new rs({sketchOptions:e,viewType:t}),rectangle:new ls({sketchOptions:e}),circle:new Do({sketchOptions:e})}}function $s(t){const{directionOptions:e,geometryType:n,sketchOptions:i,tooltipInfos:r}=t,o=e=>{const n=_a(t).mode,i=r[e].elevation;"relative-to-ground"===n||"relative-to-scene"===n||"on-the-ground"===n?i.lock(ba(t)):i.unlock()},s=t=>{if(e){const n=r[t].direction;n.committed=e.angle,n.unlockOnVertexPlacement=!1,i.values.directionMode=e.mode}};switch(n){case"polygon":case"polyline":o(n),s(n);break;case"point":case"mesh":o(n)}}function Qs(t,e){const{drawOperation:n,view:i}=e,r=Js(e),o=_a(e);if("2d"===i.type||!t||"absolute-height"!==o.mode||1!==n?.numCommittedVertices||!r||"draw-polyline"!==r.type&&"draw-polygon"!==r.type||r.elevation.locked)return;const[s,a,l]=t,c=ya(s,a,l,o,e);null!=c&&r.elevation.lock(c)}function Ks(t){Js(t)?.allFields.forEach((t=>{t.unlockOnVertexPlacement&&t.unlock()}))}function Js({geometryType:t,graphic:e,tooltipInfos:n}){return"multipoint"===t||e?.geometry?.type!==ta[t]?null:n[t]}const ta={point:"point",mesh:"mesh",polyline:"polyline",polygon:"polygon",circle:"polygon",rectangle:"polygon"};function ea(t,e){switch(t?.type){case"draw-point":na(t,e);break;case"draw-polyline":oa(t,e);break;case"draw-polygon":sa(t,e);break;case"draw-rectangle":ca(t,e);break;case"draw-circle":ua(t,e);break;case"draw-mesh":ia(t,e)}}function na(t,e){const n=e.graphic?.geometry;"point"===n?.type&&(ra(t,n,e),t.helpMessage=It("point",n))}function ia(t,e){const{graphic:n,view:i}=e,r=n?.geometry;"3d"!==i.type||r&&"mesh"!==r.type||(ra(t,r?.origin,e),r&&So(t,r),t.helpMessage=Lt(n,i))}function ra(t,e,n){const{drawOperation:i,view:r,sketchOptions:o}=n,{cursorVertex:s}=i;if(t.sketchOptions=o,t.viewType=r.type,t.setLocationFromPoint(e,va(n)),ha(t.elevation,n),!s)return void(i.constraints=void 0);const a=s;i.constraints={context:xa(a,n),x:t.x.committed,y:t.y.committed,longitude:t.longitude.committed,latitude:t.latitude.committed,elevation:t.elevation.committed,distance:null,direction:null}}function oa(t,e){const{createOperationGeometry:n,drawOperation:i}=e,r=null!=n?n.full:null;r&&"polyline"!==r.type||(aa(t,e),t.totalLength.actual=i.lastVertex?(r?Xs(r):null)??h.k:null,t.helpMessage=It("polyline",r))}function sa(t,e){const{createOperationGeometry:n,drawOperation:i}=e,r=null!=n?n.full:null;r&&"polygon"!==r.type||(aa(t,e),t.area.actual=i.lastVertex?(r?xs(r):null)??h.e:null,t.helpMessage=It("polygon",r))}function aa(t,e){const{drawOperation:n,sketchOptions:i,view:r}=e,{cursorVertex:o,lastVertex:s,secondToLastVertex:a}=n,l=i.values.effectiveDirectionMode;t.sketchOptions=i,t.viewType=r.type;const c=s&&o?js(s,o)??h.k:null;if(t.distance.actual=c,t.distance.readOnly=null==s,t.direction.actual=null,t.direction.readOnly=!0,s&&o&&("absolute"===l||a)){const e=Hn(a,s,o,l);t.direction.actual=e??h.n,t.direction.readOnly=!1}t.setLocationFromPoint(o,va(e)),ha(t.elevation,e);const u=la(s,e);t.xyMode=u,t.direction.visible="direction-distance"===u,t.distance.visible="direction-distance"===u,t.effectiveX.visible="coordinates"===u,t.effectiveY.visible="coordinates"===u;const p=o??s;n.constraints=p?{context:xa(p,e),x:t.x.committed,y:t.y.committed,longitude:t.longitude.committed,latitude:t.latitude.committed,elevation:t.elevation.committed,distance:t.distance.committed,direction:t.direction.committed}:void 0}function la(t,{sketchOptions:e}){const n=e.tooltips.xyMode;return"auto"===n?t?"direction-distance":"coordinates":n}function ca(t,e){t.sketchOptions=e.sketchOptions,t.xSize=da(e),t.ySize=fa(e),t.area=pa(e)}function ua(t,e){const{forceUniformSize:n,sketchOptions:i}=e;t.sketchOptions=i,t.radius=n?ga(e):null,t.xSize=n?null:da(e),t.ySize=n?null:fa(e),t.area=pa(e)}function ha(t,e){const{drawOperation:n}=e,i=n?.cursorVertex??n?.lastVertex;t.actual=Ss(i)??ba(e),t.visible=n.hasZ,t.readOnly=!1,t.showAsZ=!0}function pa(t){const e=t.createOperationGeometry?.full;return"polygon"!==e?.type?h.e:xs(e)??h.e}function da(t){const e=t.createOperationGeometry?.rectangle?.midpoints;return(null!=e?js(e.left,e.right):null)??h.k}function fa(t){const e=t.createOperationGeometry?.rectangle?.midpoints;return(null!=e?js(e.top,e.bottom):null)??h.k}function ga({createOperationGeometry:t}){return(null!=t?.circle?.center&&null!=t.circle.edge?js(t.circle.center,t.circle.edge):null)??h.k}function ma(t){const{geometryType:e,tooltipInfos:n}=t;switch(e){case"point":case"mesh":case"polyline":case"polygon":{const i=n[e].elevation.committed;return i?(0,h.f)(i,"meters")/(0,r.mG)(va(t)):void 0}default:return}}function ya(t,e,n,i,r){const{view:o,drawOperation:a}=r;if("3d"!==o.type||!a)return;n??=0;const l=va(r),c=_a(r),u=(0,s.E)(o,t,e,n,l,c,i);return Ps(u,l)??ba(r)}function _a(t){return t.drawOperation.elevationInfo??s.j}function va(t){return t.drawOperation.coordinateHelper.spatialReference}function ba(t){const e=(0,r.mG)(va(t));return(0,h.a)(t.defaultZ*e,"meters")}function xa(t,e){return Kn(t,e.view,va(e),_a(e),e.drawOperation.coordinateHelper.hasZ(),e.sketchOptions.values.effectiveDirectionMode)}var wa;(function(t){t[t.WhenToolEditable=0]="WhenToolEditable",t[t.WhenToolNotEditable=1]="WhenToolNotEditable",t[t.Always=2]="Always"})(wa||(wa={}));let Ma=class{constructor(){this._isToolEditable=!0,this._manipulators=new r.a8,this._resourceContexts={manipulator3D:{}},this._attached=!1}set isToolEditable(t){this._isToolEditable=t}get length(){return this._manipulators.length}add(t,e=wa.WhenToolEditable){this.addMany([t],e)}addMany(t,e=wa.WhenToolEditable){for(const n of t){const t={manipulator:n,visibilityPredicate:e,attached:!1};this._manipulators.add(t),this._attached&&this._updateManipulatorAttachment(t)}}remove(t){for(let e=0;e<this._manipulators.length;e++)if(this._manipulators.at(e).manipulator===t){const t=this._manipulators.splice(e,1)[0];this._detachManipulator(t);break}}removeAll(){this._manipulators.forEach((t=>{this._detachManipulator(t)})),this._manipulators.removeAll()}attach(){this._manipulators.forEach((t=>{this._updateManipulatorAttachment(t)})),this._attached=!0}detach(){this._manipulators.forEach((t=>{this._detachManipulator(t)})),this._attached=!1}destroy(){this.detach(),this._manipulators.forEach((({manipulator:t})=>t.destroy())),this._manipulators.destroy(),this._resourceContexts=null}on(t,e){return this._manipulators.on(t,(t=>{e(t)}))}forEach(t){for(const e of this._manipulators.items)t(e)}some(t){return this._manipulators.items.some(t)}toArray(){const t=[];return this.forEach((e=>t.push(e.manipulator))),t}intersect(t,e){let n=null,i=Number.MAX_VALUE;return this._manipulators.forEach((({manipulator:r,attached:o})=>{if(!o||!r.interactive)return;const s=r.intersectionDistance(t,e);null!=s&&s<i&&(i=s,n=r)})),n}_updateManipulatorAttachment(t){this._isManipulatorItemVisible(t)?this._attachManipulator(t):this._detachManipulator(t)}_attachManipulator(t){t.attached||(t.manipulator.attach&&t.manipulator.attach(this._resourceContexts),t.attached=!0)}_detachManipulator(t){if(!t.attached)return;const e=t.manipulator;e.grabbing=!1,e.dragging=!1,e.hovering=!1,e.selected=!1,e.detach&&e.detach(this._resourceContexts),t.attached=!1}_isManipulatorItemVisible(t){return t.visibilityPredicate===wa.Always||(this._isToolEditable?t.visibilityPredicate===wa.WhenToolEditable:t.visibilityPredicate===wa.WhenToolNotEditable)}},Ea=class extends r.e9{constructor(t){super(t),this.manipulators=new Ma,this.automaticManipulatorSelection=!0,this.hasGrabbedManipulators=!1,this.hasHoveredManipulators=!1,this.firstGrabbedManipulator=null,this.created=!1,this.removeIncompleteOnCancel=!0,this._editableFlags=new Map([[r.uX.MANAGER,!0],[r.uX.USER,!0]]),this._creationFinishedResolver=(0,r.X)()}get active(){return null!=this.view&&this.view.activeTool===this}set visible(t){this._get("visible")!==t&&(this._set("visible",t),this._syncVisible())}get editable(){return this.getEditableFlag(r.uX.USER)}set editable(t){this.setEditableFlag(r.uX.USER,t)}get updating(){return!1}get cursor(){return null}get hasFocusedManipulators(){return this.hasGrabbedManipulators||this.hasHoveredManipulators}destroy(){this.manipulators.destroy(),this._set("view",null)}onAdd(){this._syncVisible()}activate(){null!=this.view&&(this.view.focus(),this.onActivate())}deactivate(){this.onDeactivate()}handleInputEvent(t){this.onInputEvent(t)}handleInputEventAfter(t){this.onInputEventAfter(t)}setEditableFlag(t,e){this._editableFlags.set(t,e),this.manipulators.isToolEditable=this.internallyEditable,this._updateManipulatorAttachment(),t===r.uX.USER&&this.notifyChange("editable"),this.onEditableChange(),this.onManipulatorSelectionChanged()}getEditableFlag(t){return this._editableFlags.get(t)??!1}endDrag(){const t=this.view.inputManager.latestPointerLocation;if(!t)return;let e=!1;this.manipulators.forEach((({manipulator:n})=>{n.dragging&&(e=!0,n.events.emit("drag",{action:"end",start:t,screenPoint:t}))})),e&&(this.view.toolViewManager.activeTool=null)}whenCreated(){return this._creationFinishedResolver.promise}onManipulatorSelectionChanged(){}onActivate(){}onDeactivate(){}onShow(){}onHide(){}onEditableChange(){}onInputEvent(t){}onInputEventAfter(t){}get internallyEditable(){return this.getEditableFlag(r.uX.USER)&&this.getEditableFlag(r.uX.MANAGER)}finishToolCreation(){this.created||this._creationFinishedResolver.resolve(this),this._set("created",!0)}_syncVisible(){if(this.initialized)if(this.visible)this._show();else if(this._hide(),this.active)return void(this.view.activeTool=null)}_show(){this._updateManipulatorAttachment(),this.onShow()}_hide(){this._updateManipulatorAttachment(),this.onHide()}_updateManipulatorAttachment(){this.visible?this.manipulators.attach():this.manipulators.detach()}};(0,r.bt)([(0,r.bu)({constructOnly:!0})],Ea.prototype,"view",void 0),(0,r.bt)([(0,r.bu)({readOnly:!0})],Ea.prototype,"active",null),(0,r.bt)([(0,r.bu)({value:!0})],Ea.prototype,"visible",null),(0,r.bt)([(0,r.bu)({value:!0})],Ea.prototype,"editable",null),(0,r.bt)([(0,r.bu)({readOnly:!0})],Ea.prototype,"manipulators",void 0),(0,r.bt)([(0,r.bu)({readOnly:!0})],Ea.prototype,"updating",null),(0,r.bt)([(0,r.bu)()],Ea.prototype,"cursor",null),(0,r.bt)([(0,r.bu)({readOnly:!0})],Ea.prototype,"automaticManipulatorSelection",void 0),(0,r.bt)([(0,r.bu)()],Ea.prototype,"hasFocusedManipulators",null),(0,r.bt)([(0,r.bu)()],Ea.prototype,"hasGrabbedManipulators",void 0),(0,r.bt)([(0,r.bu)()],Ea.prototype,"hasHoveredManipulators",void 0),(0,r.bt)([(0,r.bu)()],Ea.prototype,"firstGrabbedManipulator",void 0),(0,r.bt)([(0,r.bu)({readOnly:!0})],Ea.prototype,"created",void 0),(0,r.bt)([(0,r.bu)({readOnly:!0})],Ea.prototype,"removeIncompleteOnCancel",void 0),Ea=(0,r.bt)([(0,r.bv)("esri.views.interactive.InteractiveToolBase")],Ea);let Ta=class extends r.e9{constructor(t){super(t),this.enabled=!1}};(0,r.bt)([(0,r.bu)({type:Boolean,nonNullable:!0})],Ta.prototype,"enabled",void 0),Ta=(0,r.bt)([(0,r.bv)("esri.views.interactive.sketch.SketchLabelOptions")],Ta);const Sa=Ta;let Pa=class extends r.e9{constructor(t){super(t),this.mode="absolute-height"}toJSON(){return{mode:this.mode}}};(0,r.bt)([(0,r.bu)({type:String,nonNullable:!0})],Pa.prototype,"mode",void 0),Pa=(0,r.bt)([(0,r.bv)("esri.views.interactive.sketch.SketchTooltipElevationOptions")],Pa);let Ca=class extends r.e9{constructor(t){super(t),this.area=!0,this.coordinates=!0,this.direction=!0,this.distance=!0,this.elevation=!0,this.header=!0,this.helpMessage=!1,this.orientation=!0,this.radius=!0,this.rotation=!0,this.scale=!0,this.size=!0,this.totalLength=!0}};(0,r.bt)([(0,r.bu)({type:Boolean,nonNullable:!0})],Ca.prototype,"area",void 0),(0,r.bt)([(0,r.bu)({type:Boolean,nonNullable:!0})],Ca.prototype,"coordinates",void 0),(0,r.bt)([(0,r.bu)({type:Boolean,nonNullable:!0})],Ca.prototype,"direction",void 0),(0,r.bt)([(0,r.bu)({type:Boolean,nonNullable:!0})],Ca.prototype,"distance",void 0),(0,r.bt)([(0,r.bu)({type:Boolean,nonNullable:!0})],Ca.prototype,"elevation",void 0),(0,r.bt)([(0,r.bu)({type:Boolean,nonNullable:!0})],Ca.prototype,"header",void 0),(0,r.bt)([(0,r.bu)({type:Boolean,nonNullable:!0})],Ca.prototype,"helpMessage",void 0),(0,r.bt)([(0,r.bu)({type:Boolean,nonNullable:!0})],Ca.prototype,"orientation",void 0),(0,r.bt)([(0,r.bu)({type:Boolean,nonNullable:!0})],Ca.prototype,"radius",void 0),(0,r.bt)([(0,r.bu)({type:Boolean,nonNullable:!0})],Ca.prototype,"rotation",void 0),(0,r.bt)([(0,r.bu)({type:Boolean,nonNullable:!0})],Ca.prototype,"scale",void 0),(0,r.bt)([(0,r.bu)({type:Boolean,nonNullable:!0})],Ca.prototype,"size",void 0),(0,r.bt)([(0,r.bu)({type:Boolean,nonNullable:!0})],Ca.prototype,"totalLength",void 0),Ca=(0,r.bt)([(0,r.bv)("esri.views.interactive.sketch.SketchTooltipVisibleElements")],Ca);const ka=Ca;let Ra=class extends r.e9{constructor(t){super(t),this.enabled=!1,this.forceEnabled=!1,this.helpMessage=null,this.helpMessageIcon=null,this.inputEnabled=!0,this.elevation=new Pa,this.placement="auto",this.offset=null,this.visibleElements=new ka,this.visualVariables=null,this.xyMode="auto"}get effectiveEnabled(){return this.forceEnabled||this.enabled}};(0,r.bt)([(0,r.bu)({type:Boolean,nonNullable:!0})],Ra.prototype,"enabled",void 0),(0,r.bt)([(0,r.bu)()],Ra.prototype,"forceEnabled",void 0),(0,r.bt)([(0,r.bu)()],Ra.prototype,"effectiveEnabled",null),(0,r.bt)([(0,r.bu)()],Ra.prototype,"helpMessage",void 0),(0,r.bt)([(0,r.bu)()],Ra.prototype,"helpMessageIcon",void 0),(0,r.bt)([(0,r.bu)({type:Boolean,nonNullable:!0})],Ra.prototype,"inputEnabled",void 0),(0,r.bt)([(0,r.bu)({type:Pa,nonNullable:!0})],Ra.prototype,"elevation",void 0),(0,r.bt)([(0,r.bu)()],Ra.prototype,"placement",void 0),(0,r.bt)([(0,r.bu)()],Ra.prototype,"offset",void 0),(0,r.bt)([(0,r.bu)({type:ka,nonNullable:!0})],Ra.prototype,"visibleElements",void 0),(0,r.bt)([(0,r.bu)()],Ra.prototype,"visualVariables",void 0),(0,r.bt)([(0,r.bu)()],Ra.prototype,"xyMode",void 0),Ra=(0,r.bt)([(0,r.bv)("esri.views.interactive.sketch.SketchTooltipOptions")],Ra);const Va=Ra;let Aa=class extends r.e9{constructor(t){super(t),this.length=null,this.verticalLength=null,this.area=null}};(0,r.bt)([(0,r.bu)()],Aa.prototype,"length",void 0),(0,r.bt)([(0,r.bu)()],Aa.prototype,"verticalLength",void 0),(0,r.bt)([(0,r.bu)()],Aa.prototype,"area",void 0),Aa=(0,r.bt)([(0,r.bv)("esri.views.interactive.sketch.Units")],Aa);const Ia=Aa;let Oa=class extends r.e9{constructor(t){super(t),this.directionMode="relative",this.relativeDirectionIsBilateral=!1}get effectiveDirectionMode(){switch(this.directionMode){case"relative":return this.relativeDirectionIsBilateral?Ln.RelativeBilateral:Ln.Relative;case"absolute":return Ln.Absolute}}get displayUnits(){return this._get("displayUnits")??new Ia}set displayUnits(t){this._set("displayUnits",t)}get inputUnits(){return this._get("inputUnits")??new Ia}set inputUnits(t){this._set("inputUnits",t)}};(0,r.bt)([(0,r.bu)({type:String,nonNullable:!0})],Oa.prototype,"directionMode",void 0),(0,r.bt)([(0,r.bu)({type:Boolean,nonNullable:!0})],Oa.prototype,"relativeDirectionIsBilateral",void 0),(0,r.bt)([(0,r.bu)()],Oa.prototype,"effectiveDirectionMode",null),(0,r.bt)([(0,r.bu)({type:Ia,nonNullable:!0})],Oa.prototype,"displayUnits",null),(0,r.bt)([(0,r.bu)({type:Ia,nonNullable:!0})],Oa.prototype,"inputUnits",null),Oa=(0,r.bt)([(0,r.bv)("esri.views.interactive.sketch.SketchValueOptions")],Oa);const Da=Oa;let Ga=class extends r.e9{constructor(t){super(t),this.labels=new Sa,this.tooltips=new Va,this.values=new Da}};(0,r.bt)([(0,r.bu)({nonNullable:!0,type:Sa})],Ga.prototype,"labels",void 0),(0,r.bt)([(0,r.bu)({nonNullable:!0,type:Va})],Ga.prototype,"tooltips",void 0),(0,r.bt)([(0,r.bu)({nonNullable:!0,type:Da})],Ga.prototype,"values",void 0),Ga=(0,r.bt)([(0,r.bv)("esri.views.interactive.sketch.SketchOptions")],Ga);const La=Ga;let za=class extends(r.d4.EventedMixin(Ea)){constructor(t){super(t),this._graphic=null,this._coordinateFormatterLoadTask=null,this._createOperationGeometry=null,this.defaultZ=0,this.directionOptions=null,this.geometryType=null,this.hasZ=!0,this.geometryToPlace=null,this.snappingManager=null,this.snapToScene=!1,this.sketchOptions=new La}initialize(){const{view:t}=this;this.internalGraphicsLayer=new r.eW({listMode:"hide",internal:!0}),this.view.map.layers.add(this.internalGraphicsLayer);const e=this.drawOperation=this.makeDrawOperation();this.tooltipInfos=Ws(t.type,this.sketchOptions);const n=To((()=>({view:t,options:this.sketchOptions.tooltips})));this.tooltip=n,$s(this._tooltipsContext),this._coordinateFormatterLoadTask=(0,r.dg)((()=>ot())),this.addHandles([e.on("vertex-add",(t=>this.onVertexAdd(t))),e.on("vertex-remove",(t=>this.onVertexRemove(t))),e.on("vertex-update",(t=>this.onVertexUpdate(t))),e.on("cursor-update",(t=>this.onCursorUpdate(t))),e.on("cursor-remove",(()=>this._updateGraphic())),e.on("complete",(t=>this.onComplete(t))),this._coordinateFormatterLoadTask,n.on("paste",(t=>Io(t,this.activeTooltipInfo))),(0,r.cc)((()=>this.cursor),(t=>{e.cursor=t}),r.hG),(0,r.uY)((()=>{const{activeTooltipInfo:t,sketchOptions:e}=this;ea(t,this._tooltipsContext),n.info=e.tooltips.effectiveEnabled?t:null})),(0,r.uY)((()=>{e.constraintZ=ma(this._tooltipsContext)}),r.eL)]),this.finishToolCreation()}destroy(){this.drawOperation=(0,r.ch)(this.drawOperation),this.tooltip=(0,r.ch)(this.tooltip),this._destroyAllVisualizations(),this.view.map.remove(this.internalGraphicsLayer),this.internalGraphicsLayer=(0,r.ch)(this.internalGraphicsLayer),this._set("view",null)}get _drawSpatialReference(){return this.drawOperation.coordinateHelper.spatialReference}get _tooltipsContext(){return{createOperationGeometry:this._createOperationGeometry,defaultZ:this.defaultZ,directionOptions:this.directionOptions,drawOperation:this.drawOperation,forceUniformSize:this.forceUniformSize,geometryType:this.geometryType,graphic:this.graphic,sketchOptions:this.sketchOptions,tooltipInfos:this.tooltipInfos,view:this.view}}get canRedo(){return this.drawOperation.canRedo}get canUndo(){return this.drawOperation.canUndo}set centered(t){this._set("centered",t),this._updateGraphic()}get cursor(){return this._get("cursor")}set cursor(t){this._set("cursor",t)}set enabled(t){this.drawOperation.interactive=t,this._set("enabled",t)}set forceUniformSize(t){this._set("forceUniformSize",t),this._updateGraphic()}get graphic(){return this._graphic}set graphicSymbol(t){this._set("graphicSymbol",t),null!=this._graphic&&(this._graphic.symbol=t)}set mode(t){const e=this.drawOperation;e&&(e.drawingMode=t),this._set("mode",t)}get updating(){return this.drawOperation?.updating??!1}get undoRedo(){const{view:{type:t,map:e}}=this;return"2d"===t&&e&&"undoRedo"in e&&e.undoRedo instanceof it?e.undoRedo:null}set undoRedo(t){this._override("undoRedo",t)}completeCreateOperation(){this.drawOperation.complete()}onInputEvent(t){this.destroyed||Vo(t,this.tooltip)||this.drawOperation.onInputEvent(t)}redo(){this.drawOperation.redo()}reset(){}undo(){this.drawOperation.undo(),0===this.drawOperation.numCommittedVertices&&$s(this._tooltipsContext)}_destroyAllVisualizations(){this.removeHandles(Ua.outline),this.removeHandles(Ua.regularVertices),this.removeHandles(Ua.activeVertex),this.removeHandles(Ua.activeEdge),this.removeHandles(Na)}_createOrUpdateGraphic(t){if(null!=this._graphic)return this.updateGraphicGeometry(t),this._graphic;const e=new r.a1({...this.graphicProperties,symbol:this.graphicSymbol});return this._graphic=e,this.updateGraphicGeometry(t),this.internalGraphicsLayer.add(e),this.addHandles(this.initializeGraphic(e)),this.notifyChange("graphic"),this.addHandles((0,r.bh)((()=>{this.internalGraphicsLayer.remove(e),this._graphic===e&&(this._graphic=null)})),Na),e}updateGraphicGeometry(t){this._graphic.geometry=t}_getCreateOperationGeometry(t={operationComplete:!1}){if(null==this.drawOperation)return;const{coordinateHelper:e,view:n,visualizationCursorVertex:i,lastVertex:r,committedVertices:o,geometryIncludingUncommittedVertices:s,numCommittedVertices:a}=this.drawOperation;if(!(a>0||null!=i))return;const l=t.operationComplete?o:s,c=l.length,u=null!=i?e.pointToArray(i):null,h=this._drawSpatialReference,p="3d"===n.type&&"global"===n.viewingMode,d=new ut;d.committedVertices=o,d.cursorVertex=u;const{geometryType:f}=this;switch(f){case"point":case"mesh":d.full=e.arrayToPoint(l[0]);break;case"multipoint":d.full=c>0?xt(l,h):null;break;case"polyline":case"polygon":c>0&&(d.full="polygon"===f?Mt([l],h,p,!0):wt([l],h,p),d.cursorEdge=null!=u&&r&&!x(i,r)?wt([[u,e.pointToArray(r)]],h,p):null,d.outline=c>1?d.full:null);break;case"circle":case"rectangle":{if(d.committedVertices=d.cursorVertex=null,!c)break;const e=vt(n,l[0]),i=l[0],r=e.makeMapPoint(i[0]+Fa*n.resolution,i[1]);"circle"===f?1===c&&t.operationComplete?d.circle=Vt([i,r],e,!0):2===c&&(this.forceUniformSize?d.circle=Vt(l,e,this.centered):d.rectangle=At(l,e,this.centered)):1===c&&t.operationComplete?d.rectangle=Et([i,r],e,!0):2===c&&(d.rectangle=this.forceUniformSize?Et(l,e,this.centered):Tt(l,e,this.centered)),d.full=null!=d.circle?d.circle.geometry:d.rectangle?.geometry,d.outline="polygon"===d.full?.type?d.full:null;break}default:return null}return d}initializeGraphic(t){return(0,r.bh)()}onComplete(t){if(!this.drawOperation)return;this._updateGraphic();let e=null;if(this.drawOperation.isCompleted){const t=this._getCreateOperationGeometry({operationComplete:!0});null!=t&&(e=this._createOrUpdateGraphic(t.full))}this._createOperationGeometry=null,this.emit("complete",{graphic:e,...t})}onCursorUpdate(t){this._updateGraphic(),this.emit("cursor-update",t)}onDeactivate(){const{drawOperation:t}=this;t&&(t.isCompleted||t.cancel())}onOutlineChanged(t){return(0,r.bh)()}onCursorEdgeChanged(t){return(0,r.bh)()}onVertexAdd(t){Ks(this._tooltipsContext),this._updateGraphic(),Qs(t.vertices.at(0)?.coordinates,this._tooltipsContext),this.emit("vertex-add",t)}onVertexRemove(t){Ks(this._tooltipsContext),this._updateGraphic(),this.emit("vertex-remove",t)}onVertexUpdate(t){this._updateGraphic(),this.emit("vertex-update",t)}_updateGraphic(){const t=this._getCreateOperationGeometry();this._createOperationGeometry=t,null!=t?(null!=t.cursorEdge?this.addHandles(this.onCursorEdgeChanged(t.cursorEdge),Ua.activeEdge):this.removeHandles(Ua.activeEdge),null!=t.outline?this.addHandles(this.onOutlineChanged(t.outline),Ua.outline):this.removeHandles(Ua.outline),null!=t.committedVertices?this.addHandles(this.onRegularVerticesChanged(t.committedVertices),Ua.regularVertices):this.removeHandles(Ua.regularVertices),null!=t.cursorVertex?this.addHandles(this.onActiveVertexChanged(t.cursorVertex),Ua.activeVertex):this.removeHandles(Ua.activeVertex),null!=t.full?this._createOrUpdateGraphic(t.full):this.removeHandles(Na)):this._destroyAllVisualizations()}get activeTooltipInfo(){return this._coordinateFormatterLoadTask?.finished?Js(this._tooltipsContext):null}};(0,r.bt)([(0,r.bu)()],za.prototype,"_coordinateFormatterLoadTask",void 0),(0,r.bt)([(0,r.bu)()],za.prototype,"_createOperationGeometry",void 0),(0,r.bt)([(0,r.bu)()],za.prototype,"_tooltipsContext",null),(0,r.bt)([(0,r.bu)({value:!0})],za.prototype,"centered",null),(0,r.bt)([(0,r.bu)()],za.prototype,"cursor",null),(0,r.bt)([(0,r.bu)({nonNullable:!0})],za.prototype,"defaultZ",void 0),(0,r.bt)([(0,r.bu)({constructOnly:!0})],za.prototype,"directionOptions",void 0),(0,r.bt)([(0,r.bu)()],za.prototype,"drawOperation",void 0),(0,r.bt)([(0,r.bu)({value:!0})],za.prototype,"enabled",null),(0,r.bt)([(0,r.bu)({value:!0})],za.prototype,"forceUniformSize",null),(0,r.bt)([(0,r.bu)({constructOnly:!0})],za.prototype,"geometryType",void 0),(0,r.bt)([(0,r.bu)()],za.prototype,"graphic",null),(0,r.bt)([(0,r.bu)({constructOnly:!0})],za.prototype,"graphicProperties",void 0),(0,r.bt)([(0,r.bu)()],za.prototype,"graphicSymbol",null),(0,r.bt)([(0,r.bu)({constructOnly:!0})],za.prototype,"hasZ",void 0),(0,r.bt)([(0,r.bu)({constructOnly:!0})],za.prototype,"geometryToPlace",void 0),(0,r.bt)([(0,r.bu)()],za.prototype,"mode",null),(0,r.bt)([(0,r.bu)()],za.prototype,"snappingManager",void 0),(0,r.bt)([(0,r.bu)()],za.prototype,"snapToScene",void 0),(0,r.bt)([(0,r.bu)()],za.prototype,"tooltip",void 0),(0,r.bt)([(0,r.bu)()],za.prototype,"tooltipInfos",void 0),(0,r.bt)([(0,r.bu)({constructOnly:!0,type:La})],za.prototype,"sketchOptions",void 0),(0,r.bt)([(0,r.bu)()],za.prototype,"updating",null),(0,r.bt)([(0,r.bu)({constructOnly:!0,nonNullable:!0})],za.prototype,"view",void 0),(0,r.bt)([(0,r.bu)({constructOnly:!0})],za.prototype,"undoRedo",null),(0,r.bt)([(0,r.bu)()],za.prototype,"activeTooltipInfo",null),za=(0,r.bt)([(0,r.bv)("esri.views.draw.DrawGraphicTool")],za);const Na=Symbol("create-operation-graphic"),Ua={outline:Symbol("outline-visual"),regularVertices:Symbol("regular-vertices-visual"),activeVertex:Symbol("active-vertex-visual"),activeEdge:Symbol("active-edge-visual")};function Ha(t){switch(t){case"point":case"polyline":case"polygon":case"multipoint":return t;case"circle":case"rectangle":return"segment";case"mesh":return"point"}}const Fa=48,Za="click";let Ba=class{constructor({consumesClicks:t,grabbableForEvent:e}){this.events=new r.d4,this.interactive=!0,this.selectable=!1,this.cursor=null,this.grabbable=!0,this.consumesClicks=t,this.grabbableForEvent=e}destroy(){}intersectionDistance(t,e){return 0}attach(){}detach(){}onElevationChange(){}onViewChange(){}};var qa;(function(t){t[t.Z=0]="Z",t[t.M=1]="M"})(qa||(qa={}));let Ya=class{constructor(t){this.spatialReference=t}createVector(){return this._tag((0,r.g_)())}pointToVector(t){return this._tag((0,r.o5)(t.x,t.y))}arrayToVector(t){return this._tag((0,r.o5)(t[0],t[1]))}vectorToArray(t){return[t[0],t[1]]}pointToArray(t){return[t.x,t.y]}vectorToPoint(t,e=new r.D){return e.x=t[0],e.y=t[1],e.z=void 0,e.m=void 0,e.spatialReference=this.spatialReference,e}arrayToPoint(t,e=new r.D){return e.x=t[0],e.y=t[1],e.z=void 0,e.m=void 0,e.spatialReference=this.spatialReference,e}vectorToDehydratedPoint(t,e){if(t)return e??={x:void 0,y:void 0,z:void 0,m:void 0,hasZ:void 0,hasM:void 0,spatialReference:void 0,type:"point"},e.x=t[0],e.y=t[1],e.z=void 0,e.m=void 0,e.hasZ=!1,e.hasM=!1,e.spatialReference=this.spatialReference,e}lerp(t,e,n,i){return(0,r.o4)(i,t,e,n)}addDelta(t,e,n){t[0]+=e,t[1]+=n}distance(t,e){return(0,r.uZ)(t,e)}getZ(t,e=void 0){return e}hasZ(){return!1}getM(t,e=void 0){return e}hasM(){return!1}clone(t){return this._tag((0,r.u_)(t))}copy(t,e){return(0,r.qj)(e,t)}fromXYZ(t){return this._tag((0,r.o5)(t[0],t[1]))}toXYZ(t,e=(0,r.ap)()){return(0,r.dQ)(e,t[0],t[1],0)}pointToXYZ(t,e=(0,r.ap)()){return(0,r.dQ)(e,t.x,t.y,0)}equals(t,e){return(0,r.u$)(t,e)}_tag(t){return t}};class Xa{constructor(t,e){this._valueType=t,this.spatialReference=e}createVector(){return this._tag((0,r.ap)())}pointToVector(t){return this._tag((0,r.aq)(t.x,t.y,this._valueType===qa.Z?t.z:t.m))}arrayToVector(t){return this._tag((0,r.aq)(t[0],t[1],t[2]||0))}vectorToArray(t){return[t[0],t[1],t[2]]}pointToArray(t){return this._valueType===qa.Z?[t.x,t.y,t.z]:[t.x,t.y,t.m]}vectorToPoint(t,e=new r.D){return e.x=t[0],e.y=t[1],e.z=this._valueType===qa.Z?t[2]:void 0,e.m=this._valueType===qa.M?t[2]:void 0,e.spatialReference=this.spatialReference,e}arrayToPoint(t,e=new r.D){return e.x=t[0],e.y=t[1],e.z=this._valueType===qa.Z?t[2]:void 0,e.m=this._valueType===qa.M?t[2]:void 0,e.spatialReference=this.spatialReference,e}vectorToDehydratedPoint(t,e){if(!t)return;e??={x:void 0,y:void 0,z:void 0,m:void 0,hasZ:void 0,hasM:void 0,spatialReference:void 0,type:"point"};const n=this._valueType===qa.Z,i=this._valueType===qa.M;return e.x=t[0],e.y=t[1],e.z=n?t[2]:void 0,e.m=i?t[2]:void 0,e.hasZ=n,e.hasM=i,e.spatialReference=this.spatialReference,e}lerp(t,e,n,i){return(0,r.iX)(i,t,e,n)}addDelta(t,e,n,i){t[0]+=e,t[1]+=n,this._valueType===qa.Z&&(t[2]+=i)}distance(t,e){return this._valueType===qa.Z?(0,r.dR)(t,e):(0,r.uZ)(t,e)}getZ(t,e=void 0){return this._valueType===qa.Z?t[2]:e}hasZ(){return this._valueType===qa.Z}getM(t,e=void 0){return this._valueType===qa.M?t[2]:e}hasM(){return this._valueType===qa.M}clone(t){return this._tag((0,r.fC)(t))}copy(t,e){return(0,r.dF)(e,t)}fromXYZ(t,e=0,n=0){return this._tag((0,r.aq)(t[0],t[1],this._valueType===qa.Z?t.length>2?t[2]:e:n))}toXYZ(t,e=(0,r.ap)()){return(0,r.dQ)(e,t[0],t[1],this._valueType===qa.Z?t[2]:0)}pointToXYZ(t,e=(0,r.ap)()){return(0,r.dQ)(e,t.x,t.y,this._valueType===qa.Z?t.z??0:0)}equals(t,e){return(0,r.uF)(t,e)}_tag(t){return t}}let ja=class{constructor(t){this.spatialReference=t}createVector(){return this._tag((0,r.iB)())}pointToVector(t){return this._tag((0,r.iV)(t.x,t.y,t.z,t.m))}arrayToVector(t){return this._tag((0,r.iV)(t[0],t[1],t[2]||0,t[3]||0))}vectorToArray(t){return[t[0],t[1],t[2],t[3]]}pointToArray(t){return[t.x,t.y,t.z,t.m]}vectorToPoint(t,e=new r.D){return e.x=t[0],e.y=t[1],e.z=t[2],e.m=t[3],e.spatialReference=this.spatialReference,e}arrayToPoint(t,e=new r.D){return e.x=t[0],e.y=t[1],e.z=t[2],e.m=t[3],e.spatialReference=this.spatialReference,e}vectorToDehydratedPoint(t,e){if(t)return e??={x:void 0,y:void 0,z:void 0,m:void 0,hasZ:void 0,hasM:void 0,spatialReference:void 0,type:"point"},e.x=t[0],e.y=t[1],e.z=t[2],e.m=t[3],e.hasZ=!0,e.hasM=!0,e.spatialReference=this.spatialReference,e}lerp(t,e,n,i){return(0,r.af)(i,t,e,n)}addDelta(t,e,n,i){t[0]+=e,t[1]+=n,t[2]+=i}distance(t,e){return(0,r.dR)(t,e)}getZ(t){return t[2]}hasZ(){return!0}getM(t){return t[3]}hasM(){return!0}clone(t){return this._tag((0,r.v0)(t))}copy(t,e){return(0,r.aa)(e,t)}fromXYZ(t,e=0,n=0){return this._tag((0,r.iV)(t[0],t[1],t.length>2?t[2]:e,n))}toXYZ(t,e=(0,r.ap)()){return(0,r.dQ)(e,t[0],t[1],t[2])}pointToXYZ(t,e=(0,r.ap)()){return(0,r.dQ)(e,t.x,t.y,t.z??0)}equals(t,e){return(0,r.ak)(t,e)}_tag(t){return t}};function Wa(t,e,n){return t&&e?new ja(n):e?new Xa(qa.M,n):t?new Xa(qa.Z,n):new Ya(n)}function $a(t,e){if(!e.supported)return;let n=1/0,i=-1/0;const r=e.upperBoundX-e.lowerBoundX;t.forEach((t=>{let o=t.pos[0];for(;o<e.lowerBoundX;)o+=r;for(;o>e.upperBoundX;)o-=r;n=Math.min(n,o),i=Math.max(i,o),t.pos[0]=o}));const o=i-n;r-o<o&&t.forEach((t=>{t.pos[0]<0&&(t.pos[0]+=r)}))}function Qa(t,e){const n=(0,r.b3)(t);return e===r.iE.Global&&n?{supported:!0,lowerBoundX:n.valid[0],upperBoundX:n.valid[1]}:{supported:!1,lowerBoundX:null,upperBoundX:null}}let Ka=class{constructor(t){this.component=t,this.leftEdge=null,this.rightEdge=null,this.type="vertex",this.index=null}get pos(){return this._pos}set pos(t){this._pos=t,this.component.unnormalizeVertexPositions()}};class Ja{constructor(t,e,n){this.component=t,this.leftVertex=e,this.rightVertex=n,this.type="edge",e.rightEdge=this,n.leftEdge=this}}class tl{constructor(t,e){this._spatialReference=t,this._viewingMode=e,this.vertices=[],this.edges=[],this.index=null}unnormalizeVertexPositions(){this.vertices.length<=1||$a(this.vertices,Qa(this._spatialReference,this._viewingMode))}updateVertexIndex(t,e){if(0===this.vertices.length)return;const n=this.vertices[0];let i=null,r=t,o=e;do{i=r,i.index=o++,r=i.rightEdge?i.rightEdge.rightVertex:null}while(null!=r&&r!==n);i.leftEdge&&i!==this.vertices[this.vertices.length-1]&&this.swapVertices(this.vertices.indexOf(i),this.vertices.length-1)}getFirstVertex(){return this.vertices.at(0)}getLastVertex(){return this.vertices.at(-1)}isClosed(){return this.vertices.length>2&&null!==this.vertices[0].leftEdge}swapVertices(t,e){const n=this.vertices[t];this.vertices[t]=this.vertices[e],this.vertices[e]=n}iterateVertices(t){if(0===this.vertices.length)return;const e=this.vertices[0];let n=e;do{t(n,n.index),n=null!=n.rightEdge?n.rightEdge.rightVertex:null}while(n!==e&&null!=n)}}let el=class t extends r.d4{constructor(t,e){super(),this.type=t,this.coordinateHelper=e,this._geometry=null,this._dirty=!0,this.components=[]}get geometry(){if(this._dirty){switch(this.type){case"point":this._geometry=this._toPoint();break;case"polyline":this._geometry=this._toPolyline();break;case"polygon":this._geometry=this._toPolygon();break;case"mesh":break;default:(0,r.iq)(this.type)}this._dirty=!1}return this._geometry}get spatialReference(){return this.coordinateHelper.spatialReference}get allVertices(){return Array.from(this.iterateVertices())}*iterateVertices(){for(const t of this.components)for(const e of t.vertices)yield e}notifyChanges(t){this._dirty=!0,this.emit("change",t)}_toPoint(){return 0===this.components.length||0===this.components[0].vertices.length?null:this.coordinateHelper.vectorToPoint(this.components[0].vertices[0].pos)}_toPolyline(){const t=[],e=this.coordinateHelper.vectorToArray;for(const n of this.components){if(n.vertices.length<1)continue;const i=[];let r=n.vertices.find((t=>null==t.leftEdge));const o=r;do{i.push(e(r.pos)),r=r.rightEdge?r.rightEdge.rightVertex:null}while(r&&r!==o);t.push(i)}return new r.a_({paths:t,spatialReference:this.spatialReference,hasZ:this.coordinateHelper.hasZ(),hasM:this.coordinateHelper.hasM()})}_toPolygon(){const t=[],e=this.coordinateHelper.vectorToArray;for(const n of this.components){if(n.vertices.length<1)continue;const i=[],r=n.vertices[0];let o=r;const s=o;do{i.push(e(o.pos)),o=null!=o.rightEdge?o.rightEdge.rightVertex:null}while(o&&o!==s);n.isClosed()&&i.push(e(r.pos)),t.push(i)}return new r.a$({rings:t,spatialReference:this.spatialReference,hasZ:this.coordinateHelper.hasZ(),hasM:this.coordinateHelper.hasM()})}static fromGeometry(e,n){const i=e.spatialReference,r=Wa(e.hasZ,e.hasM,i),o=new t(e.type,r);switch(e.type){case"polygon":nl(o,e,n);break;case"polyline":il(o,e,n);break;case"point":rl(o,e,n);break;case"mesh":rl(o,e.origin,n),o._geometry=e,o._dirty=!1}return o}};function nl(t,e,n){const i=e.spatialReference,o=t.coordinateHelper,s=e.rings;for(let a=0;a<s.length;++a){const e=s[a],l=new tl(i,n);l.index=a;const c=e.length>2&&(0,r.c)(e[0],e[e.length-1]),u=c?e.length-1:e.length;for(let t=0;t<u;++t){const n=o.arrayToVector(e[t]),i=new Ka(l);l.vertices.push(i),i.pos=n,i.index=t}const h=l.vertices.length-1;for(let t=0;t<h;++t){const e=l.vertices[t],n=l.vertices[t+1],i=new Ja(l,e,n);l.edges.push(i)}if(c){const t=new Ja(l,l.vertices[l.vertices.length-1],l.vertices[0]);l.edges.push(t)}t.components.push(l)}}function il(t,e,n){const i=e.spatialReference,r=t.coordinateHelper,o=e.paths;for(let s=0;s<o.length;++s){const e=o[s],a=new tl(i,n);a.index=s;const l=e.length;for(let t=0;t<l;++t){const n=r.arrayToVector(e[t]),i=new Ka(a);a.vertices.push(i),i.pos=n,i.index=t}const c=a.vertices.length-1;for(let t=0;t<c;++t){const e=a.vertices[t],n=a.vertices[t+1],i=new Ja(a,e,n);a.edges.push(i)}t.components.push(a)}}function rl(t,e,n){const i=e.spatialReference,r=t.coordinateHelper,o=new tl(i,n);o.index=0;const s=new Ka(o);s.index=0,s.pos=r.pointToVector(e),o.vertices.push(s),t.components.push(o)}function ol(t){return"mesh"===t.type}var sl;(function(t){t[t.NEW_STEP=0]="NEW_STEP",t[t.ACCUMULATE_STEPS=1]="ACCUMULATE_STEPS"})(sl||(sl={}));let al=class{constructor(t,e,n){this._editGeometry=t,this._component=e,this._pos=n,this._addedVertex=null,this._originalEdge=null,this._left=null,this._right=null}apply(){let t="redo";null==this._addedVertex&&(t="apply",this._addedVertex=new Ka(this._component));const e=this._component.getLastVertex();if(null==e)this._component.vertices.push(this._addedVertex),this._addedVertex.pos=this._pos,this._addedVertex.index=0;else{let t=null;e.rightEdge&&(this._originalEdge=e.rightEdge,t=this._originalEdge.rightVertex,this._component.edges.splice(this._component.edges.indexOf(this._originalEdge),1)),this._component.vertices.push(this._addedVertex),this._addedVertex.pos=this._pos,null==this._left&&(this._left=new Ja(this._component,e,this._addedVertex)),this._component.edges.push(this._left),e.rightEdge=this._left,null!=this._originalEdge&&null!=t&&(null==this._right&&(this._right=new Ja(this._component,this._addedVertex,t)),this._component.edges.push(this._right),t.leftEdge=this._right),this._component.updateVertexIndex(this._addedVertex,e.index+1)}this._editGeometry.notifyChanges({operation:t,addedVertices:[this._addedVertex]})}undo(){null!=this._addedVertex&&(this._component.vertices.splice(this._component.vertices.indexOf(this._addedVertex),1),null!=this._left&&(this._component.edges.splice(this._component.edges.indexOf(this._left),1),this._left.leftVertex.rightEdge=null),null!=this._right&&(this._component.edges.splice(this._component.edges.indexOf(this._right),1),this._right.rightVertex.leftEdge=null),null!=this._originalEdge&&(this._component.edges.push(this._originalEdge),this._originalEdge.leftVertex.rightEdge=this._originalEdge,this._originalEdge.rightVertex.leftEdge=this._originalEdge),null!=this._left?this._component.updateVertexIndex(this._left.leftVertex,this._left.leftVertex.index):this._component.updateVertexIndex(this._addedVertex,0),this._editGeometry.notifyChanges({operation:"undo",removedVertices:[this._addedVertex]}))}accumulate(){return!1}},ll=class t{constructor(t,e,n){this._editGeometry=t,this._vertices=e,this.operation=n,this._undone=!1}apply(){this._vertices.forEach((t=>this.operation.apply(t))),this._editGeometry.components.forEach((t=>t.unnormalizeVertexPositions())),this._editGeometry.notifyChanges({operation:this._undone?"redo":"apply",updatedVertices:this._vertices})}undo(){this._vertices.forEach((t=>this.operation.undo(t))),this._editGeometry.notifyChanges({operation:"undo",updatedVertices:this._vertices}),this._undone=!0}canAccumulate(t){if(this._undone||t._vertices.length!==this._vertices.length)return!1;for(let e=0;e<t._vertices.length;++e)if(t._vertices[e]!==this._vertices[e])return!1;return this.operation.canAccumulate(t.operation)}accumulate(e){return!!(e instanceof t&&this.canAccumulate(e))&&(this._vertices.forEach((t=>this.operation.accumulate(t,e.operation))),this.operation.accumulateParams(e.operation),this._editGeometry.components.forEach((t=>t.unnormalizeVertexPositions())),this._editGeometry.notifyChanges({operation:"apply",updatedVertices:this._vertices}),!0)}};var cl;(function(t){t[t.CUMULATIVE=0]="CUMULATIVE",t[t.REPLACE=1]="REPLACE"})(cl||(cl={}));let ul=class{constructor(t,e,n=0){this._editGeometry=t,this._vertices=e,this._minNumberOfVertices=n,this.removedVertices=null}apply(){let t="redo";if(null==this.removedVertices){const e=this.removedVertices=[];this._vertices.forEach((t=>{const n=this._removeVertex(t);null!=n&&e.push(n)})),t="apply"}else this.removedVertices.forEach((t=>{this._removeVertex(t.removedVertex)}));this._editGeometry.notifyChanges({operation:t,removedVertices:this._vertices})}undo(){this.removedVertices?.forEach((t=>{this._undoRemoveVertex(t)})),this._editGeometry.notifyChanges({operation:"undo",addedVertices:this._vertices})}accumulate(){return!1}_removeVertex(t){const e=t.component;if(e.vertices.length<=this._minNumberOfVertices)return null;const n={removedVertex:t,createdEdge:null},i=t.leftEdge,r=t.rightEdge;return e.vertices.splice(e.vertices.indexOf(t),1),i&&(e.edges.splice(e.edges.indexOf(i),1),i.leftVertex.rightEdge=null),r&&(e.edges.splice(e.edges.indexOf(r),1),r.rightVertex.leftEdge=null),0===t.index&&r&&this._vertices.length>0&&e.swapVertices(e.vertices.indexOf(r.rightVertex),0),i&&r&&(n.createdEdge=new Ja(e,i.leftVertex,r.rightVertex),e.edges.push(n.createdEdge)),r&&e.updateVertexIndex(r.rightVertex,r.rightVertex.index-1),n}_undoRemoveVertex(t){const e=t.removedVertex,n=t.removedVertex.component,i=e.leftEdge,r=e.rightEdge;t.createdEdge&&n.edges.splice(n.edges.indexOf(t.createdEdge),1),n.vertices.push(e),i&&(n.edges.push(i),i.leftVertex.rightEdge=i),r&&(n.edges.push(r),r.rightVertex.leftEdge=r),n.updateVertexIndex(e,e.index)}},hl=class{constructor(t,e,n){this._editGeometry=t,this._edge=e,this._t=n,this.createdVertex=null,this._left=null,this._right=null}apply(){let t="redo";const e=this._edge,n=e.component,i=e.leftVertex,r=e.rightVertex;n.edges.splice(n.edges.indexOf(e),1),null==this.createdVertex&&(t="apply",this.createdVertex=new Ka(e.component)),n.vertices.push(this.createdVertex),this.createdVertex.pos=this._editGeometry.coordinateHelper.lerp(e.leftVertex.pos,e.rightVertex.pos,this._t,this._editGeometry.coordinateHelper.createVector()),null==this._left&&(this._left=new Ja(n,i,this.createdVertex)),this._left.leftVertex.leftEdge?n.edges.push(this._left):n.edges.unshift(this._left),i.rightEdge=this._left,null==this._right&&(this._right=new Ja(n,this.createdVertex,r)),n.edges.push(this._right),r.leftEdge=this._right,n.updateVertexIndex(this.createdVertex,i.index+1),this._editGeometry.notifyChanges({operation:t,addedVertices:[this.createdVertex]})}undo(){if(null==this.createdVertex||null==this._left||null==this._right)return null;const t=this._edge,e=t.component,n=this.createdVertex.leftEdge,i=this.createdVertex.rightEdge,r=n?.leftVertex,o=i?.rightVertex;e.vertices.splice(e.vertices.indexOf(this.createdVertex),1),e.edges.splice(e.edges.indexOf(this._left),1),e.edges.splice(e.edges.indexOf(this._right),1),this._edge.leftVertex.leftEdge?e.edges.push(this._edge):e.edges.unshift(this._edge),r&&(r.rightEdge=t),o&&(o.leftEdge=t),r&&e.updateVertexIndex(r,r.index),this._editGeometry.notifyChanges({operation:"undo",removedVertices:[this.createdVertex]})}accumulate(){return!1}},pl=class t{constructor(t,e,n){this._editGeometry=t,this._vertex=e,this._pos=n}apply(){const t=null==this._originalPosition;t&&(this._originalPosition=this._vertex.pos),this._apply(t?"apply":"redo")}undo(){this._vertex.pos=this._originalPosition,this._editGeometry.notifyChanges({operation:"undo",updatedVertices:[this._vertex]})}accumulate(e){return e instanceof t&&e._vertex===this._vertex&&(this._pos=e._pos,this._apply("apply"),!0)}_apply(t){this._vertex.pos=this._pos,this._editGeometry.components.forEach((t=>t.unnormalizeVertexPositions())),this._editGeometry.notifyChanges({operation:t,updatedVertices:[this._vertex]})}},dl=class{constructor(t,e){this._editGeometry=t,this._component=e,this._createdEdge=null}apply(){let t="redo";if(null==this._createdEdge){t="apply";const e=this._component.getFirstVertex(),n=this._component.getLastVertex();if(this._component.isClosed()||this._component.vertices.length<3||null==e||null==n)return;this._createdEdge=new Ja(this._component,n,e)}this._createdEdge.leftVertex.rightEdge=this._createdEdge,this._createdEdge.rightVertex.leftEdge=this._createdEdge,this._component.edges.push(this._createdEdge),this._editGeometry.notifyChanges({operation:t})}undo(){null!=this._createdEdge&&((0,r.fs)(this._component.edges,this._createdEdge),this._createdEdge.leftVertex.rightEdge=null,this._createdEdge.rightVertex.leftEdge=null,this._editGeometry.notifyChanges({operation:"undo"}))}accumulate(){return!1}},fl=class t{constructor(t,e,n,i){this._editGeometry=t,this.dx=e,this.dy=n,this.dz=i,this._firstTime=!0}apply(){const t=this._firstTime?"apply":"redo";this._firstTime=!1,this._apply(t,this.dx,this.dy,this.dz)}undo(){this._apply("undo",-this.dx,-this.dy,-this.dz)}accumulate(e){const n=this._editGeometry.geometry;return e instanceof t&&e._editGeometry.geometry===n&&(this._apply("apply",e.dx,e.dy,e.dz),this.dx+=e.dx,this.dy+=e.dy,this.dz+=e.dz,!0)}_apply(t,e,n,i){const r=this._editGeometry.geometry;r.offset(e,n,i);const o=this._editGeometry.components[0].getFirstVertex();if(!o)return;const s=this._editGeometry.coordinateHelper;o.pos=s.pointToVector(r.origin),this._editGeometry.notifyChanges({operation:t,updatedVertices:[o]})}},gl=class t{constructor(t,e,n,i){this._helper=t,this.dx=e,this.dy=n,this.dz=i}_move(t,e,n,i){this._helper.addDelta(t.pos,e,n,i)}apply(t){this._move(t,this.dx,this.dy,this.dz)}undo(t){this._move(t,-this.dx,-this.dy,-this.dz)}canAccumulate(e){return e instanceof t}accumulate(t,e){this._move(t,e.dx,e.dy,e.dz)}accumulateParams(t){this.dx+=t.dx,this.dy+=t.dy,this.dz+=t.dz}},ml=class t{get plane(){return this._plane}get requiresSplitEdgeLeft(){return!this._left.isOriginalDirection}get requiresSplitEdgeRight(){return!this._right.isOriginalDirection}get edgeDirection(){return this._edgeDirection}constructor(t,e,n,i=0,r=bl.IMMEDIATE){this._helper=t,this._planeType=e,this._edge=n,this.distance=i,this._plane=(0,p.M)(),this._offsetPlane=(0,p.M)(),this._minDistance=-1/0,this._maxDistance=1/0,this._selectedArrow=1,r===bl.IMMEDIATE&&this._initialize()}_initialize(){this._initializeNeighbors(),this._initializePlane(),this._initializeDistanceConstraints()}_initializeNeighbors(){const t=this._toXYZ(this._edge.leftVertex.pos),e=this._toXYZ(this._edge.leftVertex.leftEdge?.leftVertex?.pos),n=this._toXYZ(this._edge.rightVertex.pos),i=this._toXYZ(this._edge.rightVertex.rightEdge?.rightVertex?.pos);this._edgeDirection=(0,r.dT)((0,r.ap)(),t,n),e?(this._left=this._computeNeighbor(t,e,this._edgeDirection),this._right=this._computeNeighbor(n,i,this._edgeDirection,this._left)):(this._right=this._computeNeighbor(n,i,this._edgeDirection),this._left=this._computeNeighbor(t,e,this._edgeDirection,this._right))}_toXYZ(t){return null!=t?this._helper.toXYZ(t):null}_pointToXYZ(t){return this._toXYZ(this._helper.pointToVector(t))}_computeNeighbor(t,e,n,i){const o=(0,r.ap)();if(e){(0,r.dT)(o,t,e);const i=!this._passesBisectingAngleThreshold(o,n);return{start:t,end:e,direction:i?this._bisectVectorsPerpendicular(n,o):o,isOriginalDirection:!i}}return this._helper.hasZ()?i&&((0,r.am)(o,n,i.direction),(0,r.am)(o,o,n),(0,r.ao)(o,o),Math.sign(o[1])!==Math.sign(n[0])&&(0,r.dC)(o,o,-1)):(0,r.dQ)(o,-n[1],n[0],0),{start:t,end:e,direction:o,isOriginalDirection:!0}}_passesBisectingAngleThreshold(t,e){const n=Math.abs((0,p.b)(e,t));return n>=yl&&n<=Math.PI-yl}_bisectVectorsPerpendicular(t,e){const n=(0,r.al)(t,e)<0?t:(0,r.gl)((0,r.ap)(),t),i=Math.abs((0,r.al)(n,e));if(!(i<_l||i>1-_l))return this._bisectDirection(n,e);const o=(0,r.am)((0,r.ap)(),n,[0,0,1]);return(0,r.ao)(o,o)}_bisectDirection(t,e){const n=(0,r.dE)((0,r.ap)(),t,e);return(0,r.ao)(n,n)}_initializePlane(){const t=this._computeNormalDirection(this._left),e=this._computeNormalDirection(this._right);(0,r.al)(t,e)<0&&(0,r.gl)(e,e),(0,p.l)(this._left.start,this._bisectDirection(t,e),this._plane)}_computeNormalDirection(t){const e=(0,r.am)((0,r.ap)(),t.direction,this._edgeDirection);(0,r.ao)(e,e);const n=(0,r.am)((0,r.ap)(),this._edgeDirection,e);return this._planeType===vl.XY&&(n[2]=0),(0,r.ao)(n,n)}_initializeDistanceConstraints(){null==this._left.end||this.requiresSplitEdgeLeft||this._updateDistanceConstraint((0,p.V)(this._plane,this._left.end)),null==this._right.end||this.requiresSplitEdgeRight||this._updateDistanceConstraint((0,p.V)(this._plane,this._right.end)),this._updateIntersectDistanceConstraint(this._plane)}_updateDistanceConstraint(t){t<=0&&(this._minDistance=Math.max(this._minDistance,t)),t>=0&&(this._maxDistance=Math.min(this._maxDistance,t))}_updateIntersectDistanceConstraint(t){const e=(0,p.O)(t),n=this._edgeDirection,i=(0,r.dE)((0,r.ap)(),this._left.start,this._left.direction),o=(0,r.dE)((0,r.ap)(),this._right.start,this._right.direction),s=this._pointInBasis2D((0,r.g_)(),e,n,this._left.start),a=this._pointInBasis2D((0,r.g_)(),e,n,i),l=this._pointInBasis2D((0,r.g_)(),e,n,this._right.start),c=this._pointInBasis2D((0,r.g_)(),e,n,o),[u]=Zt({start:a,end:s,type:qt.LINE},{start:c,end:l,type:qt.LINE});if(!u)return;const h=(0,r.un)((0,r.g_)(),s,a);(0,r.nf)(h,h);const d=(0,r.un)((0,r.g_)(),u,a),f=(0,r.uD)(h,d),g=(0,r.dE)((0,r.ap)(),i,(0,r.dC)((0,r.ap)(),this._left.direction,-f)),m=(0,p.V)(t,g);this._updateDistanceConstraint(m)}_pointInBasis2D(t,e,n,i){return t[0]=(0,p.f)(e,i),t[1]=(0,p.f)(n,i),t}_offset(t,e){Number.isFinite(this._minDistance)&&(e=Math.max(this._minDistance,e)),Number.isFinite(this._maxDistance)&&(e=Math.min(this._maxDistance,e)),(0,p.h)(this._offsetPlane,this._plane),this._offsetPlane[3]-=e;const n=(t,e,n)=>null!=e&&(0,p.k)(this._offsetPlane,t,(0,r.dE)((0,r.ap)(),t,e),n),i=(0,r.ap)();(t===this._edge.leftVertex?n(this._left.start,this._left.direction,i):n(this._right.start,this._right.direction,i))&&this._helper.copy(this._helper.fromXYZ(i,void 0,this._helper.getM(t.pos)),t.pos)}selectArrowFromStartPoint(t){this._selectedArrow=(0,p.z)(this.plane,this._pointToXYZ(t))?1:-1}get selectedArrow(){return this._selectedArrow}signedDistanceToPoint(t){return(0,p.V)(this.plane,this._pointToXYZ(t))}clampedStartAndEnd(t){const e=this._helper.toXYZ(this._helper.pointToVector(t)),n=(0,p.H)(this._plane,e,(0,r.ap)()),i=(0,p.V)(this._plane,e),o=(0,r.b0)(i,this._minDistance,this._maxDistance);return(0,r.iX)(e,n,e,o/i),{start:n,end:e}}apply(t){this._offset(t,this.distance)}undo(t){this._offset(t,0)}canAccumulate(e){return e instanceof t&&this._edge.leftVertex.index===e._edge.leftVertex.index&&this._edge.rightVertex.index===e._edge.rightVertex.index&&this._edge.component===e._edge.component&&this._maybeEqualsVec3(this._left.direction,e._left.direction)&&this._maybeEqualsVec3(this._right.direction,e._right.direction)&&(0,r.uF)((0,p.O)(this._plane),(0,p.O)(e._plane))}accumulate(t,e){const n=this._plane[3]-e._plane[3]+e.distance;this._offset(t,n)}accumulateParams(t){const e=t.distance-t._plane[3];this.distance=e+this._plane[3]}clone(){const e=new t(this._helper,this._planeType,this._edge,this.distance,bl.DEFERRED);return(0,p.h)(e._plane,this._plane),(0,p.h)(e._offsetPlane,this._offsetPlane),e._maxDistance=this._maxDistance,e._minDistance=this._minDistance,e._left=this._cloneNeighbor(this._left),e._right=this._cloneNeighbor(this._right),e._edgeDirection=(0,r.dF)((0,r.ap)(),this._edgeDirection),e}_maybeEqualsVec3(t,e){return null==t&&null==e||null!=t&&null!=e&&(0,r.uF)(t,e)}_cloneNeighbor({start:t,end:e,direction:n,isOriginalDirection:i}){return{start:(0,r.dF)((0,r.ap)(),t),end:null!=e?(0,r.dF)((0,r.ap)(),e):null,direction:(0,r.dF)((0,r.ap)(),n),isOriginalDirection:i}}};const yl=(0,r.fA)(15),_l=.001;var vl,bl;(function(t){t[t.XYZ=0]="XYZ",t[t.XY=1]="XY"})(vl||(vl={})),function(t){t[t.IMMEDIATE=0]="IMMEDIATE",t[t.DEFERRED=1]="DEFERRED"}(bl||(bl={}));let xl=class t{constructor(t,e,n=cl.CUMULATIVE){this.origin=t,this.angle=e,this._accumulationType=n}_rotate(t,e){(0,r.o3)(t.pos,t.pos,this.origin,e)}apply(t){this._rotate(t,this.angle)}undo(t){this._rotate(t,-this.angle)}canAccumulate(e){return e instanceof t&&(0,r.c)(this.origin,e.origin)}accumulate(t,e){const n=e._accumulationType===cl.REPLACE;this._rotate(t,n?e.angle-this.angle:e.angle)}accumulateParams(t){const e=t._accumulationType===cl.REPLACE;this.angle=e?t.angle:this.angle+t.angle}};class wl{constructor(t,e,n,i,o=cl.CUMULATIVE){this.origin=t,this.axis1=e,this.factor1=n,this.factor2=i,this._accumulationType=o,this.axis2=(0,r.o5)(e[1],-e[0])}_scale(t,e,n){(0,r.v1)(t.pos,t.pos,this.origin,this.axis1,e),(0,r.v1)(t.pos,t.pos,this.origin,this.axis2,n)}apply(t){this._scale(t,this.factor1,this.factor2)}undo(t){this._scale(t,1/this.factor1,1/this.factor2)}canAccumulate(t){return t instanceof wl&&(0,r.c)(this.origin,t.origin)&&(0,r.c)(this.axis1,t.axis1)}accumulate(t,e){e._accumulationType===cl.REPLACE?this._scale(t,e.factor1/this.factor1,e.factor2/this.factor2):this._scale(t,e.factor1,e.factor2)}accumulateParams(t){const e=t._accumulationType===cl.REPLACE;this.factor1=e?t.factor1:this.factor1*t.factor1,this.factor2=e?t.factor2:this.factor2*t.factor2}}let Ml=class t{constructor(t,e){this._editGeometry=t,this._newPositions=e}apply(){const t=null==this._originalPositions?"apply":"redo";if(!this._originalPositions){const t=this._editGeometry.coordinateHelper;this._originalPositions=this._editGeometry.allVertices.map((e=>t.clone(e.pos)))}this._apply(t,this._newPositions)}undo(){this._originalPositions&&this._apply("undo",this._originalPositions)}accumulate(e){return e instanceof t&&(this._newPositions=e._newPositions,this._apply("apply",this._newPositions),!0)}_apply(t,e){const n=this._editGeometry.coordinateHelper,i=this._editGeometry.allVertices;for(let r=0;r<i.length;r++)n.copy(e[r],i[r].pos);this._editGeometry.components.forEach((t=>t.unnormalizeVertexPositions())),this._editGeometry.notifyChanges({operation:t,updatedVertices:i})}};var El;const Tl=Symbol();let Sl=class{constructor(t){this._operations=[],this._closed=!1,this[El]=!0,t&&(this._operations=t,this._closed=!0)}close(){this._closed=!0}apply(){for(const t of this._operations)t.apply()}undo(){for(let t=this._operations.length-1;t>=0;t--)this._operations[t].undo()}accumulate(t){if(this._closed)return!1;const e=this._operations.length?this._operations[this._operations.length-1]:null;return e&&e.accumulate(t)||(this._operations.push(t),t.apply()),!0}};El=Tl;let Pl=class t extends r.d4{constructor(t,e){super(),this.data=t,this.viewingMode=e,this._undoStack=[],this._redoStack=[],this._listener=this.data.on("change",(t=>{t.addedVertices&&this.emit("vertex-add",{type:"vertex-add",vertices:t.addedVertices,operation:t.operation}),t.removedVertices&&this.emit("vertex-remove",{type:"vertex-remove",vertices:t.removedVertices,operation:t.operation}),t.updatedVertices&&this.emit("vertex-update",{type:"vertex-update",vertices:t.updatedVertices,operation:t.operation})}))}destroy(){this._listener.remove()}splitEdge(t,e){return this._apply(new hl(this.data,t,e))}updateVertices(t,e,n=sl.ACCUMULATE_STEPS){return this._apply(new ll(this.data,t,e),n)}move(t,e,n,i=sl.ACCUMULATE_STEPS){return ol(this.data)?this._apply(new fl(this.data,t,e,n),i):this.moveVertices(this.data.allVertices,t,e,n,i)}moveVertices(t,e,n,i,r=sl.ACCUMULATE_STEPS){return ol(this.data)?this._apply(new fl(this.data,e,n,i),r):this.updateVertices(t,new gl(this.data.coordinateHelper,e,n,i),r)}scale(t,e,n,i,r=sl.ACCUMULATE_STEPS,o=cl.CUMULATIVE){return this.scaleVertices(this.data.allVertices,t,e,n,i,r,o)}scaleVertices(t,e,n,i,r,o=sl.ACCUMULATE_STEPS,s=cl.CUMULATIVE){return this.updateVertices(t,new wl(e,n,i,r,s),o)}rotate(t,e,n=sl.ACCUMULATE_STEPS,i=cl.CUMULATIVE){return this.rotateVertices(this.data.allVertices,t,e,n,i)}rotateVertices(t,e,n,i=sl.ACCUMULATE_STEPS,r=cl.CUMULATIVE){return this.updateVertices(t,new xl(e,n,r),i)}removeVertices(t){return this._apply(new ul(this.data,t,this._minNumVerticesPerType))}appendVertex(t){return 0===this.data.components.length?null:this._apply(new al(this.data,this.data.components[0],t))}setVertexPosition(t,e){return this._apply(new pl(this.data,t,e))}offsetEdge(t,e,n,i=sl.ACCUMULATE_STEPS){return this.updateVertices([e.leftVertex,e.rightVertex],new ml(this.data.coordinateHelper,t,e,n),i)}trySetGeometry(t,e=sl.ACCUMULATE_STEPS){const{data:n}=this,{coordinateHelper:i}=n;if(n.type!==t.type||!n.spatialReference.equals(t.spatialReference)||i.hasZ()!==t.hasZ||i.hasM()!==t.hasM||!(0,r.v2)(n.geometry,t)||ol(n))return;const o=Array.from(el.fromGeometry(t,this.viewingMode).iterateVertices(),(t=>t.pos));return this.setVertexPositions(o,e)}setVertexPositions(t,e=sl.ACCUMULATE_STEPS){return this._apply(new Ml(this.data,t),e)}createResetState(){if(ol(this.data))return this._createResetStateMesh();const t=this.data.geometry.clone();return(0,r.bh)((()=>this.trySetGeometry(t)))}closeComponent(t){return this.data.components.includes(t)?this._apply(new dl(this.data,t)):null}canRemoveVertex(t){return t.vertices.length>this._minNumVerticesPerType}createUndoGroup(){const t=new Sl;return this._apply(t),(0,r.bh)((()=>t.close()))}undo(){if(this._undoStack.length>0){const t=this._undoStack.pop();return t.undo(),this._redoStack.push(t),t}return null}redo(){if(this._redoStack.length>0){const t=this._redoStack.pop();return t.apply(),this._undoStack.push(t),t}return null}get canUndo(){return this._undoStack.length>0}get canRedo(){return this._redoStack.length>0}get lastOperation(){return this._undoStack.length>0?this._undoStack[this._undoStack.length-1]:null}get _minNumVerticesPerType(){switch(this.data.type){case"point":return 1;case"polyline":return 2;case"polygon":return 3;default:return 0}}_apply(t,e=sl.ACCUMULATE_STEPS){return e!==sl.NEW_STEP&&null!=this.lastOperation&&this.lastOperation.accumulate(t)||(t.apply(),this._undoStack.push(t),this._redoStack=[]),t}_createResetStateMesh(){if(!ol(this.data))return(0,r.bh)();const t=this.data.geometry,{vertexSpace:e}=t;if(e.origin){const n=(0,r.dA)(e.origin);return(0,r.bh)((()=>{t.vertexSpace.origin=n}))}const n=t.vertexAttributes.clonePositional();return(0,r.bh)((()=>{t.vertexAttributes=n,t.vertexAttributesChanged()}))}static fromGeometry(e,n){return new t(el.fromGeometry(e,n),n)}};function Cl(t,e){let n=null,i=null;return r=>{if("cancel"===r.action)return void(null!=i&&(i.execute({action:"cancel"}),n=null,i=null));const o={action:r.action,screenStart:r.start,screenEnd:r.screenPoint};"start"===r.action&&null==n&&(n=new Al,i=new Al,e(t,n,i,r.pointerType,o)),n?.execute(o),"end"===r.action&&null!=n&&(n=null,i=null)}}function kl(t,e){return t.events.on("drag",Cl(t,e))}function Rl(t,e=null,n){let i=null;const o=null==e||t.spatialReference?.equals(e)?t=>t:t=>null!=t?(0,r.cl)(t,e):t,s={exclude:[],...n};return e=>{if("start"===e.action&&(i=o(t.toMap(e.screenStart,s))),null==i)return null;const n=o(t.toMap(e.screenEnd,s));return null!=n?{...e,mapStart:i,mapEnd:n}:null}}const Vl=()=>{};let Al=class t{constructor(){this.execute=Vl}next(e,n=new t){return null!=e&&(this.execute=t=>{const i=e(t);null!=i&&n.execute(i)}),n}};function Il(t,e,n=[]){if("2d"===t.type)return t=>t;let i=null;return r=>{"start"===r.action&&(i=t.toMap(r.screenStart,{exclude:n}),null!=i&&(i.z=(0,s.p)(i,t,e)));const o=t.toMap(r.screenEnd,{exclude:n});null!=o&&(o.z=(0,s.p)(o,t,e));const a=null!=i&&null!=o?{sceneStart:i,sceneEnd:o}:null;return{...r,scenePoints:a}}}let Ol=class{constructor(t){this.vertexHandle=null,this.excludeFeature=null,this.visualizer=null,this.selfSnappingZ=null,this.drawConstraints=null,this.editGeometryOperations=t.editGeometryOperations,this.elevationInfo=t.elevationInfo,this.pointer=t.pointer,this.vertexHandle=t.vertexHandle,this.excludeFeature=t.excludeFeature,this.feature=t.feature,this.visualizer=t.visualizer,this.selfSnappingZ=t.selfSnappingZ,this.drawConstraints=t.drawConstraints}get coordinateHelper(){return this.editGeometryOperations.data.coordinateHelper}get spatialReference(){return this.coordinateHelper.spatialReference}};function Dl({predicate:t=()=>!0,snappingManager:e,snappingContext:n,updatingHandles:i,useZ:o=!0}){const a=new Al;if(null==e)return{snappingStep:[Bl,a],cancelSnapping:Bl};let l,c=null,u=null,h=null;const p=()=>{c=(0,r.gO)(c),e.doneSnapping(),u?.frameTask.remove(),u=null,l=(0,r.my)(l),h=null},d=Gl(e,o,a);let f=null,g=null,m=null;return{snappingStep:[a=>{if(!t(a))return a;const{action:y}=a;if("start"===y){const{info:t}=a,i=Ll(e.view);if(u=zl(n,a,i),u.context.selfSnappingZ=null,!o&&null!=t){const e=Zl(n.coordinateHelper,t.handle.component);null!=e&&(u.context.selfSnappingZ={value:e,elevationInfo:n.elevationInfo??s.j})}}if(null!=u){const{context:t,originalScenePos:n,originalPos:s}=u,{mapEnd:p,mapStart:_,scenePoints:v}=a,b=Nl(s,Hl(p,_)),x=Hl(_,s),w={...a,action:"update"},M=u.context,E=Ul(n,v),T=e.update({point:b,scenePoint:E,context:t});if(m=T,Fl(p,T,x,o),f=b,g=E,"end"!==y){const{frameTask:t}=u;null==c&&(c=new AbortController),h=e=>{i.addPromise((0,r.gL)(d({frameTask:t,event:w,context:M,point:b,scenePoint:E,delta:x,getLastState:()=>({point:f,scenePoint:g,updatePoint:e.forceUpdate?null:m})},c.signal)))},h({forceUpdate:!1}),null==l&&(l=(0,r.cc)((()=>e.options.effectiveEnabled),(()=>h?.({forceUpdate:!0}))))}}return"end"===y&&p(),a},a],cancelSnapping:t=>(p(),t)}}function Gl(t,e,n){return(0,r.f8)((async({frameTask:i,point:r,scenePoint:o,context:s,event:a,delta:l,getLastState:c},u)=>{const h=await i.schedule((()=>t.snap({point:r,scenePoint:o,context:s,signal:u})),u);if(h.valid){let o=await i.schedule((()=>h.apply()),u);const p=c();null!=p.point&&r!==p.point&&(o=t.update({point:p.point,scenePoint:p.scenePoint,context:s})),null!=p.updatePoint&&x(o,p.updatePoint)||(Fl(a.mapEnd,o,l,e),n.execute(a))}}))}function Ll(t){return"3d"===t.type?t.resourceController.scheduler.registerTask(r.c5.SNAPPING):r.v3}function zl(t,e,n){return{context:new Ol({editGeometryOperations:t.editGeometryOperations,elevationInfo:t.elevationInfo,pointer:t.pointer,vertexHandle:null!=e.info?e.info.handle:null,excludeFeature:t.excludeFeature,feature:t.feature,visualizer:t.visualizer}),originalPos:null!=e.snapOrigin?t.coordinateHelper.vectorToDehydratedPoint(e.snapOrigin):e.mapStart,originalScenePos:null!=e.scenePoints?e.scenePoints.sceneStart:null,frameTask:n}}function Nl(t,[e,n,i]){const r=E(t);return r.x+=e,r.y+=n,r.hasZ&&(r.z+=i),r}function Ul(t,e){return null==t||null==e?null:Nl(t,Hl(e.sceneEnd,e.sceneStart))}function Hl(t,e){const n=t.hasZ&&e.hasZ?t.z-e.z:0;return[t.x-e.x,t.y-e.y,n]}function Fl(t,e,[n,i,r],o){t.x=e.x+n,t.y=e.y+i,o&&t.hasZ&&e.hasZ&&(t.z=e.z+r)}function Zl(t,e){if(!t.hasZ())return null;const n=e.vertices;let i=null;for(const r of n){const e=t.getZ(r.pos);if(null!=i&&null!=e&&Math.abs(e-i)>1e-6)return null;null==i&&(i=e)}return i}function Bl(t){return t}let ql=class extends r.e9{constructor(t){super(t),this.constrainResult=t=>t,this._snapPoints=null,this._frameTask=null,this._abortController=null,this._stagedPoint=null,this._snap=(0,r.f8)((async(t,e,n,i)=>{const r=this._frameTask;if(null==r)return;const o=await r.schedule((()=>e.snap({...t,context:n,signal:i})),i);o.valid&&await r.schedule((()=>{this.stagedPoint=o.apply(),t!==this._snapPoints&&null!=this._snapPoints&&(this.stagedPoint=e.update({...this._snapPoints,context:n}))}),i)}))}get stagedPoint(){return this._stagedPoint}set stagedPoint(t){this._stagedPoint=this.constrainResult(t)}initialize(){const t="3d"===this.view.type?this.view?.resourceController?.scheduler:null;this._frameTask=null!=t?t.registerTask(r.c5.SNAPPING):r.v3}destroy(){this._abortController=(0,r.gO)(this._abortController),this._frameTask=(0,r.my)(this._frameTask)}update(t,e,n){this._snapPoints=t;const{point:i,scenePoint:r}=t,o=e.update({point:i,scenePoint:r,context:n});return this.stagedPoint=o,o}async snap(t,e,n){const{point:i,scenePoint:r}=t;return this.stagedPoint=e.update({point:i,scenePoint:r,context:n}),this._snapPoints=t,null==this._abortController&&(this._abortController=new AbortController),this._snap(t,e,n,this._abortController.signal)}async snapAgainNearPreviousMapPoint(t,e){null!=this._snapPoints&&await this.snap(this._snapPoints,t,e)}abort(){this._abortController=(0,r.gO)(this._abortController),this._snapPoints=null}};var Yl;(0,r.bt)([(0,r.bu)({constructOnly:!0})],ql.prototype,"view",void 0),(0,r.bt)([(0,r.bu)()],ql.prototype,"stagedPoint",null),(0,r.bt)([(0,r.bu)()],ql.prototype,"constrainResult",void 0),(0,r.bt)([(0,r.bu)()],ql.prototype,"_stagedPoint",void 0),ql=(0,r.bt)([(0,r.bv)("esri.views.interactive.snapping.SnappingOperation")],ql),function(t){t[t.TARGET=0]="TARGET",t[t.REFERENCE=1]="REFERENCE",t[t.REFERENCE_EXTENSION=2]="REFERENCE_EXTENSION"}(Yl||(Yl={}));const Xl=Symbol("snapping-toggle");function jl(t,e=()=>{}){const n=(0,r.cc)((()=>({view:t.view,snappingOptions:t.snappingOptions})),(({view:n,snappingOptions:i})=>{if(t.removeHandles(Xl),!n||!i)return;const o=r.fa.TOOL,s=[n.on("key-down",(t=>{t.key!==_i.toggle||t.repeat||(i.enabledToggled=!0,e())}),o),n.on("key-up",(t=>{t.key===_i.toggle&&(i.enabledToggled=!1,e())}),o),n.on("pointer-move",(t=>{const n=t.native.ctrlKey;i.enabledToggled!==n&&(i.enabledToggled=n,e())}),o)];t.addHandles(s,Xl)}),r.hG);t.addHandles(n)}const Wl="crosshair",$l="progress",Ql=Symbol(),Kl=Symbol();let Jl=class extends(r.d4.EventedMixin(r.e9)){constructor(t){super(t),this._createOperationCompleted=!1,this._hideDefaultCursor=!1,this._pointerDownStates=new h.s,this._stagedScreenPoint=null,this._stagedPointerType=null,this._updatingHandles=new r.f7,this._stagedPointerId=null,this.constraintsEnabled=!1,this.constraints=void 0,this._getPointConstraint=Ni(ri),this._getPolylineOrPolygonConstraint=Ni(oi),this.constraintZ=null,this.defaultZ=null,this.isDraped=!0,this.labelOptions=new Sa,this.cursor=null,this.loading=!1,this.snapToSceneEnabled=null,this.firstVertex=null,this.lastVertex=null,this.secondToLastVertex=null,null==t.elevationInfo&&(this.elevationInfo=(0,s.u)(!!t.hasZ))}initialize(){const{geometryType:t,view:e}=this,n=e.spatialReference,i="viewingMode"in e.state?e.state.viewingMode:r.iE.Local,o="segment"===t||"multipoint"===t?"polyline":t;this.coordinateHelper=Wa(this.hasZ,this.hasM,n),this._editGeometryOperations=new Pl(new el(o,this.coordinateHelper),i),this._snappingOperation=new ql({view:e}),this.addHandles([(0,r.cc)((()=>({stagedPoint:this._snappingOperation.stagedPoint,constraint:this._constraint})),(({stagedPoint:t,constraint:e},n)=>{const{snappingOptions:i}=this;if(i&&(i.forceDisabled=null!=e&&Tn(e)),null!=n&&t===n.stagedPoint&&e!==n.constraint)return this._onKeyboardBasedChange();this._processCursor(t??this._screenToMap(this._stagedScreenPoint))}),{equals:(t,e)=>t.stagedPoint===e.stagedPoint&&(0,r.jI)(t.constraint,e.constraint)}),(0,r.cc)((()=>this.view.viewpoint),((t,e)=>{t&&e&&(0,r.q1)(t,e)&&this._onKeyboardBasedChange()}))]),this._activeComponent=new tl(n,i),this._editGeometryOperations.data.components.push(this._activeComponent);const s=this.segmentLabels;null!=s&&(s.context={view:e,editGeometryOperations:this._editGeometryOperations,elevationInfo:this.elevationInfo,labelOptions:this.labelOptions},this.addHandles((0,r.cc)((()=>this.labelOptions.enabled),(t=>{s.visible=t}),r.hG))),this.addHandles(this._editGeometryOperations.on(["vertex-add","vertex-update","vertex-remove"],(t=>{const e=t.vertices.map((t=>({componentIndex:0,vertexIndex:t.index,coordinates:this.coordinateHelper.vectorToArray(t.pos)}))),n=e.map((t=>t.coordinates)),i=this.coordinateHelper.vectorToDehydratedPoint(this._activeComponent.getFirstVertex()?.pos)??null;x(i,this.firstVertex)||(this.firstVertex=i);const r=this.coordinateHelper.vectorToDehydratedPoint(this._activeComponent.getLastVertex()?.pos)??null;x(r,this.lastVertex)||(this.lastVertex=r);const o=this.coordinateHelper.vectorToDehydratedPoint(this._activeComponent.edges.at(-1)?.leftVertex?.pos)??null;switch(x(o,this.secondToLastVertex)||(this.secondToLastVertex=o),this._processCursor(this.cursorVertex),t.type){case"vertex-add":this.emit(t.type,{...t,added:n,vertices:e});break;case"vertex-update":this.emit(t.type,{...t,updated:n,vertices:e});break;case"vertex-remove":this.emit(t.type,{...t,removed:n,vertices:e})}})));const a=this._manipulator=new Ba({consumesClicks:!1,grabbableForEvent:t=>"click"!==this.drawingMode||"touch"===t.pointerType&&this._snappingEnabled&&1===this._pointerDownStates.size});this.manipulators.add(a),a.grabbable="point"!==t,this.addHandles([a.events.on("immediate-click",(t=>this._onImmediateClick(t))),a.events.on("immediate-double-click",(t=>this._onImmediateDoubleClick(t))),(0,r.cc)((()=>this.drawingMode),(()=>{this.removeHandles(Ql),this.addHandles(this._createManipulatorDragPipeline(a),Ql)}),r.hG),(0,r.cc)((()=>({effectiveCursor:this.effectiveCursor})),(({effectiveCursor:t})=>{a.cursor=t}),r.hG)]),jl(this,(()=>{const t=this.view.inputManager.latestPointerType??"mouse",e=this._getSnappingContext(t);if(null!=this.snappingManager){const t=this._snappingOperation.snapAgainNearPreviousMapPoint(this.snappingManager,e);this._updatingHandles.addPromise((0,r.gL)(t))}}))}destroy(){(0,r.ch)(this.segmentLabels),(0,r.ch)(this._snappingOperation),this._editGeometryOperations=(0,r.ch)(this._editGeometryOperations),this._updatingHandles.destroy()}get _isDragging(){const{_stagedPointerId:t,_manipulator:e}=this;return null!=t&&this._pointerDownStates.has(t)||e.grabbing||!e.interactive}get _snappingEnabled(){return null!=this.snappingManager&&this.snappingManager.options.effectiveEnabled}get _requiresScenePoint(){const t=this._updateAndGetEffectiveDrawSurface();return"3d"===this.view.type&&this.drawSurface!==t}get canRedo(){return this._editGeometryOperations.canRedo}get canUndo(){return this._editGeometryOperations.canUndo}get committedVertices(){return this._activeComponent.vertices.map((t=>this.coordinateHelper.vectorToArray(t.pos)))}get _constraint(){const{constraints:t,constraintsEnabled:e}=this;if(t&&e)switch(this.geometryType){case"point":return this._getPointConstraint(t);case"polygon":case"polyline":return this._getPolylineOrPolygonConstraint(this.lastVertex,this.secondToLastVertex,t)}}set drawingMode(t){this._set("drawingMode",t??Za)}get effectiveCursor(){return this.loading?$l:this._hideDefaultCursor?null:this.cursor||Wl}get interactive(){return this._manipulator.interactive}set interactive(t){this._manipulator.interactive=t}get isCompleted(){return this._createOperationCompleted}get numCommittedVertices(){return this._activeComponent.vertices.length}get snappingOptions(){return null!=this.snappingManager?this.snappingManager.options:null}get cursorVertex(){return this._get("cursorVertex")}get visualizationCursorVertex(){return"mouse"===this._stagedPointerType?this.cursorVertex:null}get committableVertex(){const{cursorVertex:t,lastVertex:e,firstVertex:n,geometryType:i}=this;return"polygon"===i&&w(t,n)||w(t,e)?null:t}get updating(){return this._updatingHandles.updating}get geometryIncludingUncommittedVertices(){const{committedVertices:t,committableVertex:e,coordinateHelper:n}=this,i=t.slice();return null!=e&&i.push(n.pointToArray(e)),i}cancel(){this.complete({aborted:!0})}commitStagedVertex(){this._snappingOperation.abort();const{committableVertex:t}=this;null!=t&&this._editGeometryOperations.appendVertex(this.coordinateHelper.pointToVector(t))}complete(t){const e=t?.aborted||!1;this._snappingOperation.abort(),this.snappingManager?.doneSnapping();const{geometryType:n,numCommittedVertices:i}=this,r="multipoint"===n&&0===i||"polyline"===n&&i<2||"polygon"===n&&i<3;"segment"!==n&&"point"!==n||this.commitStagedVertex(),this._createOperationCompleted=!r,(this.isCompleted||e)&&(this._stagedScreenPoint=null,this._stagedPointerId=null,this._stagedPointerType=null,this._processCursor(null),this.emit("complete",{vertices:this.committedVertices.map(((t,e)=>({componentIndex:0,vertexIndex:e,coordinates:t}))),aborted:e,type:"complete"}))}onInputEvent(t){switch(t.type){case"pointer-down":this._pointerDownStates.add(t.pointerId);break;case"pointer-up":this._pointerDownStates.delete(t.pointerId)}switch(t.type){case"pointer-move":return this._onPointerMove(t);case"hold":return this._onHold(t)}}redo(){this._editGeometryOperations.redo()}undo(){null!=this.snappingManager&&this.snappingManager.doneSnapping(),this._editGeometryOperations.undo()}_processCursor(t){const e=(0,r.T)(this.cursorVertex),n=(0,r.T)(t),i=n&&(this._updateAndGetEffectiveDrawSurface()?.constrainZ(n)??n),o=this._snapToClosingVertex(i),s=this._applyConstraints(o);w(e,s)||(this._set("cursorVertex",s),this.segmentLabels?.set("stagedVertex",null!=s?this.coordinateHelper.pointToVector(s):null),null==s||"mouse"!==this._stagedPointerType?this.emit("cursor-remove"):this.emit("cursor-update",{updated:null,vertices:[{componentIndex:0,vertexIndex:this._activeComponent.vertices.length,coordinates:this.coordinateHelper.pointToArray(s)}],operation:"apply",type:"vertex-update"}))}_snapToClosingVertex(t){if(null==t||this._isDragging||"polygon"!==this.geometryType||this.numCommittedVertices<=2)return t;const e=this._mapToScreen(t);if(!e)return t;const n=this._activeComponent;return this._vertexWithinPointerDistance(n.vertices[0].pos,e)?this.firstVertex:this._vertexWithinPointerDistance(n.vertices.at(-1).pos,e)?this.lastVertex:t}_createManipulatorDragPipeline(t){switch(this.drawingMode){case"click":return this._createManipulatorDragPipelineClick(t);case"freehand":return this._createManipulatorDragPipelineFreehand(t);case"hybrid":return this._createManipulatorDragPipelineHybrid(t)}}_createManipulatorDragPipelineClick(t){return kl(t,((t,e,n,i)=>{const r="touch"===i&&this._snappingEnabled;if(this.isCompleted||!r)return;const{snappingStep:o,cancelSnapping:s}=Dl({predicate:()=>r,snappingManager:this.snappingManager,snappingContext:new Ol({editGeometryOperations:this._editGeometryOperations,elevationInfo:this.elevationInfo,feature:this.graphic,pointer:i,visualizer:this.snappingVisualizer,drawConstraints:this.constraints}),updatingHandles:this._updatingHandles,useZ:!this._requiresScenePoint});n=n.next((t=>(r&&null!=this.snappingManager&&this.snappingManager.doneSnapping(),t))).next(s),e.next(this._screenToMapDragEventStep()).next((t=>("start"===t.action&&(this._processCursor(t.mapStart),("segment"===this.geometryType||r&&!this.numCommittedVertices)&&this.commitStagedVertex()),t))).next(Il(this.view,this.elevationInfo)).next(...o).next((t=>(r&&(this._processCursor(t.mapEnd),"end"===t.action&&this.commitStagedVertex()),t))).next((t=>("end"===t.action&&("mouse"!==this._stagedPointerType&&this._snappingOperation.abort(),"segment"!==this.geometryType&&"point"!==this.geometryType||this.complete()),t)))}))}_createManipulatorDragPipelineFreehand(t){return kl(t,((t,e)=>{this.isCompleted||e.next(this._screenToMapDragEventStep()).next((t=>("start"===t.action&&(this._snappingOperation.abort(),null==this.committableVertex&&this._processCursor(t.mapStart),"segment"===this.geometryType&&this.commitStagedVertex()),t))).next((t=>{switch(t.action){case"start":case"update":this._processCursor(t.mapEnd),"polygon"!==this.geometryType&&"polyline"!==this.geometryType||this.commitStagedVertex();break;case"end":this.complete()}return t}))}))}_createManipulatorDragPipelineHybrid(t){return kl(t,((t,e)=>{this.isCompleted||e.next(this._screenToMapDragEventStep()).next((t=>("start"===t.action&&(this._snappingOperation.abort(),this.addHandles(this._editGeometryOperations.createUndoGroup(),Kl),this._processCursor(t.mapStart),this.commitStagedVertex()),t))).next((t=>{switch(t.action){case"start":case"update":this._processCursor(t.mapEnd),"polygon"!==this.geometryType&&"polyline"!==this.geometryType||this.commitStagedVertex();break;case"end":"mouse"!==this._stagedPointerType&&this._snappingOperation.abort(),this.removeHandles(Kl),"segment"!==this.geometryType&&"point"!==this.geometryType||this.complete()}return t}))}))}get _drawAtFixedElevation(){const{constraintsEnabled:t,constraintZ:e,geometryType:n,numCommittedVertices:i}=this;return t?null!=e||"segment"===n&&i>0:("segment"===n||"polygon"===n)&&i>0}_updateAndGetEffectiveDrawSurface(){const{constraintsEnabled:t,coordinateHelper:e,drawSurface:n,elevationDrawSurface:i,snapToSceneEnabled:r}=this;if(null==i)return n;if(!this.hasZ)return i.defaultZ=null,i;const o=this.elevationInfo?.mode;let s=this.defaultZ,a=t||"absolute-height"===o;return null!=r&&(a=r),"on-the-ground"===o&&(a=!1),this._drawAtFixedElevation&&(s=(t?this.constraintZ:null)??e.getZ(this._activeComponent.vertices[0].pos),a=!1),a?n:(i.defaultZ=s,i)}_mapToScreen(t){return this._updateAndGetEffectiveDrawSurface()?.mapToScreen(t)}_onHold(t){this._snappingOperation.abort(),"click"===this.drawingMode&&"touch"===t.pointerType&&this._snappingEnabled&&this._processCursor(t.mapPoint),t.stopPropagation()}_onImmediateClick(t){if(!("mouse"===t.pointerType&&2===t.button||this._manipulator.dragging))try{const{drawingMode:e,geometryType:n}=this;this._stagedPointerType=t.pointerType,this._stagedScreenPoint=t.screenPoint;const i=this._screenToMap(t.screenPoint);if(null==i||null==i||"freehand"===e&&"point"!==n)return;if(this._snappingEnabled&&null!=this.cursorVertex||this._processCursor(i),null==this.committableVertex)return void this.complete();this.commitStagedVertex(),"mouse"!==t.pointerType&&this._processCursor(null),("freehand"===e||"point"===n||"segment"===n&&2===this.numCommittedVertices||"segment"===n&&"hybrid"===e&&1===this.numCommittedVertices)&&this.complete()}finally{t.stopPropagation()}}_onImmediateDoubleClick(t){this._manipulator.dragging||"point"===this.geometryType||(this.complete(),t.stopPropagation())}_onPointerMove(t){const e=(0,r.h1)(t.x,t.y);this._stagedScreenPoint=e,this._stagedPointerType=t.pointerType,this._stagedPointerId=t.pointerId,this._isDragging?this._snappingOperation.abort():(t.stopPropagation(),this._processCursorMovementRelativeToSurface(e,t.pointerType))}_onKeyboardBasedChange(){"mouse"===this._stagedPointerType&&this._stagedScreenPoint&&null!=this._stagedPointerId&&!this._isDragging?this._processCursorMovementRelativeToSurface(this._stagedScreenPoint,this._stagedPointerType):this._snappingOperation.abort()}_processCursorMovementRelativeToSurface(t,e){const n=this._snappingOperation,i=this._screenToMap(t),o=this._requiresScenePoint?this.drawSurface?.screenToMap(t):null;if(null==i)return this._hideDefaultCursor=!0,this._processCursor(null),void n.abort();this._hideDefaultCursor=!1;const s=this.snappingManager;if(null==s)return this._processCursor(i),void n.abort();const a=this._getSnappingContext(e);this._updatingHandles.addPromise((0,r.gL)(n.snap({point:i,scenePoint:o},s,a)))}_applyConstraints(t){const{_constraint:e,constraints:n}=this;if(!t||!n||!e)return t;const{context:i}=n,r=li(t,i),o=r?e.closestTo(r):void 0;if(!o)return t;const s=ci(o,t,i),a="2d"===this.view.type||"absolute-height"!==i.elevationInfo.mode;return null!=s&&a&&null!=this.constraintZ&&this.hasZ&&(s.z=this.constraintZ),s}_screenToMap(t){return t?this._updateAndGetEffectiveDrawSurface()?.screenToMap(t):null}_screenToMapDragEventStep(){let t=null;return e=>{if("start"===e.action&&(t=this._screenToMap(e.screenStart)),null==t)return null;const n=this._screenToMap(e.screenEnd);return null!=n?{...e,mapStart:t,mapEnd:n}:null}}_vertexWithinPointerDistance(t,e){const n=this._mapToScreen(this.coordinateHelper.vectorToDehydratedPoint(t));return null!=n&&tc(n,e,25)}_getSnappingContext(t){const e=this._drawAtFixedElevation?this.elevationDrawSurface?.defaultZ:null;return new Ol({editGeometryOperations:this._editGeometryOperations,elevationInfo:this.elevationInfo,pointer:t,feature:this.graphic,visualizer:this.snappingVisualizer,selfSnappingZ:null!=e?{value:e,elevationInfo:this.elevationInfo}:null,drawConstraints:this.constraints})}};function tc(t,e,n){const i=t.x-e.x,r=t.y-e.y;return i*i+r*r<=n}(0,r.bt)([(0,r.bu)()],Jl.prototype,"_hideDefaultCursor",void 0),(0,r.bt)([(0,r.bu)()],Jl.prototype,"_stagedPointerId",void 0),(0,r.bt)([(0,r.bu)()],Jl.prototype,"_isDragging",null),(0,r.bt)([(0,r.bu)()],Jl.prototype,"_snappingOperation",void 0),(0,r.bt)([(0,r.bu)()],Jl.prototype,"_snappingEnabled",null),(0,r.bt)([(0,r.bu)({constructOnly:!0})],Jl.prototype,"graphic",void 0),(0,r.bt)([(0,r.bu)()],Jl.prototype,"constraintsEnabled",void 0),(0,r.bt)([(0,r.bu)()],Jl.prototype,"constraints",void 0),(0,r.bt)([(0,r.bu)()],Jl.prototype,"_constraint",null),(0,r.bt)([(0,r.bu)()],Jl.prototype,"constraintZ",void 0),(0,r.bt)([(0,r.bu)()],Jl.prototype,"defaultZ",void 0),(0,r.bt)([(0,r.bu)()],Jl.prototype,"isDraped",void 0),(0,r.bt)([(0,r.bu)({value:Za})],Jl.prototype,"drawingMode",null),(0,r.bt)([(0,r.bu)({constructOnly:!0})],Jl.prototype,"elevationDrawSurface",void 0),(0,r.bt)([(0,r.bu)({constructOnly:!0})],Jl.prototype,"elevationInfo",void 0),(0,r.bt)([(0,r.bu)({constructOnly:!0,type:Sa})],Jl.prototype,"labelOptions",void 0),(0,r.bt)([(0,r.bu)({constructOnly:!0})],Jl.prototype,"geometryType",void 0),(0,r.bt)([(0,r.bu)({constructOnly:!0})],Jl.prototype,"hasM",void 0),(0,r.bt)([(0,r.bu)({constructOnly:!0})],Jl.prototype,"hasZ",void 0),(0,r.bt)([(0,r.bu)()],Jl.prototype,"cursor",void 0),(0,r.bt)([(0,r.bu)()],Jl.prototype,"effectiveCursor",null),(0,r.bt)([(0,r.bu)()],Jl.prototype,"loading",void 0),(0,r.bt)([(0,r.bu)({constructOnly:!0})],Jl.prototype,"manipulators",void 0),(0,r.bt)([(0,r.bu)({constructOnly:!0})],Jl.prototype,"drawSurface",void 0),(0,r.bt)([(0,r.bu)({constructOnly:!0})],Jl.prototype,"segmentLabels",void 0),(0,r.bt)([(0,r.bu)({constructOnly:!0})],Jl.prototype,"snappingManager",void 0),(0,r.bt)([(0,r.bu)({constructOnly:!0})],Jl.prototype,"snappingVisualizer",void 0),(0,r.bt)([(0,r.bu)()],Jl.prototype,"snapToSceneEnabled",void 0),(0,r.bt)([(0,r.bu)({readOnly:!0})],Jl.prototype,"cursorVertex",null),(0,r.bt)([(0,r.bu)({readOnly:!0})],Jl.prototype,"visualizationCursorVertex",null),(0,r.bt)([(0,r.bu)()],Jl.prototype,"committableVertex",null),(0,r.bt)([(0,r.bu)()],Jl.prototype,"firstVertex",void 0),(0,r.bt)([(0,r.bu)()],Jl.prototype,"lastVertex",void 0),(0,r.bt)([(0,r.bu)()],Jl.prototype,"secondToLastVertex",void 0),(0,r.bt)([(0,r.bu)()],Jl.prototype,"updating",null),(0,r.bt)([(0,r.bu)({constructOnly:!0})],Jl.prototype,"view",void 0),Jl=(0,r.bt)([(0,r.bv)("esri.views.draw.DrawOperation")],Jl);let ec=class{constructor(t,e=!1,n=0){this.view=t,this.hasZ=e,this.defaultZ=n,this.mapToScreen=e=>t.toScreen(e),this.screenToMap=e?e=>{const i=t.toMap(e);return i.z=n,i}:e=>t.toMap(e)}constrainZ(t){const{defaultZ:e}=this;return this.hasZ&&t.z!==e&&((t=E(t)).z=e),t}};new r.aY;let nc=class extends za{constructor(t){super(t),this._visualElementGraphics={regularVertices:null,activeVertex:null,activeEdge:null},this.activeFillSymbol=null,this.type="draw-2d",this._visualElementSymbols={outline:t.activeLineSymbol??q,regularVertices:t.regularVerticesSymbol??Y,activeVertex:t.activeVertexSymbol??X,fill:t.activeFillSymbol},t.activeVertexSymbol||this.addHandles((0,r.cc)((()=>this.view?.effectiveTheme?.accentColor),(t=>{if(!t)return;const e=this._visualElementSymbols.activeVertex.clone().set({color:t});this._visualElementGraphics.activeVertex?.set("symbol",e),this._visualElementSymbols={...this._visualElementSymbols,activeVertex:e}}),r.cd))}normalizeCtorArgs(t){const e={...t};return delete e.activeFillSymbol,delete e.activeVertexSymbol,delete e.regularVerticesSymbol,delete e.activeLineSymbol,e}initializeGraphic(t){return null!=this._visualElementSymbols.fill&&(t.symbol=this._visualElementSymbols.fill),this.internalGraphicsLayer.graphics.sort(ic),(0,r.bh)()}makeDrawOperation(){const{defaultZ:t,hasZ:e,view:n}=this;return this._createOrUpdateGraphic(null),new Jl({view:n,manipulators:this.manipulators,geometryType:Ha(this.geometryType),drawingMode:this.mode,hasZ:e,defaultZ:t,snapToSceneEnabled:this.snapToScene,drawSurface:new ec(n,e,t),hasM:!1,snappingManager:this.snappingManager,snappingVisualizer:new Z(this.internalGraphicsLayer),graphic:this.graphic,cursor:this.cursor,constraintsEnabled:!0})}onActiveVertexChanged(t){if("point"===this.geometryType)return(0,r.bh)();const[e,n]=t,i=new r.D({x:e,y:n,spatialReference:this.view.spatialReference});return null!=this._visualElementGraphics.activeVertex?(this._visualElementGraphics.activeVertex.geometry=i,(0,r.bh)()):(this._visualElementGraphics.activeVertex=new r.a1({geometry:i,symbol:this._visualElementSymbols.activeVertex,attributes:{displayOrder:2}}),this.internalGraphicsLayer.add(this._visualElementGraphics.activeVertex),this.internalGraphicsLayer.graphics.sort(ic),(0,r.bh)((()=>{null!=this._visualElementGraphics.activeVertex&&(this.internalGraphicsLayer.remove(this._visualElementGraphics.activeVertex),this._visualElementGraphics.activeVertex=(0,r.ch)(this._visualElementGraphics.activeVertex))})))}onCursorEdgeChanged(t){return null!=this._visualElementGraphics.activeEdge?(this._visualElementGraphics.activeEdge.geometry=t,(0,r.bh)()):(this._visualElementGraphics.activeEdge=new r.a1({geometry:t,symbol:this._visualElementSymbols.outline,attributes:{displayOrder:0}}),this.internalGraphicsLayer.add(this._visualElementGraphics.activeEdge),this.internalGraphicsLayer.graphics.sort(ic),(0,r.bh)((()=>{null!=this._visualElementGraphics.activeEdge&&(this.internalGraphicsLayer.remove(this._visualElementGraphics.activeEdge),this._visualElementGraphics.activeEdge=(0,r.ch)(this._visualElementGraphics.activeEdge))})))}onRegularVerticesChanged(t){const e=new r.bU({points:t,spatialReference:this.view.spatialReference});return null!=this._visualElementGraphics.regularVertices?(this._visualElementGraphics.regularVertices.geometry=e,(0,r.bh)()):(this._visualElementGraphics.regularVertices=new r.a1({geometry:e,symbol:this._visualElementSymbols.regularVertices,attributes:{displayOrder:1}}),this.internalGraphicsLayer.add(this._visualElementGraphics.regularVertices),this.internalGraphicsLayer.graphics.sort(ic),(0,r.bh)((()=>{null!=this._visualElementGraphics.regularVertices&&(this.internalGraphicsLayer.remove(this._visualElementGraphics.regularVertices),this._visualElementGraphics.regularVertices=(0,r.ch)(this._visualElementGraphics.regularVertices))})))}};function ic(t,e){return(t.attributes?.displayOrder??-1/0)-(e.attributes?.displayOrder??-1/0)}(0,r.bt)([(0,r.bu)()],nc.prototype,"activeFillSymbol",void 0),(0,r.bt)([(0,r.bu)({readOnly:!0})],nc.prototype,"type",void 0),(0,r.bt)([(0,r.bu)({constructOnly:!0,nonNullable:!0})],nc.prototype,"view",void 0),nc=(0,r.bt)([(0,r.bv)("esri.views.2d.interactive.editingTools.draw.DrawGraphicTool2D")],nc);let rc=class{get hovering(){return this.someManipulator((t=>t.hovering))}get grabbing(){return this.someManipulator((t=>t.grabbing))}get dragging(){return this.someManipulator((t=>t.dragging))}hasManipulator(t){return this.someManipulator((e=>e===t))}someManipulator(t){let e=!1;return this.forEachManipulator((n=>{!e&&t(n)&&(e=!0)})),e}};var oc;function sc(t){let e=0,n=0,i=0;return t?("cim"===t.type&&t.data.symbol&&"symbolLayers"in t.data.symbol&&t.data.symbol.symbolLayers&&t.data.symbol.symbolLayers.map((t=>{"CIMVectorMarker"===t.type&&t.anchorPoint&&(Math.abs(t.anchorPoint.x)>e&&(e=t.anchorPoint.x),Math.abs(t.anchorPoint.y)>n&&(n=t.anchorPoint.y),null!=t.size&&t.size>i&&(i=t.size))})),e=(0,r.d2)(e),n=(0,r.d2)(n),i=(0,r.d2)(i),{offsetX:e,offsetY:n,size:i}):{offsetX:e,offsetY:n,size:i}}(function(t){t[t.TRANSLATE_XY=0]="TRANSLATE_XY",t[t.SCALE=1]="SCALE",t[t.ROTATE=2]="ROTATE"})(oc||(oc={}));let ac=class extends r.e9{set graphic(t){this._circleCollisionCache=null,this._originalSymbol=t.symbol,this._set("graphic",t),this.attachSymbolChanged()}get elevationInfo(){const{layer:t}=this.graphic,e=t&&"elevationInfo"in t?t.elevationInfo:null,n=(0,s.l)(this.graphic),i=e?e.offset:0;return new r.hN({mode:n,offset:i})}set focusedSymbol(t){t!==this._get("focusedSymbol")&&(this._set("focusedSymbol",t),this._updateGraphicSymbol(),this._circleCollisionCache=null)}grabbableForEvent(){return!0}set grabbing(t){t!==this._get("grabbing")&&(this._set("grabbing",t),this._updateGraphicSymbol())}set hovering(t){t!==this._get("hovering")&&(this._set("hovering",t),this._updateGraphicSymbol())}set selected(t){t!==this._get("selected")&&(this._set("selected",t),this._updateGraphicSymbol(),this.events.emit("select-changed",{action:t?"select":"deselect"}))}get _focused(){return this._get("hovering")||this._get("grabbing")}constructor(t){super(t),this.layer=null,this.interactive=!0,this.selectable=!1,this.grabbable=!0,this.dragging=!1,this.cursor=null,this.consumesClicks=!0,this.events=new r.d4.EventEmitter,this._circleCollisionCache=null,this._graphicSymbolChangedHandle=null,this._originalSymbol=null}destroy(){this.detachSymbolChanged(),this._resetGraphicSymbol(),this._set("view",null)}intersectionDistance(t){const e=this.graphic;if(!1===e.visible)return null;const n=e.geometry;if(null==n)return null;const i=this._get("focusedSymbol"),r=i??e.symbol;return"2d"===this.view.type?this._intersectDistance2D(this.view,t,n,r):this._intersectDistance3D(this.view,t,e)}attach(){this.attachSymbolChanged(),null!=this.layer&&this.layer.add(this.graphic)}detach(){this.detachSymbolChanged(),this._resetGraphicSymbol(),null!=this.layer&&this.layer.remove(this.graphic)}attachSymbolChanged(){this.detachSymbolChanged(),this._graphicSymbolChangedHandle=(0,r.cc)((()=>this.graphic?.symbol),(t=>{null!=t&&t!==this.focusedSymbol&&t!==this._originalSymbol&&(this._originalSymbol=t,this._focused&&null!=this.focusedSymbol&&(this.graphic.symbol=this.focusedSymbol))}),r.eL)}detachSymbolChanged(){null!=this._graphicSymbolChangedHandle&&(this._graphicSymbolChangedHandle.remove(),this._graphicSymbolChangedHandle=null)}onElevationChange(){}onViewChange(){}_updateGraphicSymbol(){this.graphic.symbol=this._focused&&null!=this.focusedSymbol?this.focusedSymbol:this._originalSymbol}_resetGraphicSymbol(){this.graphic.symbol=this._originalSymbol}_intersectDistance2D(t,e,n,i){if(null==(i=i||(0,r.v4)(n)))return null;const o=1;let s=this._circleCollisionCache;if("point"===n.type&&"cim"===i.type&&"CIMPointSymbol"===i.data.symbol?.type&&i.data.symbol.symbolLayers){const{offsetX:s,offsetY:a,size:l}=sc(i),c=(0,r.v5)(e,cc),u=l/2,h=t.toScreen(n),p=h.x+s,d=h.y+a;return(0,r.uG)(c,[p,d])<u*u?o:null}if("point"!==n.type||"simple-marker"!==i.type)return(0,v.i)(e,n,t)?o:null;if(null==s||!s.originalPoint.equals(n)){const e=n,o=t.spatialReference;if((0,r.bD)(e.spatialReference,o)){const t=(0,r.cl)(e,o);s={originalPoint:e.clone(),mapPoint:t,radiusPx:(0,r.d2)(i.size)},this._circleCollisionCache=s}}if(null!=s){const n=(0,r.v5)(e,cc),a=t.toScreen?.(s.mapPoint);if(!a)return null;const l=s.radiusPx,c=a.x+(0,r.d2)(i.xoffset),u=a.y-(0,r.d2)(i.yoffset);return(0,r.uG)(n,[c,u])<l*l?o:null}return null}_intersectDistance3D(t,e,n){const i=t.toMap(e,{include:[n]});return i&&(0,_.c)(i,lc,t.renderSpatialReference)?(0,r.dR)(lc,t.state.camera.eye):null}};(0,r.bt)([(0,r.bu)({constructOnly:!0,nonNullable:!0})],ac.prototype,"graphic",null),(0,r.bt)([(0,r.bu)()],ac.prototype,"elevationInfo",null),(0,r.bt)([(0,r.bu)({constructOnly:!0,nonNullable:!0})],ac.prototype,"view",void 0),(0,r.bt)([(0,r.bu)({value:null})],ac.prototype,"focusedSymbol",null),(0,r.bt)([(0,r.bu)({constructOnly:!0})],ac.prototype,"layer",void 0),(0,r.bt)([(0,r.bu)()],ac.prototype,"interactive",void 0),(0,r.bt)([(0,r.bu)()],ac.prototype,"selectable",void 0),(0,r.bt)([(0,r.bu)()],ac.prototype,"grabbable",void 0),(0,r.bt)([(0,r.bu)({value:!1})],ac.prototype,"grabbing",null),(0,r.bt)([(0,r.bu)()],ac.prototype,"dragging",void 0),(0,r.bt)([(0,r.bu)()],ac.prototype,"hovering",null),(0,r.bt)([(0,r.bu)({value:!1})],ac.prototype,"selected",null),(0,r.bt)([(0,r.bu)()],ac.prototype,"cursor",void 0),ac=(0,r.bt)([(0,r.bv)("esri.views.interactive.GraphicManipulator")],ac);const lc=(0,r.ap)(),cc=(0,r.qd)();let uc=class extends rc{constructor(t){super(),this._view=t.view,this._tool=t.tool,this._graphic=t.graphic,this._manipulator=this._createManipulator(),this.forEachManipulator((t=>this._tool.manipulators.add(t)))}destroy(){this.forEachManipulator((t=>{this._tool.manipulators.remove(t),t.destroy()})),this._tool=null,this._view=null,this._manipulator=null,this._graphic=null}forEachManipulator(t){t(this._manipulator,oc.TRANSLATE_XY)}createDragPipeline(t,e){let n=null,i=null,r=0,o=0,s=0;const{offsetX:a,offsetY:l,size:c}=sc(this._graphic.symbol);return kl(this._manipulator,((u,h)=>{h.next((e=>{if("start"===e.action){const e=t();n=e.editGeometryOperations,i=e.constraints}return e})).next(Rl(this._view)).next((t=>{const{x:u,y:h,z:p}=t.mapEnd;if(i&&(u+a<i.xmin||h+l-c<i.ymin||u+a>i.xmax||h+l-c>i.ymax))return t;("start"===t.action||0===r&&0===o&&0===s)&&(r=t.mapStart.x,o=t.mapStart.y,s=t.mapStart.z);const d=u-r,f=h-o,g=p-s;r=u,o=h,s=p;const m="start"===t.action?sl.NEW_STEP:sl.ACCUMULATE_STEPS,y=n.move(d,f,g,m);return e(t,y),t}))}))}_createManipulator(){const t=this._view,e=this._graphic;return new ac({view:t,graphic:e,selectable:!0,cursor:"move"})}};const hc={up:"ArrowUp",down:"ArrowDown",left:"ArrowLeft",right:"ArrowRight",toggleOpacity:"t",shift:"Shift",primaryKey:r.uM},pc=1,dc=10,fc=new r.h2("#009af2");let gc=class extends Ea{constructor(t){super(t),this._isOpacityToggled=!1,this._isModifierActive=!1,this._factor=1,this._initialControlPoints=null,this._graphicsLayer=new r.eW({internal:!0,listMode:"hide",visible:!1,effect:"drop-shadow(0px, 0px, 3px)"}),this._undoStack=[],this._redoStack=[],this._sharedUndoStack=[],this._sharedRedoStack=[],this._highlightHandle=null,this.activeHandle=0,this.type="reshape"}initialize(){this._initialize()}destroy(){const{map:t}=this.view;this._controlPointManipulations.forEach((t=>t.destroy())),this._controlPointEditGeometryOperations.forEach((t=>t.destroy())),t.removeMany([this._graphicsLayer]),this._graphicsLayer.removeAll(),this._graphicsLayer=(0,r.ch)(this._graphicsLayer),this._georeference=null,this._controlPointGraphics=null,this._controlPointManipulations=null,this._graphicsLayer=null,this._controlPointEditGeometryOperations=null,this._undoStack=null,this._redoStack=null,this._initialControlPoints=null,this._sharedUndoStack=null,this._sharedRedoStack=null}get _hasValidSpatialReference(){return(0,r.du)(this.view.spatialReference)}onActivate(){this.visible=!0}onDeactivate(){this.visible=!1}onShow(){this._graphicsLayer.visible=!0}onHide(){this._graphicsLayer.visible=!1}canUndo(){const t=this._undoStack[this._undoStack.length-1];return null!=t&&this._controlPointEditGeometryOperations[t].canUndo}canRedo(){const t=this._redoStack[this._redoStack.length-1];return null!=t&&this._controlPointEditGeometryOperations[t].canRedo}undo(){if(this._undoStack.length>0){const t=this._undoStack.pop();this._controlPointEditGeometryOperations[t].undo(),this.updateGraphics(),this._redoStack.push(t)}}redo(){if(this._redoStack.length>0){const t=this._redoStack.pop();this._controlPointEditGeometryOperations[t].redo(),this.updateGraphics(),this._undoStack.push(t)}}refresh(){const{mediaElement:t}=this;if(null==t.georeference)return;const e=t.georeference;"control-points"===e.type&&null!=e.coords&&(this._georeference=e,this._georeference.controlPoints.forEach((({mapPoint:t},e)=>{const n=this._controlPointEditGeometryOperations[e],i=n.data.components[0].vertices[0];n.setVertexPosition(i,n.data.coordinateHelper.pointToVector(t))})),this.updateGraphics())}reset(){this._georeference.controlPoints=this._initialControlPoints,this.refresh(),this._sharedUndoStack.length=0,this._sharedRedoStack.length=0}updateGraphics(){const t=this._georeference,e=t.controlPoints,n=e[0].mapPoint.spatialReference,i=this._hasValidSpatialReference;this._georeference.controlPoints=this._controlPointEditGeometryOperations.map(((o,s)=>{const a=o.data.geometry;return this._controlPointGraphics[s].geometry=a,{mapPoint:(0,r.cl)(a,n),sourcePoint:i?e[s].sourcePoint:t.toSource(a)}}))}updateActiveHandle(t){if(this.activeHandle===t)return;const e=this._controlPointGraphics[this.activeHandle].symbol.clone();(0,r.jm)(e,this.view.effectiveTheme.accentColor),this._controlPointGraphics[this.activeHandle].symbol=e;const n=this._controlPointGraphics[t].symbol.clone();(0,r.jm)(n,fc),this._controlPointGraphics[t].symbol=n,this.activeHandle=t,this.view.surface===document.activeElement&&this.highlightActiveHandle()}async highlightActiveHandle(){this.removeHighlightActiveHandle();const t=await this.view.whenLayerView(this._graphicsLayer);this._highlightHandle=t.highlight(this._controlPointGraphics[this.activeHandle])}removeHighlightActiveHandle(){this._highlightHandle&&this._highlightHandle.remove()}setSharedUndoStack(t){this._sharedUndoStack=t}setSharedRedoStack(t){this._sharedRedoStack=t}async _initialize(){const{view:t,mediaElement:e}=this;if(null==e.georeference)return;const n=e.georeference;"control-points"===n.type&&null!=n.coords&&(this._georeference=n,this._initialControlPoints=this._georeference.controlPoints,t.map.addMany([this._graphicsLayer]),t.focus(),this.visible=!1,this.finishToolCreation(),await this._loadProjectionEngine(),this._controlPointEditGeometryOperations=this._georeference.controlPoints.map((({mapPoint:e})=>Pl.fromGeometry((0,r.cl)(e,t.spatialReference),r.iE.Local))),this._controlPointGraphics=this._controlPointEditGeometryOperations.map(((t,e)=>new r.a1({symbol:new r.up({data:{type:"CIMSymbolReference",symbol:{type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,colorLocked:!0,anchorPoint:{x:0,y:-15.75},anchorPointUnits:"Absolute",dominantSizeAxis3D:"Y",size:9,billboardMode3D:"FaceNearPlane",frame:{xmin:0,ymin:0,xmax:84.3,ymax:84.3},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{rings:[[[83.2,32.5],[84.3,40.7],[83.8,48.9],[81.7,56.9],[78.1,64.3],[73,70.9],[66.9,76.4],[59.7,80.5],[51.9,83.2],[43.7,84.3],[35.4,83.8],[27.4,81.7],[20,78],[13.4,73],[7.9,66.8],[3.8,59.7],[1.1,51.9],[0,43.7],[.5,35.4],[2.6,27.4],[6.3,20],[11.3,13.4],[17.5,7.9],[24.7,3.8],[32.5,1.1],[39.8,.1],[47.1,.3],[54.3,1.8],[61.1,4.5],[67.4,8.4],[72.9,13.3],[77.4,19.1],[80.9,25.5],[83.2,32.5]]]},symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:[255,255,255,255]}]}}],scaleSymbolsProportionally:!0,respectFrame:!0,clippingPath:{type:"CIMClippingPath",clippingType:"Intersect",path:{rings:[[[0,0],[84.3,0],[84.3,84.3],[0,84.3],[0,0]]]}},rotation:0},{type:"CIMVectorMarker",enable:!0,anchorPoint:{x:0,y:-11.25},anchorPointUnits:"Absolute",dominantSizeAxis3D:"Y",size:22.5,billboardMode3D:"FaceNearPlane",frame:{xmin:0,ymin:0,xmax:197.7,ymax:294.7},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{rings:[[[98.9,0],[119.4,23.2],[139.4,49.3],[156.8,75.2],[171.2,100.8],[182.4,125.3],[190.6,148.8],[195.7,171.4],[197.7,192.9],[197.7,195.8],[197.7,200.3],[197.6,202.5],[197.5,204.8],[197.3,207.1],[197,209.4],[196.7,211.7],[196.4,214.1],[196,216.4],[195.5,218.7],[195,221.1],[194.4,223.4],[193.7,225.8],[193,228.1],[192.2,230.5],[191.4,232.8],[190.5,235.1],[189.5,237.5],[188.5,239.7],[187.4,242],[186.2,244.3],[185,246.5],[183.7,248.7],[182.4,250.9],[181,253.1],[179.5,255.2],[178,257.3],[176.4,259.4],[174.7,261.4],[173.1,263.3],[171.3,265.3],[169.5,267.2],[167.7,269],[165.8,270.8],[163.9,272.5],[161.9,274.2],[159.9,275.8],[157.8,277.4],[155.7,278.9],[153.6,280.4],[151.4,281.7],[149.2,283.1],[147,284.4],[144.8,285.6],[142.5,286.7],[140.3,287.8],[138,288.8],[135.7,289.8],[133.4,290.7],[131,291.5],[128.7,292.3],[126.4,293],[124,293.6],[121.7,294.2],[119.4,294.7],[117,295.2],[114.7,295.6],[112.4,296],[110.1,296.3],[107.8,296.5],[105.5,296.7],[103.3,296.8],[101.1,296.9],[98.8,296.9],[83.1,295.7],[67.8,292],[53.3,285.9],[39.9,277.5],[28.1,267.2],[18,255.1],[10,241.5],[4.2,226.9],[.9,211.5],[0,195.8],[.1,192.9],[2.1,171.4],[7.2,148.8],[15.4,125.3],[26.6,100.8],[41,75.2],[58.4,49.3],[78.4,23.2],[98.9,0]]]},symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:e===this.activeHandle?fc.toArray():this.view.effectiveTheme.accentColor.toArray()}]}}],scaleSymbolsProportionally:!0,respectFrame:!0,clippingPath:{type:"CIMClippingPath",clippingType:"Intersect",path:{rings:[[[0,0],[197.7,0],[197.7,294.7],[0,294.7],[0,0]]]}},rotation:0}],haloSize:1,scaleX:1,angleAlignment:"Display",angle:0}}}),geometry:t.data.geometry}))),this._graphicsLayer.graphics.addMany([...this._controlPointGraphics]),this._controlPointManipulations=this._controlPointGraphics.map((e=>new uc({tool:this,view:t,graphic:e}))),this.addHandles([...this._controlPointManipulations.map(((t,e)=>t.createDragPipeline(this._getInfo.bind(this,e),((t,n)=>{"start"===t.action&&(this._undoStack.push(e),this._redoStack=[],this._sharedUndoStack.push({tool:this,operation:n}),this._sharedRedoStack.length=0),this.updateGraphics()})))),(0,r.cc)((()=>this.view.scale),(()=>this.active?this.updateGraphics():null))]),this._controlPointManipulations.forEach(((t,e)=>{const n=t=>{this.addHandles([t.events.on(["click","grab-changed"],(t=>this.updateActiveHandle(e)))])};t.forEachManipulator(n)})),this.addHandles([t.on("key-down",(n=>{t.activeTool===this&&(n.key!==hc.shift||n.repeat||(this._isModifierActive=!0,n.stopPropagation()),n.key!==hc.toggleOpacity||n.repeat||(e.opacity*=this._isOpacityToggled?2:.5,this._isOpacityToggled=!this._isOpacityToggled,n.stopPropagation()),n.key!==hc.primaryKey||n.repeat||(this._factor=dc,n.stopPropagation()),this._isModifierActive&&(n.key===hc.up&&(this._move(0,this._factor),n.stopPropagation()),n.key===hc.down&&(this._move(0,-this._factor),n.stopPropagation()),n.key===hc.left&&(this._move(-this._factor,0),n.stopPropagation()),n.key===hc.right&&(this._move(this._factor,0),n.stopPropagation())))})),t.on("key-up",(e=>{t.activeTool===this&&(e.key===hc.shift&&(this._isModifierActive=!1,e.stopPropagation()),e.key===hc.primaryKey&&(this._factor=pc,e.stopPropagation()))}))]))}async _loadProjectionEngine(){const t=this._georeference.controlPoints[0].mapPoint;return(0,r.dM)(t.spatialReference,this.view.spatialReference)}_getInfo(t){return{editGeometryOperations:this._controlPointEditGeometryOperations[t],constraints:this._hasValidSpatialReference?null:{xmin:0,ymin:0,xmax:this._georeference.width,ymax:this._georeference.height}}}_move(t,e){const n=this._controlPointEditGeometryOperations[this.activeHandle].move(t*this.view.resolution,e*this.view.resolution,0,sl.NEW_STEP);this._sharedUndoStack.push({tool:this,operation:n}),this._sharedRedoStack.length=0,this.updateGraphics()}};function mc(t,e){"start"===t.action?e.cursor="grabbing":e.cursor="grab"}(0,r.bt)([(0,r.bu)()],gc.prototype,"_hasValidSpatialReference",null),(0,r.bt)([(0,r.bu)()],gc.prototype,"activeHandle",void 0),(0,r.bt)([(0,r.bu)({constructOnly:!0,nonNullable:!0})],gc.prototype,"mediaElement",void 0),(0,r.bt)([(0,r.bu)({readOnly:!0})],gc.prototype,"type",void 0),(0,r.bt)([(0,r.bu)({constructOnly:!0})],gc.prototype,"view",void 0),gc=(0,r.bt)([(0,r.bv)("esri.views.2d.interactive.editingTools.ControlPointsTransformTool")],gc);class yc{constructor(){this._lastDragEvent=null,this.next=new Al,this._enabled=!1}get enabled(){return this._enabled}set enabled(t){if(this._enabled!==t&&null!=this._lastDragEvent){const e={...this._lastDragEvent,action:"update"};t&&this._adjustScaleFactors(e),this.next.execute(e)}this._enabled=t}createDragEventPipelineStep(){return this._lastDragEvent=null,t=>(this._lastDragEvent="end"!==t.action?{...t}:null,this._enabled&&this._adjustScaleFactors(t),t)}_adjustScaleFactors(t){const e=0!==t.direction[0]&&0!==t.direction[1]?Math.max(Math.abs(t.factor1),Math.abs(t.factor2)):0===t.direction[0]?Math.abs(t.factor2):Math.abs(t.factor1);t.factor1=t.factor1<0?-e:e,t.factor2=t.factor2<0?-e:e}}let _c=class{constructor(){this._lastDragEvent=null,this.next=new Al,this._enabled=!1}get enabled(){return this._enabled}set enabled(t){if(this._enabled!==t&&null!=this._lastDragEvent){const e={...this._lastDragEvent,action:"update"};t&&this._adjustRotateAngle(e),this.next.execute(e)}this._enabled=t}createDragEventPipelineStep(){return this._lastDragEvent=null,t=>(this._lastDragEvent="end"!==t.action?{...t}:null,this._enabled&&this._adjustRotateAngle(t),t)}_adjustRotateAngle(t){const e=(0,r.et)(t.rotateAngle);t.rotateAngle=(0,r.fA)(5*Math.round(e/5))}};function vc(t,e,n,i=!1){const o=Math.atan2(e.y-n.y,e.x-n.x)-Math.atan2(t.y-n.y,t.x-n.x),s=Math.atan2(Math.sin(o),Math.cos(o));return i?s:(0,r.et)(s)}function bc(t,e){return xc(t,e,!1)}function xc(t,e,n){if(t instanceof ll){if(t.operation instanceof gl)return wc(t.operation,e,n),!0;if(t.operation instanceof xl)return Mc(t.operation,e,n),!0;if(t.operation instanceof wl)return Ec(t.operation,e,n),!0}return!1}function wc(t,e,n=!1){const i=n?-1:1,o=(0,r.aq)(i*t.dx,i*t.dy,i*t.dz);(0,r.dE)(e.origin,e.origin,o),(0,b.K)(e)}function Mc(t,e,n=!1){const i=n?-t.angle:t.angle;(0,r.v8)(e.basis1,e.basis1,r.it,i),(0,r.v8)(e.basis2,e.basis2,r.it,i),(0,b.K)(e)}function Ec(t,e,n=!1){const i=n?1/t.factor1:t.factor1,o=n?1/t.factor2:t.factor2;(0,r.dC)(e.basis1,e.basis1,i),(0,r.dC)(e.basis2,e.basis2,o),(0,r.v1)(e.origin,e.origin,t.origin,t.axis1,i),(0,r.v1)(e.origin,e.origin,t.origin,t.axis2,o),(0,b.K)(e)}function Tc(t,e,n,i){i||(i=(0,b.W)());const o=(0,r.gV)(p.t.get(),t[1],-t[0]),s=(0,r.gV)(p.t.get(),Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),a=(0,r.gV)(p.t.get(),Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY),l=p.t.get();e.components.forEach((e=>e.vertices.forEach((({pos:e})=>{(0,r.gV)(l,(0,r.uD)(t,e),(0,r.uD)(o,e)),(0,r.v6)(s,s,l),(0,r.v7)(a,a,l)}))));const c=1e-6,u=(0,r.gV)(p.t.get(),a[0]-s[0]<c?n/2:0,a[1]-s[1]<c?n/2:0);return(0,r.un)(s,s,u),(0,r.ng)(a,a,u),(0,r.nh)(i.basis1,t,(a[0]-s[0])/2),(0,r.nh)(i.basis2,o,(a[1]-s[1])/2),(0,r.gV)(i.origin,s[0]*t[0]+s[1]*o[0],s[0]*t[1]+s[1]*o[1]),(0,r.ng)(i.origin,i.origin,i.basis1),(0,r.ng)(i.origin,i.origin,i.basis2),(0,b.K)(i),i}class Sc extends rc{constructor(t){super(),this._handles=new r.gZ,this._originCache=(0,r.ap)(),this._view=t.view,this._tool=t.tool,this._graphic=t.graphic,this._snapRotation=t.snapRotation,this._manipulator=this._createManipulator(),this._handles.add([this._manipulator.events.on("grab-changed",(t=>mc(t,this._manipulator)))]),this.forEachManipulator((t=>this._tool.manipulators.add(t)))}destroy(){this._handles.destroy(),this.forEachManipulator((t=>{this._tool.manipulators.remove(t),t.destroy()})),this._tool=null,this._view=null,this._manipulator=null,this._snapRotation=null,this._graphic=null,this._handles=null,this._originCache=null}forEachManipulator(t){t(this._manipulator,oc.ROTATE)}createDragPipeline(t,e){let n=null,i=null;return kl(this._manipulator,((o,s)=>{s.next((e=>{if("start"===e.action){o.cursor="grabbing";const e=t();n=e.plane,i=e.editGeometryOperations}return e})).next(Rl(this._view)).next((t=>({...t,rotateAngle:vc(t.mapStart,t.mapEnd,{x:n.origin[0],y:n.origin[1]},!0)}))).next(this._snapRotation.createDragEventPipelineStep(),this._snapRotation.next).next((t=>{const o=(0,r.dF)(this._originCache,n.origin),s="start"===t.action?sl.NEW_STEP:sl.ACCUMULATE_STEPS,a=i.rotate(o,t.rotateAngle,s,cl.REPLACE);return bc(a,n),e(t,a),t})).next((t=>("end"===t.action&&(o.cursor="grab"),t)))}))}_createManipulator(){const t=this._view,e=this._graphic;return new ac({view:t,graphic:e,selectable:!0,cursor:"grab"})}}const Pc=10,Cc=1e-6,kc=.3;function Rc(t){const e=(0,r.dS)(t.basis1),n=(0,r.dS)(t.basis2);return kc*Math.min(e,n)}class Vc extends rc{constructor(t){super(),this._handles=new r.gZ,this._planeStart=(0,b.W)(),this._displayPlaneStart=(0,b.W)(),this._originCache=(0,r.ap)(),this._axisCache=(0,r.g_)(),this._renderStartCache=(0,r.ap)(),this._renderEndCache=(0,r.ap)(),this._resizeOriginCache=(0,r.ap)(),this._view=t.view,this._tool=t.tool,this._graphic=t.graphic,this._direction=t.direction,this._preserveAspectRatio=t.preserveAspectRatio,this._manipulator=this._createManipulator(),this._handles.add([this._manipulator.events.on("grab-changed",(t=>mc(t,this._manipulator)))]),this.forEachManipulator((t=>this._tool.manipulators.add(t)))}destroy(){this._handles.destroy(),this.forEachManipulator((t=>{this._tool.manipulators.remove(t),t.destroy()})),this._tool=null,this._view=null,this._graphic=null,this._manipulator=null,this._direction=null,this._handles=null,this._planeStart=null,this._displayPlaneStart=null,this._originCache=null,this._axisCache=null,this._renderStartCache=null,this._renderEndCache=null,this._resizeOriginCache=null,this._preserveAspectRatio=null}forEachManipulator(t){t(this._manipulator,oc.SCALE)}createDragPipeline(t,e){let n=null,i=null,o=null,s=0,a=null,l=null;const c=this._planeStart,u=this._displayPlaneStart,h=this._direction;return kl(this._manipulator,((p,d)=>{d.next((e=>{if("start"===e.action){p.cursor="grabbing";const e=t();n=e.plane,i=e.displayPlane,o=e.editGeometryOperations,s=Pc*this._view.resolution,(0,b.Z)(n,c),(0,b.Z)(i,u);const l=(0,r.b3)(o.data.spatialReference);a=l?l.valid[1]-l.valid[0]-3*Pc*this._view.resolution:null}return e})).next(Rl(this._view)).next((t=>{const e=(0,r.dF)(this._renderStartCache,[t.mapStart.x,t.mapStart.y,0]),n=(0,r.dF)(this._renderEndCache,[t.mapEnd.x,t.mapEnd.y,0]),o=(0,r.dF)(this._resizeOriginCache,u.origin);(0,r.h9)(o,o,u.basis1,-h[0]),(0,r.h9)(o,o,u.basis2,-h[1]),(0,r.dB)(n,n,o),(0,r.dB)(e,e,o);const a=0!==h[0]&&0!==h[1],l=Rc(u),c=Rc(i)/l,p=(t,i)=>{if(0===t)return 1;let o=(0,r.dS)(i),l=.5*t*(0,r.al)(i,n)/o;const u=l<0?-1:1;a&&(l+=(o-.5*t*(0,r.al)(i,e)/o)*u*c);const h=o<1.5*s?1:Cc;return o=Math.max(o-s,Cc),u>0&&(l-=Pc*this._view.resolution),u*Math.max(u*(l/o),h)},d=p(h[0],u.basis1),f=p(h[1],u.basis2);return{...t,direction:h,factor1:d,factor2:f}})).next(this._preserveAspectRatio.createDragEventPipelineStep(),this._preserveAspectRatio.next).next((t=>{const i=(0,r.dF)(this._originCache,c.origin);(0,r.h9)(i,i,c.basis1,-h[0]),(0,r.h9)(i,i,c.basis2,-h[1]);const s=(0,r.gV)(this._axisCache,c.basis1[0],c.basis1[1]);(0,r.nf)(s,s);const u=o.data.allVertices,p="start"===t.action?sl.NEW_STEP:sl.ACCUMULATE_STEPS,d=o.scaleVertices(u,i,s,t.factor1,t.factor2,p,cl.REPLACE);return a&&a<o.data.geometry.extent.width&&l?o.updateVertices(u,l):((0,b.Z)(c,n),bc(d,n),l=d.operation,e(t,d)),t})).next((t=>("end"===t.action&&(p.cursor="grab"),t)))}))}_createManipulator(){return new ac({view:this._view,graphic:this._graphic,selectable:!0,cursor:"grab"})}}function Ac(t){return"graphic"===t?.type}function Ic(t){return t.find(Ac)??null}const Oc=80,Dc=10,Gc=30,Lc=[[1,1],[1,-1],[-1,-1],[-1,1],[1,0],[0,-1],[-1,0],[0,1]],zc=1,Nc=10;let Uc=class extends Ea{constructor(t){super(t),this._initialControlPoints=null,this._initialGeometry=null,this._graphic=null,this._planeCache=(0,b.W)(),this._displayPlaneCache=(0,b.W)(),this._mainAxisCache=(0,r.g_)(),this._rotationHandleCache=(0,r.ap)(),this._cornerA=(0,r.ap)(),this._cornerB=(0,r.ap)(),this._cornerC=(0,r.ap)(),this._cornerD=(0,r.ap)(),this._avgAB=(0,r.ap)(),this._avgBC=(0,r.ap)(),this._avgCD=(0,r.ap)(),this._avgDA=(0,r.ap)(),this._preserveAspectRatio=new yc,this._snapRotation=new _c,this._graphicsLayer=new r.eW({internal:!0,listMode:"hide",visible:!1}),this._sharedUndoStack=[],this._sharedRedoStack=[],this._isOpacityToggled=!1,this._factor=zc,this.preserveAspectRatio=null,this.snapRotation=null,this.type="transform"}initialize(){this._initialize()}destroy(){const{map:t}=this.view;this._dragManipulation.destroy(),this._rotateManipulation.destroy(),this._scaleManipulations.forEach((t=>t.destroy())),this._editGeometryOperations.destroy(),t.removeMany([this._graphicsLayer]),this._graphicsLayer.removeAll(),this._graphicsLayer=(0,r.ch)(this._graphicsLayer),this._initialControlPoints=null,this._initialGeometry=null,this._graphic=null,this._preserveAspectRatio=null,this._snapRotation=null,this._planeCache=null,this._displayPlaneCache=null,this._rotationHandleCache=null,this._mainAxisCache=null,this._cornerA=null,this._cornerB=null,this._cornerC=null,this._cornerD=null,this._avgAB=null,this._avgBC=null,this._avgCD=null,this._avgDA=null,this._sharedUndoStack=null,this._sharedRedoStack=null}get _plane(){const t=this._graphic.geometry;if(null==t)return null;const e=this._editGeometryOperations.data,n=e.components[0].edges[0],i=(0,r.un)(this._mainAxisCache,n.leftVertex.pos,n.rightVertex.pos);(0,r.nf)(i,i);let o=Oc*this.view.resolution;const s=this.view.spatialReference;return(0,r.a5)(s,t.spatialReference)&&(o*=(0,r.cm)(s)/(0,r.cm)(t.spatialReference)),Tc(i,e,o,this._planeCache)}get _displayPlane(){const t=this._plane;if(!t)return null;const e=this._displayPlaneCache;(0,b.Z)(t,e);const n=Dc*this.view.resolution;return(0,r.dC)(e.basis1,e.basis1,1+n/(0,r.dS)(e.basis1)),(0,r.dC)(e.basis2,e.basis2,1+n/(0,r.dS)(e.basis2)),e}get _backgroundGraphicGeometry(){const t=this._displayPlane;if(!t)return null;const e=this.view.spatialReference;return this._updateDisplayPlaneConrers(t),new r.a$({spatialReference:e,rings:[[this._cornerA,this._cornerB,this._cornerC,this._cornerD,this._cornerA]]})}get _rotateGraphicGeometry(){const t=this._plane;if(!t)return null;const e=this._rotationHandleCache;return(0,r.ao)(e,t.basis1),(0,r.dC)(e,e,Gc*this.view.resolution),(0,r.dE)(e,e,t.origin),(0,r.dE)(e,e,t.basis1),new r.D({x:e[0],y:e[1],spatialReference:this.view.spatialReference})}get _scaleGraphicGeometries(){const t=this._displayPlane;if(!t)return[];const e=this.view.spatialReference;this._updateDisplayPlaneConrers(t);const{_cornerA:n,_cornerB:i,_cornerC:o,_cornerD:s}=this,a=(0,r.iX)(this._avgAB,n,i,.5),l=(0,r.iX)(this._avgBC,i,o,.5),c=(0,r.iX)(this._avgCD,o,s,.5),u=(0,r.iX)(this._avgDA,s,n,.5);return[new r.D({x:n[0],y:n[1],spatialReference:e}),new r.D({x:i[0],y:i[1],spatialReference:e}),new r.D({x:o[0],y:o[1],spatialReference:e}),new r.D({x:s[0],y:s[1],spatialReference:e}),new r.D({x:a[0],y:a[1],spatialReference:e}),new r.D({x:l[0],y:l[1],spatialReference:e}),new r.D({x:c[0],y:c[1],spatialReference:e}),new r.D({x:u[0],y:u[1],spatialReference:e})]}onActivate(){this.visible=!0}onDeactivate(){this.visible=!1}onShow(){this._graphicsLayer.visible=!0}onHide(){this._graphicsLayer.visible=!1}canUndo(){return this._editGeometryOperations.canUndo}canRedo(){return this._editGeometryOperations.canRedo}undo(){this._editGeometryOperations.undo(),this.updateGraphics()}redo(){this._editGeometryOperations.redo(),this.updateGraphics()}refresh(){const{view:t,target:e}=this,n="georeference"in e?e.georeference.coords:e.geometry,i=this._editGeometryOperations,o=i.data.components[0].vertices,s=el.fromGeometry((0,r.cl)(n,t.spatialReference),r.iE.Local).components[0].vertices;o.forEach(((t,e)=>{i.setVertexPosition(t,s[e].pos)})),this.updateGraphics()}reset(){const{target:t}=this;if("georeference"in t){const e=t.georeference;"control-points"===e.type&&(e.controlPoints=this._initialControlPoints)}else t.geometry=this._initialGeometry;this.refresh(),this._sharedUndoStack.length=0,this._sharedRedoStack.length=0}updateGraphics(){const t=this._editGeometryOperations.data.geometry;"georeference"in this.target&&(this.target.georeference.coords=t),this._graphic.geometry=t,this._backgroundGraphic.geometry=this._backgroundGraphicGeometry,this._rotateGraphic.geometry=this._rotateGraphicGeometry,this._scaleGraphicGeometries.forEach(((t,e)=>{this._scaleGraphics[e].geometry=t}))}setSharedUndoStack(t){this._sharedUndoStack=t}setSharedRedoStack(t){this._sharedRedoStack=t}async _initialize(){const{view:t,target:e}=this;if("georeference"in e){const t=e.georeference;this._graphic=new r.a1({geometry:t.coords}),this._initialControlPoints="control-points"===t.type?t.controlPoints:null}else this._graphic=e,this._initialGeometry=e.geometry;t.map.addMany([this._graphicsLayer]),t.focus(),this.visible=!1,this.finishToolCreation(),await this._loadProjectionEngine(),this._editGeometryOperations=Pl.fromGeometry((0,r.cl)(this._graphic.geometry,t.spatialReference),r.iE.Local),this._backgroundGraphic=new r.a1({symbol:new r.eo({color:"transparent",outline:{type:"simple-line",color:t.effectiveTheme.accentColor,width:2}}),geometry:this._backgroundGraphicGeometry}),this._rotateGraphic=new r.a1({symbol:new r.en({color:(0,r.v9)(t.effectiveTheme.accentColor),outline:{type:"simple-line",color:t.effectiveTheme.accentColor,width:1}}),geometry:this._rotateGraphicGeometry}),this._scaleGraphics=this._scaleGraphicGeometries.map((e=>new r.a1({symbol:new r.en({size:6,style:"square",color:(0,r.v9)(t.effectiveTheme.accentColor),outline:{type:"simple-line",color:t.effectiveTheme.accentColor,width:1}}),geometry:e}))),this._graphicsLayer.graphics.addMany([this._backgroundGraphic,this._rotateGraphic,...this._scaleGraphics]),this._dragManipulation=new uc({tool:this,view:t,graphic:this._graphic}),this._rotateManipulation=new Sc({tool:this,view:t,graphic:this._rotateGraphic,snapRotation:this._snapRotation}),this._scaleManipulations=this._scaleGraphics.map(((e,n)=>new Vc({tool:this,view:t,graphic:e,direction:Lc[n],preserveAspectRatio:this._preserveAspectRatio}))),this.addHandles([this._dragManipulation.createDragPipeline(this._getInfo.bind(this),this._updateGraphics.bind(this)),this._rotateManipulation.createDragPipeline(this._getInfo.bind(this),this._updateGraphics.bind(this)),...this._scaleManipulations.map((t=>t.createDragPipeline(this._getInfo.bind(this),this._updateGraphics.bind(this)))),(0,r.cc)((()=>this.view.scale),(()=>this.active?this.updateGraphics():null)),t.on("click",(async n=>{if(null!=t.activeTool&&t.activeTool!==this)return;const i=(0,r.va)(n),o=[];t.map.allLayers.forEach((t=>{"vector-tile"!==t.type&&"imagery"!==t.type||o.push(t)}));const s=await this.view.hitTest(i,{exclude:o}),a=s.results;if(0===a.length)t.activeTool=null;else{const n=Ic(s.results),i="georeference"in e,r=a.map((t=>"media"===t.type?t.element:null)).filter(Boolean),o=new Set([...this._graphicsLayer.graphics,i?null:e].filter(Boolean));i&&r.includes(e)||null!=n&&o.has(n.graphic)?null==t.activeTool&&(t.activeTool=this):t.activeTool=null}}))]);const n=t=>{this.addHandles(t.events.on("grab-changed",(t=>{"georeference"in e&&("start"===t.action?e.opacity*=.5:"end"===t.action&&(e.opacity*=2))})))};this._dragManipulation.forEachManipulator(n),this._rotateManipulation.forEachManipulator(n),this._scaleManipulations.forEach((t=>t.forEachManipulator(n)));const i=new xi;i.addToggle(bi.preserveAspectRatio,(()=>{null==this.preserveAspectRatio&&(this._preserveAspectRatio.enabled=!this._preserveAspectRatio.enabled)})),i.addToggle(bi.rotateIncrements,(()=>{null==this.snapRotation&&(this._snapRotation.enabled=!this._snapRotation.enabled)})),i.add(bi.toggleOpacity,(()=>{"georeference"in e&&(e.opacity*=this._isOpacityToggled?2:.5,this._isOpacityToggled=!this._isOpacityToggled)})),i.addToggle(bi.factorModifier,(t=>this._factor="key-down"===t.type?Nc:zc)),i.add(bi.scaleUp,(()=>this._scale(this._factor))),i.add(bi.scaleDown,(()=>this._scale(-this._factor))),i.add(bi.moveUp,(()=>this._move(0,this._factor))),i.add(bi.moveDown,(()=>this._move(0,-this._factor))),i.add(bi.moveLeft,(()=>this._move(-this._factor,0))),i.add(bi.moveRight,(()=>this._move(this._factor,0))),this.addHandles([t.on("key-down",(e=>{t.activeTool===this&&i.dispatch(t.inputManager,e)})),t.on("key-up",(e=>{t.activeTool===this&&i.dispatch(t.inputManager,e)}))])}async _loadProjectionEngine(){const t=this._graphic.geometry;return(0,r.dM)(t.spatialReference,this.view.spatialReference)}_updateDisplayPlaneConrers(t){const{basis1:e,basis2:n,origin:i}=t,o=this._cornerA;(0,r.dE)(o,i,e),(0,r.dE)(o,o,n);const s=this._cornerB;(0,r.dE)(s,i,e),(0,r.dB)(s,s,n);const a=this._cornerC;(0,r.dB)(a,i,e),(0,r.dB)(a,a,n);const l=this._cornerD;(0,r.dB)(l,i,e),(0,r.dE)(l,l,n)}_getInfo(){return{editGeometryOperations:this._editGeometryOperations,plane:this._plane,displayPlane:this._displayPlane}}_updateGraphics(t,e){"start"===t.action&&(this._sharedUndoStack.push({tool:this,operation:e}),this._sharedRedoStack.length=0),this.updateGraphics()}_scale(t){const e=this._editGeometryOperations,n=e.data.geometry.extent?.width,i=(n+t*this.view.resolution)/n,o=e.scale(this._plane.origin,r.vb,i,i,sl.NEW_STEP,cl.REPLACE);this._sharedUndoStack.push({tool:this,operation:o}),this._sharedRedoStack.length=0,this.updateGraphics()}_move(t,e){const n=this._editGeometryOperations.move(t*this.view.resolution,e*this.view.resolution,0,sl.NEW_STEP);this._sharedUndoStack.push({tool:this,operation:n}),this._sharedRedoStack.length=0,this.updateGraphics()}};(0,r.bt)([(0,r.bu)()],Uc.prototype,"_plane",null),(0,r.bt)([(0,r.bu)()],Uc.prototype,"_backgroundGraphicGeometry",null),(0,r.bt)([(0,r.bu)()],Uc.prototype,"_rotateGraphicGeometry",null),(0,r.bt)([(0,r.bu)()],Uc.prototype,"_scaleGraphicGeometries",null),(0,r.bt)([(0,r.bu)()],Uc.prototype,"preserveAspectRatio",void 0),(0,r.bt)([(0,r.bu)()],Uc.prototype,"snapRotation",void 0),(0,r.bt)([(0,r.bu)({constructOnly:!0,nonNullable:!0})],Uc.prototype,"target",void 0),(0,r.bt)([(0,r.bu)({readOnly:!0})],Uc.prototype,"type",void 0),(0,r.bt)([(0,r.bu)({constructOnly:!0})],Uc.prototype,"view",void 0),Uc=(0,r.bt)([(0,r.bv)("esri.views.2d.interactive.editingTools.TransformTool")],Uc);const Hc={redo:"r",undo:"z"};let Fc=class extends r.e9{constructor(t){super(t),this._transformTool=null,this._controlPointsTransformTool=null,this._advancedModeTransformTool=null,this._activeTool=null,this._sharedUndoStack=[],this._sharedRedoStack=[],this._originalOpacity=null,this.activeHandle=0}initialize(){const{view:t,mediaElement:e,preserveAspectRatio:n,snapRotation:i,advancedMode:o}=this;this._originalOpacity=e.opacity,this._transformTool=new Uc({target:e,view:t,preserveAspectRatio:n,snapRotation:i}),this._controlPointsTransformTool=new gc({mediaElement:e,view:t}),this._advancedModeTransformTool=new gc({mediaElement:o.mediaElement,view:o.view}),this._transformTool.setSharedUndoStack(this._sharedUndoStack),this._transformTool.setSharedRedoStack(this._sharedRedoStack),this._controlPointsTransformTool.setSharedUndoStack(this._sharedUndoStack),this._controlPointsTransformTool.setSharedRedoStack(this._sharedRedoStack),this._advancedModeTransformTool.setSharedUndoStack(this._sharedUndoStack),this._advancedModeTransformTool.setSharedRedoStack(this._sharedRedoStack);const s=e.georeference,a=o.mediaElement.georeference;o.view.tools.addMany([this._advancedModeTransformTool]),"controlPoints"in a&&"controlPoints"in s&&this.addHandles([o.view.on("key-down",(t=>{t.key===Hc.undo&&this.canUndo()&&(this.undo(),t.stopPropagation()),t.key===Hc.redo&&this.canRedo()&&(this.redo(),t.stopPropagation())})),o.view.on("focus",(async t=>{this._controlPointsTransformTool.removeHighlightActiveHandle(),this._advancedModeTransformTool.highlightActiveHandle()})),(0,r.cc)((()=>a.controlPoints),(t=>{s.controlPoints=t.map((({sourcePoint:t},e)=>({sourcePoint:t,mapPoint:s.controlPoints[e].mapPoint}))),this._activeTool?.refresh()})),(0,r.cc)((()=>this._controlPointsTransformTool.activeHandle),(t=>{this._advancedModeTransformTool.updateActiveHandle(t),this.activeHandle=t})),(0,r.cc)((()=>this._advancedModeTransformTool.activeHandle),(t=>{this._controlPointsTransformTool.updateActiveHandle(t),this.activeHandle=t}))]),this.addHandles([t.on("key-down",(t=>{t.key===Hc.undo&&this.canUndo()&&(this.undo(),t.stopPropagation()),t.key===Hc.redo&&this.canRedo()&&(this.redo(),t.stopPropagation())})),t.on("focus",(async t=>{this._advancedModeTransformTool.removeHighlightActiveHandle(),this._controlPointsTransformTool.highlightActiveHandle()}))]),t.tools.addMany([this._transformTool,this._controlPointsTransformTool]),t.activeTool=this._transformTool,this._activeTool=this._transformTool,t.focus()}destroy(){this._transformTool?.destroy(),this._controlPointsTransformTool?.destroy(),this._transformTool=null,this._controlPointsTransformTool=null,this._advancedModeTransformTool=null,this._activeTool=null,this._sharedUndoStack=null,this._sharedRedoStack=null}canUndo(){return this._sharedUndoStack.length>0}canRedo(){return this._sharedRedoStack.length>0}undo(){if(this._sharedUndoStack.length>0){const{tool:t,operation:e}=this._sharedUndoStack.pop();t!==this._activeTool&&t.refresh(),e.undo(),t.updateGraphics(),this._sharedRedoStack.push({tool:t,operation:e}),this._activeTool!==t&&this._activeTool?.refresh()}}redo(){if(this._sharedRedoStack.length>0){const{tool:t,operation:e}=this._sharedRedoStack.pop();t!==this._activeTool&&t.refresh(),e.apply(),t.updateGraphics(),this._sharedUndoStack.push({tool:t,operation:e}),this._activeTool!==t&&this._activeTool?.refresh()}}refresh(){this._activeTool.refresh()}reset(){this._activeTool.reset(),this._advancedModeTransformTool.reset()}async enableAdvancedMode(){this.view.activeTool=this._controlPointsTransformTool,this._activeTool=this._controlPointsTransformTool,this._activeTool.refresh(),await this.advancedMode.view.when(),this.advancedMode.view.activeTool=this._advancedModeTransformTool,this._originalOpacity=this._controlPointsTransformTool.mediaElement.opacity,this._controlPointsTransformTool.mediaElement.opacity=.25*this._originalOpacity}disableAdvancedMode(){this.view.activeTool=this._transformTool,this._activeTool=this._transformTool,this._activeTool.refresh(),this.advancedMode.view.activeTool=null,this._controlPointsTransformTool.mediaElement.opacity=this._originalOpacity}};(0,r.bt)([(0,r.bu)()],Fc.prototype,"activeHandle",void 0),(0,r.bt)([(0,r.bu)({constructOnly:!0})],Fc.prototype,"advancedMode",void 0),(0,r.bt)([(0,r.bu)()],Fc.prototype,"preserveAspectRatio",void 0),(0,r.bt)([(0,r.bu)()],Fc.prototype,"snapRotation",void 0),(0,r.bt)([(0,r.bu)({constructOnly:!0,nonNullable:!0})],Fc.prototype,"mediaElement",void 0),(0,r.bt)([(0,r.bu)({constructOnly:!0})],Fc.prototype,"view",void 0),Fc=(0,r.bt)([(0,r.bv)("esri.views.2d.interactive.editingTools.MediaTransformToolsWrapper")],Fc)},70632:function(t,e,n){n.d(e,{$:function(){return x},E:function(){return g},P:function(){return v},Z:function(){return _},a:function(){return c},b:function(){return m},i:function(){return a},j:function(){return M},l:function(){return l},m:function(){return d},p:function(){return p},u:function(){return s},w:function(){return b},x:function(){return f}});var i=n(44444);function r(t){return t?M:E}function o(t,e){return e?.mode?e.mode:r(t).mode}function s(t,e){return e??r(t)}function a(t,e){return o(null==t||(t.hasZ??!1),e)}function l(t){const e=u(t);return a(t.geometry,e)}function c(t){const e=u(t),n=a(t.geometry,e),i=null!=e&&"on-the-ground"!==n?w(e):0,r=e?.featureExpressionInfo;return{mode:n,offset:i,featureExpressionInfo:r}}function u(t){return t.layer&&"elevationInfo"in t.layer?t.layer.elevationInfo:null}function h(t,e){if(!t?.offset)return 0;const{offset:n,unit:r}=t;if("decimal-degrees"===r)return 0;const o="unknown"!==r&&r?r:"meters",s=(0,i.e1)(e);return s?(0,i.aU)(n,o,s):0}function p(t,e,n){if(!n?.mode)return;const i=t.hasZ?t.z:0,r=h(n,t.spatialReference);switch(n.mode){case"absolute-height":return i-r;case"on-the-ground":return 0;case"relative-to-ground":return i-((e.elevationProvider.getElevation(t.x,t.y,i,t.spatialReference,"ground")??0)+r);case"relative-to-scene":return i-((e.elevationProvider.getElevation(t.x,t.y,i,t.spatialReference,"scene")??0)+r)}}function d(t,e,n,i=null){return g(t,e.x,e.y,e.hasZ?e.z:0,e.spatialReference,n,i)}function f(t,e,n,i,r=null){return g(t,e[0],e[1],e.length>2?e[2]:0,n,i,r)}function g(t,e,n,i,r,o,s=null){if(null==o)return;const a=null!=s?s.mode:"absolute-height";if("on-the-ground"===a)return 0;const{absoluteZ:l}=m(e,n,i,r,t,o);return y(l,e,n,i,r,t,s,a)}function m(t,e,n,i,r,o){const s=h(o,i);switch(o.mode){case"absolute-height":return{absoluteZ:n+s,elevation:0};case"on-the-ground":{const n=r.elevationProvider.getElevation(t,e,0,i,"ground")??0;return{absoluteZ:n,elevation:n}}case"relative-to-ground":{const o=r.elevationProvider.getElevation(t,e,n,i,"ground")??0;return{absoluteZ:n+o+s,elevation:o}}case"relative-to-scene":{const o=r.elevationProvider.getElevation(t,e,n,i,"scene")??0;return{absoluteZ:n+o+s,elevation:o}}}}function y(t,e,n,i,r,o,s,a){const l=h(s,r);switch(a){case"absolute-height":return t-l;case"relative-to-ground":return t-((o.elevationProvider.getElevation(e,n,i,r,"ground")??0)+l);case"relative-to-scene":return t-((o.elevationProvider.getElevation(e,n,i,r,"scene")??0)+l)}}function _(t,e,n){return n&&n.mode!==e?`${t} only support ${e} elevation mode`:null}function v(t,e,n){return n?.mode===e?`${t} do not support ${e} elevation mode`:null}function b(t,e){return null!=e?.featureExpressionInfo&&"0"!==e.featureExpressionInfo.expression?`${t} do not support featureExpressionInfo`:null}function x(t,e){e&&t.warn(".elevationInfo=",e)}function w(t){return(t?.offset??0)*(0,i.e2)(t?.unit)}const M={mode:"absolute-height",offset:0},E={mode:"on-the-ground",offset:null}},63897:function(t,e,n){n.d(e,{N:function(){return m},R:function(){return h},b:function(){return d},j:function(){return f},q:function(){return g},v:function(){return u},y:function(){return c}});var i=n(44444);function r(t){if(!t)return null;const e=t.wkid;if(e)return i.aW[e];const n=t.wkt2??t.wkt;return n?o(n):null}function o(t){const e=i.aX.exec(t);if(!e||2!==e.length)return null;const n=e[1].split(",");if(!n||n.length<3)return null;const r=parseFloat(n[1]),o=parseFloat(n[2]);return isNaN(r)||isNaN(o)?null:{a:r,f:0===o?0:1/o}}function s(t){const e=r(t);if(a(e))return e;const n=e.a*(1-e.f);return Object.assign(e,{b:n,eSq:1-(n/e.a)**2,radius:(2*e.a+n)/3,densificationRatio:1e4/((2*e.a+n)/3)})}function a(t){return null!=t&&"b"in t&&"eSq"in t&&"radius"in t}function l(t,e,n){const{a:r,eSq:o}=s(n),a=Math.sqrt(o),l=Math.sin(e[1]*i.aV),c=r*e[0]*i.aV;let u;return u=o>0?r*((1-o)*(l/(1-o*(l*l))-1/(2*a)*Math.log((1-a*l)/(1+a*l))))*.5:r*l,t[0]=c,t[1]=u,t}function c(t){return(0,i.a4)(t)&&!!r(t)}function u(t,e="square-meters"){if(t.some((t=>!c(t.spatialReference))))throw new i.s("geodesic-areas:invalid-spatial-reference","the input geometries spatial reference is not supported");const n=[];for(let i=0;i<t.length;i++){const e=t[i],r=e.spatialReference,{radius:o,densificationRatio:a}=s(r),l=o*a;n.push(p(e,l))}const r=[],o=[0,0],a=[0,0];for(let s=0;s<n.length;s++){const{rings:t,spatialReference:c}=n[s];let u=0;for(let e=0;e<t.length;e++){const n=t[e];l(o,n[0],c),l(a,n[n.length-1],c);let i=a[0]*o[1]-o[0]*a[1];for(let t=0;t<n.length-1;t++)l(o,n[t+1],c),l(a,n[t],c),i+=a[0]*o[1]-o[0]*a[1];u+=i}u=(0,i.aU)(u,"square-meters",e),r.push(u/-2)}return r}function h(t,e="meters"){if(!t)throw new i.s("geodesic-lengths:invalid-geometries","the input geometries type is not supported");if(t.some((t=>!c(t.spatialReference))))throw new i.s("geodesic-lengths:invalid-spatial-reference","the input geometries spatial reference is not supported");const n=[];for(let r=0;r<t.length;r++){const o=t[r],{spatialReference:s}=o,a="polyline"===o.type?o.paths:o.rings;let l=0;for(let t=0;t<a.length;t++){const e=a[t];let n=0;for(let t=1;t<e.length;t++){const i=e[t-1][0],r=e[t][0],o=e[t-1][1],a=e[t][1];if(o!==a||i!==r){const t=new d;g(t,[i,o],[r,a],s),n+=t.distance}}l+=n}l=(0,i.aU)(l,"meters",e),n.push(l)}return n}function p(t,e){if("polyline"!==t.type&&"polygon"!==t.type)throw new i.s("geodesic-densify:invalid-geometry","the input geometry is neither polyline nor polygon");const{spatialReference:n}=t;if(!c(n))throw new i.s("geodesic-densify:invalid-spatial-reference","the input geometry spatial reference is not supported");const r="polyline"===t.type?t.paths:t.rings,o=[],s=[0,0],a=new d;for(const i of r){const t=[];o.push(t),t.push([i[0][0],i[0][1]]);let r,l,c=i[0][0],u=i[0][1];for(let o=0;o<i.length-1;o++){if(r=i[o+1][0],l=i[o+1][1],c===r&&u===l)continue;const h=[c,u];g(a,[c,u],[r,l],n);const{azimuth:p,distance:d}=a,m=d/e;if(m>1){for(let i=1;i<=m-1;i++)f(s,h,p,i*e,n),t.push(s.slice());f(s,h,p,(d+Math.floor(m-1)*e)/2,n),t.push(s.slice())}f(s,h,p,d,n),t.push(s.slice()),c=s[0],u=s[1]}}const l=(0,i.aZ)(i.aY,n);return"polyline"===t.type?new i.a_({paths:o,spatialReference:l}):new i.a$({rings:o,spatialReference:l})}class d{constructor(t=0,e=void 0,n=void 0){this.distance=t,this.azimuth=e,this.reverseAzimuth=n}}function f(t,e,n,r,o){const a=e[0],l=e[1],c=a*i.aV,u=l*i.aV,h=(n??0)*i.aV,{a:p,b:d,f:f}=s(o),g=Math.sin(h),m=Math.cos(h),y=(1-f)*Math.tan(u),_=1/Math.sqrt(1+y*y),v=y*_,b=Math.atan2(y,m),x=_*g,w=x*x,M=1-w,E=M*(p*p-d*d)/(d*d),T=1+E/16384*(4096+E*(E*(320-175*E)-768)),S=E/1024*(256+E*(E*(74-47*E)-128));let P,C,k,R,V=r/(d*T),A=2*Math.PI;for(;Math.abs(V-A)>1e-12;)k=Math.cos(2*b+V),P=Math.sin(V),C=Math.cos(V),R=S*P*(k+S/4*(C*(2*k*k-1)-S/6*k*(4*P*P-3)*(4*k*k-3))),A=V,V=r/(d*T)+R;const I=v*P-_*C*m,O=Math.atan2(v*C+_*P*m,(1-f)*Math.sqrt(w+I*I)),D=Math.atan2(P*g,_*C-v*P*m),G=f/16*M*(4+f*(4-3*M)),L=O/i.aV,z=(c+(D-(1-G)*f*x*(V+G*P*(k+G*C*(2*k*k-1)))))/i.aV;return t[0]=z,t[1]=L,t}function g(t,e,n,r){const o=e[0]*i.aV,a=e[1]*i.aV,l=n[0]*i.aV,c=n[1]*i.aV,{a:u,b:h,f:p,radius:d}=s(r),f=l-o,g=Math.atan((1-p)*Math.tan(a)),m=Math.atan((1-p)*Math.tan(c)),y=Math.sin(g),_=Math.cos(g),v=Math.sin(m),b=Math.cos(m);let x,w,M,E,T,S,P,C,k,R,V=1e3,A=f;do{if(P=Math.sin(A),C=Math.cos(A),M=Math.sqrt(b*P*(b*P)+(_*v-y*b*C)*(_*v-y*b*C)),0===M)return t.distance=0,t.azimuth=void 0,t.reverseAzimuth=void 0,t;T=y*v+_*b*C,S=Math.atan2(M,T),k=_*b*P/M,w=1-k*k,E=T-2*y*v/w,isNaN(E)&&(E=0),R=p/16*w*(4+p*(4-3*w)),x=A,A=f+(1-R)*p*k*(S+R*M*(E+R*T*(2*E*E-1)))}while(Math.abs(A-x)>1e-12&&--V>0);if(0===V){const e=d,n=Math.acos(Math.sin(a)*Math.sin(c)+Math.cos(a)*Math.cos(c)*Math.cos(l-o))*e,r=l-o,s=Math.sin(r)*Math.cos(c),u=Math.cos(a)*Math.sin(c)-Math.sin(a)*Math.cos(c)*Math.cos(r),h=Math.atan2(s,u);return t.azimuth=h/i.aV,t.distance=n,t.reverseAzimuth=void 0,t}const I=w*(u*u-h*h)/(h*h),O=I/1024*(256+I*(I*(74-47*I)-128)),D=h*(1+I/16384*(4096+I*(I*(320-175*I)-768)))*(S-O*M*(E+O/4*(T*(2*E*E-1)-O/6*E*(4*M*M-3)*(4*E*E-3)))),G=Math.atan2(b*Math.sin(A),_*v-y*b*Math.cos(A)),L=Math.atan2(_*Math.sin(A),_*v*Math.cos(A)-y*b);return t.azimuth=G/i.aV,t.distance=D,t.reverseAzimuth=L/i.aV,t}function m(t){return c(t)?t:(0,i.a7)(t)?i.aY.WGS84:null}},2518:function(t,e,n){n.r(e),n.d(e,{buffer:function(){return C},changeDefaultSpatialReferenceTolerance:function(){return q},clearDefaultSpatialReferenceTolerance:function(){return Y},clip:function(){return l},contains:function(){return u},convexHull:function(){return w},crosses:function(){return h},cut:function(){return c},densify:function(){return z},difference:function(){return M},disjoint:function(){return y},distance:function(){return p},equals:function(){return d},extendedSpatialReferenceInfo:function(){return a},flipHorizontal:function(){return D},flipVertical:function(){return G},generalize:function(){return L},geodesicArea:function(){return F},geodesicBuffer:function(){return k},geodesicDensify:function(){return N},geodesicLength:function(){return Z},intersect:function(){return T},intersectLinesToPoints:function(){return B},intersects:function(){return f},isSimple:function(){return b},nearestCoordinate:function(){return R},nearestVertex:function(){return V},nearestVertices:function(){return A},offset:function(){return P},overlaps:function(){return _},planarArea:function(){return U},planarLength:function(){return H},relate:function(){return v},rotate:function(){return O},simplify:function(){return x},symmetricDifference:function(){return E},touches:function(){return g},union:function(){return S},within:function(){return m}});var i=n(44444),r=n(36239),o=n(7536);function s(t){const e=Array.isArray(t)?t[0].spatialReference:t.spatialReference;return e?(0,i.aZ)(i.aY,e):i.aY.WGS84}function a(t){return r.G.extendedSpatialReferenceInfo(t)}function l(t,e){return r.G.clip(o.hydratedAdapter,s(t),t,e)}function c(t,e){return r.G.cut(o.hydratedAdapter,s(t),t,e)}function u(t,e){return r.G.contains(o.hydratedAdapter,s(t),t,e)}function h(t,e){return r.G.crosses(o.hydratedAdapter,s(t),t,e)}function p(t,e,n){return r.G.distance(o.hydratedAdapter,s(t),t,e,n)}function d(t,e){return r.G.equals(o.hydratedAdapter,s(t),t,e)}function f(t,e){return r.G.intersects(o.hydratedAdapter,s(t),t,e)}function g(t,e){return r.G.touches(o.hydratedAdapter,s(t),t,e)}function m(t,e){return r.G.within(o.hydratedAdapter,s(t),t,e)}function y(t,e){return r.G.disjoint(o.hydratedAdapter,s(t),t,e)}function _(t,e){return r.G.overlaps(o.hydratedAdapter,s(t),t,e)}function v(t,e,n){return r.G.relate(o.hydratedAdapter,s(t),t,e,n)}function b(t){return r.G.isSimple(o.hydratedAdapter,s(t),t)}function x(t){return r.G.simplify(o.hydratedAdapter,s(t),t)}function w(t,e=!1){return r.G.convexHull(o.hydratedAdapter,s(t),t,e)}function M(t,e){return r.G.difference(o.hydratedAdapter,s(t),t,e)}function E(t,e){return r.G.symmetricDifference(o.hydratedAdapter,s(t),t,e)}function T(t,e){return r.G.intersect(o.hydratedAdapter,s(t),t,e)}function S(t,e=null){return r.G.union(o.hydratedAdapter,s(t),t,e)}function P(t,e,n,i,a,l){return r.G.offset(o.hydratedAdapter,s(t),t,e,n,i,a,l)}function C(t,e,n,i=!1){return r.G.buffer(o.hydratedAdapter,s(t),t,e,n,i)}function k(t,e,n,i,a,l){return r.G.geodesicBuffer(o.hydratedAdapter,s(t),t,e,n,i,a,l)}function R(t,e,n=!0){return r.G.nearestCoordinate(o.hydratedAdapter,s(t),t,e,n)}function V(t,e){return r.G.nearestVertex(o.hydratedAdapter,s(t),t,e)}function A(t,e,n,i){return r.G.nearestVertices(o.hydratedAdapter,s(t),t,e,n,i)}function I(t){return"xmin"in t?"center"in t?t.center:null:"x"in t?t:"extent"in t?t.extent?.center??null:null}function O(t,e,n){if(null==t)throw new X;const i=t.spatialReference;if(null==(n=n??I(t)))throw new X;const o=t.constructor.fromJSON(r.G.rotate(t,e,n));return o.spatialReference=i,o}function D(t,e){if(null==t)throw new X;const n=t.spatialReference;if(null==(e=e??I(t)))throw new X;const i=t.constructor.fromJSON(r.G.flipHorizontal(t,e));return i.spatialReference=n,i}function G(t,e){if(null==t)throw new X;const n=t.spatialReference;if(null==(e=e??I(t)))throw new X;const i=t.constructor.fromJSON(r.G.flipVertical(t,e));return i.spatialReference=n,i}function L(t,e,n,i){return r.G.generalize(o.hydratedAdapter,s(t),t,e,n,i)}function z(t,e,n){return r.G.densify(o.hydratedAdapter,s(t),t,e,n)}function N(t,e,n,i=0){return r.G.geodesicDensify(o.hydratedAdapter,s(t),t,e,n,i)}function U(t,e){return r.G.planarArea(o.hydratedAdapter,s(t),t,e)}function H(t,e){return r.G.planarLength(o.hydratedAdapter,s(t),t,e)}function F(t,e,n){return r.G.geodesicArea(o.hydratedAdapter,s(t),t,e,n)}function Z(t,e,n){return r.G.geodesicLength(o.hydratedAdapter,s(t),t,e,n)}function B(t,e){return r.G.intersectLinesToPoints(o.hydratedAdapter,s(t),t,e)}function q(t,e){r.G.changeDefaultSpatialReferenceTolerance(t,e)}function Y(t){r.G.clearDefaultSpatialReferenceTolerance(t)}class X extends Error{constructor(){super("Illegal Argument Exception")}}},7536:function(t,e,n){n.r(e),n.d(e,{hydratedAdapter:function(){return r}});var i=n(44444);const r={convertToGEGeometry:o,exportPoint:s,exportPolygon:a,exportPolyline:l,exportMultipoint:c,exportExtent:u};function o(t,e){if(null==e)return null;let n="cache"in e?e.cache._geVersion:void 0;return null==n&&(n=t.convertJSONToGeometry(e),"cache"in e&&(e.cache._geVersion=n)),n}function s(t,e,n){const r=t.hasZ(e),o=t.hasM(e),s=new i.D({x:t.getPointX(e),y:t.getPointY(e),spatialReference:n});return r&&(s.z=t.getPointZ(e)),o&&(s.m=t.getPointM(e)),s.cache._geVersion=e,s}function a(t,e,n){const r=new i.a$({rings:t.exportPaths(e),hasZ:t.hasZ(e),hasM:t.hasM(e),spatialReference:n});return r.cache._geVersion=e,r}function l(t,e,n){const r=new i.a_({paths:t.exportPaths(e),hasZ:t.hasZ(e),hasM:t.hasM(e),spatialReference:n});return r.cache._geVersion=e,r}function c(t,e,n){const r=new i.bU({hasZ:t.hasZ(e),hasM:t.hasM(e),points:t.exportPoints(e),spatialReference:n});return r.cache._geVersion=e,r}function u(t,e,n){const r=t.hasZ(e),o=t.hasM(e),s=new i.bn({xmin:t.getXMin(e),ymin:t.getYMin(e),xmax:t.getXMax(e),ymax:t.getYMax(e),spatialReference:n});if(r){const n=t.getZExtent(e);s.zmin=n.vmin,s.zmax=n.vmax}if(o){const n=t.getMExtent(e);s.mmin=n.vmin,s.mmax=n.vmax}return s.cache._geVersion=e,s}},87792:function(t,e,n){n.d(e,{A:function(){return u},M:function(){return l},b:function(){return a},j:function(){return c},v:function(){return s}});var i=n(44444),r=n(38837),o=n(81203);function s(t){return t?{origin:(0,i.dA)(t.origin),vector:(0,i.dA)(t.vector)}:{origin:(0,i.ap)(),vector:(0,i.ap)()}}function a(t,e,n=s()){return(0,i.dF)(n.origin,t),(0,i.dB)(n.vector,e,t),n}function l(t,e){const n=(0,i.dB)(o.c.get(),e,t.origin),r=(0,i.al)(t.vector,n),s=(0,i.al)(t.vector,t.vector),a=(0,i.b0)(r/s,0,1),l=(0,i.dB)(o.c.get(),(0,i.dC)(o.c.get(),t.vector,a),n);return(0,i.al)(l,l)}function c(t,e,n){return u(t,e,0,1,n)}function u(t,e,n,r,s){const{vector:a,origin:l}=t,c=(0,i.dB)(o.c.get(),e,l),u=(0,i.al)(a,c)/(0,i.dD)(a);return(0,i.dC)(s,a,(0,i.b0)(u,n,r)),(0,i.dE)(s,s,t.origin)}new r.s((()=>s()))},77703:function(t,e,n){function i(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function r(t){return[t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15]]}function o(t,e,n,i,r,o,s,a,l,c,u,h,p,d,f,g){return[t,e,n,i,r,o,s,a,l,c,u,h,p,d,f,g]}function s(t,e){return new Float64Array(t,e,16)}n.d(e,{e:function(){return i},o:function(){return a},r:function(){return r}});const a=i();Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:a,clone:r,create:i,createView:s,fromValues:o},Symbol.toStringTag,{value:"Module"}))},9794:function(t,e,n){n.d(e,{a:function(){return s},g:function(){return a},m:function(){return p},s:function(){return c},u:function(){return l}});var i=n(44444),r=n(65332);function o(){return i.G.getLogger("esri.geometry.Mesh")}function s(t){return null!=t.origin}function a(t){return s(t.vertexSpace)}function l(t,e){if(!s(t))return null;const[n,r,o]=t.origin;return new i.D({x:n,y:r,z:o,spatialReference:e})}function c(t,e){const{x:n,y:s,z:a,spatialReference:l}=t,c=[n,s,a??0];return void 0!==e?.geographic&&((0,i.E)(o(),"option: geographic",{replacement:"Use the `vertexSpace` option instead.",version:"4.29",warnOnce:!0}),e.vertexSpace&&o().warn("Deprecated geographic flag ignored since vertexSpace option is provided.")),"local"===(e?.vertexSpace??h(e?.geographic)??u(l))?new r.a({origin:c}):new r.b({origin:c})}function u(t){return t.isGeographic||t.isWebMercator?"local":"georeferenced"}function h(t){return null==t?void 0:t?"local":"georeferenced"}function p(t,e){return t.type===e.type&&(t.origin===e.origin||null!=t.origin&&null!=e.origin&&(0,i.H)(t.origin,e.origin))}},81203:function(t,e,n){n.d(e,{D:function(){return w},H:function(){return F},J:function(){return Z},M:function(){return x},O:function(){return E},P:function(){return G},Q:function(){return q},U:function(){return T},V:function(){return Y},a:function(){return m},b:function(){return l},c:function(){return f},d:function(){return b},f:function(){return a},g:function(){return v},h:function(){return M},k:function(){return L},l:function(){return S},m:function(){return _},o:function(){return y},p:function(){return P},q:function(){return N},r:function(){return g},t:function(){return d},u:function(){return c},v:function(){return C},w:function(){return U},x:function(){return z},y:function(){return D},z:function(){return H}});var i=n(44444),r=n(10769),o=n(77703),s=n(83875);function a(t,e){return(0,i.al)(t,e)/(0,i.dS)(t)}function l(t,e){const n=(0,i.al)(t,e)/((0,i.dS)(t)*(0,i.dS)(e));return-(0,i.dU)(n)}function c(t,e,n){(0,i.ao)(u,t),(0,i.ao)(h,e);const r=(0,i.al)(u,h),o=(0,i.dU)(r),s=(0,i.am)(u,u,h);return(0,i.al)(s,n)<0?2*Math.PI-o:o}const u=(0,i.ap)(),h=(0,i.ap)();let p=class t{constructor(t){this._create=t,this._items=new Array,this._itemsPtr=0}get(){return 0===this._itemsPtr&&(0,i.kB)((()=>this._reset())),this._itemsPtr>=this._items.length&&this._items.push(this._create()),this._items[this._itemsPtr++]}_reset(){const t=2*this._itemsPtr;this._items.length>t&&(this._items.length=t),this._itemsPtr=0}static createVec2f64(){return new t(i.g_)}static createVec3f64(){return new t(i.ap)}static createVec4f64(){return new t(i.iB)}static createMat3f64(){return new t(r.e)}static createMat4f64(){return new t(o.e)}static createQuatf64(){return new t(s.e)}get test(){}};const d=p.createVec2f64(),f=p.createVec3f64(),g=p.createVec4f64();p.createMat3f64();const m=p.createMat4f64(),y=p.createQuatf64();function _(t){const e=t[0]*t[0]+t[4]*t[4]+t[8]*t[8],n=t[1]*t[1]+t[5]*t[5]+t[9]*t[9],i=t[2]*t[2]+t[6]*t[6]+t[10]*t[10];return Math.sqrt(Math.max(e,n,i))}function v(t,e){const n=Math.sqrt(e[0]*e[0]+e[4]*e[4]+e[8]*e[8]),r=Math.sqrt(e[1]*e[1]+e[5]*e[5]+e[9]*e[9]),o=Math.sqrt(e[2]*e[2]+e[6]*e[6]+e[10]*e[10]);return(0,i.dQ)(t,n,r,o),t}function b(t,e,n){Math.abs(t[0])>Math.abs(t[1])?(0,i.dQ)(e,0,1,0):(0,i.dQ)(e,1,0,0),(0,i.am)(n,t,e),(0,i.am)(e,n,t),(0,i.ao)(n,n),(0,i.ao)(e,e)}function x(t=$){return[t[0],t[1],t[2],t[3]]}function w(t=$[0],e=$[1],n=$[2],i=$[3]){return T(t,e,n,i,g.get())}function M(t,e){return T(e[0],e[1],e[2],e[3],t)}function E(t){return t}function T(t,e,n,i,r=x()){return r[0]=t,r[1]=e,r[2]=n,r[3]=i,r}function S(t,e,n){const i=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],r=Math.abs(i-1)>1e-5&&i>1e-12?1/Math.sqrt(i):1;return n[0]=e[0]*r,n[1]=e[1]*r,n[2]=e[2]*r,n[3]=-(n[0]*t[0]+n[1]*t[1]+n[2]*t[2]),n}function P(t,e,n,i=x()){const r=n[0]-e[0],o=n[1]-e[1],s=n[2]-e[2],a=t[0]-e[0],l=t[1]-e[1],c=t[2]-e[2],u=o*c-s*l,h=s*a-r*c,p=r*l-o*a,d=u*u+h*h+p*p,f=Math.abs(d-1)>1e-5&&d>1e-12?1/Math.sqrt(d):1;return i[0]=u*f,i[1]=h*f,i[2]=p*f,i[3]=-(i[0]*t[0]+i[1]*t[1]+i[2]*t[2]),i}function C(t,e,n,r=0,o=Math.floor(n*(1/3)),s=Math.floor(n*(2/3))){if(n<3)return!1;e(R,r);let a=o,l=!1;for(;a<n-1&&!l;)e(V,a),a++,l=!(0,i.H)(R,V);if(!l)return!1;for(a=Math.max(a,s),l=!1;a<n&&!l;)e(A,a),a++,(0,i.dB)(I,R,V),(0,i.ao)(I,I),(0,i.dB)(O,V,A),(0,i.ao)(O,O),l=!(0,i.H)(R,A)&&!(0,i.H)(V,A)&&Math.abs((0,i.al)(I,O))<k;return l?(P(R,V,A,t),!0):(0!==r||1!==o||2!==s)&&C(t,e,n,0,1,2)}const k=.99619469809,R=(0,i.ap)(),V=(0,i.ap)(),A=(0,i.ap)(),I=(0,i.ap)(),O=(0,i.ap)();function D(t,e,n){return e!==t&&M(t,e),t[3]=-(0,i.al)(t,n),t}function G(t,e,n,r){return(0,i.am)(A,e,t),S(n,A,r)}function L(t,e,n,r){return j(W(t,e,(0,i.dB)(f.get(),n,e),K,r))}function z(t,e,n){return null!=e&&j(W(t,e.origin,e.direction,J,n))}function N(t,e,n){return j(W(t,e.origin,e.vector,Q.NONE,n))}function U(t,e,n){return j(W(t,e.origin,e.vector,Q.CLAMP,n))}function H(t,e){return Y(t,e)>=0}function F(t,e,n){const r=(0,i.dC)(f.get(),t,-t[3]),o=B(t,(0,i.dB)(f.get(),e,r),f.get());return(0,i.dE)(n,o,r),n}function Z(t,e,n,r){const o=t,s=f.get(),l=f.get();b(o,s,l);const c=(0,i.dB)(f.get(),n,e),u=a(s,c),h=a(l,c),p=a(o,c);return(0,i.dQ)(r,u,h,p)}function B(t,e,n){const r=(0,i.dC)(f.get(),t,(0,i.al)(t,e));return(0,i.dB)(n,e,r),n}function q(t,e){return Math.abs(Y(t,e))}function Y(t,e){return(0,i.al)(t,e)+t[3]}var X;function j(t){return t===X.INTERSECTS_INSIDE_OUT||t===X.INTERSECTS_OUTSIDE_IN}function W(t,e,n,r,o){const s=(0,i.al)(t,n),a=Y(t,e);if(0===s)return a>=0?X.INSIDE:X.OUTSIDE;let l=-a/s;return r&Q.CLAMP&&(l=(0,i.b0)(l,0,1)),!(r&Q.INFINITE_MIN)&&l<0||!(r&Q.INFINITE_MAX)&&l>1?a>=0?X.INSIDE:X.OUTSIDE:((0,i.dE)(o,e,(0,i.dC)(o,n,l)),a>=0?X.INTERSECTS_INSIDE_OUT:X.INTERSECTS_OUTSIDE_IN)}(function(t){t[t.INTERSECTS_INSIDE_OUT=0]="INTERSECTS_INSIDE_OUT",t[t.INTERSECTS_OUTSIDE_IN=1]="INTERSECTS_OUTSIDE_IN",t[t.INSIDE=2]="INSIDE",t[t.OUTSIDE=3]="OUTSIDE"})(X||(X={}));const $=[0,0,1,0];var Q;(function(t){t[t.NONE=0]="NONE",t[t.CLAMP=1]="CLAMP",t[t.INFINITE_MIN=4]="INFINITE_MIN",t[t.INFINITE_MAX=8]="INFINITE_MAX"})(Q||(Q={}));const K=Q.INFINITE_MIN|Q.INFINITE_MAX,J=Q.INFINITE_MAX},32443:function(t,e,n){n.d(e,{c:function(){return r}});var i=n(44444);function r(t,e,n,r){if((0,i.bD)(t.spatialReference,n)){o[0]=t.x,o[1]=t.y;const s=t.z;return o[2]=s??r??0,(0,i.bE)(o,t.spatialReference,0,e,n,0)}const s=(0,i.bF)(t,n);return!!s&&(e[0]=s?.x,e[1]=s?.y,e[2]=s?.z??r??0,!0)}const o=(0,i.ap)()},3930:function(t,e,n){n.d(e,{a:function(){return a},e:function(){return o},n:function(){return s}});var i=n(44444),r=n(32443);function o(t,e,n,i){return{x:t,y:e,z:n,hasZ:null!=n,hasM:!1,spatialReference:i,type:"point"}}function s(t,e,n,i,r){t.x=e,t.y=n,t.z=i,t.hasZ=null!=i,t.spatialReference=r}function a(t,e,n,i,o){return!(null==e||null==i||t.length<2)&&(l.x=t[0],l.y=t[1],l.z=t[2],l.spatialReference=e,(0,r.c)(l,n,i,o))}const l=o(0,0,0,i.aY.WGS84)},63655:function(t,e,n){n.d(e,{L:function(){return m},N:function(){return I},O:function(){return y},R:function(){return D},T:function(){return v},X:function(){return w},b:function(){return a},v:function(){return l},x:function(){return c}});var i=n(10769),r=n(83875),o=n(44444);function s(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function a(t,e,n){n*=.5;const i=Math.sin(n);return t[0]=i*e[0],t[1]=i*e[1],t[2]=i*e[2],t[3]=Math.cos(n),t}function l(t,e){const n=2*Math.acos(e[3]),i=Math.sin(n/2);return i>(0,o.a9)()?(t[0]=e[0]/i,t[1]=e[1]/i,t[2]=e[2]/i):(t[0]=1,t[1]=0,t[2]=0),n}function c(t,e,n){const i=e[0],r=e[1],o=e[2],s=e[3],a=n[0],l=n[1],c=n[2],u=n[3];return t[0]=i*u+s*a+r*c-o*l,t[1]=r*u+s*l+o*a-i*c,t[2]=o*u+s*c+i*l-r*a,t[3]=s*u-i*a-r*l-o*c,t}function u(t,e,n){n*=.5;const i=e[0],r=e[1],o=e[2],s=e[3],a=Math.sin(n),l=Math.cos(n);return t[0]=i*l+s*a,t[1]=r*l+o*a,t[2]=o*l-r*a,t[3]=s*l-i*a,t}function h(t,e,n){n*=.5;const i=e[0],r=e[1],o=e[2],s=e[3],a=Math.sin(n),l=Math.cos(n);return t[0]=i*l-o*a,t[1]=r*l+s*a,t[2]=o*l+i*a,t[3]=s*l-r*a,t}function p(t,e,n){n*=.5;const i=e[0],r=e[1],o=e[2],s=e[3],a=Math.sin(n),l=Math.cos(n);return t[0]=i*l+r*a,t[1]=r*l-i*a,t[2]=o*l+s*a,t[3]=s*l-o*a,t}function d(t,e){const n=e[0],i=e[1],r=e[2];return t[0]=n,t[1]=i,t[2]=r,t[3]=Math.sqrt(Math.abs(1-n*n-i*i-r*r)),t}function f(t,e,n,i){const r=e[0],s=e[1],a=e[2],l=e[3];let c,u,h,p,d,f=n[0],g=n[1],m=n[2],y=n[3];return u=r*f+s*g+a*m+l*y,u<0&&(u=-u,f=-f,g=-g,m=-m,y=-y),1-u>(0,o.a9)()?(c=Math.acos(u),h=Math.sin(c),p=Math.sin((1-i)*c)/h,d=Math.sin(i*c)/h):(p=1-i,d=i),t[0]=p*r+d*f,t[1]=p*s+d*g,t[2]=p*a+d*m,t[3]=p*l+d*y,t}function g(t){const e=o.ar,n=e(),i=e(),r=e(),s=Math.sqrt(1-n),a=Math.sqrt(n);return t[0]=s*Math.sin(2*Math.PI*i),t[1]=s*Math.cos(2*Math.PI*i),t[2]=a*Math.sin(2*Math.PI*r),t[3]=a*Math.cos(2*Math.PI*r),t}function m(t,e){const n=e[0],i=e[1],r=e[2],o=e[3],s=n*n+i*i+r*r+o*o,a=s?1/s:0;return t[0]=-n*a,t[1]=-i*a,t[2]=-r*a,t[3]=o*a,t}function y(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t}function _(t,e){const n=e[0]+e[4]+e[8];let i;if(n>0)i=Math.sqrt(n+1),t[3]=.5*i,i=.5/i,t[0]=(e[5]-e[7])*i,t[1]=(e[6]-e[2])*i,t[2]=(e[1]-e[3])*i;else{let n=0;e[4]>e[0]&&(n=1),e[8]>e[3*n+n]&&(n=2);const r=(n+1)%3,o=(n+2)%3;i=Math.sqrt(e[3*n+n]-e[3*r+r]-e[3*o+o]+1),t[n]=.5*i,i=.5/i,t[3]=(e[3*r+o]-e[3*o+r])*i,t[r]=(e[3*r+n]+e[3*n+r])*i,t[o]=(e[3*o+n]+e[3*n+o])*i}return t}function v(t,e,n,i){const r=.5*Math.PI/180;e*=r,n*=r,i*=r;const o=Math.sin(e),s=Math.cos(e),a=Math.sin(n),l=Math.cos(n),c=Math.sin(i),u=Math.cos(i);return t[0]=o*l*u-s*a*c,t[1]=s*a*u+o*l*c,t[2]=s*l*c-o*a*u,t[3]=s*l*u+o*a*c,t}function b(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}const x=o.aa,w=o.ab,M=o.ac,E=c,T=o.ad,S=o.ae,P=o.af,C=o.ag,k=C,R=o.ah,V=R,A=o.ai,I=o.aj,O=o.ak;function D(t,e,n){const i=(0,o.al)(e,n);return i<-.999999?((0,o.am)(G,L,e),(0,o.an)(G)<1e-6&&(0,o.am)(G,z,e),(0,o.ao)(G,G),a(t,G,Math.PI),t):i>.999999?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):((0,o.am)(G,e,n),t[0]=G[0],t[1]=G[1],t[2]=G[2],t[3]=1+i,A(t,t))}const G=(0,o.ap)(),L=(0,o.aq)(1,0,0),z=(0,o.aq)(0,1,0);function N(t,e,n,i,r,o){return f(U,e,r,o),f(H,n,i,o),f(t,U,H,2*o*(1-o)),t}const U=(0,r.e)(),H=(0,r.e)();function F(t,e,n,i){const r=Z;return r[0]=n[0],r[3]=n[1],r[6]=n[2],r[1]=i[0],r[4]=i[1],r[7]=i[2],r[2]=-e[0],r[5]=-e[1],r[8]=-e[2],A(t,_(t,r))}const Z=(0,i.e)();Object.freeze(Object.defineProperty({__proto__:null,add:M,calculateW:d,conjugate:y,copy:x,dot:S,equals:O,exactEquals:I,fromEuler:v,fromMat3:_,getAxisAngle:l,identity:s,invert:m,len:k,length:C,lerp:P,mul:E,multiply:c,normalize:A,random:g,rotateX:u,rotateY:h,rotateZ:p,rotationTo:D,scale:T,set:w,setAxes:F,setAxisAngle:a,slerp:f,sqlerp:N,sqrLen:V,squaredLength:R,str:b},Symbol.toStringTag,{value:"Module"}))},83875:function(t,e,n){function i(){return[0,0,0,1]}function r(t){return[t[0],t[1],t[2],t[3]]}function o(t,e,n,i){return[t,e,n,i]}n.d(e,{e:function(){return i},r:function(){return s},t:function(){return r}});const s=i();Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:s,clone:r,create:i,fromValues:o},Symbol.toStringTag,{value:"Module"}))},7137:function(t,e,n){n.d(e,{a:function(){return l},w:function(){return a}});var i=n(44444);const r=new i.aY(i.bG),o=new i.aY(i.bH),s=new i.aY(i.bI),a=new i.aY(i.bJ);function l(t){const e=c.get(t);if(e)return e;let n=r;if(t)if(t===o)n=o;else if(t===s)n=s;else{const e=t.wkid,r=t.latestWkid;if(null!=e||null!=r)(0,i.bK)(e)||(0,i.bK)(r)?n=o:((0,i.bL)(e)||(0,i.bL)(r))&&(n=s);else{const e=t.wkt2??t.wkt;if(e){const t=e.toUpperCase();t===u?n=o:t===h&&(n=s)}}}return c.set(t,n),n}const c=new Map,u=o.wkt.toUpperCase(),h=s.wkt.toUpperCase()},38837:function(t,e,n){n.d(e,{$:function(){return F},E:function(){return _},H:function(){return L},I:function(){return I},N:function(){return S},O:function(){return w},T:function(){return M},U:function(){return P},V:function(){return C},_:function(){return v},a:function(){return x},b:function(){return a},f:function(){return J},i:function(){return W},k:function(){return c},s:function(){return o},v:function(){return u},w:function(){return d}});var i=n(44444),r=(n(10769),n(81203));class o{constructor(t){this._allocator=t,this._items=[],this._itemsPtr=0,this._grow()}get(){return 0===this._itemsPtr&&(0,i.kB)((()=>this._reset())),this._itemsPtr===this._items.length&&this._grow(),this._items[this._itemsPtr++]}_reset(){const t=Math.min(3*Math.max(8,this._itemsPtr),this._itemsPtr+3*s);this._items.length=Math.min(t,this._items.length),this._itemsPtr=0}_grow(){for(let t=0;t<Math.max(8,Math.min(this._items.length,s));t++)this._items.push(this._allocator())}}const s=1024;function a(t){return t?l((0,i.dA)(t.origin),(0,i.dA)(t.direction)):l((0,i.ap)(),(0,i.ap)())}function l(t,e){return{origin:t,direction:e}}function c(t,e){const n=g.get();return n.origin=t,n.direction=e,n}function u(t,e=a()){return p(t.origin,t.direction,e)}function h(t,e,n=a()){return(0,i.dF)(n.origin,t),(0,i.dB)(n.direction,e,t),n}function p(t,e,n=a()){return(0,i.dF)(n.origin,t),(0,i.dF)(n.direction,e),n}function d(t,e){const n=(0,i.am)(r.c.get(),(0,i.ao)(r.c.get(),t.direction),(0,i.dB)(r.c.get(),e,t.origin));return(0,i.al)(n,n)}function f(t,e,n){const r=(0,i.al)(t.direction,(0,i.dB)(n,e,t.origin));return(0,i.dE)(n,t.origin,(0,i.dC)(n,t.direction,r)),n}const g=new o((()=>a()));function m(t,e){const n=(0,i.dS)(t),r=(0,i.kC)(t[2]/n),o=Math.atan2(t[1]/n,t[0]/n);return(0,i.dQ)(e,n,r,o),e}const y=_();function _(){return(0,i.iB)()}const v=i.ak,b=i.ak;function x(t,e){return(0,i.aa)(e,t)}function w(t,e){return(0,i.iV)(t[0],t[1],t[2],e)}function M(t){return t}function E(t){t[0]=t[1]=t[2]=t[3]=0}function T(t,e){return t[0]=t[1]=t[2]=0,t[3]=e,t}function S(t){return t[3]}function P(t){return t}function C(t,e,n,r){return(0,i.iV)(t,e,n,r)}function k(t,e,n){return t!==n&&(n[0]=t[0],n[1]=t[1],n[2]=t[2]),n[3]=t[3]+e,n}function R(t,e,n){return t!==n&&x(t,n),n}function V(t,e){return e}function A(t,e,n){if(null==e||!D(t,e,O))return!1;let{t0:i,t1:r}=O;if((i<0||r<i&&r>0)&&(i=r),i<0)return!1;if(n){const{origin:t,direction:r}=e;n[0]=t[0]+r[0]*i,n[1]=t[1]+r[1]*i,n[2]=t[2]+r[2]*i}return!0}function I(t,e,n){const r=h(e,n);if(!D(t,r,O))return[];const{origin:o,direction:s}=r,{t0:a,t1:l}=O,c=e=>{const n=(0,i.ap)();return(0,i.h9)(n,o,s,e),F(t,n,n)};return Math.abs(a-l)<(0,i.a9)()?[c(a)]:[c(a),c(l)]}const O={t0:0,t1:0};function D(t,e,n){const{origin:i,direction:r}=e,o=G;o[0]=i[0]-t[0],o[1]=i[1]-t[1],o[2]=i[2]-t[2];const s=r[0]*r[0]+r[1]*r[1]+r[2]*r[2];if(0===s)return!1;const a=2*(r[0]*o[0]+r[1]*o[1]+r[2]*o[2]),l=a*a-4*s*(o[0]*o[0]+o[1]*o[1]+o[2]*o[2]-t[3]*t[3]);if(l<0)return!1;const c=Math.sqrt(l);return n.t0=(-a-c)/(2*s),n.t1=(-a+c)/(2*s),!0}const G=(0,i.ap)();function L(t,e){return A(t,e,null)}function z(t,e,n){if(A(t,e,n))return n;const o=N(t,e,r.c.get());return(0,i.dE)(n,e.origin,(0,i.dC)(r.c.get(),e.direction,(0,i.dR)(e.origin,o)/(0,i.dS)(e.direction))),n}function N(t,e,n){const o=r.c.get(),s=r.a.get();(0,i.am)(o,e.origin,e.direction);const a=S(t);(0,i.am)(n,o,e.origin),(0,i.dC)(n,n,1/(0,i.dS)(n)*a);const l=B(t,e.origin),c=(0,r.b)(e.origin,n);return(0,i.dY)(s,c+l,o),(0,i.dX)(n,n,s),n}function U(t,e,n,i){const r=S(t),o=r*r,s=e+.5*Math.PI,a=n*n+o-2*Math.cos(s)*n*r,l=Math.sqrt(a),c=a-o;if(c<=0)return.5;const u=Math.sqrt(c),h=Math.acos(u/l)-Math.asin(r/(l/Math.sin(s)));return Math.min(1,(h+.5*i)/i)}function H(t,e,n){return A(t,e,n)?n:(f(e,t,n),F(t,n,n))}function F(t,e,n){const o=(0,i.dB)(r.c.get(),e,t),s=(0,i.dC)(r.c.get(),o,t[3]/(0,i.dS)(o));return(0,i.dE)(n,s,t)}function Z(t,e){const n=(0,i.dB)(r.c.get(),e,t),o=(0,i.dD)(n),s=t[3]*t[3];return Math.sqrt(Math.abs(o-s))}function B(t,e){const n=(0,i.dB)(r.c.get(),e,t),o=(0,i.dS)(n),s=S(t),a=s+Math.abs(s-o);return(0,i.dU)(s/a)}const q=(0,i.ap)();function Y(t,e,n,r){const o=(0,i.dB)(q,e,t);switch(n){case i.dZ.X:{const t=m(o,q)[2];return(0,i.dQ)(r,-Math.sin(t),Math.cos(t),0)}case i.dZ.Y:{const t=m(o,q),e=t[1],n=t[2],s=Math.sin(e);return(0,i.dQ)(r,-s*Math.cos(n),-s*Math.sin(n),Math.cos(e))}case i.dZ.Z:return(0,i.ao)(r,o);default:return}}function X(t,e){const n=(0,i.dB)(Q,e,t);return(0,i.dS)(n)-t[3]}function j(t,e,n,r){const o=X(t,e),s=Y(t,e,i.dZ.Z,Q),a=(0,i.dC)(Q,s,n-o);return(0,i.dE)(r,e,a)}function W(t,e){const n=(0,i.iY)(t,e),r=S(t);return n<=r*r}function $(t,e,n=(0,i.iB)()){const r=(0,i.dR)(t,e),o=t[3],s=e[3];return r+s<o?((0,i.aa)(n,t),n):r+o<s?((0,i.aa)(n,e),n):((0,i.iX)(n,t,e,(r+s-o)/(2*r)),n[3]=(r+o+s)/2,n)}const Q=(0,i.ap)(),K=_(),J=Object.freeze(Object.defineProperty({__proto__:null,NullSphere:y,altitudeAt:X,angleToSilhouette:B,axisAt:Y,cameraFrustumCoverage:U,clear:E,closestPoint:H,closestPointOnSilhouette:N,containsPoint:W,copy:x,create:_,distanceToSilhouette:Z,elevate:k,equals:b,exactEquals:v,fromCenterAndRadius:w,fromRadius:T,fromValues:C,getCenter:P,getExtent:V,getRadius:S,intersectLine:I,intersectRay:A,intersectRayClosestSilhouette:z,intersectsRay:L,projectPoint:F,setAltitudeAt:j,setExtent:R,tmpSphere:K,union:$,wrap:M},Symbol.toStringTag,{value:"Module"}))},30726:function(t,e,n){n.d(e,{S:function(){return l},v:function(){return a}});var i=n(38837),r=n(44444),o=n(87792);n(81203);function s(t){return t?{p0:(0,r.dA)(t.p0),p1:(0,r.dA)(t.p1),p2:(0,r.dA)(t.p2)}:{p0:(0,r.ap)(),p1:(0,r.ap)(),p2:(0,r.ap)()}}function a(t,e,n){const i=e[0]-t[0],r=e[1]-t[1],o=n[0]-t[0],s=n[1]-t[1];return.5*Math.abs(i*s-r*o)}function l(t,e,n){return(0,r.dB)(c,e,t),(0,r.dB)(u,n,t),.5*(0,r.dS)((0,r.am)(c,c,u))}new i.s(o.v),new i.s((()=>s()));const c=(0,r.ap)(),u=(0,r.ap)()}}]);
//# sourceMappingURL=8911.a20da281.js.map