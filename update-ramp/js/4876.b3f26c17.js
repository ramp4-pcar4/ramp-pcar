"use strict";(self["webpackChunkramp_website"]=self["webpackChunkramp_website"]||[]).push([[4876],{54876:function(e,i,t){t.r(i),t.d(i,{default:function(){return c}});var a=t(44444);class r extends a.m6{overviewGraphicLayer;overviewmapStore;constructor(e){super(e),this.overviewGraphicLayer=this.$iApi.geo.layer.createLayer({id:"RampOverviewGraphic",layerType:a.kj.GRAPHIC,url:"",cosmetic:!0}),this.overviewmapStore=(0,a.m7)(this.$vApp.$pinia)}createMapView(e){if(!e)throw new Error("Attempted to create overview map view without a basemap");const i="string"==typeof e?this.findBasemap(e):e;this.applyBasemap(i),this._rampExtentSet=this.$iApi.geo.map.getExtentSet().clone(),this._rampSR=this._rampExtentSet.sr.clone();const t=this.overviewmapStore.expandFactor;this.esriView=(0,a.hT)(new a.m8({map:this.esriMap,container:this._targetDiv,constraints:{rotationEnabled:!1},spatialReference:this._rampSR.toESRI(),extent:this.$iApi.geo.map.getExtent().toESRI().expand(t)})),this.esriView.ui.components=[],this.handlers.push({type:"mouse-wheel",handler:this.esriView.on("mouse-wheel",(e=>{e.stopPropagation()}))}),this.handlers.push({type:"double-click",handler:this.esriView.on("double-click",(e=>{e.stopPropagation()}))}),this.handlers.push({type:"key-down",handler:this.esriView.on("key-down",(e=>{e.stopPropagation()}))}),this.handlers.push({type:"key-up",handler:this.esriView.on("key-up",(e=>{e.stopPropagation()}))}),this.handlers.push({type:"drag",handler:this.esriView.on("drag",(e=>{e.stopPropagation(),this.mapDrag(e)}))}),this.esriView.container.addEventListener("touchmove",(e=>{e.preventDefault()})),this.esriView.watch("fatalError",(()=>{const e=new IntersectionObserver((i=>{i.forEach((i=>{i.isIntersecting&&(this.esriView?.tryFatalErrorRecovery(),e.disconnect())}))}));e.observe(this.esriView.container)})),this.esriView.when((()=>{this._viewPromise.resolveMe(),this.created=!0}))}async addMapGraphicLayer(){if(!this.esriMap)return void this.noMapErr();const e=new a.ko(this.$iApi.geo.map.getExtent(),"overview-graphic"),i=this.overviewmapStore.borderColour??"#FF0000",t=this.overviewmapStore.borderWidth??1,r=this.overviewmapStore.areaColour??"#000000",s=this.overviewmapStore.areaOpacity??.25,o=`${r}${Math.round(255*s).toString(16)}`;e.style=new a.m9({fill:{colour:o},outline:{colour:i,width:t}}),await this.overviewGraphicLayer.initiate(),await this.overviewGraphicLayer.addGraphic(e),this.esriMap?.add(this.overviewGraphicLayer.esriLayer)}async removeMapGraphicLayer(){if(this.esriMap){if(!this.overviewGraphicLayer.esriLayer)throw new Error("Attempted to remove layer from the map without an esri layer. Likely layer.initiate() was not called or had not finished.");this.overviewGraphicLayer.removeGraphic(),this.esriMap.remove(this.overviewGraphicLayer.esriLayer),await this.overviewGraphicLayer.terminate()}else this.noMapErr()}destroyMapView(){this.esriView?.container.removeEventListener("touchmove",(e=>{e.preventDefault()})),super.destroyMapView()}findBasemap(e){const i=this._basemapStore.find((i=>i.id===e));if(i)return i;{const i=(0,a.kl)(this.$vApp.$pinia).config.map;if(i){const t=i.basemaps.find((i=>i.id===e));if(t)return new a.ma(t)}}throw new Error(`Invalid basemap id requested: ${e}`)}setBasemap(e){if(!this.esriView||!this.esriMap)return this.noMapErr(),!1;const i=this.findBasemap(e),t=(this.getCurrentBasemapId()?this.findBasemap(this.getCurrentBasemapId()):void 0)?.tileSchemaId!==i.tileSchemaId;return t?(this.destroyMapView(),this.createMapView(i)):this.applyBasemap(i),t}startExtent=null;async mapDrag(e){if("mouse"===e.native.pointerType)if("start"===e.action)await this.cursorHitTest(e)&&(this.startExtent=(0,a.hT)(this.overviewGraphicLayer.getEsriGraphic("overview-graphic").geometry));else if(this.startExtent){const i=this.esriView.toMap(e.origin),t=this.esriView.toMap({x:e.x,y:e.y}),a=this.startExtent.clone().offset(t.x-i.x,t.y-i.y,0);this.overviewGraphicLayer.getEsriGraphic("overview-graphic").geometry=a,"end"===e.action&&(this.$iApi.geo.map.zoomMapTo(this.$iApi.geo.geom.geomEsriToRamp(a),void 0,!1),this.startExtent=null)}}updateOverview(e){const i=this.overviewmapStore.expandFactor,t=this.zoomMapTo(e.expand(i),void 0,!1),a=this.overviewGraphicLayer.getLocalGraphic("overview-graphic");return this.overviewGraphicLayer.removeGraphic(a),a.geometry=e,this.overviewGraphicLayer.addGraphic(a),t}async cursorHitTest(e){return(await this.esriView.hitTest(e)).results.length>0}}class s extends a.F{_parseConfig(e){const i=(0,a.m7)(this.$vApp.$pinia);i.basemaps=e?.basemaps||{},i.mapConfig.basemaps=e?Object.values(e.basemaps):[],i.startMinimized=e?.startMinimized??!0,i.expandFactor=e?.expandFactor??1.5,i.borderColour=e?.borderColour??"#FF0000",i.borderWidth=e?.borderWidth??1,i.areaColour=e?.areaColour??"#000000",i.areaOpacity=e?.areaOpacity??.25}get config(){return super.config}}const o={class:"relative h-full w-full overflow-hidden"},n={class:"absolute h-30 w-30 top-0 right-0"},p=["content","aria-label"],h=(0,a.fI)({__name:"overviewmap",setup(e){const i=(0,a.m7)(),{t:t}=(0,a.fJ)(),s=(0,a.f_)("iApi"),h=(0,a.kl)(),v=(0,a.f$)(),l=(0,a.fM)((()=>h.activeBasemapConfig)),c=(0,a.fM)((()=>i.mapConfig)),d=(0,a.fM)((()=>i.basemaps)),m=(0,a.fM)((()=>i.startMinimized));let w=(0,a.km)(new r(s));const u=(0,a.f$)(!0),f=(0,a.f$)(!1),y=(0,a.km)([]);(0,a.g4)((()=>{s.geo.map.viewPromise.then((async()=>{E(),w.createMap(c.value,v.value.querySelector(".overviewmap")),await w.viewPromise,await w.addMapGraphicLayer(),u.value=m.value;let e=w.updateOverview(s.geo.map.getExtent());y.push(s.event.on(a.g9.MAP_EXTENTCHANGE,(0,a.g1)(100,(i=>{e.then((()=>{w.updateOverview(i)}))})))),y.push(s.event.on(a.g9.MAP_CREATED,(()=>{E()}))),y.push(s.event.on(a.g9.MAP_REFRESH_END,(()=>{E()}))),y.push(s.event.on(a.g9.MAP_BASEMAPCHANGE,(async e=>{!e.schemaChanged&&w.created&&l.value&&void 0===d.value[l.value.tileSchemaId]&&(await w.removeMapGraphicLayer(),w.setBasemap(e.basemapId),await w.addMapGraphicLayer())})))}))})),(0,a.g5)((()=>{y.forEach((e=>s.event.off(e))),w.destroyMap()}));const g=async e=>{f.value=!u.value&&await w.cursorHitTest(e)},b=()=>({height:(u.value?48:200)+"px",width:(u.value?48:200)+"px"}),M=()=>({top:(u.value?-6:-3)+"px",right:(u.value?-6:-3)+"px",transform:`rotate(${u.value?225:45}deg)`}),E=()=>{if(l.value)try{const e=l.value?.tileSchemaId;if(!e)throw new Error("Overview Map could not obtain the tile schema of the main map");const t=d.value[e];if(!t)throw new Error("Overview Map could not find a suitable basemap that matches the tile schema of the main map");w.created||i.updateInitialBasemap(t.id),w.created&&w.viewPromise.then((()=>w.setBasemap(t.id)))}catch{w.created||i.updateInitialBasemap(l.value.id),w.viewPromise.then((()=>w.setBasemap(l.value.id)))}else console.error("Overview Map could not obtain the basemap config used by the main map")};return(e,i)=>{const r=(0,a.fO)("tippy");return(0,a.fQ)(),(0,a.fU)("div",{class:"relative",ref_key:"el",ref:v},[(0,a.fT)("div",{style:(0,a.kq)(b()),class:"pointer-events-auto absolute top-0 right-0 mt-12 mr-12 shadow-tm border-4 border-solid border-white bg-white transition-all duration-300 ease-out"},[(0,a.fT)("div",o,[(0,a.fT)("div",{class:(0,a.fW)(["overviewmap absolute top-0 right-0 h-192 w-192",{"cursor-move":f.value}]),onMousemove:g},null,34)]),(0,a.fT)("div",n,[(0,a.fP)(((0,a.fQ)(),(0,a.fU)("button",{type:"button",tabindex:"0",class:"cursor-pointer absolute h-full w-full",onClick:i[0]||(i[0]=e=>u.value=!u.value),content:(0,a.fY)(t)(u.value?"overviewmap.expand":"overviewmap.minimize"),"aria-label":(0,a.fY)(t)(u.value?"overviewmap.expand":"overviewmap.minimize")},[((0,a.fQ)(),(0,a.fU)("svg",{class:"absolute fill-current text-gray-500 transition-all duration-300 ease-out",style:(0,a.kq)(M()),xmlns:"http://www.w3.org/2000/svg",fit:"",height:"100%",width:"100%",preserveAspectRatio:"xMidYMid meet",viewBox:"0 0 24 24",focusable:"false"},i[1]||(i[1]=[(0,a.fT)("g",{id:"apple-keyboard-control"},[(0,a.fT)("path",{d:"M 19.7782,11.7782L 18.364,13.1924L 12,6.82843L 5.63604,13.1924L 4.22183,11.7782L 12,4L 19.7782,11.7782 Z "})],-1)]),4))],8,p)),[[r,{placement:"left",hideOnClick:!1}]])])],4)],512)}}}),v=(0,a.jO)(h,[["__scopeId","data-v-461fd934"]]),l={en:{"overviewmap.expand":"Expand Overview","overviewmap.minimize":"Minimize Overview"},fr:{"overviewmap.expand":"Développer l'aperçu","overviewmap.minimize":"Réduire l'aperçu"}};class c extends s{added(){Object.entries(l).forEach((e=>this.$iApi.$i18n.mergeLocaleMessage(...e))),this._parseConfig(this.config);const e=this.$vApp.$watch((()=>this.config),(e=>this._parseConfig(e))),{destroy:i,el:t}=this.mount(v,{app:this.$element});this.$vApp.$el.getElementsByClassName("inner-shell")[0].appendChild(t.childNodes[0]),this.removed=()=>{e(),i(),(0,a.m7)(this.$vApp.$pinia).$reset()}}}}}]);
//# sourceMappingURL=4876.b3f26c17.js.map