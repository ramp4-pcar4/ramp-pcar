"use strict";(self["webpackChunkramp_website"]=self["webpackChunkramp_website"]||[]).push([[9224],{40222:function(t,e,a){a.d(e,{a:function(){return et},d:function(){return rt},f:function(){return ot}});var n=a(44444),s=a(66080),i=a(56499),r=a(54396),o=a(38006),l=a(36649),c=a(63643);function u(t){const e=h(d(t)),a=e,s=!0,i=Math.max(e/2,5),r=Math.round((0,n.d2)(t.maxPathLength)/i)+1,o=10,{density:l}=t;return{smoothing:(0,n.d2)(t.smoothing),interpolate:!0,velocityScale:"flow-from"===t.flowRepresentation?1:-1,verticesPerLine:r,minSpeedThreshold:.001,segmentLength:i,maxTurnAngle:1,collisions:s,lineCollisionWidth:a,lineSpacing:o,density:l}}function h(t){return"constant"===t.kind?t.value[0]:t.values[t.values.length-1]}function f(t){const e=t.toRgba();return[e[0]/255,e[1]/255,e[2]/255,e[3]]}function m(t){return{kind:"constant",value:[.1,.1,.1,1]}}function d(t){if(!t.hasVisualVariables("size"))return{kind:"constant",value:[(0,n.d2)(t.trailWidth)]};const e=t.getVisualVariablesForType("size")[0],a=[],s=[];let i;if(e.stops){for(const t of e.stops)a.push(t.value),s.push((0,n.d2)(t.size));i=e.stops.length}else a.push(e.minDataValue,e.maxDataValue),s.push((0,n.d2)(e.minSize),(0,n.d2)(e.maxSize)),i=2;return{kind:"ramp",stops:a,values:s,count:i}}function p(t){if(!t.hasVisualVariables("color"))return{kind:"constant",value:f(t.color)};const e=t.getVisualVariablesForType("color")[0],a=[],n=[];for(const s of e.stops)a.push(s.value),Array.prototype.push.apply(n,f(s.color));return{kind:"ramp",stops:a,values:n,count:e.stops.length}}function y(t){if(!t.hasVisualVariables("opacity"))return{kind:"constant",value:[1]};const e=t.getVisualVariablesForType("opacity")[0],a=[],n=[];for(const s of e.stops)a.push(s.value),n.push(s.opacity);return{kind:"ramp",stops:a,values:n,count:e.stops.length}}function x(t,e,a,n){switch(e){case"int":t.setUniform1iv(a,n);break;case"float":t.setUniform1fv(a,n);break;case"vec2":t.setUniform2fv(a,n);break;case"vec3":t.setUniform3fv(a,n);break;case"vec4":t.setUniform4fv(a,n)}}function g(t,e,a,n){"constant"===n.kind?x(t,a,`u_${e}`,n.value):(x(t,"float",`u_${e}_stops`,n.stops),x(t,a,`u_${e}_values`,n.values),t.setUniform1i(`u_${e}_count`,n.count))}function _(t,e){let a=!0;return a=a&&t.collisions===e.collisions,a=a&&t.density===e.density,a=a&&t.interpolate===e.interpolate,a=a&&t.lineCollisionWidth===e.lineCollisionWidth,a=a&&t.lineSpacing===e.lineSpacing,a=a&&t.maxTurnAngle===e.maxTurnAngle,a=a&&t.minSpeedThreshold===e.minSpeedThreshold,a=a&&t.segmentLength===e.segmentLength,a=a&&t.smoothing===e.smoothing,a=a&&t.velocityScale===e.velocityScale,a=a&&t.verticesPerLine===e.verticesPerLine,a}function w(t,e){return t===e||null!=t&&null!=e&&t.equals(e)}function v(t,e){if(!_(t.simulationSettings,e.simulationSettings)||!w(t.timeExtent,e.timeExtent))return!1;let a=!0;return a=a&&t.loadImagery===e.loadImagery,a=a&&t.createFlowMesh===e.createFlowMesh,a=a&&t.color.kind===e.color.kind,a=a&&t.opacity.kind===e.opacity.kind,a=a&&t.size.kind===e.size.kind,a}let b=class t{constructor(t){this._params=t,this.animated=!1}isCompatible(e){if(!(e instanceof t)||!w(this._params.timeExtent,e._params.timeExtent))return!1;let a=!0;return a=a&&this._params.loadImagery===e._params.loadImagery,a=a&&this._params.color.kind===e._params.color.kind,a=a&&this._params.opacity.kind===e._params.opacity.kind,a}async load(t,e){const{extent:a,size:s}=t;(0,n.J)(e);const i=await this._params.loadImagery(a,s[0],s[1],this._params.timeExtent,e);return new A(i,{color:this._params.color,opacity:this._params.opacity})}render(t,e,a){const{context:s}=t,{program:i}=a;s.setFaceCullingEnabled(!1),s.setBlendingEnabled(!0),s.setBlendFunction(n.aQ.ONE,n.aQ.ONE_MINUS_SRC_ALPHA),s.useProgram(i),i.setUniformMatrix3fv("u_dvsMat3",e.dvsMat3),s.bindTexture(a.texture,0),i.setUniform1i("u_texture",0),i.setUniform1f("u_Min",a.min),i.setUniform1f("u_Max",a.max),g(i,"color","vec4",this._params.color),g(i,"opacity","float",this._params.opacity),s.bindVAO(a.vertexArray),s.drawArrays(n.hW.TRIANGLE_STRIP,0,4)}};const M=new Map;M.set("a_position",0),M.set("a_texcoord",1);const S=new Map([["geometry",[new r.t("a_position",2,n.aC.UNSIGNED_SHORT,0,8),new r.t("a_texcoord",2,n.aC.UNSIGNED_SHORT,4,8)]]]),R={vsPath:"raster/flow/imagery",fsPath:"raster/flow/imagery",attributes:M};class A{constructor(t,e){this._flowData=t,this._values=e}attach(t){const{context:e}=t,{width:a,height:r}=this._flowData,o=s.E.createVertex(e,n.az.STATIC_DRAW,new Uint16Array([0,0,0,1,a,0,1,1,0,r,0,0,a,r,1,0])),l=new Map([["geometry",o]]),c=new i.o(e,M,S,l),u=[];"ramp"===this._values.color.kind&&u.push("vvColor"),"ramp"===this._values.opacity.kind&&u.push("vvOpacity");const h=t.painter.materialManager.getProgram(R,u);let f=1e6,m=-1e6;for(let n=0;n<r;n++)for(let t=0;t<a;t++)if(0!==this._flowData.mask[n*a+t]){const e=this._flowData.data[2*(n*a+t)],s=this._flowData.data[2*(n*a+t)+1],i=Math.sqrt(e*e+s*s);f=Math.min(f,i),m=Math.max(m,i)}const d=new Uint8Array(4*a*r);for(let n=0;n<r;n++)for(let t=0;t<a;t++)if(0!==this._flowData.mask[n*a+t]){const e=this._flowData.data[2*(n*a+t)],s=this._flowData.data[2*(n*a+t)+1],i=(Math.sqrt(e*e+s*s)-f)/(m-f);d[4*(n*a+t)]=255*i,d[4*(n*a+t)+1]=0,d[4*(n*a+t)+2]=0,d[4*(n*a+t)+3]=255}else d[4*(n*a+t)]=0,d[4*(n*a+t)+1]=0,d[4*(n*a+t)+2]=0,d[4*(n*a+t)+3]=0;const p=new n.ct;p.internalFormat=n.cA.RGBA,p.wrapMode=n.cx.CLAMP_TO_EDGE,p.flipped=!0,p.width=a,p.height=r;const y=new n.cy(e,p,d);this.vertexArray=c,this.program=h,this.texture=y,this.min=f,this.max=m,this._flowData=null}detach(){this.vertexArray.dispose(),this.texture.dispose()}get ready(){return this.program.compiled}}let P=class t{constructor(t){this._params=t}get animated(){return this._params.flowSpeed>0}isCompatible(e){return e instanceof t&&v(this._params,e._params)}async load(t,e){const{extent:a,size:s}=t;(0,n.J)(e);const i=await this._params.loadImagery(a,s[0],s[1],this._params.timeExtent,e),{vertexData:r,indexData:o}=await this._params.createFlowMesh("Particles",this._params.simulationSettings,i,e);return new T(r,o,{color:this._params.color,opacity:this._params.opacity,size:this._params.size})}render(t,e,a){const{context:s}=t,{program:i}=a;s.setFaceCullingEnabled(!1),s.setBlendingEnabled(!0),s.setBlendFunction(n.aQ.ONE,n.aQ.ONE_MINUS_SRC_ALPHA),s.useProgram(i),i.setUniform1f("u_time",e.time),i.setUniform1f("u_trailLength",this._params.trailLength),i.setUniform1f("u_flowSpeed",this._params.flowSpeed),i.setUniform1f("u_featheringSize",this._params.featheringSize),i.setUniform1f("u_featheringOffset",this._params.featheringOffset),i.setUniform1f("u_introFade",this._params.introFade?1:0),i.setUniform1f("u_fadeToZero",this._params.fadeToZero?1:0),i.setUniform1f("u_decayRate",this._params.decayRate),i.setUniformMatrix3fv("u_dvsMat3",e.dvsMat3),i.setUniformMatrix3fv("u_displayViewMat3",e.displayViewMat3),g(i,"color","vec4",this._params.color),g(i,"opacity","float",this._params.opacity),g(i,"size","float",this._params.size),s.bindVAO(a.vertexArray),s.drawElements(n.hW.TRIANGLES,a.indexCount,n.aC.UNSIGNED_INT,0)}};const D=new Map;D.set("a_xyts0",0),D.set("a_xyts1",1),D.set("a_typeIdDurationSeed",2),D.set("a_extrudeInfo",3);const E=new Map([["geometry",[new r.t("a_xyts0",4,n.aC.FLOAT,0,64),new r.t("a_xyts1",4,n.aC.FLOAT,16,64),new r.t("a_typeIdDurationSeed",4,n.aC.FLOAT,32,64),new r.t("a_extrudeInfo",4,n.aC.FLOAT,48,64)]]]),C={vsPath:"raster/flow/particles",fsPath:"raster/flow/particles",attributes:D};let T=class{constructor(t,e,a){this._vertexData=t,this._indexData=e,this._values=a}attach(t){const{context:e}=t,a=s.E.createVertex(e,n.az.STATIC_DRAW,this._vertexData),r=s.E.createIndex(e,n.az.STATIC_DRAW,this._indexData),o=new Map([["geometry",a]]),l=new i.o(e,D,E,o,r),c=[];"ramp"===this._values.color.kind&&c.push("vvColor"),"ramp"===this._values.opacity.kind&&c.push("vvOpacity"),"ramp"===this._values.size.kind&&c.push("vvSize");const u=t.painter.materialManager.getProgram(C,c);this.vertexArray=l,this.program=u,this.indexCount=this._indexData.length,this._vertexData=null,this._indexData=null}detach(){this.vertexArray.dispose()}get ready(){return this.program.compiled}},z=class t{constructor(t){this._styles=t}get animated(){return this._styles.reduce(((t,e)=>t||e.animated),!1)}isCompatible(e){if(!(e instanceof t)||this._styles.length!==e._styles.length)return!1;const a=this._styles.length;for(let t=0;t<a;t++)if(!this._styles[t].isCompatible(e._styles[t]))return!1;return!0}async load(t,e){const a=await Promise.all(this._styles.map((a=>a.load(t,e))));return new k(a)}render(t,e,a){for(let n=0;n<this._styles.length;n++)this._styles[n].render(t,e,a.resources[n])}},k=class{constructor(t){this.resources=t}attach(t){for(const e of this.resources)e.attach(t)}detach(){for(const t of this.resources)t.detach()}get ready(){return this.resources.reduce(((t,e)=>t&&e.ready),!0)}};class O{constructor(t){this._params=t}get animated(){return this._params.flowSpeed>0}isCompatible(t){return t instanceof O&&v(this._params,t._params)}async load(t,e){const{extent:a,size:s}=t;(0,n.J)(e);const i=await this._params.loadImagery(a,s[0],s[1],this._params.timeExtent,e),{vertexData:r,indexData:o}=await this._params.createFlowMesh("Streamlines",this._params.simulationSettings,i,e);return new V(r,o,{color:this._params.color,opacity:this._params.opacity,size:this._params.size})}render(t,e,a){const{context:s}=t,{program:i}=a;s.setFaceCullingEnabled(!1),s.setBlendingEnabled(!0),s.setBlendFunction(n.aQ.ONE,n.aQ.ONE_MINUS_SRC_ALPHA),s.useProgram(i),i.setUniform1f("u_time",e.time),i.setUniform1f("u_trailLength",this._params.trailLength),i.setUniform1f("u_flowSpeed",this._params.flowSpeed),i.setUniform1f("u_featheringSize",this._params.featheringSize),i.setUniform1f("u_featheringOffset",this._params.featheringOffset),i.setUniform1f("u_introFade",this._params.introFade?1:0),i.setUniform1f("u_fadeToZero",this._params.fadeToZero?1:0),i.setUniform1f("u_decayRate",this._params.decayRate),i.setUniformMatrix3fv("u_dvsMat3",e.dvsMat3),i.setUniformMatrix3fv("u_displayViewMat3",e.displayViewMat3),g(i,"color","vec4",this._params.color),g(i,"opacity","float",this._params.opacity),g(i,"size","float",this._params.size),s.bindVAO(a.vertexArray),s.drawElements(n.hW.TRIANGLES,a.indexCount,n.aC.UNSIGNED_INT,0)}}const I=new Map;I.set("a_positionAndSide",0),I.set("a_timeInfo",1),I.set("a_extrude",2),I.set("a_speed",3);const N=new Map([["geometry",[new r.t("a_positionAndSide",3,n.aC.FLOAT,0,36),new r.t("a_timeInfo",3,n.aC.FLOAT,12,36),new r.t("a_extrude",2,n.aC.FLOAT,24,36),new r.t("a_speed",1,n.aC.FLOAT,32,36)]]]),F={vsPath:"raster/flow/streamlines",fsPath:"raster/flow/streamlines",attributes:I};let V=class{constructor(t,e,a){this._vertexData=t,this._indexData=e,this._values=a}attach(t){const{context:e}=t,a=s.E.createVertex(e,n.az.STATIC_DRAW,this._vertexData),r=s.E.createIndex(e,n.az.STATIC_DRAW,this._indexData),o=new Map([["geometry",a]]),l=new i.o(e,I,N,o,r),c=[];"ramp"===this._values.color.kind&&c.push("vvColor"),"ramp"===this._values.opacity.kind&&c.push("vvOpacity"),"ramp"===this._values.size.kind&&c.push("vvSize");const u=t.painter.materialManager.getProgram(F,c);this.vertexArray=l,this.program=u,this.indexCount=this._indexData.length,this._vertexData=null,this._indexData=null}detach(){this.vertexArray.dispose()}get ready(){return this.program.compiled}};const U=4,G=1,L=.5,W=!0,q=!0,j=2.3;function B(t,e){const{flowSpeed:a,trailLength:n}=t,s=u(t);let i=null;const r={opacity:y(t),size:d(t)};let o=p(t);if("none"===t.background)r.color=o;else{"constant"===o.kind&&(o={kind:"ramp",stops:[0,1],values:[0,0,0,1,o.value[0],o.value[1],o.value[2],o.value[3]],count:2});const t={loadImagery:e.loadImagery,timeExtent:e.timeExtent,color:o,opacity:{kind:"constant",value:[1]}};i=new b(t),r.color=m()}const l={loadImagery:e.loadImagery,createFlowMesh:e.createFlowMesh,simulationSettings:s,timeExtent:e.timeExtent,trailLength:n,flowSpeed:a,featheringSize:G,featheringOffset:L,introFade:W,fadeToZero:q,decayRate:j,color:r.color,opacity:r.opacity,size:r.size},c="butt"===t.trailCap||h(d(t))<=U?new O(l):new P(l);return null!=i?new z([i,c]):c}class H extends o.e{constructor(){super(...arguments),this._visualState={time:0,dvsMat3:(0,n.gH)(),displayViewMat3:(0,n.gH)()}}dispose(){}prepareState(t){const{context:e}=t;e.setColorMask(!0,!0,!0,!0),e.setStencilFunction(n.id.EQUAL,0,255)}draw(t,e){const{requestRender:a,allowDelayedRender:n}=t,{displayData:s}=e;if(null==s||("loaded"===s.state.name&&s.attach(t),"attached"!==s.state.name))return;const i=s.state.resources;!n||i.ready||null==a?(this._visualState.time=t.time/1e3,this._visualState.dvsMat3=e.transforms.displayViewScreenMat3,this._visualState.displayViewMat3=t.state.displayViewMat3,s.flowStyle.render(t,this._visualState,i),s.flowStyle.animated&&null!=a&&a()):a()}}class Q extends o.n{constructor(){super(...arguments),this.flowStyle=null}doRender(t){super.doRender(t)}prepareRenderPasses(t){const e=t.registerRenderPass({name:"flow",brushes:[H],target:()=>this.children,drawPhase:n.aK.MAP});return[...super.prepareRenderPasses(t),e]}}class Y{constructor(t,e,a,n){this.state={name:"created"},this.flowStyle=t,this.extent=e,this.size=a,this.pixelRatio=n}async load(){const t=new AbortController;this.state={name:"loading",abortController:t};const e={extent:this.extent,size:this.size,pixelRatio:this.pixelRatio},a=await this.flowStyle.load(e,t.signal);this.state={name:"loaded",resources:a}}attach(t){if("loaded"!==this.state.name)return void n.G.getLogger("esri.views.2d.engine.flow.FlowDisplayData").error("Only loaded resources can be attached.");const e=this.state.resources;e.attach(t),this.state={name:"attached",resources:e}}detach(){if("loading"===this.state.name)return this.state.abortController.abort(),void(this.state={name:"detached"});"attached"===this.state.name&&(this.state.resources.detach(),this.state={name:"detached"})}update(t){return!!this.flowStyle.isCompatible(t.flowStyle)&&(!(!this.extent.equals(t.extent)||this.size[0]!==t.size[0]||this.size[1]!==t.size[1]||this.pixelRatio!==t.pixelRatio)&&(this.flowStyle=t.flowStyle,!0))}}class J extends l.e{constructor(){super(...arguments),this._displayData=null}get displayData(){return this._displayData}set displayData(t){this._displayData=t,this.requestRender()}clear(){null!=this._displayData&&(this._displayData.detach(),this._displayData=null,this.requestRender())}setTransform(t){const{displayData:e}=this;if(null==e)return;const a=e.extent.xmin,s=e.extent.ymax,i=[0,0];t.toScreen(i,[a,s]);const r=(e.extent.xmax-e.extent.xmin)/e.size[0]/t.resolution,o=(0,n.fA)(t.rotation),{displayViewScreenMat3:l}=this.transforms;(0,n.oz)(l,[-1,1,0]),(0,n.hY)(l,l,[2/(t.size[0]*t.pixelRatio),-2/(t.size[1]*t.pixelRatio),1]),(0,n.gB)(l,l,[i[0],i[1],0]),(0,n.gD)(l,l,o),(0,n.hY)(l,l,[r*t.pixelRatio,r*t.pixelRatio,1])}_createTransforms(){return{displayViewScreenMat3:(0,n.gH)()}}}const $=1.15;let K=class extends n.e9{constructor(t){super(t),this._flowDisplayObject=new J,this._loading=null}initialize(){this.flowContainer.addChild(this._flowDisplayObject)}destroy(){this._clear(),this.flowContainer.removeAllChildren()}get updating(){return null!=this._loading}update(t){const{flowStyle:e}=this.flowContainer;if(null==e)return void this._clear();const{extent:a,rotation:s,resolution:i,pixelRatio:r}=t.state,o=X(a,s);o.expand($);const l=[Math.round((o.xmax-o.xmin)/i),Math.round((o.ymax-o.ymin)/i)],c=new Y(e,o,l,r);if(null!=this._loading){if(this._loading.update(c))return;this._loading.detach(),this._loading=null}null!=this._flowDisplayObject.displayData&&this._flowDisplayObject.displayData.update(c)||(c.load().then((()=>{this._flowDisplayObject.clear(),this._flowDisplayObject.displayData=this._loading,this._loading=null}),(t=>{(0,n.c7)(t)||(n.G.getLogger(this).error("A resource failed to load.",t),this._loading=null)})),this._loading=c)}_clear(){this._flowDisplayObject.clear(),null!=this._loading&&(this._loading.detach(),this._loading=null)}};(0,n.bt)([(0,n.bu)()],K.prototype,"_loading",void 0),(0,n.bt)([(0,n.bu)()],K.prototype,"flowContainer",void 0),(0,n.bt)([(0,n.bu)()],K.prototype,"updating",null),K=(0,n.bt)([(0,n.bv)("esri.views.2d.engine.flow.FlowStrategy")],K);const Z=K;function X(t,e){const a=new n.D({x:(t.xmax+t.xmin)/2,y:(t.ymax+t.ymin)/2,spatialReference:t.spatialReference}),s=t.xmax-t.xmin,i=t.ymax-t.ymin,r=Math.abs(Math.cos((0,n.fA)(e))),o=Math.abs(Math.sin((0,n.fA)(e))),l=r*s+o*i,c=o*s+r*i,u=new n.bn({xmin:a.x-l/2,ymin:a.y-c/2,xmax:a.x+l/2,ymax:a.y+c/2,spatialReference:t.spatialReference});return u.centerAt(a),u}let tt=class extends n.e9{constructor(){super(...arguments),this._loadImagery=(t,e,a,s,i)=>(0,n.oA)(this.layer,t,e,a,s,i),this._createFlowMesh=(t,e,a,n)=>this.layer.createFlowMesh({meshType:t,flowData:a,simulationSettings:e},{signal:n}),this.attached=!1,this.type="flow",this.timeExtent=null,this.redrawOrRefetch=async()=>{this._updateVisualization()}}get updating(){return!this.attached||this._strategy.updating}attach(){const{layer:t}=this,e=()=>{this._loadImagery=(e,a,s,i,r)=>(0,n.oA)(t,e,a,s,i,r),this._updateVisualization()};"multidimensionalDefinition"in t?this.addHandles((0,n.cc)((()=>t.multidimensionalDefinition),e)):this.addHandles([(0,n.cc)((()=>t.mosaicRule),e),(0,n.cc)((()=>t.rasterFunction),e),(0,n.cc)((()=>t.definitionExpression),e)]),this.container=new Q,this._strategy=new Z({flowContainer:this.container}),this._updateVisualization()}detach(){this._strategy.destroy(),this.container?.removeAllChildren(),this.container=null,this.removeHandles()}update(t){t.stationary?this._strategy.update(t):this.layerView.requestUpdate()}hitTest(t){return new n.a1({attributes:{},geometry:t.clone(),layer:this.layer})}moveEnd(){}async doRefresh(){}_updateVisualization(){const t=this.layer.renderer;if(null==t||"flow"!==t.type)return;const e=B(t,{loadImagery:this._loadImagery,createFlowMesh:this._createFlowMesh,timeExtent:this.timeExtent});this.container.flowStyle=e,this.layerView.requestUpdate()}};(0,n.bt)([(0,n.bu)()],tt.prototype,"_strategy",void 0),(0,n.bt)([(0,n.bu)()],tt.prototype,"attached",void 0),(0,n.bt)([(0,n.bu)()],tt.prototype,"container",void 0),(0,n.bt)([(0,n.bu)()],tt.prototype,"layer",void 0),(0,n.bt)([(0,n.bu)()],tt.prototype,"layerView",void 0),(0,n.bt)([(0,n.bu)()],tt.prototype,"type",void 0),(0,n.bt)([(0,n.bu)()],tt.prototype,"updating",null),(0,n.bt)([(0,n.bu)()],tt.prototype,"timeExtent",void 0),tt=(0,n.bt)([(0,n.bv)("esri.views.2d.engine.flow.FlowView2D")],tt);const et=tt,at=new Float32Array([.27058823529411763,.4588235294117647,.7098039215686275,1,.396078431372549,.5372549019607843,.7215686274509804,1,.5176470588235295,.6196078431372549,.7294117647058823,1,.6352941176470588,.7058823529411765,.7411764705882353,1,.7529411764705882,.8,.7450980392156863,1,.8705882352941177,.8901960784313725,.7490196078431373,1,1,1,.7490196078431373,1,1,.8627450980392157,.6313725490196078,1,.9803921568627451,.7254901960784313,.5176470588235295,1,.9607843137254902,.596078431372549,.4117647058823529,1,.9294117647058824,.4588235294117647,.3176470588235294,1,.9098039215686274,.08235294117647059,.08235294117647059,1]),nt=new Float32Array([0,92/255,230/255,1]),st={beaufort_ft:at,beaufort_m:at,beaufort_km:at,beaufort_mi:at,beaufort_kn:new Float32Array([.1568627450980392,.5725490196078431,.7803921568627451,1,.34901960784313724,.6352941176470588,.7294117647058823,1,.5058823529411764,.7019607843137254,.6705882352941176,1,.6274509803921569,.7607843137254902,.6078431372549019,1,.7490196078431373,.8313725490196079,.5411764705882353,1,.8549019607843137,.9019607843137255,.4666666666666667,1,.9803921568627451,.9803921568627451,.39215686274509803,1,.9882352941176471,.8352941176470589,.3254901960784314,1,.9882352941176471,.7019607843137254,.4,1,.9803921568627451,.5529411764705883,.20392156862745098,1,.9686274509803922,.43137254901960786,.16470588235294117,1,.9411764705882353,.2784313725490196,.11372549019607843,1]),classified_arrow:new Float32Array([.2196078431372549,.6588235294117647,0,1,.5450980392156862,1.2117647058823529,0,1,1,1,0,1,1,.5019607843137255,0,1,1,0,0,1]),ocean_current_m:new Float32Array([.3058823529411765,.10196078431372549,.6,1,.7019607843137254,.10588235294117647,.10196078431372549,1,.792156862745098,.5019607843137255,.10196078431372549,1,.6941176470588235,.6941176470588235,.6941176470588235,1]),ocean_current_kn:new Float32Array([0,0,0,1,0,.1450980392156863,.39215686274509803,1,.3058823529411765,.10196078431372549,.6,1,.592156862745098,0,.39215686274509803,1,.7019607843137254,.10588235294117647,.10196078431372549,1,.6941176470588235,.3058823529411765,.10196078431372549,1,.792156862745098,.5019607843137255,.10196078431372549,1,.6941176470588235,.7019607843137254,.20392156862745098,1,.6941176470588235,.6941176470588235,.6941176470588235,1]),simple_scalar:nt,single_arrow:nt,wind_speed:new Float32Array([0,0,0,1])},it=[0,20];class rt extends o.e{constructor(){super(...arguments),this._desc={magdir:{vsPath:"raster/magdir",fsPath:"raster/magdir",attributes:new Map([["a_pos",0],["a_offset",1],["a_vv",2]])},scalar:{vsPath:"raster/scalar",fsPath:"raster/scalar",attributes:new Map([["a_pos",0],["a_offset",1],["a_vv",2]])}}}dispose(){}prepareState({context:t}){t.setBlendingEnabled(!0),t.setBlendFunctionSeparate(n.aQ.ONE,n.aQ.ONE_MINUS_SRC_ALPHA,n.aQ.ONE,n.aQ.ONE_MINUS_SRC_ALPHA),t.setColorMask(!0,!0,!0,!0),t.setStencilWriteMask(0),t.setStencilTestEnabled(!0),t.setStencilOp(n.ie.KEEP,n.ie.KEEP,n.ie.REPLACE)}draw(t,e){if(null==e.source||0===e.source.validPixelCount)return;const{context:a,timeline:s}=t;if(s.begin(this.name),a.setStencilFunction(n.id.EQUAL,e.stencilRef,255),e.updateVectorFieldVAO(t),"scalar"===t.renderPass){const a=e.vaoData.scalar;a&&this._drawScalars(t,e,a.vao,a.elementCount)}else{const a=e.vaoData.magdir;a&&this._drawTriangles(t,e,a.vao,a.elementCount)}s.end(this.name)}_drawTriangles(t,e,a,s){const{context:i,painter:r,requestRender:o,allowDelayedRender:l}=t,{symbolizerParameters:c}=e,u=c.dataRange?["dataRange"]:[];"geographic"===c.rotationType&&u.push("rotationGeographic");const h=r.materialManager.getProgram(this._desc.magdir,u);if(l&&null!=o&&!h.compiled)return void o();i.useProgram(h);const{coordScale:f,opacity:m,transforms:d}=e;h.setUniform2fv("u_coordScale",f),h.setUniform1f("u_opacity",m),h.setUniformMatrix3fv("u_dvsMat3",d.displayViewScreenMat3);const{style:p,dataRange:y,rotation:x,symbolPercentRange:g}=c;h.setUniform4fv("u_colors",st[p]),h.setUniform2fv("u_dataRange",y||it),h.setUniform1f("u_rotation",x),h.setUniform2fv("u_symbolPercentRange",g);const _=this._getSymbolSize(t,e);h.setUniform2fv("u_symbolSize",_),i.bindVAO(a),i.drawElements(n.hW.TRIANGLES,s,n.aC.UNSIGNED_INT,0)}_drawScalars(t,e,a,s){const{context:i,painter:r,requestRender:o,allowDelayedRender:l}=t,{symbolizerParameters:c}=e,u=[];"wind_speed"===c.style?u.push("innerCircle"):c.dataRange&&u.push("dataRange"),"geographic"===c.rotationType&&u.push("rotationGeographic");const h=r.materialManager.getProgram(this._desc.scalar,u);if(l&&null!=o&&!h.compiled)return void o();i.useProgram(h);const{coordScale:f,opacity:m,transforms:d}=e;h.setUniform2fv("u_coordScale",f),h.setUniform1f("u_opacity",m),h.setUniformMatrix3fv("u_dvsMat3",d.displayViewScreenMat3);const{dataRange:p,symbolPercentRange:y}=c;h.setUniform2fv("u_dataRange",p||it),h.setUniform2fv("u_symbolPercentRange",y);const x=this._getSymbolSize(t,e);h.setUniform2fv("u_symbolSize",x),i.bindVAO(a),i.drawElements(n.hW.TRIANGLES,s,n.aC.UNSIGNED_INT,0)}_getSymbolSize(t,e){const a=e.key?2**(t.displayLevel-e.key.level):e.resolution/t.state.resolution,{symbolTileSize:n}=e.symbolizerParameters;return[n/(Math.round((e.width-e.offset[0])/n)*n)/a,n/(Math.round((e.height-e.offset[1])/n)*n)/a]}}class ot extends l.e{constructor(t=null){super(),this._source=null,this._symbolizerParameters=null,this._vaoInvalidated=!0,this.coordScale=[1,1],this.height=null,this.key=null,this.offset=null,this.stencilRef=0,this.resolution=null,this.pixelRatio=1,this.x=0,this.y=0,this.rotation=0,this.rawPixelData=null,this.vaoData=null,this.width=null,this.source=t}destroy(){null!=this.vaoData&&(this.vaoData.magdir?.vao.dispose(),this.vaoData.scalar?.vao.dispose(),this.vaoData=null)}get symbolizerParameters(){return this._symbolizerParameters}set symbolizerParameters(t){JSON.stringify(this._symbolizerParameters)!==JSON.stringify(t)&&(this._symbolizerParameters=t,this.invalidateVAO())}get source(){return this._source}set source(t){this._source=t,this.invalidateVAO()}invalidateVAO(){this._vaoInvalidated||null==this.vaoData||(this.vaoData.magdir?.vao.dispose(),this.vaoData.scalar?.vao.dispose(),this.vaoData=null,this._vaoInvalidated=!0,this.requestRender())}updateVectorFieldVAO(t){if(this._vaoInvalidated){if(this._vaoInvalidated=!1,null!=this.source&&null==this.vaoData){const{style:e}=this.symbolizerParameters;switch(e){case"beaufort_ft":case"beaufort_km":case"beaufort_kn":case"beaufort_m":case"beaufort_mi":case"classified_arrow":case"ocean_current_kn":case"ocean_current_m":case"single_arrow":{const e=(0,n.oB)(this.source,this.symbolizerParameters),a=this._createVectorFieldVAO(t.context,e);this.vaoData={magdir:a}}break;case"simple_scalar":{const e=(0,n.oC)(this.source,this.symbolizerParameters),a=this._createVectorFieldVAO(t.context,e);this.vaoData={scalar:a}}break;case"wind_speed":{const e=(0,n.oB)(this.source,this.symbolizerParameters),a=this._createVectorFieldVAO(t.context,e),s=(0,n.oC)(this.source,this.symbolizerParameters),i=this._createVectorFieldVAO(t.context,s);this.vaoData={magdir:a,scalar:i}}}}this.ready(),this.requestRender()}}_createTransforms(){return{displayViewScreenMat3:(0,n.gH)()}}setTransform(t){const e=(0,n.gA)(this.transforms.displayViewScreenMat3),[a,s]=t.toScreenNoRotation([0,0],[this.x,this.y]),i=this.resolution/this.pixelRatio/t.resolution,r=i*this.width,o=i*this.height,l=Math.PI*this.rotation/180;(0,n.gB)(e,e,(0,n.gC)(a,s)),(0,n.gB)(e,e,(0,n.gC)(r/2,o/2)),(0,n.gD)(e,e,-l),(0,n.gB)(e,e,(0,n.gC)(-r/2,-o/2)),(0,n.gE)(e,e,(0,n.gC)(r,o)),(0,n.gF)(this.transforms.displayViewScreenMat3,t.displayViewMat3,e)}onAttach(){this.invalidateVAO()}onDetach(){this.invalidateVAO()}_createVectorFieldVAO(t,e){const{vertexData:a,indexData:r}=e,o=s.E.createVertex(t,n.az.STATIC_DRAW,new Float32Array(a)),l=s.E.createIndex(t,n.az.STATIC_DRAW,new Uint32Array(r)),u=(0,c.b)("vector-field",{geometry:[{location:0,name:"a_pos",count:2,type:n.aC.FLOAT,normalized:!1},{location:1,name:"a_offset",count:2,type:n.aC.FLOAT,normalized:!1},{location:2,name:"a_vv",count:2,type:n.aC.FLOAT,normalized:!1}]});return{vao:new i.o(t,u.attributes,u.bufferLayouts,new Map([["geometry",o]]),l),elementCount:r.length}}}},6255:function(t,e,a){a.d(e,{C:function(){return g},D:function(){return O},I:function(){return b},K:function(){return k},V:function(){return F},a:function(){return Q},c:function(){return J},e:function(){return G},f:function(){return $},i:function(){return q},j:function(){return x},l:function(){return Y},t:function(){return L},v:function(){return y},w:function(){return i}});var n,s=a(44444);function i(t,e,a){return!(0,s.bD)(t,e,a)}function r(t,e,a){const n=i(t,e,a);if(n&&!(0,s.cj)())throw new s.s("rasterprojectionhelper-project","projection engine is not loaded");return n}(function(t){t[t.None=0]="None",t[t.North=1]="North",t[t.South=2]="South",t[t.Both=3]="Both"})(n||(n={}));const o=(t,e,a,n=0)=>{if(1===a[0])return[0,0];let s=1,i=-1,r=1,o=-1;for(let y=0;y<t.length;y+=2)isNaN(t[y])||(s=s>t[y]?t[y]:s,i=i>t[y]?i:t[y],r=r>t[y+1]?t[y+1]:r,o=o>t[y+1]?o:t[y+1]);const{cols:l,rows:c}=e,u=(i-s)/l/a[0],h=(o-r)/c/a[1],f=2*n;let m=0,d=!1,p=[0,0];for(let y=0;y<l-3;y++){for(let e=0;e<c-3;e++){const a=y*c*2+2*e,n=(t[a]+t[a+4]+t[a+4*c]+t[a+4*c+4])/4,s=(t[a+1]+t[a+5]+t[a+4*c+1]+t[a+4*c+5])/4,i=Math.abs((n-t[a+2*c+2])/u),r=Math.abs((s-t[a+2*c+3])/h);if(i+r>m&&(m=i+r,p=[i,r]),f&&m>f){d=!0;break}}if(d)break}return p},l={3395:20037508.342789244,3410:17334193.943686873,3857:20037508.342788905,3975:17367530.445161372,4087:20037508.342789244,4088:20015108.787169147,6933:17367530.445161372,32662:20037508.342789244,53001:20015086.79602057,53002:10007543.39801029,53003:20015086.79602057,53004:20015086.79602057,53016:14152803.599503474,53017:17333573.624304302,53034:20015086.79602057,53079:20015114.352186374,53080:20015114.352186374,54001:20037508.342789244,54002:10018754.171394624,54003:20037508.342789244,54004:20037508.342789244,54016:14168658.027268292,54017:17367530.44516137,54034:20037508.342789244,54079:20037508.342789244,54080:20037508.342789244,54100:20037508.342789244,54101:20037508.342789244},c=32,u=4,h=u,f=new Map,m=new Map,d=500;let p=null;async function y(){p&&(0,s.cj)()||((0,s.cj)()||await(0,s.ck)(),p=await Promise.all([a.e(6239),a.e(2518)]).then(a.bind(a,2518)))}function x(t,e,a){return r(t.spatialReference,e),a?(0,s.cs)(e,t.spatialReference,t):(0,s.cs)(t.spatialReference,e,t)}function g(t,e,a,n=null){const i=t.spatialReference;if(!i||!e||i.equals(e))return t;r(i,e,n);const o=a.center,l=new s.bn({xmin:o.x-t.x/2,xmax:o.x+t.x/2,ymin:o.y-t.y/2,ymax:o.y+t.y/2,spatialReference:i}),c=(0,s.cl)(l,e,n),u=F(e);return null==c||null!=u&&c.width>=u?_(t,i,e):{x:c.width,y:c.height}}function _(t,e,a){const n=(0,s.cm)(e)/(0,s.cm)(a);return{x:t.x*n,y:t.y*n}}function w(t,e,a){const{spatialReference:n}=a;if(!n||!e||n.equals(e))return t;if(n.isGeographic&&e.isGeographic)return _(t,n,e);if(r(n,e),!p)throw new s.s("raster-projection-helper:project-dataset-resolution","geometry engine is not loaded");let{x:i,y:o}=t;const l=(i+o)/2*(0,s.cm)(n);let c=1;l>30&&(c=30/l,i*=c,o*=c);const u=256,h=i*u/2,f=o*u/2,{x:m,y:d}=a.center,y=[];for(let s=0;s<=u;s++)y.push([m-h,d-f+s*o]);for(let s=1;s<=u;s++)y.push([m-h+s*i,d+f]);for(let s=1;s<=u;s++)y.push([m+h,d+f-s*o]);for(let s=1;s<u;s++)y.push([m+h-s*i,d-f]);y.push(y[0]);const x=new s.a$({rings:[y],spatialReference:n}),g=(0,s.cl)(x,e);if(!g)return _(t,n,e);const w=g.extent,v=F(e);if(null==w||null!=v&&w.width>=v)return _(t,n,e);const b=p.planarArea(g),M=i*o*u*u,S=Math.sqrt(b/M)/c,R={x:w.width/c/u,y:w.height/c/u},A={x:i*S,y:o*S},P=R.x*R.y;return Math.abs(P-A.x*A.y)/P<.1?R:A}function v(t,e=.01){return(0,s.cm)(t)?e/(0,s.cm)(t):0}function b(t,e,a=null,n=!0){const i=t.spatialReference;if(i.equals(e))return t;r(i,e,a);const o=(0,s.cl)(t,e,a);return n&&o&&M([t],[o],i,e),o}function M(t,e,a,n){const s=V(a,!0),i=V(n,!0),r=v(a,d),o=v(n,d);if(r&&null!=s&&null!=i)for(let l=0;l<t.length;l++){const a=e[l];if(!a)continue;const{x:n}=t[l],{x:c}=a;c>=i[1]-o&&Math.abs(n-s[0])<r?a.x-=i[1]-i[0]:c<=i[0]+o&&Math.abs(n-s[1])<r&&(a.x+=i[1]-i[0])}}function S(t){const{inSR:e,outSR:a,datumTransformation:n,preferPE:s}=t;if(e.equals(a)){const{points:e}=C(t,null);return e}return e.isWebMercator&&a.isWGS84||e.isWGS84&&a.isWebMercator?P(t):r(e,a,n)&&s&&(e.isGeographic||null!=D(e))?A(t):R(t)}function R(t){const{points:e}=C(t,null),{inSR:a,outSR:n,datumTransformation:i}=t,r=e.map((t=>new s.D(t[0],t[1],a))),o=(0,s.cl)(r,n,i);return i&&M(r,o,a,n),o.map((t=>t?[t.x,t.y]:[NaN,NaN]))}function A(t){const{inSR:e,outSR:a,datumTransformation:n}=t,i=D(e),{points:r,mask:o}=C(t,i);if(!e.isGeographic){const t=e.wkid?s.cn.coordsys(e.wkid):s.cn.fromString(e.isGeographic?s.co.PE_TYPE_GEOGCS:s.co.PE_TYPE_PROJCS,e.wkt2||e.wkt);s.cp.projToGeog(t,r.length,r)}if(null!=n&&n.steps.length){let t;if(a.isGeographic&&(t=r.map((([t])=>t>179.9955?1:t<-179.9955?-1:0))),n.steps.forEach((t=>{const e=t.wkid?s.cn.geogtran(t.wkid):s.cn.fromString(s.co.PE_TYPE_GEOGTRAN,t.wkt);s.cq.geogToGeog(e,r.length,r,null,t.isInverse?s.co.PE_TRANSFORM_2_TO_1:s.co.PE_TRANSFORM_1_TO_2)})),t)for(let e=0;e<r.length;e++){const a=t[e],n=r[e][0],s=n>179.9955?1:n<-179.9955?-1:0;a&&s&&a!==s&&(r[e][0]=a>0?n+360:n-360)}}if(!a.isGeographic){const t=D(a,!0),e=null!=t&&t.isEnvelope?[t.bbox[1],t.bbox[3]]:[-90,90];T(r,e);const n=a.wkid?s.cn.coordsys(a.wkid):s.cn.fromString(a.isGeographic?s.co.PE_TYPE_GEOGCS:s.co.PE_TYPE_PROJCS,a.wkt2||a.wkt);s.cp.geogToProj(n,r.length,r)}let l=r;if(o&&r.length!==o.length){l=[];for(let t=0,e=0;t<o.length;t++)o[t]?l.push(r[e++]):l.push([NaN,NaN])}return l}function P(t){const{cols:e,rows:a,xres:n,yres:i,usePixelCenter:r,inSR:o,outSR:l}=t;let{xmin:c,ymax:u}=t;r&&(c+=n/2,u-=i/2);const h=[],f=[],m=Math.max(e,a);for(let p=0;p<m;p++){const t=c+n*Math.min(e,p),r=u-i*Math.min(a,p),m=(0,s.cl)(new s.D({x:t,y:r,spatialReference:o}),l);p<=e&&h.push(m.x),p<=a&&f.push(m.y)}const d=[];for(let s=0;s<e;s++)for(let t=0;t<a;t++)d.push([h[s],f[t]]);return d}function D(t,e=!1){let a=t.wkid||t.wkt2||t.wkt;if(!a||t.isGeographic)return null;if(a=String(a),f.has(a)){const t=f.get(a);return e?t?.gcs:t?.pcs}const n=t.wkid?s.cn.coordsys(t.wkid):s.cn.fromString(t.isGeographic?s.co.PE_TYPE_GEOGCS:s.co.PE_TYPE_PROJCS,t.wkt2||t.wkt),i=E(n,v(t,1e-4)),r=E(n,0,!0);return f.set(a,{pcs:i,gcs:r}),e?r:i}function E(t,e=0,a=!1){const n=s.cr.generate(t),i=a?t.horizonGcsGenerate():t.horizonPcsGenerate();if(!n||!i?.length)return null;let r=!1,o=i.find((t=>1===t.getInclusive()&&1===t.getKind()));if(!o){if(o=i.find((t=>1===t.getInclusive()&&0===t.getKind())),!o)return null;r=!0}const l=a?0:(2===n.getNorthPoleLocation()?1:0)|(2===n.getSouthPoleLocation()?2:0),c=n.isPannableRectangle(),u=o.getCoord();if(r)return{isEnvelope:r,isPannable:c,vertices:u,coef:null,bbox:[u[0][0]-e,u[0][1]-e,u[1][0]+e,u[1][1]+e],poleLocation:l};let h=0;const f=[];let[m,d]=u[0],[p,y]=u[0];for(let s=0,x=u.length;s<x;s++){h++,h===x&&(h=0);const[t,e]=u[s],[a,n]=u[h];if(n===e)f.push([t,a,e,n,2]);else{const s=(a-t)/(n-e||1e-4),i=t-s*e;e<n?f.push([s,i,e,n,0]):f.push([s,i,n,e,1])}m=m<t?m:t,d=d<e?d:e,p=p>t?p:t,y=y>e?y:e}return{isEnvelope:!1,isPannable:c,vertices:u,coef:f,bbox:[m,d,p,y],poleLocation:l}}function C(t,e){const a=[],{cols:n,rows:s,xres:i,yres:r,usePixelCenter:o}=t;let{xmin:l,ymax:c}=t;if(o&&(l+=i/2,c-=r/2),null==e){for(let t=0;t<n;t++)for(let e=0;e<s;e++)a.push([l+i*t,c-r*e]);return{points:a}}const u=new Uint8Array(n*s);if(e.isEnvelope){const{bbox:[t,o,h,f]}=e;for(let m=0,d=0;m<n;m++){const n=l+i*m,p=e.isPannable||n>=t&&n<=h;for(let t=0;t<s;t++,d++){const e=c-r*t;p&&e>=o&&e<=f&&(a.push([n,e]),u[d]=1)}}return{points:a,mask:u}}const h=e.coef,f=[];for(let m=0;m<s;m++){const t=c-r*m,e=[],a=[];for(let s=0;s<h.length;s++){const[n,i,r,o,l]=h[s];if(t===r&&r===o)e.push(n),e.push(i),a.push(2),a.push(2);else if(t>=r&&t<=o){const s=n*t+i;e.push(s),a.push(l)}}let n=e;if(e.length>2){let t=2===a[0]?0:a[0],s=e[0];n=[];for(let i=1;i<a.length;i++)2===a[i]&&i!==a.length-1||(a[i]!==t&&(n.push(0===t?Math.min(s,e[i-1]):Math.max(s,e[i-1])),t=a[i],s=e[i]),i===a.length-1&&n.push(0===a[i]?Math.min(s,e[i]):Math.max(s,e[i])));n.sort(((t,e)=>t-e))}else e[0]>e[1]&&(n=[e[1],e[0]]);f.push(n)}for(let m=0,d=0;m<n;m++){const t=l+i*m;for(let e=0;e<s;e++,d++){const n=c-r*e,s=f[e];if(2===s.length)t>=s[0]&&t<=s[1]&&(a.push([t,n]),u[d]=1);else if(s.length>2){let e=!1;for(let a=0;a<s.length;a+=2)if(t>=s[a]&&t<=s[a+1]){e=!0;break}e&&(a.push([t,n]),u[d]=1)}}}return{points:a,mask:u}}function T(t,e){const[a,n]=e;for(let s=0;s<t.length;s++){const e=t[s][1];(e<a||e>n)&&(t[s]=[NaN,NaN])}}function z(t,e){const a=F(t[0].spatialReference);if(t.length<2||null==a||(e=e??v(t[0].spatialReference),1===(t=t.filter((t=>t.width>e))).length))return t[0];let{xmin:n,xmax:i,ymin:r,ymax:o}=t[0];for(let s=1;s<t.length;s++){const e=t[s];i=e.xmax+a*s,r=Math.min(r,e.ymin),o=Math.max(o,e.ymax)}return new s.bn({xmin:n,xmax:i,ymin:r,ymax:o,spatialReference:t[0].spatialReference})}function k(t,e,a=null,i=!0){const r=t.spatialReference;if(r.equals(e))return t;const o=G(t),l=F(r,!0),c=F(e);if(0===o||null==l||null==c){const o=N(t,e,a,i);if(null==l&&null!=c&&Math.abs(o.width-c)<v(e)&&(0,s.cj)()){const a=D(r);if(null!=a&&a.poleLocation===n.None&&t.width<(a.bbox[2]-a.bbox[0])/2)return I(t,e)||o}return o}const u=t.clone().normalize();if(1===u.length&&t.xmax<l&&t.xmax-l/2>v(r)){const{xmin:e,xmax:a}=t;for(let n=0;n<=o;n++){const i=0===n?e:-l/2,c=n===o?a-l*n:l/2;u[n]=new s.bn({xmin:i,xmax:c,ymin:t.ymin,ymax:t.ymax,spatialReference:r})}}return z(u.map((t=>N(t,e,a,i))).filter(s.ci))}function O(t,e,a){if("extent"===t.type){const{xmin:e,ymin:a,xmax:n,ymax:i,spatialReference:r}=t;t=new s.a$({rings:[[[e,i],[n,i],[n,a],[e,a],[e,i]]],spatialReference:r})}return t.spatialReference.equals(e)?t:(r(t.spatialReference,e,a),(0,s.cl)(t,e,a))}function I(t,e){const a=F(e);if(null==a)return null;let{xmin:n,ymin:i,xmax:r,ymax:o}=t;const l=t.spatialReference,c=new s.a$({spatialReference:l,rings:[[[n,i],[r,i],[r,o],[n,o],[n,i]]]}),u=(0,s.cl)(c,e);if(2!==u.rings.length||!u.rings[0].length||!u.rings[1].length)return null;const{rings:h}=u,f=v(l),m=new s.bn({spatialReference:e});for(let s=0;s<2;s++){n=r=h[s][0][0],i=o=h[s][0][1];for(let t=0;t<h[s].length;t++)n=n>h[s][t][0]?h[s][t][0]:n,r=r<h[s][t][0]?h[s][t][0]:r,i=i>h[s][t][1]?h[s][t][1]:i,o=o<h[s][t][1]?h[s][t][1]:o;if(0===s)m.ymin=i,m.ymax=o,m.xmin=n,m.xmax=r;else if(m.ymin=Math.min(m.ymin,i),m.ymax=Math.max(m.ymax,o),Math.abs(r-a/2)<f)m.xmin=n,m.xmax=m.xmax+a;else{if(!(Math.abs(n+a/2)<f))return null;m.xmax=r+a}}return m}function N(t,e,a=null,n=!0,i=!0){const o=t.spatialReference;if(o.equals(e)||!e)return t;r(o,e,a);const l=(0,s.cl)(t,e,a);if(i&&e.isWebMercator&&l&&(l.ymax=Math.min(20037508.342787,l.ymax),l.ymin=Math.max(-20037508.342787,l.ymin),l.ymin>=l.ymax))return null;if(!n||!l)return l;const c=V(o,!0),u=V(e,!0);if(null==c||null==u)return l;const h=v(o,.001),f=v(o,d),m=v(e,.001);if(Math.abs(l.xmin-u[0])<m&&Math.abs(l.xmax-u[1])<m){const n=Math.abs(t.xmin-c[0]),i=Math.abs(c[1]-t.xmax);if(n<h&&i>f){l.xmin=u[0];const n=[];n.push(new s.D(t.xmax,t.ymin,o)),n.push(new s.D(t.xmax,(t.ymin+t.ymax)/2,o)),n.push(new s.D(t.xmax,t.ymax,o));const i=n.map((t=>b(t,e,a))).filter((t=>!isNaN(t?.x))).map((t=>t.x));l.xmax=Math.max.apply(null,i)}if(i<h&&n>f){l.xmax=u[1];const n=[];n.push(new s.D(t.xmin,t.ymin,o)),n.push(new s.D(t.xmin,(t.ymin+t.ymax)/2,o)),n.push(new s.D(t.xmin,t.ymax,o));const i=n.map((t=>b(t,e,a))).filter((t=>!isNaN(t?.x))).map((t=>t.x));l.xmin=Math.min.apply(null,i)}}else{const t=v(e,.001);Math.abs(l.xmin-u[0])<t&&(l.xmin=u[0]),Math.abs(l.xmax-u[1])<t&&(l.xmax=u[1])}return l}function F(t,e=!1){if(!t)return null;const a=e?20037508.342787:20037508.342788905;return t.isWebMercator?2*a:t.wkid&&t.isGeographic?360:2*l[t.wkid]||null}function V(t,e=!1){if(t.isGeographic)return[-180,180];const a=F(t,e);return null!=a?[-a/2,a/2]:null}function U(t,e,a,n){let s=(t-e)/a;return s-Math.floor(s)!=0?s=Math.floor(s):n&&(s-=1),s}function G(t,e=!1){const a=F(t.spatialReference);if(null==a)return 0;const n=e?0:-a/2,s=v(t.spatialReference),i=!e&&Math.abs(t.xmax-a/2)<s?a/2:t.xmax,r=!e&&Math.abs(t.xmin+a/2)<s?-a/2:t.xmin;return U(i,n,a,!0)-U(r,n,a,!1)}function L(t){const e=t.storageInfo.origin.x,a=F(t.spatialReference,!0);if(null==a)return{originX:e,halfWorldWidth:null,pyramidsInfo:null};const n=a/2,{nativePixelSize:s,storageInfo:i,extent:r}=t,{maximumPyramidLevel:o,blockWidth:l,pyramidScalingFactor:c}=i;let u=s.x;const h=[],f=null!=t.transform&&"gcs-shift"===t.transform.type,m=e+(f?0:n),d=f?a-e:n-e;for(let p=0;p<=o;p++){const t=(r.xmax-e)/u/l,a=t-Math.floor(t)==0?t:Math.ceil(t),n=d/u/l,s=n-Math.floor(n)==0?n:Math.ceil(n),i=Math.floor(m/u/l),o=Math.round(m/u)%l,f=(l-Math.round(d/u)%l)%l;h.push({resolutionX:u,blockWidth:l,datasetColumnCount:a,worldColumnCountFromOrigin:s,leftMargin:o,rightPadding:f,originColumnOffset:i}),u*=c}return{originX:e,halfWorldWidth:n,pyramidsInfo:h,hasGCSSShiftTransform:f}}function W(t){if(!t||t.isGeographic)return t;const e=String(t.wkid||t.wkt2||t.wkt);let a;return m.has(e)?a=m.get(e):(a=(t.wkid?s.cn.coordsys(t.wkid):s.cn.fromString(s.co.PE_TYPE_PROJCS,t.wkt2||t.wkt)).getGeogcs().getCode(),m.set(e,a)),new s.aY({wkid:a})}function q(t){const e=t.isAdaptive&&null==t.spacing;let a=t.spacing||[c,c],n=j(t),s={cols:n.size[0]+1,rows:n.size[1]+1};const r=n.outofBoundPointCount>0&&n.outofBoundPointCount<n.offsets.length/2;let l=n.outofBoundPointCount===n.offsets.length/2||e&&r?[0,0]:o(n.offsets,s,a,h);const f=(l[0]+l[1])/2,m=t.projectedExtent.spatialReference,d=t.srcBufferExtent.spatialReference;if(e&&(r||f>h)&&(i(m,d,t.datumTransformation)&&(m.isGeographic||D(m)),a=[u,u],n=j({...t,spacing:a}),s={cols:n.size[0]+1,rows:n.size[1]+1},l=o(n.offsets,s,a,h)),n.error=l,a[0]>1&&(n.coefficients=B(n.offsets,s,r)),t.includeGCSGrid&&!m.isGeographic&&!m.isWebMercator)if(d.isGeographic)n.gcsGrid={offsets:n.offsets,coefficients:n.coefficients,spacing:a};else{const e=D(m);if(null!=e&&!e.isEnvelope){const e=W(m),i=k(t.projectedExtent,e),{offsets:o}=j({...t,srcBufferExtent:i,spacing:a}),l=B(o,s,r);n.gcsGrid={offsets:o,coefficients:l,spacing:a}}}return n}function j(t){const{projectedExtent:e,srcBufferExtent:a,pixelSize:n,datumTransformation:i,rasterTransform:o}=t,l=e.spatialReference,h=a.spatialReference,f=r(l,h),{xmin:m,ymin:p,xmax:y,ymax:x}=e,g=F(h),_=null!=g&&(t.hasWrapAround||"gcs-shift"===o?.type),w=t.spacing||[c,c],b=w[0]*n.x,M=w[1]*n.y,R=1===w[0],A=Math.ceil((y-m)/b-.1/w[0])+(R?0:1),P=Math.ceil((x-p)/M-.1/w[1])+(R?0:1),E=S({cols:A,rows:P,xmin:m,ymax:x,xres:b,yres:M,inSR:l,outSR:h,datumTransformation:i,preferPE:w[0]<=u,usePixelCenter:R}),C=[];let T,z=0;const k=R?-1:NaN,{xmin:O,xmax:I,ymax:N,width:V,height:U}=a,G=v(h,d),L=null!=g&&O>0&&I>g/2;let W=!1;if(f){const t=D(l);W=null!=t&&t.poleLocation>0}for(let r=0;r<A;r++){const t=[];for(let e=0;e<P;e++){let a=E[r*P+e];if(_&&a[0]>I&&a[0]>g/2-G?a[0]-=g:_&&0===r&&a[0]<0&&L&&!o&&(a[0]+=g),!a||isNaN(a[0])||isNaN(a[1]))C.push(k),C.push(k),t.push(null),z++;else{if(o){const t=o.inverseTransform(new s.D({x:a[0],y:a[1],spatialReference:h}));a=[t.x,t.y]}t.push(a),r>0&&_&&T[e]&&a[0]<T[e][0]&&(a[0]+=g,W&&a[0]>I&&a[0]>g&&(a[0]-=g)),C.push((a[0]-O)/V),C.push((N-a[1])/U)}}T=t}return{offsets:C,error:null,coefficients:null,outofBoundPointCount:z,spacing:w,size:R?[A,P]:[A-1,P-1]}}function B(t,e,a){const{cols:n,rows:s}=e,i=new Float32Array((n-1)*(s-1)*2*6),r=new Float32Array([-0,-1,1,-1,1,-0,1,-0,-0]),o=new Float32Array([-1,1,0,0,-1,1,1,0,0]);for(let l=0;l<n-1;l++){for(let e=0;e<s-1;e++){let a=l*s*2+2*e;const c=t[a],u=t[a+1],h=t[a+2],f=t[a+3];a+=2*s;const m=t[a],d=t[a+1],p=t[a+2],y=t[a+3];let x=0,g=12*(e*(n-1)+l);for(let t=0;t<3;t++)i[g++]=r[x++]*c+r[x++]*h+r[x++]*p;x=0;for(let t=0;t<3;t++)i[g++]=r[x++]*u+r[x++]*f+r[x++]*y;x=0;for(let t=0;t<3;t++)i[g++]=o[x++]*c+o[x++]*m+o[x++]*p;x=0;for(let t=0;t<3;t++)i[g++]=o[x++]*u+o[x++]*d+o[x++]*y}if(a)for(let t=0;t<i.length;t++)isNaN(i[t])&&(i[t]=-1)}return i}function H(t,e){const a=t.clone().normalize();return 1===a.length?a[0]:z(a,e)}function Q(t){const{spatialReference:e}=t,a=(0,s.b3)(e);if(!a)return t;const[n,i]=a.valid,r=i-n;let o=0;if(t.xmin<n){const e=n-t.xmin;o=Math.ceil(e/r)}else if(t.xmin>i){const e=t.xmin-i;o=-Math.ceil(e/r)}return new s.bn({spatialReference:t.spatialReference,xmin:t.xmin+o*r,ymin:t.ymin,xmax:t.xmax+o*r,ymax:t.ymax})}function Y(t,e,a){const{storageInfo:n,pixelSize:i}=e;let r=0,o=!1;const{pyramidResolutions:l}=n,c="mixed"===n.tileInfo.format?.toLowerCase()?Math.max(1,Math.min(3,n.tileInfo.dpi/96)):1,u=(t.x+t.y)/2/c;if(null!=l&&l.length){const t=l[l.length-1],n=(t.x+t.y)/2,c=(i.x+i.y)/2;if(u<=c)r=0;else if(u>=n)r=l.length,o=u/n>8;else{let t,e=c;for(let n=1;n<=l.length;n++){if(t=(l[n-1].x+l[n-1].y)/2,u<=t){u===t?r=n:"down"===a?(r=n-1,o=u/e>8):r="up"===a||u-e>t-u||u/e>2?n:n-1;break}e=t}}const h=0===r?i:l[r-1];return o&&Math.min(h.x,h.y)*(0,s.cm)(e.spatialReference)>19567&&(o=!1),{pyramidLevel:r,pyramidResolution:new s.D({x:h.x,y:h.y,spatialReference:e.spatialReference}),excessiveReading:o}}const h=Math.log(t.x/i.x)/Math.LN2,f=Math.log(t.y/i.y)/Math.LN2,m=e.storageInfo.maximumPyramidLevel||0;r="down"===a?Math.floor(Math.min(h,f)):"up"===a?Math.ceil(Math.max(h,f)):Math.round((h+f)/2),r<0?r=0:r>m&&(o=r>m+3,r=m);const d=2**r;return{pyramidLevel:r,pyramidResolution:new s.D({x:d*e.nativePixelSize.x,y:d*e.nativePixelSize.y,spatialReference:e.spatialReference}),excessiveReading:o}}function J(t,e){const{pixelSize:a,extent:n}=t,s=x(n,e,!1);return k(H(n,(a.x+a.y)/16),e,s)}function $(t,e,a){const n=a?.tileSize,i=a?.alignGlobalDatasetWithAGOL,{extent:r,spatialReference:o,pixelSize:l}=t,c=w(l,e,r);if(null==c)return{projectedPixelSize:null,scales:null,srcResolutions:null,isCustomTilingScheme:!1};const u=(c.x+c.y)/2,h=(0,s.cm)(e),f=u*h*96*39.37,m=e.isGeographic?256/n*295828763.7958547:256/n*591657527.591555;let d="vector-magdir"===t.dataType||"vector-uv"===t.dataType;const p=J(t,e),y=Math.min(Math.ceil(Math.log(Math.min(t.width,t.height)/32)/Math.LN2),Math.ceil(Math.log(m/2/f)/Math.LN2));if(!d&&i&&(e.isGeographic||e.isWebMercator)){const a=F(e);if(d=G(p)>0||null!=a&&p.width>a/4,!d&&null!=a){let e=-1;if(y<3)e=2**y*u*n;else if(t.storageInfo){const{maximumPyramidLevel:a=0,pyramidScalingFactor:s=2}=t.storageInfo;e=s**a*u*n}const s=Math.ceil(a/e);d=1===s||2===s&&a/2-p.xmax<e}}let x,g=f;const _=1.001,v=Math.min(2,Math.max(1.414,t.storageInfo?.pyramidScalingFactor||2));if(d){g=m;const a=e.isGeographic?1341104507446289e-21:.29858214164761665,n=a*(96*h*39.37),i=e.isGeographic?4326:3857;x=w({x:a,y:a},o,J(t,new s.aY({wkid:i}))),x.x*=g/n,x.y*=g/n}else{x={x:l.x,y:l.y};let t=0;for(;g<m*(_/2)&&t<y;)t++,g*=v,x.x*=v,x.y*=v;Math.max(g,m)/Math.min(g,m)<=_&&(g=m)}const b=[g],M=[{x:x.x,y:x.y}],S=70.5310735,R=Math.min(S,f)/_;for(;g>=R;)g/=v,x.x/=v,x.y/=v,b.push(g),M.push({x:x.x,y:x.y});return{projectedPixelSize:c,scales:b,srcResolutions:M,isCustomTilingScheme:!d}}},49707:function(t,e,a){a.d(e,{i:function(){return r}});var n=a(44444);function s(t){if(!t)return t;const{start:e,end:a}=t;return new n.fq({start:null!=e?(0,n.gI)(e,-e.getTimezoneOffset(),"minutes"):e,end:null!=a?(0,n.gI)(a,-a.getTimezoneOffset(),"minutes"):a})}function i(t){if(!t)return t;const{start:e,end:a}=t;return new n.fq({start:null!=e?(0,n.gI)(e,e.getTimezoneOffset(),"minutes"):e,end:null!=a?(0,n.gI)(a,a.getTimezoneOffset(),"minutes"):a})}function r(t,e,a){if(null==t?.timeInfo)return null;const{datesInUnknownTimezone:n=!1,timeOffset:r,useViewTime:o}=t;let l=t.timeExtent;n&&(l=i(l));let c=o?e&&l?e.intersection(l):e||l:l;return!c||c.isEmpty||c.isAllTime?c:(r&&(c=c.offset(-r.value,r.unit)),n&&(c=s(c)),c.equals(a)?a:c)}}}]);
//# sourceMappingURL=9224.94001239.js.map