{"version":3,"file":"js/4159.29cee5a2.js","mappings":"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","sources":["webpack://ramp-website/./node_modules/ramp-pcar/dist/esDynamic/KnowledgeGraphLayer-Cs2Un4Hx.js"],"sourcesContent":["import{ea as M,ee as T,eb as _,eq as D,ec as S,ed as L,ef as v,er as E,a8 as l,cc as N,eL as A,B as k,s as g,eM as y,eN as C,G as u,p as G,eD as I,eB as b,eE as R,bz as O,bt as o,bu as r,eg as U,eO as j,ej as z,bv as F,e4 as P,aw as K,ep as x}from\"./main-DCIX61zy.js\";import{u as p,c as w,E as B,F as H,R as $}from\"./KnowledgeGraphSublayer-VSk21z03.js\";import{F as q}from\"./knowledgeGraphService-BTB1M7Gx.js\";let n=class extends M(T(_(D(S(L(v(E(x)))))))){constructor(e){super(e),this._graphTypeLookup=new Map,this._namedTypesModified=!1,this.dataManager=null,this.definitionSetMap=null,this.knowledgeGraph=null,this.layers=new(l.ofType(p)),this.memberEntityTypes=null,this.memberRelationshipTypes=null,this.operationalLayerType=\"KnowledgeGraphLayer\",this.sublayerIdsCache=new Map,this.tables=new(l.ofType(p)),this.type=\"knowledge-graph\",this.url=null,this.addHandles(N(()=>this.layers.concat(this.tables),(t,i)=>this._handleSublayersChange(t,i),A))}load(e){return this.addResolvingPromise(this._doLoad(e)),Promise.resolve(this)}async _doLoad(e){try{await this.loadFromPortal({supportedTypes:[\"Knowledge Graph Layer\"]},e)}catch(t){k(t)}await this._fetchMetadata(),await this._initializeLayerProperties(),this.loadLayerAssumingLocalCache(),await w(this)}async _fetchMetadata(){if(!this.url)throw new g(\"knowledge-graph:missing-url\",\"KnowledgeGraphLayer must be created with a url\");const e=await q(this.url);this.knowledgeGraph=e,this._forEachGraphType(t=>{t.name&&this._graphTypeLookup.set(t.name,t)})}async _initializeLayerProperties(){this.originIdOf(\"inclusionModeDefinition\")===y.USER?this._validateInclusionModeDefinition():await this._initializeInclusionModeDefinition(),this._setMemberTypes(),this.dataManager=new B({knowledgeGraph:this.knowledgeGraph,inclusionModeDefinition:this.inclusionModeDefinition})}async _initializeInclusionModeDefinition(){const e=this.definitionSetMap?await H(this.definitionSetMap,!0):{generateAllSublayers:!0,namedTypeDefinitions:new Map};[...this.layers.toArray(),...this.tables.toArray()].forEach(t=>{const i=this._graphTypeLookup.get(t.graphTypeName);i&&!e.namedTypeDefinitions.has(i.name)&&e.namedTypeDefinitions.set(i.name,{useAllData:!0})}),this.setAtOrigin(\"inclusionModeDefinition\",e,C(this.originIdOf(\"definitionSetMap\")))}_validateInclusionModeDefinition(){const{inclusionModeDefinition:e}=this;if(!e)return;const{namedTypeDefinitions:t}=e;if(t?.size>0)t.forEach((i,a)=>{const s=this._graphTypeLookup.get(a);if(!s)return u.getLogger(this).warn(`A named type, ${a}, was in the inclusion list that wasn't in the data model and will be removed`),void t.delete(a);s.type!==\"relationship\"&&s.type!==\"entity\"&&(u.getLogger(this).warn(`A named type, ${a}, was in the inclusion list that wasn't properly modeled and will be removed`),t.delete(a))});else if(!e.generateAllSublayers)throw new g(\"knowledge-graph:composite-layer-constructor\",\"If an explicit inclusion definition is defined, at least one namedTypeDefinition must also be defined\")}_setMemberTypes(){let e=[],t=[];const{inclusionModeDefinition:i}=this,a=i?.namedTypeDefinitions;!i||i.generateAllSublayers?(e=this.knowledgeGraph.dataModel?.entityTypes??[],t=this.knowledgeGraph.dataModel?.relationshipTypes??[]):a&&a.size>0&&a.forEach((s,d)=>{const h=this._graphTypeLookup.get(d);switch(h?.type){case\"relationship\":t.push(h);break;case\"entity\":e.push(h)}}),this.memberEntityTypes=e,this.memberRelationshipTypes=t}_forEachGraphType(e){[...this.knowledgeGraph.dataModel?.entityTypes??[],...this.knowledgeGraph.dataModel?.relationshipTypes??[]].forEach(t=>{e(t)})}_refreshNamedTypes(){this._namedTypesModified=!0;for(const e of this.layers)e.emit(\"refresh\",{dataChanged:!0});for(const e of this.tables)e.emit(\"refresh\",{dataChanged:!0})}async _handleNewRecords(e){const t=[];this.dataManager.addToLayer(e);for(const i of e)this.sublayerIdsCache.has(i.typeName)||(this.sublayerIdsCache.set(i.typeName,new Set),t.push(i.typeName)),this.sublayerIdsCache.get(i.typeName).add(i.id);for(const i of t){const a=this._graphTypeLookup.get(i);a&&(this._addSublayer(a),a.type===\"entity\"?this.dataManager.entityTypeNames.add(i):this.dataManager.relationshipTypeNames.add(i),this.dataManager.sublayerCaches.set(i,new Map))}await w(this,t),this._refreshNamedTypes()}_createSublayers(e,t,i){e.forEach(a=>{const s=this._createSublayer(a);i(s)&&t.push(s),this._updateSublayerCaches(a)})}_addSublayer(e){const t=this._createSublayer(e);return t.geometryType?this.layers.push(t):this.tables.push(t),t}_createSublayer(e){return new p({objectType:e,parentCompositeLayer:this,graphType:e.type})}_updateSublayers(e,t){t.forEach(i=>{i.parentCompositeLayer=this;const a=e.find(s=>s.type===i.graphType&&s.name===i.graphTypeName);a&&(i.objectType=a,this._updateSublayerCaches(a))})}_updateSublayerCaches(e){const t=this.dataManager.sublayerCaches;t.has(e.name)||t.set(e.name,new Map)}_saveUrlAsNewResource(e,t,i,a){e[t]=\"<pending>\",i.pendingOperations.push(X(this.inclusionModeDefinition).then(s=>{const d=Y(a);e[t]=d.itemRelativeUrl,i.toAdd.push({resource:d,content:{type:\"blob\",blob:s},compress:!1,finish:h=>{this.definitionSetMap=h.url}})}))}_displaysAllRecords(e){for(const[,{useAllData:t}]of e.namedTypeDefinitions)if(!t)return!1;return!0}_handleSublayersChange(e,t){t&&(t.forEach(i=>{i.parent=null}),this.removeHandles(\"sublayers-owner\")),e&&(e.forEach(i=>{i.parent=this}),this.addHandles([e.on(\"after-add\",({item:i})=>{i.parent=this}),e.on(\"after-remove\",({item:i})=>{i.parent=null})],\"sublayers-owner\"))}readDefinitionSetMap(e,t,i){return G(e,i)}writeDefinitionSetMap(e,t,i,a){const s=a?.portalItem,d=a?.resources,h=I(a?.origin);if(!s||!d||h==null)return void(e&&(t[i]=b(e,a)));const{inclusionModeDefinition:f}=this;if(!f||this._displaysAllRecords(f))return void(this.definitionSetMap=null);const c=this.originIdOf(\"inclusionModeDefinition\");if(c===y.USER||this._namedTypesModified||h<c)this._saveUrlAsNewResource(t,i,d,s);else if(h===c&&e){const m=b(e,a);R(m)?this._saveUrlAsNewResource(t,i,d,s):t[i]=m}}set inclusionModeDefinition(e){this.loadStatus!==\"loaded\"&&this.loadStatus!==\"failed\"?this._set(\"inclusionModeDefinition\",e):u.getLogger(this).error(\"#inclusionModeDefinition\",\"inclusionModeDefinition cannot be changed after the layer is loaded.\")}loadLayerAssumingLocalCache(){const e=[...this.memberEntityTypes,...this.memberRelationshipTypes];this.originIdOf(\"layers\")===y.DEFAULTS?this._createSublayers(e,this.layers,t=>!!t.geometryType):this._updateSublayers(e,this.layers),this.originIdOf(\"tables\")===y.DEFAULTS?this._createSublayers(e,this.tables,t=>!t.geometryType):this._updateSublayers(e,this.tables),this.dataManager.inclusionModeDefinition?.namedTypeDefinitions?.forEach((t,i)=>{const a=O(this.sublayerIdsCache,i,()=>new Set);t.members?.forEach(s=>{a.add(s.id)})})}async addRecords(e){await this._handleNewRecords(e)}async removeRecords(e){const t=[];for(const i of e)this.dataManager.inclusionModeDefinition?.namedTypeDefinitions?.get(i.typeName)?.useAllData===!1&&this.dataManager.inclusionModeDefinition?.namedTypeDefinitions?.get(i.typeName)?.members?.has(i.id)&&t.push(i);this.dataManager.removeFromLayer(t);for(const i of t)this.sublayerIdsCache.get(i.typeName)?.delete(i.id);return this._refreshNamedTypes(),t}};o([r()],n.prototype,\"dataManager\",void 0),o([r({json:{write:{ignoreOrigin:!0,writerEnsuresNonNull:!0}}})],n.prototype,\"definitionSetMap\",void 0),o([U(\"definitionSetMap\")],n.prototype,\"readDefinitionSetMap\",null),o([j(\"definitionSetMap\")],n.prototype,\"writeDefinitionSetMap\",null),o([r()],n.prototype,\"inclusionModeDefinition\",null),o([r()],n.prototype,\"knowledgeGraph\",void 0),o([r({type:l.ofType(p),json:{write:{ignoreOrigin:!0}}})],n.prototype,\"layers\",void 0),o([r()],n.prototype,\"memberEntityTypes\",void 0),o([r()],n.prototype,\"memberRelationshipTypes\",void 0),o([r({type:[\"KnowledgeGraphLayer\"]})],n.prototype,\"operationalLayerType\",void 0),o([r()],n.prototype,\"sublayerIdsCache\",void 0),o([r({type:l.ofType(p),json:{write:{ignoreOrigin:!0}}})],n.prototype,\"tables\",void 0),o([r({json:{read:!1}})],n.prototype,\"type\",void 0),o([r(z)],n.prototype,\"url\",void 0),n=o([F(\"esri.layers.KnowledgeGraphLayer\")],n);const V=n;async function X(e){const t=await $(e);return new Blob([t],{type:\"application/x-protobuf\"})}function Y(e){const t=`definitionSetMap-${P()}.dat`,i=K(\"knowledgeGraphLayer\",t);return e.resourceFromPath(i)}export{V as default};\n"],"names":["n","constructor","e","super","this","_graphTypeLookup","Map","_namedTypesModified","dataManager","definitionSetMap","knowledgeGraph","layers","ofType","memberEntityTypes","memberRelationshipTypes","operationalLayerType","sublayerIdsCache","tables","type","url","addHandles","concat","t","i","_handleSublayersChange","load","addResolvingPromise","_doLoad","Promise","resolve","loadFromPortal","supportedTypes","_fetchMetadata","_initializeLayerProperties","loadLayerAssumingLocalCache","_forEachGraphType","name","set","originIdOf","USER","_validateInclusionModeDefinition","_initializeInclusionModeDefinition","_setMemberTypes","inclusionModeDefinition","generateAllSublayers","namedTypeDefinitions","toArray","forEach","get","graphTypeName","has","useAllData","setAtOrigin","size","a","s","getLogger","warn","delete","dataModel","entityTypes","relationshipTypes","d","h","push","_refreshNamedTypes","emit","dataChanged","_handleNewRecords","addToLayer","typeName","Set","add","id","_addSublayer","entityTypeNames","relationshipTypeNames","sublayerCaches","_createSublayers","_createSublayer","_updateSublayerCaches","geometryType","objectType","parentCompositeLayer","graphType","_updateSublayers","find","_saveUrlAsNewResource","pendingOperations","X","then","Y","itemRelativeUrl","toAdd","resource","content","blob","compress","finish","_displaysAllRecords","parent","removeHandles","on","item","readDefinitionSetMap","writeDefinitionSetMap","portalItem","resources","origin","f","c","m","loadStatus","_set","error","DEFAULTS","members","addRecords","removeRecords","removeFromLayer","prototype","json","write","ignoreOrigin","writerEnsuresNonNull","read","V","async","Blob","resourceFromPath"],"sourceRoot":""}